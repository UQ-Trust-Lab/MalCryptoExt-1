{"version":3,"sources":["webpack:///./src/common/delay.js","webpack:///./src/background/services/autoFillInit.js","webpack:///./src/background/executeInstructions.js","webpack:///./src/background/getCredentialsFromInstructions.js","webpack:///./src/background/getSsoInstructionsForItem.js"],"names":["delay","t","Promise","resolve","setTimeout","autoFillInit","item","newTab","submit","port","store","autoFill","tabId","sender","tab","id","console","debug","data","getSsoInstructionsForItem","process","instructions","url","JSON","parse","browser","tabs","create","executeInstructions","username","password","otp","getCredentialsFromInstructions","update","publish","timeout","Date","now","executeInstruction","type","frameId","cookies","remove","name","executeScript","code","time","message","dto","redirectUrl","filter","i","map","test","split","tracker","isShared","checkTrackerForSharedAccount","checkTrackerForPublicUserAccount","getSsoInstructionsForSharedItem","epmAppSettings","applicationId","appId","companyUserAccountId","accId","getSsoInstructionsForEpmAccount","getSsoInstructions"],"mappings":"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","file":"16.js","sourcesContent":["const delay = t => new Promise(resolve => setTimeout(resolve, t));\n\nexport default delay;\n","import executeInstructions from '../executeInstructions';\nimport getCredentialsFromInstructions from '../getCredentialsFromInstructions';\nimport getSsoInstructionsForItem from '../getSsoInstructionsForItem';\nimport { publish, store } from '../store';\n\nconst autoFillInit = async ({ item, newTab, submit }, port) => {\n  if (!submit && store.autoFill.tabId === port.sender.tab.id) {\n    console.debug('auto-login already in progress. will not override.');\n    return;\n  }\n\n  const data = await getSsoInstructionsForItem(item);\n\n  // firefox and opera do not allow executing js coming from server.\n  // this block will only be included in chrome build. it will be dropped from\n  // non-chrome builds because it evaluates to `if (false)`.\n  if (process.env.BROWSER === 'chrome' && submit && data.instructions) {\n    const { instructions, url } = JSON.parse(data.instructions);\n    const tab =\n      newTab === true ? await browser.tabs.create({ url }) : port.sender.tab;\n    await executeInstructions(instructions, tab.id);\n    return;\n  }\n\n  const { url, username, password, otp } = getCredentialsFromInstructions(data);\n  const tab =\n    newTab === true ? await browser.tabs.create({ url }) : port.sender.tab;\n  if (newTab === 'redirect') await browser.tabs.update(tab.id, { url });\n  publish({\n    autoFill: {\n      otp,\n      password,\n      submit,\n      tabId: tab.id,\n      timeout: Date.now() + 60 * 1000,\n      username,\n    },\n  });\n};\n\nexport default autoFillInit;\n","// fixme:\n//   firefox and opera users will not benefit from this script because this file\n//   is included only in chrome build.\n//   browser.tabs.executeScript is executing js coming from server, and\n//   considered insecure. that makes sense, because if we could execute\n//   arbitrary scripts, then there would be no point in reviewing extensions.\n// todo:\n//   it is possible to make all instructions like REDIRECT, REMOVE_COOKIE, and\n//   TIME_OUT which come with params instead of arbitrary scripts.\n\nimport delay from '../common/delay';\n\nconst executeInstruction = async (type, data, tabId, frameId) => {\n  switch (type) {\n    case 'REDIRECT':\n      return browser.tabs.update(tabId, { url: data.url });\n    case 'REMOVE_COOKIE':\n      return browser.cookies.remove({ url: data.url, name: data.name });\n    case 'POPULATE_ELEMENT':\n      await delay(500);\n      return browser.tabs.executeScript(tabId, { code: data.code, frameId });\n    case 'SUBMIT':\n      return browser.tabs.executeScript(tabId, { code: data.code, frameId });\n    case 'REMEMBER_ME':\n      return browser.tabs.executeScript(tabId, { code: data.code, frameId });\n    case 'TIME_OUT':\n      return delay(data.time);\n    default:\n      throw { message: 'Unknown instruction type', type, tabId, data };\n  }\n};\n\nconst executeInstructions = async (instructions, tabId, frameId) => {\n  for (const { type, data } of instructions) {\n    await executeInstruction(type, data, tabId, frameId);\n  }\n};\n\nexport default executeInstructions;\n","// com.saaspass.web.rest.extension.dto.AuthenticatorInstructionsDTO\nconst getCredentialsFromInstructions = dto => {\n  if (!dto.instructions) {\n    return dto;\n  }\n\n  const { instructions, url } = JSON.parse(dto.instructions);\n  const [redirectUrl] = instructions\n    .filter(i => i.type === 'REDIRECT')\n    .map(i => i.data.url);\n  const [username, password, otp] = instructions\n    .filter(i => i.type === 'POPULATE_ELEMENT')\n    .map(i => i.data.code)\n    .filter(code => /\\.value\\s*=/.test(code))\n    .map(code => code.split(/\\.value\\s*=\\s*/)[1].split(/'/)[1]);\n  return { url: redirectUrl || url, username, password, otp };\n};\n\nexport default getCredentialsFromInstructions;\n","import {\n  checkTrackerForPublicUserAccount,\n  checkTrackerForSharedAccount,\n  getSsoInstructions,\n  getSsoInstructionsForEpmAccount,\n  getSsoInstructionsForSharedItem,\n} from './rest/SaaspassExtensionResource';\n\nconst getSsoInstructionsForItem = item => {\n  if (item.tracker && item.isShared) {\n    return checkTrackerForSharedAccount(item.tracker);\n  } else if (item.tracker) {\n    return checkTrackerForPublicUserAccount(item.tracker);\n  } else if (item.isShared) {\n    return getSsoInstructionsForSharedItem(item.id);\n  } else if (item.epmAppSettings) {\n    const { applicationId: appId, companyUserAccountId: accId } = item;\n    return getSsoInstructionsForEpmAccount(appId, accId);\n  } else {\n    return getSsoInstructions(item.id);\n  }\n};\n\nexport default getSsoInstructionsForItem;\n"],"sourceRoot":""}