/*!
 * 
 * Copyright 2021 NAVER Corp. All Rights reserved.
 * All rights, including but not limited to, copyrights,
 * and intellectual property rights of this source code are owned by NAVER Corp.
 * 
 * You may not use, reproduce, modify, or distribute this source code
 * without prior written permission from NAVER Corp.
 * 
 */!function(e){var t={};function n(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(a,s,function(t){return e[t]}.bind(null,s));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t){e.exports=function(){"use strict";const e={},{whale:t}=window;if(!t||!t.runtime||!t.runtime.onMessage)return!1;return t.runtime.onMessage.addListener((function(t,n,a){t.namespace&&Array.isArray(e[t.namespace])&&e[t.namespace].forEach(e=>{e(t.message,n,a)});return!0})),{broadcast:function(e,n){if(!t.tabs)return new Promise((e,t)=>{t()});const a=[];return t.tabs.query({},s=>{s.forEach(s=>{a.push(new Promise(a=>{t.tabs.sendMessage(s.id,{namespace:e,message:n},e=>{t.runtime.lastError,a(e)})}))})}),Promise.all(a)},listen:function(t,n){e[t]=e[t]||[],e[t].push(n)},send:function(e,n,a,s){return new Promise(r=>{void 0!==a&&a>-1?t.tabs.sendMessage(a,{namespace:e,message:n},void 0!==s&&s>-1?{frameId:s}:{},e=>{t.runtime.lastError,r(e)}):t.runtime.sendMessage({namespace:e,message:n},e=>{t.runtime.lastError,r(e)})})}}}()},function(e,t,n){"use strict";var a=n(2);const s=["ko","en","ja","zh-CN"];t.a={detect:(e,t)=>new Promise(async n=>{const s=new FormData;s.append("image",e),s.append("lang",t);const r=await Object(a.a)("https://apis.naver.com/whale/papago/ocr/detect"),o=new XMLHttpRequest;o.open("POST",r),o.onload=function(){n((e=>{const t=(e=>{const t=[];return void 0===e||0===e.length?[{failed:!0}]:(e.forEach(e=>{if(void 0!==e.text)if(t.length>=1&&((e,t)=>t.LT.y-10<=e.y&&t.LB.y+10>=e.y)(t[t.length-1],e)){const n=t.pop();t.push({x:n.x,y:n.y,width:e.RB.x-n.x,height:e.RB.y-n.y,text:`${n.text} ${e.text}`})}else t.push({x:e.LT.x,y:e.LT.y,width:e.RB.x-e.LT.x,height:e.RB.y-e.LT.y,text:e.text})}),t)})(JSON.parse(e).ocrs);if(!t||0===t.length)return null;if(t[0]&&t[0].failed)return null;const n=[];return t.forEach(e=>{n.push(e.text)}),n})(this.response))},o.send(s)}),isSupportedLanguage:e=>s.includes(e),getSupportedLanguages:()=>s}},function(e,t,n){"use strict";function a(e){return new Promise((t,n)=>{whale&&whale.utility&&whale.utility.getHmacURL?whale.utility.getHmacURL(e,e=>{t(e)}):n()})}n.d(t,"a",(function(){return a}))},,function(e,t,n){"use strict";var a=n(2);const s="https://apis.naver.com/whale/papago/nsmt/translate",r="https://apis.naver.com/whale/papago/n2mt/translate",o=["ko","en","ja","zh-CN","es","fr","de","ru","vi","th","id","it","pt","hi"],i=["ko","en","ja","zh-CN","es","fr","de","ru","vi","th","id","it"],u={sources:o},c=()=>{u.targets||(u.targets={},o.forEach(e=>{["pt","hi"].includes(e)?u.targets[e]=["en"]:u.targets[e]="en"===e?o.filter(t=>t!==e):o.filter(t=>!["pt","hi",e].includes(t))})),u.nmt||(u.nmt={},i.forEach(e=>{u.nmt[e]=i.filter(t=>t!==e)}))},d=()=>(c(),u),l=(e,t)=>(c(),t?u.sources.includes(e)&&u.targets[e].includes(t):u.sources.includes(e));t.a={run:async(e,t,n)=>{if(0===(n||"").trim().length)return n;if(e===t)throw!1;if(!l(e,t))throw!1;const o=await(async(e,t)=>{const{nmt:n}=d(),o=n[e]&&n[e].includes(t);return await Object(a.a)(o?r:s)})(e,t),i=await fetch(o,{method:"post",mode:"cors",body:[`source=${e}`,`target=${t}`,`text=${encodeURIComponent(n)}`].join("&"),headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"})});if(!i.ok)throw!1;const u=await i.json();if(!u||!u.message||!u.message.result)throw!1;return u.message.result.translatedText},isSupported:l,getSupportedLanguages:d}},,,,,,,,,function(e,t,n){n(16),n(17),e.exports=n(14)},function(e,t){var n,a,s,r,o,i;n=window,a=document,s="script",r="ga",n.GoogleAnalyticsObject=r,n.ga=n.ga||function(){(n.ga.q=n.ga.q||[]).push(arguments)},n.ga.l=Number(new Date),o=a.createElement(s),i=a.getElementsByTagName(s)[0],o.async=1,o.src="https://www.google-analytics.com/analytics.js",o.addEventListener("load",()=>{whale.storage.local.get("GA_LOCAL_STORAGE_KEY",({GA_LOCAL_STORAGE_KEY:e})=>{e?ga("create","UA-103600426-13",{storage:"none",clientId:e}):ga("create","UA-103600426-13","auto"),ga(e=>{whale.storage.local.set({GA_LOCAL_STORAGE_KEY:e.get("clientId")})}),ga("set","checkProtocolTask",null)})}),i.parentNode.insertBefore(o,i)},,function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a);const r=(e,t)=>new Promise(n=>{const a=document.createElement("canvas");a.width=t.dwidth,a.height=t.dheight,a.getContext("2d").drawImage(e,t.sx,t.sy,t.swidth,t.sheight,t.dx,t.dy,t.dwidth,t.dheight),a.toBlob(e=>{(e=>{navigator.devBuild&&window.debug&&window.open(URL.createObjectURL(e))})(e),n(e)},"image/jpeg",1)});var o=async(e,t,n=1,a=1)=>{const s=await(o=e,new Promise(e=>{if(o.startsWith("data:image/")){const t=new Image;t.onload=()=>{e(t)},t.src=o}else{const t=new XMLHttpRequest;t.open("GET",o),t.responseType="blob",t.onload=()=>{const n=new Image;n.onload=()=>{e(n)},n.src=URL.createObjectURL(t.response)},t.send()}}));var o;const i=((e,t,n)=>{const a=e.width+6,s=e.height+6;return{sx:Math.round((e.x-3)*t),sy:Math.round((e.y-3)*n),swidth:Math.round(a*t),sheight:Math.round(s*n),dx:0,dy:0,dwidth:Math.round(a*t),dheight:Math.round(s*n)}})(t,n,a);return await r(s,i)},i=n(1),u=n(4);whale.contextMenus.create({id:"OCR",title:whale.i18n.getMessage("MENUITEM_TEXT"),contexts:["image"],onclick:(e,t)=>{const{srcUrl:n,frameId:a}=e;whale.windows.update(t.windowId,{focused:!0},()=>{whale.tabs.update(t.id,{active:!0},()=>{s.a.send("ocr.start",{srcUrl:n},t.id,a)})});try{const n=e.frameUrl||e.pageUrl||t.url;ga("send","pageview",new URL(n).origin)}catch(e){console.warn(e)}}}),s.a.listen("ocr.translate",async(e,t,n)=>{const{bound:a,imageUrl:s,scaleX:r,scaleY:c}=e,{srcLang:d,tarLang:l}=e,h=await o(s,a,r,c),f=await i.a.detect(h,d);if(f){const e=await u.a.run(d,l,f.join("\n"));n({texts:f,translated:e});try{ga("send","event","success",`${d} → ${l}`,s)}catch(e){console.warn(e)}}else{n({texts:null});try{ga("send","event","fail",`${d} → ${l}`,s)}catch(e){console.warn(e)}}}),s.a.listen("bubble",(e,t)=>{e.tabId=t.tab&&t.tab.id,s.a.send("bubble",e,e.tabId)}),s.a.listen("whomi",(e,t,n)=>{n(t)}),s.a.listen("frameRect",async(e,t,n)=>{var a,r;n(await Promise.race([await s.a.send("frameFind",e,t.tab.id,0),(a=1e3,new Promise((e,t)=>{setTimeout(()=>{t(r)},a)}))]))})},function(e,t,n){"use strict";n.r(t);const a=/。，；〈〉｛｝《》『』「」（）【】\x06\x07\x08\u3000/g,s={CJK:/[⺀-\u2efe\u3000-〾㇀-\u31ee㐀-\u4dbe一-\u9ffe豈-\ufafe]|[\ud840-\ud868\ud86a-\ud86c][\udc00-\udfff]|\ud869[\udc00-\udede\udf00-\udfff]|\ud86d[\udc00-\udf3e\udf40-\udfff]|\ud86e[\udc00-\udc1e]|\ud87e[\udc00-\ude1e]/g,ZH:/[\u3100-\u312f]/g,KO:/[ᄀ-\u11fe\u3130-ㆎ\ua960-\ua97e가-\ud7ae\ud7b0-\ud7fe]|[\uffa0-\uffdc]/g,JA:/[\u3040-ゞ゠-ヾㇰ-ㇾ]|\ud82c[\udc00-\udcfe|\uff65-\uff9d|\uff10-\uff19]/g},r=/^[\u0020-\u007F]+$/m;var o=n(0),i=n.n(o);const u=["ar","da","de","el","es","fa","fr","hi","hu","id","it","ja","ms","nl","pl","pt","ro","ru","sv","th","tr","vi","zh-CN","zh-TW"],c={nb:"no",fil:"tl","zh-HK":"zh-TW","zh-MO":"zh-TW","zh-SG":"zh-CN"},d={he:"iw",jv:"jw"},l={},h=e=>{if(e=f(e),!g(e))return"";const[t]=e.split("-");return c[e]||d[t]||e},f=(e="")=>{[e]=e.split(","),e=(e=e.replace(/\s/g,"")).replace(/_/g,"-");const[t,n]=e.split("-");return t&&n?`${t.toLowerCase()}-${n.toUpperCase()}`:e},g=e=>/[a-zA-Z]{2,3}(-[a-zA-Z]{2})?/.test(e),p=(e,t)=>new Promise(n=>{whale.i18n.detectLanguage(e,o=>{const[i]=(o.languages||[]).filter(e=>e&&e.percentage>75),u=i&&i.language||function(e,t,n){return e=e.replace(a,"").replace(/\s/g,""),r.test(e)?"en":s.KO.test(e)?"ko":s.JA.test(e)?"ja":s.ZH.test(e)?"zh":s.CJK.test(e)?n&&s.JA.test(n)||t&&("X-EUC"===(t=t.toUpperCase())||t.endsWith("JIS")||t.endsWith("JP")||t.includes("JA"))?"ja":"zh":void 0}(e,t);n(u)})});whale.webRequest.onCompleted.addListener(e=>{if(!Array.isArray(e.responseHeaders))return;const t=e.responseHeaders.find(e=>"content-language"===e.name.toLowerCase());t&&(l[e.url]=t.value)},{urls:["http://*/*","https://*/*"],types:["main_frame","sub_frame","xmlhttprequest"]}),i.a.listen("language",async(e,t,n)=>{const a=e.htmlLang||"",s=l[e.url]||"",r=await p(e.content,e.charset)||"",o=h(a)||h(s)||"";let i;if(o?o.startsWith("zh")&&r.startsWith("zh")?i=r:o.substr(0,2)===r.substr(0,2)?i=o:o.startsWith("en")&&u[r]&&(i=r):i=r,!i){const t=await p(e.meta.repeat(3),e.charset)||"";o.substr(0,2)===t.substr(0,2)&&(i=o)}i&&i.startsWith("zh")&&(i="zh-CN"),n(i)})}]);