(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{106:function(e,t,r){"use strict";r.d(t,"e",(function(){return n})),r.d(t,"g",(function(){return s})),r.d(t,"d",(function(){return o})),r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return d})),r.d(t,"f",(function(){return l}));var a=r(179);async function n(e){return Object(a.e)(e)}async function s(e){return Object(a.g)(e)}async function o(e){return Object(a.d)(e)}async function i(e){return Object(a.a)(e)}async function c(e){return Object(a.b)(e)}async function d(e){return Object(a.c)(e)}async function l(e){return Object(a.f)(e)}},107:function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"d",(function(){return b})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return I}));var a=r(11),n=r.n(a),s=r(8),o=r.n(s),i=r(37),c=r.n(i),d=r(1),l=r.n(d),u=r(16),p=r(25),h=r(152),f=r(76);const w=function(e){if(null==e)throw new Error("getOrThrow no tx part found. Should never happen");return e};class g{static async getIOsForTx(e,t,r){var a,n;const s=await g.depTables.AssociateTxWithUtxoIOs.getIOsForTx(e,t,{txs:r.txs}),i=await g.depTables.AssociateToken.join(e,t,{listIds:c()(a=r.txs).call(a,e=>{var t,r;const a=w(s.get(e));return[...o()(t=a.utxoInputs).call(t,e=>e.TokenListId),...o()(r=a.utxoOutputs).call(r,e=>e.TokenListId)]}),networkId:r.networkId});return o()(n=r.txs).call(n,e=>({txType:u.n.CardanoByron,transaction:e,...w(s.get(e)),tokens:o()(i).call(i,e=>({TokenList:e.TokenList,Token:{TokenId:e.Token.TokenId,Identifier:e.Token.Identifier,NetworkId:e.Token.NetworkId}}))}))}}l()(g,"ownTables",n()({})),l()(g,"depTables",n()({AssociateTxWithUtxoIOs:f.a,AssociateToken:p.a}));class b{static async getIOsForTx(e,t,r){var a,n,s;if(0===r.txs.length)return[];const{depTables:i}=b,d=await i.AssociateTxWithAccountingIOs.getIOsForTx(e,t,{txs:r.txs}),l=await i.AssociateTxWithUtxoIOs.getIOsForTx(e,t,{txs:r.txs}),p=await i.AssociateToken.join(e,t,{listIds:c()(a=r.txs).call(a,e=>{var t,r,a,n;const s=w(l.get(e)),i=w(d.get(e));return[...o()(t=s.utxoInputs).call(t,e=>e.TokenListId),...o()(r=s.utxoOutputs).call(r,e=>e.TokenListId),...o()(a=i.accountingInputs).call(a,e=>e.TokenListId),...o()(n=i.accountingOutputs).call(n,e=>e.TokenListId)]}),networkId:r.networkId}),h=await i.GetCertificates.forTransactions(e,t,{txIds:o()(n=r.txs).call(n,e=>e.TransactionId)});return o()(s=r.txs).call(s,e=>{var t;return{txType:u.n.Jormungandr,transaction:e,certificates:null!==(t=h.get(e.TransactionId))&&void 0!==t?t:[],...w(l.get(e)),...w(d.get(e)),tokens:o()(p).call(p,e=>({TokenList:e.TokenList,Token:{TokenId:e.Token.TokenId,Identifier:e.Token.Identifier,NetworkId:e.Token.NetworkId}}))}})}}l()(b,"ownTables",n()({})),l()(b,"depTables",n()({AssociateTxWithAccountingIOs:h.a,AssociateTxWithUtxoIOs:f.a,GetCertificates:p.d,AssociateToken:p.a}));class y{static async getIOsForTx(e,t,r){var a,n,s;const{depTables:i}=y,d=await i.AssociateTxWithUtxoIOs.getIOsForTx(e,t,{txs:r.txs}),l=await i.AssociateTxWithAccountingIOs.getIOsForTx(e,t,{txs:r.txs}),p=await i.GetCertificates.forTransactions(e,t,{txIds:o()(a=r.txs).call(a,e=>e.TransactionId)}),h=await g.depTables.AssociateToken.join(e,t,{listIds:c()(n=r.txs).call(n,e=>{var t,r,a,n;const s=w(d.get(e)),i=w(l.get(e));return[...o()(t=s.utxoInputs).call(t,e=>e.TokenListId),...o()(r=s.utxoOutputs).call(r,e=>e.TokenListId),...o()(a=i.accountingInputs).call(a,e=>e.TokenListId),...o()(n=i.accountingOutputs).call(n,e=>e.TokenListId)]}),networkId:r.networkId});return o()(s=r.txs).call(s,e=>{var t;return{txType:u.n.CardanoShelley,transaction:e,certificates:null!==(t=p.get(e.TransactionId))&&void 0!==t?t:[],...w(d.get(e)),accountingInputs:w(l.get(e)).accountingInputs,tokens:o()(h).call(h,e=>({TokenList:e.TokenList,Token:{TokenId:e.Token.TokenId,Identifier:e.Token.Identifier,NetworkId:e.Token.NetworkId}}))}})}}l()(y,"ownTables",n()({})),l()(y,"depTables",n()({AssociateTxWithUtxoIOs:f.a,GetCertificates:p.d,AssociateTxWithAccountingIOs:h.a,AssociateToken:p.a}));class I{static async getIOsForTx(e,t,r){var a,n;const s=await I.depTables.AssociateTxWithUtxoIOs.getIOsForTx(e,t,{txs:r.txs}),i=await g.depTables.AssociateToken.join(e,t,{listIds:c()(a=r.txs).call(a,e=>{var t,r;const a=w(s.get(e));return[...o()(t=a.utxoInputs).call(t,e=>e.TokenListId),...o()(r=a.utxoOutputs).call(r,e=>e.TokenListId)]}),networkId:r.networkId});return o()(n=r.txs).call(n,e=>{const t=w(s.get(e));return{txType:u.n.Ergo,transaction:e,...t,tokens:o()(i).call(i,e=>({TokenList:e.TokenList,Token:{TokenId:e.Token.TokenId,Identifier:e.Token.Identifier,NetworkId:e.Token.NetworkId}}))}})}}l()(I,"ownTables",n()({})),l()(I,"depTables",n()({AssociateTxWithUtxoIOs:f.a,AssociateToken:p.a}))},117:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return u})),r.d(t,"d",(function(){return p})),r.d(t,"f",(function(){return h})),r.d(t,"e",(function(){return f})),r.d(t,"c",(function(){return w}));var a=r(84),n=r.n(a),s=r(92),o=r.n(s),i=r(167),c=r(307),d=r(6);const l=()=>Object(i.generateMnemonic)(160).split(" "),u=t=>{const r=Object(i.mnemonicToSeedSync)(t),a=c.createHmac("sha256",e.from("ed25519 seed","utf8")).update(n()(e).call(e,[e.of(1),r],1+r.length)).digest(),[s,l]=(t=>{let r,a,n,s=t;do{r=c.createHmac("sha512",e.from("ed25519 seed","utf8")).update(s).digest(),s=r,a=o()(r).call(r,0,32),n=o()(r).call(r,32)}while(0!=(32&a[31]));return[a,n]})(r);s[0]&=248,s[31]&=63,s[31]|=64;const u=n()(e).call(e,[s,l,a],s.length+l.length+a.length);return d.a.WalletV4.Bip32PrivateKey.from_bytes(u)};function p(t){const r=Object(i.mnemonicToEntropy)(t),a=e.from("");return d.a.WalletV4.Bip32PrivateKey.from_bip39_entropy(e.from(r,"hex"),a)}function h(e){const t=d.a.WalletV2.Entropy.from_english_mnemonics(e);return d.a.WalletV2.DaedalusWallet.recover(t)}function f(e){const t=d.a.WalletV2.PrivateKey.from_hex(e);return d.a.WalletV2.DaedalusWallet.new(t)}function w(){const t=Object(i.generateMnemonic)(160),r=Object(i.mnemonicToEntropy)(t),a=e.from("");return d.a.WalletV4.Bip32PrivateKey.from_bip39_entropy(e.from(r,"hex"),a)}}).call(this,r(48).Buffer)},118:function(e,t,r){"use strict";function a(e,t){let r=void 0===t?2166136261:t;for(let t=0,a=e.length;t<a;t++)r^=e.charCodeAt(t),r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24);return r>>>0}function n(e,t){const r=new ArrayBuffer(8),n=new DataView(r),s=a(e,t),o=a(s.toString(16)+e,t),i=s&~(1<<20);return n.setInt32(0,i),n.setInt32(4,o),n.getFloat64(0)}r.d(t,"a",(function(){return n}))},119:function(e,t,r){"use strict";r.d(t,"e",(function(){return b})),r.d(t,"b",(function(){return y})),r.d(t,"a",(function(){return I})),r.d(t,"f",(function(){return v})),r.d(t,"d",(function(){return T})),r.d(t,"c",(function(){return m})),r.d(t,"g",(function(){return x}));var a=r(11),n=r.n(a),s=r(31),o=r.n(s),i=r(55),c=r.n(i),d=r(1),l=r.n(d),u=r(22),p=r(65),h=r(15),f=r(86),w=r(16),g=r(62);class b{static async overrideLastSyncInfo(e,t,r){return await Object(h.d)(e,t,r,b.ownTables[p.c.name].name)}static async create(e,t){return await Object(h.c)(e,t,{BlockHash:null,SlotNum:null,Height:0,Time:null},b.ownTables[p.c.name].name)}static async remove(e,t,r){await Object(h.n)(e,t,b.ownTables[p.c.name].name,b.ownTables[p.c.name].properties.LastSyncInfoId,r)}}l()(b,"ownTables",n()({[p.c.name]:p.c})),l()(b,"depTables",n()({}));class y{static async delete(e,t,r){await Object(h.n)(e,t,y.ownTables[w.m.name].name,y.ownTables[w.m.name].properties.TransactionId,r.txIds);const a=await y.depTables.GetLastSyncForPublicDeriver.forId(e,t,r.publicDeriverId);await y.depTables.ModifyLastSyncInfo.overrideLastSyncInfo(e,t,{LastSyncInfoId:a.LastSyncInfoId,BlockHash:null,SlotNum:null,Height:0,Time:null})}}l()(y,"ownTables",n()({[w.m.name]:w.m})),l()(y,"depTables",n()({ModifyLastSyncInfo:b,GetLastSyncForPublicDeriver:f.d}));class I{static async add(e,t,r){var a;const n=await I.depTables.AddDerivation.add(e,t,r.addLevelRequest,c()(o()(a=r.derivationTables).call(a)),r.levelSpecificTableName),s=await b.create(e,t);return{publicDeriverResult:await Object(h.c)(e,t,r.addPublicDeriverRequest({derivationId:n.KeyDerivation.KeyDerivationId,lastSyncInfoId:s.LastSyncInfoId}),I.ownTables[p.d.name].name),levelResult:n}}}l()(I,"ownTables",n()({[p.d.name]:p.d})),l()(I,"depTables",n()({AddDerivation:g.a,ModifyLastSyncInfo:b}));class v{static async rename(e,t,r){const a=e.getSchema().table(v.ownTables[p.d.name].name),n=e.update(a).set(a[p.d.properties.Name],r.newName).where(u.op.and(a[p.d.properties.PublicDeriverId].eq(r.pubDeriverId)));await t.attach(n)}}l()(v,"ownTables",n()({[p.d.name]:p.d})),l()(v,"depTables",n()({}));class T{static async add(e,t,r){return await Object(h.c)(e,t,r,T.ownTables[p.b.name].name)}}l()(T,"ownTables",n()({[p.b.name]:p.b})),l()(T,"depTables",n()({}));class m{static async add(e,t,r){return await Object(h.c)(e,t,r,m.ownTables[p.a.name].name)}static async remove(e,t,r){const a=m.ownTables[p.a.name];await Object(h.n)(e,t,a.name,a.properties.ConceptualWalletId,r)}static async rename(e,t,r){const a=e.getSchema().table(m.ownTables[p.a.name].name),n=e.update(a).set(a[p.a.properties.Name],r.newName).where(u.op.and(a[p.a.properties.ConceptualWalletId].eq(r.walletId)));await t.attach(n)}}l()(m,"ownTables",n()({[p.a.name]:p.a})),l()(m,"depTables",n()({}));class x{static async remove(e,t,r){const a=await x.depTables.GetPublicDeriver.get(e,t,r.publicDeriverId);if(null==a)throw new h.a("RemovePublicDeriver::remove");await Object(h.n)(e,t,x.ownTables[p.d.name].name,x.ownTables[p.d.name].properties.PublicDeriverId,[r.publicDeriverId]),await x.depTables.RemoveKeyDerivationTree.remove(e,t,{rootKeyId:a.KeyDerivationId}),await x.depTables.ModifyLastSyncInfo.remove(e,t,[a.LastSyncInfoId])}}l()(x,"ownTables",n()({[p.d.name]:p.d})),l()(x,"depTables",n()({GetPublicDeriver:f.e,RemoveKeyDerivationTree:g.l,ModifyLastSyncInfo:b}))},120:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o}));var a=r(11),n=r.n(a);const s=n()({BIP32ED25519:0,BIP32:1}),o=n()({Public:0,Private:1})},130:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return k})),r.d(t,"b",(function(){return O})),r.d(t,"c",(function(){return S}));var a=r(56),n=r.n(a),s=r(32),o=r.n(s),i=r(34),c=r.n(i),d=r(35),l=r.n(d),u=r(30),p=r.n(u),h=r(8),f=r.n(h),w=r(55),g=r.n(w),b=r(11),y=r.n(b),I=r(62),v=r(25),T=r(6),m=r(21),x=r(60),A=r(15);function k(e){return async t=>{var r;const a=y()({GetAddress:v.b,ModifyAddress:I.d}),n=g()(Object(A.h)(...f()(r=p()(a)).call(r,e=>a[e]))),s=new l.a(t.lockedTables);for(const e of n)if(!s.has(e))throw new Error("rawGenAddByHash missing lock on "+e);const o=await a.GetAddress.getByHash(t.db,t.tx,[t.address.data]);for(const t of o)if(e.has(t.AddressId))return;const i=await a.ModifyAddress.addFromCanonicalByHash(t.db,t.tx,[{...t.address,keyDerivationId:t.keyDerivationId}]);for(const t of i)e.add(t.AddressId)}}async function D(e,t,r,a,n,s,o,i){var d;const l=c()(d=await r.GetAddress.getByHash(e,t,[i])).call(d,e=>n.has(e.AddressId));if(l.length>1)throw new Error("addFromCanonical Should never happen multi-match");if(0===l.length)a.push(s);else{const a=await r.GetAddress.getKeyForFamily(e,t,l[0].AddressId);if(null==a)throw new Error("addFromCanonical Should never happen no mapping");const i=await r.ModifyAddress.addFromCanonicalByHash(e,t,[{keyDerivationId:a,data:s.data,type:s.type}]);o.set(s.data,i[0].AddressId),n.add(i[0].AddressId)}}function O(e){return async t=>{var r;const a=y()({GetAddress:v.b}),n=g()(Object(A.h)(...f()(r=p()(a)).call(r,e=>a[e]))),s=new l.a(t.lockedTables);for(const e of n)if(!s.has(e))throw new Error("rawGenFindOwnAddress missing lock on "+e);const o=await a.GetAddress.getByHash(t.db,t.tx,[t.hash]);for(const t of o)if(e.has(t.AddressId))return t.AddressId}}function S(t,r){return async a=>{var s;const i=y()({GetAddress:v.b,ModifyAddress:I.d}),d=g()(Object(A.h)(...f()(s=p()(i)).call(s,e=>i[e]))),u=new l.a(a.lockedTables);for(const e of d)if(!u.has(e))throw new Error("rawGenHashToIdsFunc missing lock on "+e);const h=g()(new l.a(a.hashes)),w=await i.GetAddress.getByHash(a.db,a.tx,h),b=o()(w).call(w,(e,t)=>{const r=e.get(t.Hash)||[];return e.set(t.Hash,[...r,t]),e},new n.a),k=[],O=new n.a;for(const e of h)if(b.has(e)){const r=b.get(e);if(null==r)throw new Error("should never happen");const a=c()(r).call(r,e=>t.has(e.AddressId));if(a.length>1)throw new Error("rawGenHashToIdsFunc Address associated multiple times with same wallet");if(1===a.length){O.set(e,a[0].AddressId);continue}k.push(e)}else k.push(e);const S=[],E=f()(k).call(k,e=>({data:e,type:Object(x.b)(e,"bytes",r)}));for(const r of E)if(r.type===m.b.CARDANO_BASE){const n=T.a.WalletV4.Address.from_bytes(e.from(r.data,"hex")),s=T.a.WalletV4.BaseAddress.from_address(n);if(null==s)throw new Error("rawGenHashToIdsFunc not base address Should never happen");const o=T.a.WalletV4.EnterpriseAddress.new(n.network_id(),s.payment_cred()),c=e.from(o.to_address().to_bytes()).toString("hex");await D(a.db,a.tx,i,S,t,r,O,c)}else if(r.type===m.b.CARDANO_PTR){const n=T.a.WalletV4.Address.from_bytes(e.from(r.data,"hex")),s=T.a.WalletV4.PointerAddress.from_address(n);if(null==s)throw new Error("rawGenHashToIdsFunc not ptr address Should never happen");const o=T.a.WalletV4.EnterpriseAddress.new(n.network_id(),s.payment_cred()),c=e.from(o.to_address().to_bytes()).toString("hex");await D(a.db,a.tx,i,S,t,r,O,c)}else if(r.type===m.b.JORMUNGANDR_GROUP){const n=T.a.WalletV3.Address.from_bytes(e.from(r.data,"hex")),s=n.to_group_address();if(null==s)throw new Error("rawGenHashToIdsFunc Should never happen");const o=T.a.WalletV3.Address.single_from_public_key(s.get_spending_key(),n.get_discrimination()),c=e.from(o.as_bytes()).toString("hex");await D(a.db,a.tx,i,S,t,r,O,c)}else S.push(r);const P=await i.ModifyAddress.addForeignByHash(a.db,a.tx,S);for(let e=0;e<S.length;e++)O.set(S[e].data,P[e].AddressId);return O}}}).call(this,r(48).Buffer)},1300:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return F}));var a=r(90),n=r.n(a),s=r(58),o=r.n(s),i=r(32),c=r.n(i),d=r(68),l=r.n(d),u=r(34),p=r.n(u),h=r(40),f=r.n(h),w=r(123),g=r.n(w),b=r(8),y=r.n(b),I=r(29),v=r.n(I),T=r(10),m=r(341),x=r(456),A=(r(77),r(843)),k=r(23),D=r(17),O=r(131),S=r(166),E=r(19),P=r(660),C=r(138),_=r(50),G=r(1301),W=r(311),N=r(117),j=r(493),R=r(710),B=r(20),K=r(21),U=r(134),L=r(173),M=r(38);class F{static isValidMnemonic(e){return Object(m.a)(e.mnemonic,e.numberOfWords)}async getTransactionRowsToExport(e){try{const t=await Object(W.a)({publicDeriver:e.publicDeriver});return T.a.debug("ErgoApi::getTransactionRowsToExport: success"),Object(j.b)(t.txs,e.getDefaultToken(e.publicDeriver.getParent().getNetworkInfo().NetworkId))}catch(e){if(T.a.error("ErgoApi::getTransactionRowsToExport: "+Object(T.d)(e)),e instanceof D.b)throw e;throw new k.d}}async refreshTransactions(e){T.a.debug(`ErgoApi::refreshTransactions called: ${Object(T.c)(e)}`);const{skip:t=0,limit:r}=e;try{var a;e.isLocalRequest||await Object(W.f)(e.publicDeriver.getDb(),e.publicDeriver,e.checkAddressesInUse,e.getTransactionsHistoryForAddresses,e.getAssetInfo,e.getBestBlock);const n=await Object(W.a)({publicDeriver:e.publicDeriver,skip:t,limit:r});T.a.debug("ErgoApi::refreshTransactions success: "+Object(T.c)(n));const s=y()(a=n.txs).call(a,t=>A.a.fromAnnotatedTx({tx:t,addressLookupMap:n.addressLookupMap,network:e.publicDeriver.getParent().getNetworkInfo(),defaultToken:e.publicDeriver.getParent().getDefaultToken()}));return{transactions:s,total:s.length}}catch(e){if(T.a.error("ErgoApi::refreshTransactions error: "+Object(T.d)(e)),e instanceof D.b)throw e;throw new k.d}}async refreshPendingTransactions(e){T.a.debug("ErgoApi::refreshPendingTransactions called");try{var t;const r=await Object(W.c)({publicDeriver:e.publicDeriver});return T.a.debug("ErgoApi::refreshPendingTransactions success: "+Object(T.c)(r)),y()(t=r.txs).call(t,t=>A.a.fromAnnotatedTx({tx:t,addressLookupMap:r.addressLookupMap,network:e.publicDeriver.getParent().getNetworkInfo(),defaultToken:e.publicDeriver.getParent().getDefaultToken()}))}catch(e){if(T.a.error("ErgoApi::refreshPendingTransactions error: "+Object(T.d)(e)),e instanceof D.b)throw e;throw new k.d}}async removeAllTransactions(e){try{await Object(W.e)({publicDeriver:e.publicDeriver});try{await e.refreshWallet()}catch(e){T.a.warn("removeAllTransactions failed to connect to remote to resync. Data was still cleared locally")}}catch(e){if(T.a.error("ErgoApi::removeAllTransactions error: "+Object(T.d)(e)),e instanceof D.b)throw e;throw new k.d}}async getForeignAddresses(e){try{return await Object(W.b)({publicDeriver:e.publicDeriver})}catch(e){if(T.a.error("ErgoApi::getForeignAddresses error: "+Object(T.d)(e)),e instanceof D.b)throw e;throw new k.d}}async getChainAddressesForDisplay(e){T.a.debug("ErgoApi::getChainAddressesForDisplay called"+Object(T.c)(e));try{return await Object(O.c)(e)}catch(e){if(T.a.error("ErgoApi::getChainAddressesForDisplay error: "+Object(T.d)(e)),e instanceof D.b)throw e;throw new k.d}}async getAllAddressesForDisplay(e){T.a.debug("ErgoApi::getAllAddressesForDisplay called: "+Object(T.c)(e));try{return await Object(S.a)(e)}catch(e){if(T.a.error("ErgoApi::getAllAddressesForDisplay error: "+Object(T.d)(e)),e instanceof D.b)throw e;throw new k.d}}async createWallet(e){return await this.restoreWallet(e)}async restoreWallet(e){T.a.debug("ErgoApi::restoreWallet called");const{recoveryPhrase:t,walletName:r,walletPassword:a}=e;try{const n=E.g+0,s=Object(P.a)(t),o=[],i=await Object(G.a)({db:e.db,rootPk:s,password:a,accountIndex:n,walletName:r,accountName:"",network:e.network}),c=await C.a.createBip44Wallet(e.db,i.bip44WrapperRow);for(const e of i.publicDeriver)o.push(await _.a.createPublicDeriver(e.publicDeriverResult,c));return T.a.debug("ErgoApi::restoreWallet success"),{publicDerivers:o}}catch(e){var n;if(T.a.error("ErgoApi::restoreWallet error: "+Object(T.d)(e)),null!=e.message&&g()(n=e.message).call(n,"Wallet with that mnemonics already exists"))throw new k.E;if(e instanceof D.b)throw e;throw new k.d}}generateWalletRecoveryPhrase(){T.a.debug("ErgoApi::generateWalletRecoveryPhrase called");try{const e=new f.a(e=>e(Object(N.a)()));return T.a.debug("ErgoApi::generateWalletRecoveryPhrase success"),e}catch(e){if(T.a.error("ErgoApi::generateWalletRecoveryPhrase error: "+Object(T.d)(e)),e instanceof D.b)throw e;throw new k.d}}async createUnsignedTx(e){const t=await e.publicDeriver.getAllUtxos(),r=p()(t).call(t,t=>p()(e).call(e,t)),a=Object(j.a)(r),n=[{address:e.receiver}];if(!H(e.tokens)){var s;const t=(await e.publicDeriver.getAllUtxoAddresses())[0],r=l()(s=t.addrs).call(s,e=>e.Type===K.b.ERGO_P2PK);if(null==r)throw new Error("createUnsignedTx no p2pk address found. Should never happen");n.push({address:r.Hash,addressing:t.addressing})}return this.createUnsignedTxForUtxos({receivers:n,network:e.publicDeriver.getParent().getNetworkInfo(),defaultToken:e.publicDeriver.getParent().getDefaultToken(),utxos:a,tokens:e.tokens,txFee:e.txFee,currentHeight:e.currentHeight})}async createUnsignedTxForUtxos(e){T.a.debug("ErgoApi::createUnsignedTxForUtxos called");try{var t;const s=c()(t=Object(B.d)(e.network)).call(t,(e,t)=>o()(e,t),{}),i={FeeAddress:s.FeeAddress,MinimumBoxValue:s.MinimumBoxValue,NetworkId:e.network.NetworkId};let d;if(H(e.tokens)){if(1!==e.receivers.length)throw new Error("createUnsignedTxForUtxos wrong output size for sendAll");const t=e.receivers[0];d=Object(R.b)({receiver:t,utxos:e.utxos,currentHeight:e.currentHeight,txFee:e.txFee,protocolParams:i})}else{var r,a;const t=c()(r=e.receivers).call(r,(e,t)=>null!=t.addressing?(e.push({address:t.address,addressing:t.addressing}),e):e,[]);if(1!==t.length)throw new Error("createUnsignedTxForUtxos needs exactly one change address");const n=t[0],s=c()(a=e.receivers).call(a,(e,t)=>null==t.addressing?(e.push({address:t.address}),e):e,[]);if(s.length>1)throw new Error("createUnsignedTxForUtxos can't send to more than one address");d=Object(R.a)({outputs:1===s.length?[{address:s[0].address,amount:V(e.defaultToken,e.tokens,e.utxos)}]:[],changeAddr:{address:n.address,addressing:n.addressing},utxos:e.utxos,txFee:e.txFee,currentHeight:e.currentHeight,protocolParams:{...i,DefaultIdentifier:e.defaultToken.defaultIdentifier}})}return T.a.debug("ErgoApi::createUnsignedTxForUtxos success: "+Object(T.c)(d)),new x.a({senderUtxos:d.senderUtxos,unsignedTx:d.unsignedTx,changeAddr:d.changeAddr,networkSettingSnapshot:{FeeAddress:s.FeeAddress,ChainNetworkId:n()(s.ChainNetworkId,10),NetworkId:e.network.NetworkId}})}catch(e){if(T.a.error("ErgoApi::createUnsignedTxForUtxos error: "+Object(T.d)(e)),e instanceof D.b)throw e;throw new k.d}}async signAndBroadcast(t){T.a.debug("ErgoApi::signAndBroadcast called");const{password:r}=t;try{const a=await t.publicDeriver.getSigningKey(),n=await t.publicDeriver.normalizeKey({...a,password:r}),s=Object(R.c)({signRequest:t.signRequest,keyLevel:t.publicDeriver.getParent().getPublicDeriverLevel(),signingKey:U.c.fromBuffer(e.from(n.prvKeyHex,"hex"))}),o=t.sendTx({network:t.publicDeriver.getParent().getNetworkInfo(),inputs:s.inputs,dataInputs:s.dataInputs,outputs:s.outputs});return T.a.debug("ErgoApi::signAndBroadcast success: "+Object(T.c)(o)),o}catch(e){if(e instanceof L.a)throw new k.t;if(T.a.error("ErgoApi::signAndBroadcast error: "+Object(T.d)(e)),e instanceof k.u)throw new k.u;if(e instanceof D.b)throw e;throw new k.d}}}function H(e){return null!=l()(e).call(e,e=>!(!0!==e.shouldSendAll||!e.token.IsDefault))}function V(e,t,r){const a=new M.a([],e);for(const e of t)if(null!=e.amount)a.add({amount:new v.a(e.amount),identifier:e.token.Identifier,networkId:e.token.NetworkId});else if(e.token.IsDefault){const t=c()(r).call(r,(e,t)=>e.plus(t.amount),new v.a(0));a.add({amount:t,identifier:e.token.Identifier,networkId:e.token.NetworkId})}else{const t=c()(r).call(r,(t,r)=>{var a;if(null==r.assets)return t;const n=l()(a=r.assets).call(a,t=>t.tokenId===e.token.Identifier);return null!=n?t.plus(n.amount):t},new v.a(0));a.add({amount:t,identifier:e.token.Identifier,networkId:e.token.NetworkId})}return a}}).call(this,r(48).Buffer)},1301:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return T}));var a=r(40),n=r.n(a),s=r(35),o=r.n(s),i=r(90),c=r.n(i),d=r(8),l=r.n(d),u=r(43),p=(r(22),r(19)),h=r(188),f=r(239),w=r(53),g=r(130),b=r(357),y=r(120),I=r(134),v=r(6);async function T(t){if(t.accountIndex<p.g)throw new Error("createStandardBip44Wallet needs hardened index");const r=Object(h.b)(t.password,t.rootPk.toBuffer()),a=Object(I.g)(t.rootPk,[p.i.BIP44,p.d.ERGO,t.accountIndex,p.c.EXTERNAL]).toPublic(),s=c()(t.network.BaseConfig[0].ChainNetworkId,10),i=await async function(t,r,a){const n=Object(u.range)(0,p.a),s=l()(n).call(n,a=>e.from(v.a.SigmaRust.Address.from_public_key(Object(I.f)(t,a).key.publicKey).to_bytes(r)).toString("hex"));return l()(n).call(n,e=>({index:e,insert:async t=>await Object(b.a)(a,t,s[e])}))}(a,s,Object(g.a)(new o.a)),d=[];let T;return T=await f.a.start(t.db,w.b).addConceptualWallet(e=>({NetworkId:t.network.NetworkId,Name:t.walletName})).addFromRoot(e=>({rootInsert:{privateKeyInfo:{Hash:r,IsEncrypted:!0,PasswordLastUpdate:null,Type:y.a.BIP32},publicKeyInfo:null,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:null,Index:null}),levelInfo:e=>n.a.resolve({KeyDerivationId:e.keyDerivationId})},tree:e=>({derivationId:e,children:[]})})).addBip44Wrapper(e=>({ConceptualWalletId:e.conceptualWalletRow.ConceptualWalletId,SignerLevel:w.a.ROOT.level,PublicDeriverLevel:w.a.CHAIN.level,PrivateDeriverKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId,PrivateDeriverLevel:d.length,RootKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId})).derivePublicDeriver(e=>{const r=e.bip44WrapperRow.PrivateDeriverKeyDerivationId,a=e.bip44WrapperRow.PrivateDeriverLevel;if(null==r||null==a)throw new Error("createStandardBip44Wallet missing private deriver");return{deriverRequest:{decryptPrivateDeriverPassword:t.password,publicDeriverMeta:{name:t.accountName},path:[{index:p.i.BIP44,insert:{}},{index:p.d.ERGO,insert:{}},{index:t.accountIndex,insert:{}},{index:p.c.EXTERNAL,insert:{DisplayCutoff:0}}],initialDerivations:i},privateDeriverKeyDerivationId:r,privateDeriverLevel:a}}).commit(),T}}).call(this,r(48).Buffer)},1302:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r(134);function n(e){if(e.startingFrom.level+1<e.addressing.startLevel)throw new Error("deriveByAddressing keyLevel < startLevel");let t=e.startingFrom.key;for(let r=e.startingFrom.level-e.addressing.startLevel+1;r<e.addressing.path.length;r++)t=Object(a.f)(t,e.addressing.path[r]);return t}},1303:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return ee}));var a=r(68),n=r.n(a),s=r(84),o=r.n(s),i=r(35),c=r.n(i),d=r(56),l=r.n(d),u=r(123),p=r.n(u),h=r(40),f=r.n(h),w=r(34),g=r.n(w),b=r(58),y=r.n(b),I=r(32),v=r.n(I),T=r(8),m=r.n(T),x=r(29),A=r.n(x),k=r(10),D=r(558),O=r(19),S=r(1304),E=r(310),P=r(159),C=r(559),_=r(53),G=r(50),W=r(33),N=(r(77),r(214)),j=r(117),R=r(341),B=r(23),K=r(17),U=r(358),L=r(195),M=r(359),F=r(228),H=r(173),V=r(131),$=r(166),q=r(494),J=r(238),X=r(6),Y=r(151),z=r(21),Z=r(20),Q=r(38);class ee{async getAllAddressesForDisplay(e){k.a.debug("JormungandrApi::getAllAddressesForDisplay called: "+Object(k.c)(e));try{return await Object($.a)(e)}catch(e){if(k.a.error("JormungandrApi::getAllAddressesForDisplay error: "+Object(k.d)(e)),e instanceof K.b)throw e;throw new B.d}}async getChainAddressesForDisplay(e){k.a.debug("JormungandrApi::getChainAddressesForDisplay called: "+Object(k.c)(e));try{return await Object(V.c)(e)}catch(e){if(k.a.error("JormungandrApi::getChainAddressesForDisplay error: "+Object(k.d)(e)),e instanceof K.b)throw e;throw new B.d}}async refreshTransactions(e){k.a.debug(`JormungandrApi::refreshTransactions called: ${Object(k.c)(e)}`);const{skip:t=0,limit:r}=e;try{var a;e.isLocalRequest||await Object(E.f)(e.publicDeriver.getDb(),e.publicDeriver,e.checkAddressesInUse,e.getTransactionsHistoryForAddresses,e.getBestBlock);const n=await Object(E.a)({publicDeriver:e.publicDeriver,skip:t,limit:r});k.a.debug("JormungandrApi::refreshTransactions success: "+Object(k.c)(n));const s=m()(a=n.txs).call(a,t=>D.a.fromAnnotatedTx({tx:t,addressLookupMap:n.addressLookupMap,network:e.publicDeriver.getParent().getNetworkInfo(),defaultToken:e.publicDeriver.getParent().getDefaultToken()}));return{transactions:s,total:s.length}}catch(e){if(k.a.error("JormungandrApi::refreshTransactions error: "+Object(k.d)(e)),e instanceof K.b)throw e;throw new B.d}}async refreshPendingTransactions(e){k.a.debug("JormungandrApi::refreshPendingTransactions called");try{var t;const r=await Object(E.c)({publicDeriver:e.publicDeriver});return k.a.debug("JormungandrApi::refreshPendingTransactions success: "+Object(k.c)(r)),m()(t=r.txs).call(t,t=>D.a.fromAnnotatedTx({tx:t,addressLookupMap:r.addressLookupMap,network:e.publicDeriver.getParent().getNetworkInfo(),defaultToken:e.publicDeriver.getParent().getDefaultToken()}))}catch(e){if(k.a.error("JormungandrApi::refreshPendingTransactions error: "+Object(k.d)(e)),e instanceof K.b)throw e;throw new B.d}}async removeAllTransactions(e){try{await Object(E.e)({publicDeriver:e.publicDeriver});try{await e.refreshWallet()}catch(e){k.a.warn("removeAllTransactions failed to connect to remote to resync. Data was still cleared locally")}}catch(e){if(k.a.error("JormungandrApi::removeAllTransactions error: "+Object(k.d)(e)),e instanceof K.b)throw e;throw new B.d}}async getForeignAddresses(e){try{return await Object(E.b)({publicDeriver:e.publicDeriver})}catch(e){if(k.a.error("JormungandrApi::getForeignAddresses error: "+Object(k.d)(e)),e instanceof K.b)throw e;throw new B.d}}async createWallet(e){return await this.restoreWallet(e)}async signAndBroadcast(t){k.a.debug("JormungandrApi::signAndBroadcast called");const{password:r,signRequest:a}=t;try{var n;const s=await t.publicDeriver.getSigningKey(),o=await t.publicDeriver.normalizeKey({...s,password:r}),i=v()(n=Object(Z.e)(t.publicDeriver.getParent().getNetworkInfo())).call(n,(e,t)=>y()(e,t),{}),c=Object(N.e)({senderUtxos:a.senderUtxos,changeAddr:a.changeAddr,IOs:a.unsignedTx,certificate:a.certificate},t.publicDeriver.getParent().getPublicDeriverLevel(),X.a.WalletV3.Bip32PrivateKey.from_bytes(e.from(o.prvKeyHex,"hex")),!1,void 0,i.ChainNetworkId),d=t.sendTx({network:t.publicDeriver.getParent().getNetworkInfo(),id:e.from(c.id().as_bytes()).toString("hex"),encodedTx:c.as_bytes()});return k.a.debug("JormungandrApi::signAndBroadcast success: "+Object(k.c)(d)),d}catch(e){if(e instanceof H.a)throw new B.t;if(k.a.error("JormungandrApi::signAndBroadcast error: "+Object(k.d)(e)),e instanceof K.b)throw e;throw new B.d}}async createUnsignedTx(e){k.a.debug("JormungandrApi::createUnsignedTx called");const{receiver:t}=e;try{var r;const a=await e.publicDeriver.getAllUtxos(),n=g()(a).call(a,t=>g()(e).call(e,t)),s=Object(N.a)(n),o=v()(r=Object(Z.e)(e.publicDeriver.getParent().getNetworkInfo())).call(r,(e,t)=>y()(e,t),{});let i;if(null!=e.shouldSendAll)i=Object(N.c)(t,s,void 0,{feeConfig:o.LinearFee,networkId:e.publicDeriver.getParent().getNetworkInfo().NetworkId});else{if(null==e.amount)throw new Error("createUnsignedTx unknown param");{const r=e.amount,a=await e.publicDeriver.nextInternal();if(null==a.addressInfo)throw new Error("createUnsignedTx no internal addresses left. Should never happen");const n=a.addressInfo;i=Object(N.b)([{address:t,amount:r}],[{address:n.addr.Hash,addressing:n.addressing}],s,void 0,{feeConfig:o.LinearFee,networkId:e.publicDeriver.getParent().getNetworkInfo().NetworkId})}}return k.a.debug("JormungandrApi::createUnsignedTx success: "+Object(k.c)(i)),new F.a({senderUtxos:i.senderUtxos,unsignedTx:i.IOs,changeAddr:i.changeAddr,certificate:i.certificate},{NetworkId:e.publicDeriver.getParent().getNetworkInfo().NetworkId})}catch(e){if(k.a.error("JormungandrApi::createUnsignedTx error: "+Object(k.d)(e)),e instanceof K.b)throw e;throw new B.d}}async createDelegationTx(t){var r;k.a.debug("JormungandrApi::createDelegationTx called");const a=v()(r=Object(Z.e)(t.publicDeriver.getParent().getNetworkInfo())).call(r,(e,t)=>y()(e,t),{}),s=await t.publicDeriver.getStakingKey(),o=Object(P.d)(s.addr.Hash),i=Object(C.a)(o,t.poolRequest),c=X.a.WalletV3.Certificate.stake_delegation(i),d=await t.publicDeriver.getAllUtxos(),l=Object(N.a)(d),u=await t.publicDeriver.nextInternal();if(null==u.addressInfo)throw new Error("createDelegationTx no internal addresses left. Should never happen");const p=u.addressInfo,h=Object(N.b)([],[{address:p.addr.Hash,addressing:p.addressing}],l,c,{feeConfig:a.LinearFee,networkId:t.publicDeriver.getParent().getNetworkInfo().NetworkId}),f=Object(P.b)(o,d,!1),w=v()(f).call(f,(e,r)=>{var a;return e.joinAddMutable(new Q.a(m()(a=r.output.tokens).call(a,e=>({identifier:e.Token.Identifier,amount:new A.a(e.TokenList.Amount),networkId:e.Token.NetworkId})),t.publicDeriver.getParent().getDefaultToken()))},new Q.a([],t.publicDeriver.getParent().getDefaultToken())),g=function(t,r,a,s){const o=e.from(a.as_bytes()).toString("hex"),i=new Q.a([],s);for(const e of t.senderUtxos){const t=n()(r).call(r,t=>t.output.Transaction.Hash===e.tx_hash&&t.output.UtxoTransactionOutput.OutputIndex===e.tx_index);if(null==t)throw new Error("getDifferenceAfterTx utxo not found. Should not happen");const a=t.address;var c;if(Object(P.c)(a,o,!0))i.joinAddMutable(new Q.a(m()(c=t.output.tokens).call(c,e=>({identifier:e.Token.Identifier,amount:new A.a(e.TokenList.Amount),networkId:e.Token.NetworkId})),s))}const d=new Q.a([],s);{const r=t.IOs.outputs();for(let t=0;t<r.size();t++){const a=r.get(t),n=e.from(a.address().as_bytes()).toString("hex");Object(P.c)(n,o,!0)&&d.add({amount:new A.a(a.value().to_str()),identifier:s.defaultIdentifier,networkId:s.defaultNetworkId})}}return d.joinSubtractCopy(i)}(h,d,o,t.publicDeriver.getParent().getDefaultToken()),b=w.joinAddCopy(g).joinAddCopy(t.valueInAccount);return{signTxRequest:new F.a({senderUtxos:h.senderUtxos,unsignedTx:h.IOs,changeAddr:h.changeAddr,certificate:h.certificate},{NetworkId:t.publicDeriver.getParent().getNetworkInfo().NetworkId}),totalAmountToDelegate:b}}async signAndBroadcastDelegationTx(t){k.a.debug("JormungandrApi::signAndBroadcastDelegationTx called");const{password:r,signRequest:a}=t;try{var n;const s=v()(n=Object(Z.e)(t.publicDeriver.getParent().getNetworkInfo())).call(n,(e,t)=>y()(e,t),{}),o=await t.publicDeriver.getSigningKey(),i=await t.publicDeriver.getStakingKey(),c=await t.publicDeriver.normalizeKey({...o,password:r}),d=X.a.WalletV3.Bip32PrivateKey.from_bytes(e.from(c.prvKeyHex,"hex")),l=Object(J.a)({addressing:i.addressing,startingFrom:{key:d,level:t.publicDeriver.getParent().getPublicDeriverLevel()}}).to_raw_key(),u=a.unsignedTx;if(null==t.signRequest.certificate)throw new Error("signAndBroadcastDelegationTx missing certificate");const p=t.signRequest.certificate,h=Object(N.e)({senderUtxos:a.senderUtxos,changeAddr:a.changeAddr,certificate:p,IOs:u},t.publicDeriver.getParent().getPublicDeriverLevel(),d,!1,{certificate:p,stakingKey:l},s.ChainNetworkId),f=e.from(h.id().as_bytes()).toString("hex"),w=h.as_bytes(),g=t.sendTx({network:t.publicDeriver.getParent().getNetworkInfo(),id:f,encodedTx:w});return k.a.debug("JormungandrApi::signAndBroadcastDelegationTx success: "+Object(k.c)(g)),g}catch(e){if(e instanceof H.a)throw new B.t;if(k.a.error("JormungandrApi::signAndBroadcastDelegationTx error: "+Object(k.d)(e)),e instanceof K.b)throw e;throw new B.d}}async saveLastReceiveAddressIndex(e){k.a.debug("JormungandrApi::saveLastReceiveAddressIndex called");try{const t=Object(W.c)(e.publicDeriver);if(null==t)return;await t.setCutoff({newIndex:e.index})}catch(e){if(k.a.error("JormungandrApi::saveLastReceiveAddressIndex error: "+Object(k.d)(e)),e instanceof K.b)throw e;throw new B.d}}static isValidMnemonic(e){return Object(R.a)(e.mnemonic,e.numberOfWords)}generateWalletRecoveryPhrase(){k.a.debug("JormungandrApi::generateWalletRecoveryPhrase called");try{const e=new f.a(e=>e(Object(j.a)()));return k.a.debug("JormungandrApi::generateWalletRecoveryPhrase success"),e}catch(e){if(k.a.error("JormungandrApi::generateWalletRecoveryPhrase error: "+Object(k.d)(e)),e instanceof K.b)throw e;throw new B.d}}async restoreWallet(e){k.a.debug("JormungandrApi::restoreWallet called");const{recoveryPhrase:t,walletName:r,walletPassword:a}=e;try{var n;const s=O.g+0,o=Object(J.c)(Object(j.d)(t)),i=[],c=v()(n=Object(Z.e)(e.network)).call(n,(e,t)=>y()(e,t),{}),d=await Object(S.a)({db:e.db,discrimination:c.Discriminant,rootPk:o,password:a,accountIndex:s,walletName:r,accountName:"",network:e.network}),l=await Y.a.createCip1852Wallet(e.db,d.cip1852WrapperRow);for(const e of d.publicDeriver)i.push(await G.a.createPublicDeriver(e.publicDeriverResult,l));return k.a.debug("JormungandrApi::restoreWallet success"),{publicDerivers:i}}catch(e){var s;if(k.a.error("JormungandrApi::restoreWallet error: "+Object(k.d)(e)),null!=e.message&&p()(s=e.message).call(s,"Wallet with that mnemonics already exists"))throw new B.E;if(e instanceof K.b)throw e;throw new B.d}}async restoreWalletForTransfer(t){var r;k.a.debug("JormungandrApi::restoreWalletForTransfer called");const{rootPk:a,checkAddressesInUse:n}=t,s=v()(r=Object(Z.e)(t.network)).call(r,(e,t)=>y()(e,t),{});try{const r=new l.a,i=new c.a,d=a.derive("cip1852"===t.transferSource?O.i.CIP1852:O.i.BIP44).derive(O.d.CARDANO).derive(t.accountIndex),u=e=>{if(!i.has(e.address.data)){let t=r.get(e.keyDerivationId);null==t&&(t=[],r.set(e.keyDerivationId,t)),t.push(e.address.data),i.add(e.address.data)}return f.a.resolve()};let p;if("bip44"===t.transferSource){const e=X.a.WalletV2.Bip44AccountPublic.new(Object(J.b)(d.to_public()),X.a.WalletV2.DerivationScheme.v2());p=await Object(U.a)({generateInternalAddresses:Object(L.b)(e.bip44_chain(!1),s.ByronNetworkId),generateExternalAddresses:Object(L.b)(e.bip44_chain(!0),s.ByronNetworkId),network:t.network,lastUsedInternal:-1,lastUsedExternal:-1,checkAddressesInUse:n,addByHash:u,type:z.b.CARDANO_LEGACY})}else{if("cip1852"!==t.transferSource)throw new Error(`restoreWalletForTransfer unexpected wallet type ${t.transferSource}`);{const r=d.derive(O.c.CHIMERIC_ACCOUNT).derive(O.h).to_public().to_raw_key(),a=await Object(M.c)({accountPublicKey:e.from(d.to_public().as_bytes()).toString("hex"),lastUsedInternal:-1,lastUsedExternal:-1,network:t.network,checkAddressesInUse:n,addByHash:u,stakingKey:r});if("cip1852"!==t.transferSource)throw new Error(`restoreWalletForTransfer unexpected shelley type ${t.transferSource}`);p=g()(a).call(a,e=>e.index===O.c.EXTERNAL||e.index===O.c.INTERNAL)}}const h=Object(_.c)(p),w=[];for(let e=0;e<h.length;e++){const a=h[e];await a.insert({db:null,tx:null,lockedTables:[],keyDerivationId:e});const n=r.get(e);if(null==n)throw new Error("restoreWalletForTransfer should never happen");const s=m()(n).call(n,e=>{var r;return{address:e,addressing:{startLevel:_.a.ACCOUNT.level,path:o()(r=[t.accountIndex]).call(r,a.path)}}});w.push(...s)}return k.a.debug("restoreWalletForTransfer success"),{masterKey:e.from(a.as_bytes()).toString("hex"),addresses:w}}catch(e){var i;if(k.a.error("restoreWalletForTransfer error: "+Object(k.d)(e)),null!=e.message&&p()(i=e.message).call(i,"Wallet with that mnemonics already exists"))throw new B.E;if(e instanceof K.b)throw e;throw new B.d}}async getTransactionRowsToExport(e){try{const t=await Object(E.a)({publicDeriver:e.publicDeriver});return k.a.debug("JormungandrApi::getTransactionRowsToExport: success"),Object(q.a)(t.txs,e.getDefaultToken(e.publicDeriver.getParent().getNetworkInfo().NetworkId))}catch(e){if(k.a.error("JormungandrApi::getTransactionRowsToExport: "+Object(k.d)(e)),e instanceof K.b)throw e;throw new B.d}}}}).call(this,r(48).Buffer)},1304:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return y}));var a=r(35),n=r.n(a),s=r(40),o=r.n(s),i=r(8),c=r.n(i),d=r(43),l=(r(22),r(19)),u=r(239),p=r(6),h=r(188),f=r(53),w=r(130),g=r(359),b=r(120);async function y(t){if(t.accountIndex<l.g)throw new Error("createStandardCip1852Wallet needs hardened index");const r=Object(h.b)(t.password,t.rootPk.as_bytes()),a=t.rootPk.derive(l.i.CIP1852).derive(l.d.CARDANO).derive(t.accountIndex).to_public(),s=await async function(t,r,a){var n;const s=Object(d.range)(0,l.a),i=r.derive(l.c.CHIMERIC_ACCOUNT).derive(l.h).to_raw_key(),u=c()(s).call(s,a=>{const n=r.derive(l.c.EXTERNAL).derive(a).to_raw_key(),s=p.a.WalletV3.Address.single_from_public_key(n,t);return e.from(s.as_bytes()).toString("hex")}),h=c()(s).call(s,a=>{const n=r.derive(l.c.INTERNAL).derive(a).to_raw_key(),s=p.a.WalletV3.Address.single_from_public_key(n,t);return e.from(s.as_bytes()).toString("hex")}),f=c()(s).call(s,e=>({index:e,insert:async t=>await Object(g.b)(a,t,i,u[e])})),w=c()(s).call(s,e=>({index:e,insert:async t=>await Object(g.b)(a,t,i,h[e])})),b=c()(n=[0]).call(n,e=>({index:e,insert:async e=>await Object(g.a)(a,e,i,t)}));return[{index:l.c.EXTERNAL,insert:e=>o.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:0}),children:f},{index:l.c.INTERNAL,insert:e=>o.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:w},{index:l.c.CHIMERIC_ACCOUNT,insert:e=>o.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:b}]}(t.discrimination,a,Object(w.a)(new n.a)),i=[];let y;return y=await u.a.start(t.db,f.b).addConceptualWallet(e=>({NetworkId:t.network.NetworkId,Name:t.walletName})).addFromRoot(e=>({rootInsert:{privateKeyInfo:{Hash:r,IsEncrypted:!0,PasswordLastUpdate:null,Type:b.a.BIP32ED25519},publicKeyInfo:null,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:null,Index:null}),levelInfo:e=>o.a.resolve({KeyDerivationId:e.keyDerivationId})},tree:e=>({derivationId:e,children:[]})})).addCip1852Wrapper(e=>({ConceptualWalletId:e.conceptualWalletRow.ConceptualWalletId,SignerLevel:f.a.ROOT.level,PublicDeriverLevel:f.a.ACCOUNT.level,PrivateDeriverKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId,PrivateDeriverLevel:i.length,RootKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId})).derivePublicDeriver(e=>{const r=e.cip1852WrapperRow.PrivateDeriverKeyDerivationId,a=e.cip1852WrapperRow.PrivateDeriverLevel;if(null==r||null==a)throw new Error("createStandardCip1852Wallet missing private deriver");return{deriverRequest:{decryptPrivateDeriverPassword:t.password,publicDeriverMeta:{name:t.accountName},path:[{index:l.i.CIP1852,insert:{}},{index:l.d.CARDANO,insert:{}},{index:t.accountIndex,insert:{}}],initialDerivations:s},privateDeriverKeyDerivationId:r,privateDeriverLevel:a}}).commit(),y}}).call(this,r(48).Buffer)},131:function(e,t,r){"use strict";r.d(t,"e",(function(){return E})),r.d(t,"d",(function(){return C})),r.d(t,"c",(function(){return _})),r.d(t,"f",(function(){return G})),r.d(t,"a",(function(){return W})),r.d(t,"g",(function(){return N})),r.d(t,"b",(function(){return j}));var a=r(68),n=r.n(a),s=r(30),o=r.n(s),i=r(11),c=r.n(i),d=r(37),l=r.n(d),u=r(34),p=r.n(u),h=r(35),f=r.n(h),w=r(227),g=r.n(w),b=r(8),y=r.n(b),I=r(43),v=r(29),T=(r(77),r(157),r(25)),m=r(15),x=r(88),A=r(53),k=r(76),D=r(21),O=r(38),S=r(19);async function E(e,t,r,a,n){const s=await async function(e,t,r,a,n,s){var o;const i=await r.GetPathWithSpecific.getTree(e,t,a,async a=>await r.GetDerivationSpecific.get(e,t,a,n,s));return y()(o=i.rows).call(o,e=>{const t=i.pathMap.get(e.KeyDerivationId);if(null==t)throw new Error("rawGetDerivationsByPath should never happen");return{row:e,addressing:{path:t,startLevel:a.derivationLevel-a.commonPrefix.length+1}}})}(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetDerivationSpecific:r.GetDerivationSpecific},a,A.a.ADDRESS.level,n),o=await r.GetAddress.fromCanonical(e,t,y()(s).call(s,e=>e.row.KeyDerivationId),void 0);return y()(s).call(s,e=>{const t=o.get(e.row.KeyDerivationId);if(null==t)throw new Error("rawGetBip44AddressesByPath should never happen");return{...e,addrs:t}})}async function P(e,t,r,a){const n=await r.GetUtxoTxOutputsWithTx.getOutputsForAddresses(e,t,a.addressIds,[D.d.IN_BLOCK],a.networkId);return new f.a(y()(n).call(n,e=>e.UtxoTransactionOutput.AddressId))}async function C(e,t,r,a){var n,s,o,i;const c=y()(n=p()(s=l()(o=a.addresses).call(o,e=>e.addrs)).call(s,e=>e.Type===a.type)).call(n,e=>e.AddressId),d=await P(e,t,{GetUtxoTxOutputsWithTx:r.GetUtxoTxOutputsWithTx},{addressIds:c,networkId:a.networkId}),u=function(e,t){const r=Object(I.groupBy)(e,e=>e.UtxoTransactionOutput.AddressId);return Object(I.mapValues)(r,e=>W(e,t))}(await r.GetUtxoTxOutputsWithTx.getUtxo(e,t,c,a.networkId),a.defaultToken);return l()(i=a.addresses).call(i,e=>{var t,r;return y()(t=p()(r=e.addrs).call(r,e=>e.Type===a.type)).call(t,t=>({address:t.Hash,values:u[t.AddressId],addressing:e.addressing,isUsed:d.has(t.AddressId),type:a.type}))})}async function _(e){var t,r;const a=e.publicDeriver.getParent().getDerivationTables(),n=c()({GetUtxoTxOutputsWithTx:k.c,GetAddress:T.b,GetPathWithSpecific:T.m,GetDerivationSpecific:x.a}),s=l()(t=y()(r=o()(n)).call(r,e=>n[e])).call(t,t=>Object(m.g)(e.publicDeriver.getDb(),t));return await Object(m.m)(e.publicDeriver.getDb(),[...s,...Object(m.k)(e.publicDeriver.getDb(),a)],async t=>await async function(e,t,r,a){const n=await r.publicDeriver.rawGetAddressesForChain(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},r.chainsRequest,a);let s=n;if(r.chainsRequest.chainId===S.c.EXTERNAL){const o=await r.publicDeriver.rawGetCutoff(e,{GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},void 0,a);s=p()(n).call(n,e=>e.addressing.path[e.addressing.path.length-1]<=o)}let o=await C(r.publicDeriver.getDb(),e,{GetUtxoTxOutputsWithTx:t.GetUtxoTxOutputsWithTx},{addresses:s,type:r.type,networkId:r.publicDeriver.getParent().getNetworkInfo().NetworkId,defaultToken:r.publicDeriver.getParent().getDefaultToken()});if(r.chainsRequest.chainId===S.c.INTERNAL){let e=-1;for(const t of o)if(t.isUsed){const r=t.addressing.path[t.addressing.path.length-1];r>e&&(e=r)}o=p()(o).call(o,t=>t.addressing.path[t.addressing.path.length-1]<=e+1)}return o}(t,n,{publicDeriver:e.publicDeriver,chainsRequest:e.chainsRequest,type:e.type},a))}async function G(e,t,r,a){var n;const s=await P(e,t,{GetUtxoTxOutputsWithTx:r.GetUtxoTxOutputsWithTx},{addressIds:l()(n=a.addressesForChain).call(n,e=>{var t;return y()(t=e.addrs).call(t,e=>e.AddressId)}),networkId:a.networkId}),o=function(e){var t;g()(t=e.singleChainAddresses).call(t,(e,t)=>e.addressing.path[e.addressing.path.length-1]-t.addressing.path[t.addressing.path.length-1]);let r=-1;for(let t=0;t<e.singleChainAddresses.length;t++)for(const a of e.singleChainAddresses[t].addrs)e.usedStatus.has(a.AddressId)&&(r=t);return r}({singleChainAddresses:a.addressesForChain,usedStatus:s}),i=a.addressesForChain[o+1];return void 0===i?{addressInfo:void 0,index:o+1}:{addressInfo:{...i},index:o+1}}function W(e,t){const r=new O.a([],t);for(const t of e)for(const e of t.tokens)r.add({identifier:e.Token.Identifier,amount:new v.BigNumber(e.TokenList.Amount),networkId:e.Token.NetworkId});return r}async function N(e,t,r,a){if(null!=r.displayCutoffInstance){const s=(()=>{if(r.publicDeriverLevel===A.a.ACCOUNT.level){var e;const t=n()(e=r.tree).call(e,e=>e.index===S.c.EXTERNAL);if(null==t||null==t.children)throw new Error("updateCutoffFromInsert should never happen");return t.children}if(r.publicDeriverLevel===A.a.CHAIN.level)return r.tree;throw new Error("updateCutoffFromInsert incorrect pubderiver level")})();let o=0;for(const e of s)e.index>o&&(o=e.index);const i=await r.displayCutoffInstance.rawGetCutoff(e,{GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},void 0,a);o-S.a>i&&await r.displayCutoffInstance.rawSetCutoff(e,{ModifyDisplayCutoff:t.ModifyDisplayCutoff,GetDerivationsByPath:t.GetDerivationsByPath,GetKeyDerivation:t.GetKeyDerivation},{newIndex:o-S.a})}}async function j(e,t){var r,a;const n=c()({GetCertificates:T.d}),s=l()(r=y()(a=o()(n)).call(a,e=>n[e])).call(r,t=>Object(m.g)(e,t));return await Object(m.m)(e,s,async r=>await n.GetCertificates.forAddress(e,r,{addressIds:t}))}},134:function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return l})),r.d(t,"a",(function(){return u})),r.d(t,"d",(function(){return p})),r.d(t,"c",(function(){return h})),r.d(t,"e",(function(){return g})),r.d(t,"f",(function(){return y})),r.d(t,"g",(function(){return I}));var a=r(1),n=r.n(a),s=r(103),o=r(120),i=r(6),c=r(490),d=r(403);class l{constructor(e){n()(this,"key",void 0),this.key=e}toBuffer(){return e.from(this.key.as_bytes())}getType(){return o.a.BIP32ED25519}verify(e,t){return this.key.to_raw_key().verify(e,i.a.WalletV3.Ed25519Signature.from_bytes(t))}static fromBuffer(e){const t=i.a.WalletV3.Bip32PublicKey.from_bytes(e);return l.fromV3Key(t)}static fromV3Key(e){return new(b(f(l)))(e)}}class u{constructor(e){n()(this,"key",void 0),this.key=e}toBuffer(){return e.from(this.key.as_bytes())}getType(){return o.a.BIP32ED25519}sign(t){return e.from(this.key.to_raw_key().sign(t).to_hex(),"hex")}toPublic(){const e=this.key.to_public();return l.fromV3Key(e)}static fromBuffer(e){const t=i.a.WalletV3.Bip32PrivateKey.from_bytes(e);return u.fromV3Key(t)}static fromV3Key(e){return new(w(f(u)))(e)}}class p{constructor(e){n()(this,"key",void 0),this.key=e}toBuffer(){return Object(d.decode)(this.key.toBase58())}getType(){return o.a.BIP32}verify(e,t){return this.key.verify(e,t)}static fromBuffer(e){const t=Object(c.fromBase58)(Object(d.encode)(e));return p.fromBip32(t)}static fromBip32(e){return new(b(f(p)))(e)}}class h{constructor(e){n()(this,"key",void 0),this.key=e}toBuffer(){return Object(d.decode)(this.key.toBase58())}getType(){return o.a.BIP32}sign(e){return this.key.sign(e)}toPublic(){const e=Object(c.fromPublicKey)(this.key.publicKey,this.key.chainCode);return p.fromBip32(e)}static fromBuffer(e){const t=Object(c.fromBase58)(Object(d.encode)(e));return h.fromBip32(t)}static fromBip32(e){return new(w(f(h)))(e)}}const f=Object(s.Mixin)(e=>class extends e{});const w=Object(s.Mixin)(e=>class extends e{});function g(e){if(e instanceof w)return e}const b=Object(s.Mixin)(e=>class extends e{});function y(e,t){if(e instanceof u)return u.fromV3Key(e.key.derive(t));if(e instanceof l)return l.fromV3Key(e.key.derive(t));if(e instanceof h)return h.fromBip32(e.key.derive(t));if(e instanceof p)return p.fromBip32(e.key.derive(t));throw new Error("Unexpected class in deriveKey")}function I(e,t){let r=e;for(let e=0;e<t.length;e++)r=y(r,t[e]);return r}}).call(this,r(48).Buffer)},1344:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return p}));var a=r(113),n=r.n(a),s=r(8),o=r.n(s),i=r(357),c=r(134),d=r(19),l=r(280),u=r(6);const p=(t,r,a,s)=>{var p;const h=Object(c.g)(t,[d.i.BIP44,d.d.ERGO,r+d.g,d.c.EXTERNAL]).toPublic(),f=Object(l.walletChecksum)(h.toBuffer().toString("hex")),w=Object(i.b)(h.key,s);var g,b,y;return{addresses:(g=[...n()(p=Array(a)).call(p)],o()(b=o()(y=w(g)).call(y,t=>u.a.SigmaRust.NetworkAddress.from_bytes(e.from(t,"hex")))).call(b,e=>e.to_base58())),plate:f}}}).call(this,r(48).Buffer)},1345:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return u}));var a=r(8),n=r.n(a),s=r(113),o=r.n(s),i=r(6),c=r(340),d=r(19),l=r(280);const u=(t,r,a,s)=>{var u;const p=t.derive(d.i.CIP1852).derive(d.d.CARDANO).derive(r+d.g).to_public(),h=p.derive(d.c.EXTERNAL),f=p.derive(d.c.CHIMERIC_ACCOUNT).derive(d.h).to_raw_key(),w=Object(l.legacyWalletChecksum)(e.from(p.as_bytes()).toString("hex"));return{addresses:function(e,t,r){return a=>n()(a).call(a,a=>{const n=e.derive(a).to_raw_key();return i.a.WalletV3.Address.delegation_from_public_key(n,t,r).to_string(c.a.ADDRESS)})}(h,f,s)([...o()(u=Array(a)).call(u)]),plate:w}}}).call(this,r(48).Buffer)},1346:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return y}));var a=r(30),n=r.n(a),s=r(8),o=r.n(s),i=r(32),c=r.n(i),d=r(29),l=r.n(d),u=r(10),p=r(23),h=r(17),f=r(153),w=r(6),g=r(38),b=r(21);async function y(t){try{var r,a;const{addressKeys:s,senderUtxos:i}=t,d=new g.a([{identifier:b.c.Cardano,amount:c()(r=o()(i).call(i,e=>new l.a(e.amount))).call(r,(e,t)=>e.plus(t),new l.a(0)),networkId:t.protocolParams.networkId}],{defaultNetworkId:t.protocolParams.networkId,defaultIdentifier:b.c.Cardano}),u=Object(f.e)(t.outputAddr,i,t.absSlotNumber,t.protocolParams),p=new g.a([{identifier:b.c.Cardano,amount:new l.a((null===(a=u.txBuilder.get_fee_if_set())||void 0===a?void 0:a.to_str())||"0").plus(u.txBuilder.get_deposit().to_str()),networkId:t.protocolParams.networkId}],{defaultNetworkId:t.protocolParams.networkId,defaultIdentifier:b.c.Cardano}),h=function(t,r){const a=w.a.WalletV4.hash_transaction(t),s=w.a.WalletV4.BootstrapWitnesses.new();for(const t of n()(r)){const n=w.a.WalletV4.make_daedalus_bootstrap_witness(a,w.a.WalletV4.ByronAddress.from_base58(t),w.a.WalletV4.LegacyDaedalusPrivateKey.from_bytes(e.from(r[t].to_hex(),"hex")));s.add(n)}const o=w.a.WalletV4.TransactionWitnessSet.new();return o.set_bootstraps(s),w.a.WalletV4.Transaction.new(t,o,void 0)}(u.txBuilder.build(),s);return{recoveredBalance:d,fee:p,id:e.from(w.a.WalletV4.hash_transaction(h.body()).to_bytes()).toString("hex"),encodedTx:h.to_bytes(),senders:n()(s),receivers:[t.outputAddr.address]}}catch(e){if(u.a.error(`daedalusTransfer::buildDaedalusTransferTx ${Object(u.d)(e)}`),e instanceof h.b)throw e;throw new p.c}}}).call(this,r(48).Buffer)},1348:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));r(29),r(6);var a=r(1349),n=r(464);async function s(e){const t=await Object(n.a)({addresses:e.addresses,network:e.network,getUTXOsForAddresses:e.getUTXOsForAddresses});return Object(a.a)({outputAddr:e.outputAddr,keyLevel:e.keyLevel,signingKey:e.signingKey,senderUtxos:t,protocolParams:e.protocolParams,absSlotNumber:e.absSlotNumber})}},1349:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return v}));var a=r(55),n=r.n(a),s=r(35),o=r.n(s),i=r(8),c=r.n(i),d=r(32),l=r.n(d),u=r(29),p=r.n(u),h=r(10),f=r(23),w=r(17),g=r(153),b=r(6),y=r(38),I=r(21);async function v(t){try{var r,a;const{senderUtxos:s}=t,i=new y.a([{identifier:I.c.Cardano,amount:l()(r=c()(s).call(s,e=>new p.a(e.amount))).call(r,(e,t)=>e.plus(t),new p.a(0)),networkId:t.protocolParams.networkId}],{defaultNetworkId:t.protocolParams.networkId,defaultIdentifier:I.c.Cardano}),d=Object(g.d)(t.outputAddr,s,t.absSlotNumber,t.protocolParams),u=new y.a([{identifier:I.c.Cardano,amount:new p.a((null===(a=d.txBuilder.get_fee_if_set())||void 0===a?void 0:a.to_str())||"0").plus(d.txBuilder.get_deposit().to_str()),networkId:t.protocolParams.networkId}],{defaultNetworkId:t.protocolParams.networkId,defaultIdentifier:I.c.Cardano}),h=Object(g.f)({senderUtxos:d.senderUtxos,unsignedTx:d.txBuilder,changeAddr:d.changeAddr,certificate:void 0},t.keyLevel,t.signingKey,new o.a,void 0);return{recoveredBalance:i,fee:u,id:e.from(b.a.WalletV4.hash_transaction(h.body()).to_bytes()).toString("hex"),encodedTx:h.to_bytes(),senders:n()(new o.a(c()(s).call(s,e=>e.receiver))),receivers:[t.outputAddr.address]}}catch(e){if(h.a.error(`transfer::buildYoroiTransferTx ${Object(h.d)(e)}`),e instanceof w.b)throw e;throw new f.c}}}).call(this,r(48).Buffer)},1356:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return b}));var a=r(123),n=r.n(a),s=r(207),o=r.n(s),i=r(8),c=r.n(i),d=r(1),l=r.n(d),u=r(98),p=r.n(u),h=r(10),f=r(23),w=r(6),g=r(492);class b{constructor(t,r,a){l()(this,"getLastLaunchVersion",void 0),l()(this,"getCurrentLocale",void 0),l()(this,"getPlatform",void 0),l()(this,"getUTXOsForAddresses",async t=>{const{BackendService:r}=t.network.Backend;if(null==r)throw new Error("getUTXOsForAddresses missing backend url");const a=await p()(`${r}/api/txs/utxoForAddresses`,{method:"post",timeout:4e4,data:{addresses:t.addresses},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::getUTXOsForAddresses error: "+Object(h.d)(e)),new f.p});return c()(a).call(a,t=>{var r;if(o()(r=t.receiver).call(r,"addr")){const r=e.from(w.a.WalletV4.Address.from_bech32(t.receiver).to_bytes()).toString("hex");return{...t,receiver:r}}return t})}),l()(this,"getTxsBodiesForUTXOs",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getTxsBodiesForUTXOs missing backend url");return p()(`${t}/api/txs/txBodies`,{method:"post",timeout:4e4,data:{txsHashes:e.txsHashes},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::getTxsBodiesForUTXOs error: "+Object(h.d)(e)),new f.n})}),l()(this,"getUTXOsSumsForAddresses",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getUTXOsSumsForAddresses missing backend url");return p()(`${t}/api/txs/utxoSumForAddresses`,{method:"post",timeout:4e4,data:{addresses:e.addresses},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::getUTXOsSumsForAddresses error: "+Object(h.d)(e)),new f.q})}),l()(this,"getTransactionsHistoryForAddresses",t=>{const{network:r,...a}=t,{BackendService:n}=r.Backend;if(null==n)throw new Error("getTransactionsHistoryForAddresses missing backend url");return p()(`${n}/api/v2/txs/history`,{method:"post",timeout:4e4,data:a,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(t=>{var r;return c()(r=t.data).call(r,t=>{if("shelley"===t.type){for(const r of t.inputs)try{const t=Object(g.fromWords)(Object(g.decode)(r.address,1e3).words);r.address=e.from(t).toString("hex")}catch(e){}for(const r of t.outputs)try{const t=Object(g.fromWords)(Object(g.decode)(r.address,1e3).words);r.address=e.from(t).toString("hex")}catch(e){}}if(null!=t.height)return t;const r=t.block_num;return delete t.block_num,{...t,height:r}})}).catch(e=>{if(h.a.error("RemoteFetcher::getTransactionsHistoryForAddresses error: "+Object(h.d)(e)),"REFERENCE_BLOCK_MISMATCH"===(null==e?void 0:e.response)||"REFERENCE_TX_NOT_FOUND"===(null==e?void 0:e.response)||"REFERENCE_BEST_BLOCK_MISMATCH"===(null==e?void 0:e.response))throw new f.A;throw new f.m})}),l()(this,"getRewardHistory",e=>{const{network:t,...r}=e,{BackendService:a}=t.Backend;if(null==a)throw new Error("getRewardHistory missing backend url");return p()(`${a}/api/account/rewardHistory`,{method:"post",data:r,timeout:4e4,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::getRewardHistory error: "+Object(h.d)(e)),new f.l})}),l()(this,"getBestBlock",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getBestBlock missing backend url");return p()(`${t}/api/v2/bestblock`,{method:"get",timeout:4e4,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::getBestBlock error: "+Object(h.d)(e)),new f.i})}),l()(this,"sendTx",t=>{const r=e.from(t.encodedTx).toString("base64"),{BackendService:a}=t.network.Backend;if(null==a)throw new Error("sendTx missing backend url");return p()(`${a}/api/txs/signed`,{method:"post",timeout:4e4,data:{signedTx:r},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(()=>({txId:t.id})).catch(e=>{var t;if(h.a.error("RemoteFetcher::sendTx error: "+Object(h.d)(e)),n()(t=e.request.response).call(t,"Invalid witness"))throw new f.u;throw new f.B})}),l()(this,"checkAddressesInUse",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("checkAddressesInUse missing backend url");return p()(`${t}/api/v2/addresses/filterUsed`,{method:"post",timeout:4e4,data:{addresses:e.addresses},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::checkAddressesInUse error: "+Object(h.d)(e)),new f.a})}),l()(this,"getAccountState",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getAccountState missing backend url");return p()(`${t}/api/account/state`,{method:"post",timeout:4e4,data:{addresses:e.addresses},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::getAccountState error: "+Object(h.d)(e)),new f.e})}),l()(this,"getPoolInfo",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getPoolInfo missing backend url");return p()(`${t}/api/pool/info`,{method:"post",timeout:4e4,data:{poolIds:e.poolIds},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::getPoolInfo error: "+Object(h.d)(e)),new f.j})}),this.getLastLaunchVersion=t,this.getCurrentLocale=r,this.getPlatform=a}}}).call(this,r(48).Buffer)},1357:function(e,t,r){"use strict";r.d(t,"a",(function(){return D}));var a=r(35),n=r.n(a),s=r(30),o=r.n(s),i=r(58),c=r.n(i),d=r(84),l=r.n(d),u=r(32),p=r.n(u),h=r(40),f=r.n(h),w=r(8),g=r.n(w),b=r(1),y=r.n(b),I=r(29),v=r.n(I),T=r(17),m=r(43),x=r(23),A=r(10),k=r(52);class D{constructor(e){y()(this,"baseFetcher",void 0),y()(this,"getUTXOsForAddresses",e=>{return(t=this.baseFetcher.getUTXOsForAddresses,async function(e){try{const r=Object(m.chunk)(e.addresses,50),a=g()(r).call(r,r=>t({addresses:r,network:e.network}));return f.a.all(a).then(e=>p()(e).call(e,(e,t)=>l()(e).call(e,t),[]))}catch(e){if(A.a.error("batchedFetcher:::batchUTXOsForAddresses error: "+Object(A.d)(e)),e instanceof T.b)throw e;throw new x.g}})(e);var t}),y()(this,"getTxsBodiesForUTXOs",e=>{return(t=this.baseFetcher.getTxsBodiesForUTXOs,async function(e){try{const r=Object(m.chunk)(e.txsHashes,150),a=g()(r).call(r,r=>t({network:e.network,txsHashes:r}));return f.a.all(a).then(t=>{const r=p()(t).call(t,(e,t)=>c()(e,t),{});if(e.txsHashes.length!==o()(r).length)throw new x.o;return r})}catch(e){if(A.a.error("batchedFetcher::batchTxsBodiesForInputs error: "+Object(A.d)(e)),e instanceof T.b)throw e;throw new x.o}})(e);var t}),y()(this,"getUTXOsSumsForAddresses",e=>{return(t=this.baseFetcher.getUTXOsSumsForAddresses,async function(e){try{const r=Object(m.chunk)(e.addresses,50),a=g()(r).call(r,r=>t({network:e.network,addresses:r})),n=await f.a.all(a),s=p()(n).call(n,(e,t)=>e.plus(null!=t.sum&&""!==t.sum?new v.a(t.sum):new v.a(0)),new v.a(0));return s.isZero()?{sum:null}:{sum:s.toString()}}catch(e){if(A.a.error("batchedFetcher::batchGetUTXOsSumsForAddresses error: "+Object(A.d)(e)),e instanceof T.b)throw e;throw new x.q}})(e);var t}),y()(this,"getTransactionsHistoryForAddresses",e=>{return(t=this.baseFetcher.getTransactionsHistoryForAddresses,async function(e){try{const r=await async function(e,t){const r=Object(m.chunk)(e,50),a=g()(r).call(r,t),n=await f.a.all(a);return p()(n).call(n,(e,t)=>l()(e).call(e,t),[])}(e.addresses,async r=>await async function e(t,r,a){const n=await a(r);if(0===n.length)return t;const s=l()(t).call(t,n);if(n.length===k.a.wallets.TRANSACTION_REQUEST_SIZE){const t=function(e){const t=[];for(const r of e)null!=r.block_hash&&null!=r.tx_ordinal&&null!=r.height&&t.push({blockHash:r.block_hash,txHash:r.hash,txOrdinal:r.tx_ordinal,height:r.height});if(0===t.length)return;let r=t[0];for(let e=1;e<t.length;e++)t[e].height>r.height?r=t[e]:t[e].height===r.height&&t[e].txOrdinal>r.txOrdinal&&(r=t[e]);return r}(n);if(void 0===t)throw new Error("_batchHistoryByTransaction only pending/failed tx returned");return await e(s,{...r,after:{block:t.blockHash,tx:t.txHash}},a)}return s}([],{...e,addresses:r},t)),a=new n.a,s=[];for(const e of r)a.has(e.hash)||(s.push(e),a.add(e.hash));return s}catch(e){if(A.a.error("batchedFetcher::batchGetTransactionsHistoryForAddresses error: "+Object(A.d)(e)),e instanceof T.b)throw e;throw new x.m}})(e);var t}),y()(this,"getRewardHistory",e=>{return(t=this.baseFetcher.getRewardHistory,async function(e){try{const r=Object(m.chunk)(e.addresses,50),a=g()(r).call(r,r=>t({network:e.network,addresses:r})),n=await f.a.all(a);return c()({},...n)}catch(e){if(A.a.error("batchedFetcher::batchGetRewardHistory error: "+Object(A.d)(e)),e instanceof T.b)throw e;throw new x.l}})(e);var t}),y()(this,"getBestBlock",e=>this.baseFetcher.getBestBlock(e)),y()(this,"sendTx",e=>this.baseFetcher.sendTx(e)),y()(this,"getAccountState",e=>{return(t=this.baseFetcher.getAccountState,async function(e){try{const r=Object(m.chunk)(e.addresses,50),a=g()(r).call(r,r=>t({network:e.network,addresses:r})),n=await f.a.all(a);return c()({},...n)}catch(e){if(A.a.error("batchedFetcher::batchGetAccountState error: "+Object(A.d)(e)),e instanceof T.b)throw e;throw new x.e}})(e);var t}),y()(this,"checkAddressesInUse",e=>{return(t=this.baseFetcher.checkAddressesInUse,async function(e){try{const r=Object(m.chunk)(e.addresses,50),a=g()(r).call(r,r=>t({network:e.network,addresses:r})),n=await f.a.all(a);return p()(n).call(n,(e,t)=>l()(e).call(e,t),[])}catch(e){if(A.a.error("batchedFetcher::batchCheckAddressesInUse error: "+Object(A.d)(e)),e instanceof T.b)throw e;throw new x.a}})(e);var t}),y()(this,"getPoolInfo",e=>{return(t=this.baseFetcher.getPoolInfo,async function(e){try{const r=Object(m.chunk)(e.poolIds,50),a=g()(r).call(r,r=>t({network:e.network,poolIds:r})),n=await f.a.all(a);return c()({},...n)}catch(e){if(A.a.error("batchedFetcher::batchGetPoolInfo error: "+Object(A.d)(e)),e instanceof T.b)throw e;throw new x.j}})(e);var t}),this.baseFetcher=e}}},1361:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return f}));var a=r(123),n=r.n(a),s=r(8),o=r.n(s),i=r(1),c=r.n(i),d=r(98),l=r.n(d),u=r(10),p=r(23),h=r(212);class f{constructor(t,r,a){c()(this,"getLastLaunchVersion",void 0),c()(this,"getCurrentLocale",void 0),c()(this,"getPlatform",void 0),c()(this,"getUTXOsForAddresses",async t=>{var r;const{BackendService:a}=t.network.Backend;if(null==a)throw new Error("getUTXOsForAddresses missing backend url");return await l()(`${a}/api/txs/utxoForAddresses`,{method:"post",timeout:4e4,data:{addresses:o()(r=t.addresses).call(r,t=>Object(h.encode)(e.from(t,"hex")))},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>{var t;return o()(t=e.data).call(t,e=>({...e,receiver:Object(h.decode)(e.receiver).toString("hex")}))}).catch(e=>{throw u.a.error("RemoteFetcher::getUTXOsForAddresses error: "+Object(u.d)(e)),new p.p})}),c()(this,"getTxsBodiesForUTXOs",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getTxsBodiesForUTXOs missing backend url");return l()(`${t}/api/txs/txBodies`,{method:"post",timeout:4e4,data:{txsHashes:e.txHashes},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw u.a.error("RemoteFetcher::getTxsBodiesForUTXOs error: "+Object(u.d)(e)),new p.n})}),c()(this,"getUTXOsSumsForAddresses",t=>{var r;const{BackendService:a}=t.network.Backend;if(null==a)throw new Error("getUTXOsSumsForAddresses missing backend url");return l()(`${a}/api/txs/utxoSumForAddresses`,{method:"post",timeout:4e4,data:{addresses:o()(r=t.addresses).call(r,t=>Object(h.encode)(e.from(t,"hex")))},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw u.a.error("RemoteFetcher::getUTXOsSumsForAddresses error: "+Object(u.d)(e)),new p.q})}),c()(this,"getTransactionsHistoryForAddresses",t=>{const{network:r,...a}=t,{BackendService:n}=r.Backend;if(null==n)throw new Error("getTransactionsHistoryForAddresses missing backend url");return(s=async e=>l()(`${n}/api/v2/txs/history`,{method:"post",timeout:4e4,data:{...a,addresses:e.addresses},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>{const t=e.data;for(const e of t)for(let t=0;t<e.inputs.length;t++)null==e.inputs[t].assets&&(e.inputs[t].assets=[]);return t}).catch(e=>{if(u.a.error("RemoteFetcher::getTransactionsHistoryForAddresses error: "+Object(u.d)(e)),"REFERENCE_BLOCK_MISMATCH"===(null==e?void 0:e.response)||"REFERENCE_TX_NOT_FOUND"===(null==e?void 0:e.response)||"REFERENCE_BEST_BLOCK_MISMATCH"===(null==e?void 0:e.response))throw new p.A;throw new p.m}),async t=>{var r;const a=o()(r=t.addresses).call(r,t=>Object(h.encode)(e.from(t,"hex"))),n=await s({network:t.network,addresses:a,untilBlock:t.untilBlock,...t.after?{after:t.after}:null});return o()(n).call(n,e=>{var t,r,a;return{...e,inputs:o()(t=e.inputs).call(t,e=>({...e,address:Object(h.decode)(e.address).toString("hex")})),dataInputs:o()(r=e.dataInputs).call(r,e=>({...e,address:Object(h.decode)(e.address).toString("hex")})),outputs:o()(a=e.outputs).call(a,e=>({...e,address:Object(h.decode)(e.address).toString("hex")}))}})})(t);var s}),c()(this,"getBestBlock",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getBestBlock missing backend url");return l()(`${t}/api/v2/bestblock`,{method:"get",timeout:4e4,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw u.a.error("RemoteFetcher::getBestBlock error: "+Object(u.d)(e)),new p.i})}),c()(this,"sendTx",e=>{const{network:t,...r}=e,{BackendService:a}=t.Backend;if(null==a)throw new Error("sendTx missing backend url");return l()(`${a}/api/txs/signed`,{method:"post",timeout:4e4,data:r,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>({txId:e.data.id})).catch(e=>{var t;if(u.a.error("RemoteFetcher::sendTx error: "+Object(u.d)(e)),n()(t=e.request.response).call(t,"Invalid witness"))throw new p.u;throw new p.B})}),c()(this,"getAssetInfo",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getAssetInfo missing backend url");return l()(`${t}/api/assets/info`,{method:"post",timeout:4e4,data:{assetIds:e.assetIds},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw u.a.error("RemoteFetcher::getAssetInfo error: "+Object(u.d)(e)),new p.h})}),c()(this,"checkAddressesInUse",t=>{const{BackendService:r}=t.network.Backend;if(null==r)throw new Error("checkAddressesInUse missing backend url");return(a=e=>l()(`${r}/api/v2/addresses/filterUsed`,{method:"post",timeout:4e4,data:{addresses:e.addresses},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw u.a.error("RemoteFetcher::checkAddressesInUse error: "+Object(u.d)(e)),new p.a}),async t=>{var r;const n=o()(r=t.addresses).call(r,t=>Object(h.encode)(e.from(t,"hex"))),s=await a({network:t.network,addresses:n});return o()(s).call(s,e=>Object(h.decode)(e).toString("hex"))})(t);var a}),this.getLastLaunchVersion=t,this.getCurrentLocale=r,this.getPlatform=a}}}).call(this,r(48).Buffer)},1362:function(e,t,r){"use strict";r.d(t,"a",(function(){return D}));var a=r(35),n=r.n(a),s=r(30),o=r.n(s),i=r(58),c=r.n(i),d=r(84),l=r.n(d),u=r(32),p=r.n(u),h=r(40),f=r.n(h),w=r(8),g=r.n(w),b=r(1),y=r.n(b),I=r(29),v=r.n(I),T=r(17),m=r(43),x=r(23),A=r(10),k=r(52);class D{constructor(e){y()(this,"baseFetcher",void 0),y()(this,"getUTXOsForAddresses",e=>{return(t=this.baseFetcher.getUTXOsForAddresses,async function(e){try{const r=Object(m.chunk)(e.addresses,50),a=g()(r).call(r,r=>t({addresses:r,network:e.network}));return f.a.all(a).then(e=>p()(e).call(e,(e,t)=>l()(e).call(e,t),[]))}catch(e){if(A.a.error("batchedFetcher:::batchUTXOsForAddresses error: "+Object(A.d)(e)),e instanceof T.b)throw e;throw new x.g}})(e);var t}),y()(this,"getTxsBodiesForUTXOs",e=>{return(t=this.baseFetcher.getTxsBodiesForUTXOs,async function(e){try{const r=Object(m.chunk)(e.txHashes,150),a=g()(r).call(r,r=>t({network:e.network,txHashes:r}));return f.a.all(a).then(t=>{const r=p()(t).call(t,(e,t)=>c()(e,t),{});if(e.txHashes.length!==o()(r).length)throw new x.o;return r})}catch(e){if(A.a.error("batchedFetcher::batchTxsBodiesForInputs error: "+Object(A.d)(e)),e instanceof T.b)throw e;throw new x.o}})(e);var t}),y()(this,"getUTXOsSumsForAddresses",e=>{return(t=this.baseFetcher.getUTXOsSumsForAddresses,async function(e){try{const r=Object(m.chunk)(e.addresses,50),a=g()(r).call(r,r=>t({network:e.network,addresses:r})),n=await f.a.all(a);return{sum:p()(n).call(n,(e,t)=>e.plus(null!=t.sum&&""!==t.sum?new v.a(t.sum):new v.a(0)),new v.a(0)).toString()}}catch(e){if(A.a.error("batchedFetcher::batchGetUTXOsSumsForAddresses error: "+Object(A.d)(e)),e instanceof T.b)throw e;throw new x.q}})(e);var t}),y()(this,"getTransactionsHistoryForAddresses",e=>{return(t=this.baseFetcher.getTransactionsHistoryForAddresses,async function(e){try{const r=await async function(e,t){const r=Object(m.chunk)(e,50),a=g()(r).call(r,t),n=await f.a.all(a);return p()(n).call(n,(e,t)=>l()(e).call(e,t),[])}(e.addresses,async r=>await async function e(t,r,a){const n=await a(r);if(0===n.length)return t;const s=l()(t).call(t,n);if(n.length===k.a.wallets.TRANSACTION_REQUEST_SIZE){const t=function(e){const t=[];for(const r of e)null!=r.block_hash&&null!=r.tx_ordinal&&null!=r.block_num&&t.push({blockHash:r.block_hash,txHash:r.hash,txOrdinal:r.tx_ordinal,height:r.block_num});if(0===t.length)return;let r=t[0];for(let e=1;e<t.length;e++)t[e].height>r.height?r=t[e]:t[e].height===r.height&&t[e].txOrdinal>r.txOrdinal&&(r=t[e]);return r}(n);if(void 0===t)throw new Error("_batchHistoryByAddresses only pending/failed tx returned");return await e(s,{...r,after:{block:t.blockHash,tx:t.txHash}},a)}return s}([],{...e,addresses:r},t)),a=new n.a,s=[];for(const e of r)a.has(e.hash)||(s.push(e),a.add(e.hash));return s}catch(e){if(A.a.error("batchedFetcher::batchGetTransactionsHistoryForAddresses error: "+Object(A.d)(e)),e instanceof T.b)throw e;throw new x.m}})(e);var t}),y()(this,"getBestBlock",e=>this.baseFetcher.getBestBlock(e)),y()(this,"sendTx",e=>this.baseFetcher.sendTx(e)),y()(this,"checkAddressesInUse",e=>{return(t=this.baseFetcher.checkAddressesInUse,async function(e){try{const r=Object(m.chunk)(e.addresses,50),a=g()(r).call(r,r=>t({network:e.network,addresses:r})),n=await f.a.all(a);return p()(n).call(n,(e,t)=>l()(e).call(e,t),[])}catch(e){if(A.a.error("batchedFetcher::batchCheckAddressesInUse error: "+Object(A.d)(e)),e instanceof T.b)throw e;throw new x.a}})(e);var t}),y()(this,"getAssetInfo",e=>{return(t=this.baseFetcher.getAssetInfo,async function(e){try{const r=Object(m.chunk)(e.assetIds,50),a=g()(r).call(r,r=>t({network:e.network,assetIds:r})),n=await f.a.all(a),s={};for(const e of n)for(const t of o()(e))s[t]=e[t];return s}catch(e){if(A.a.error("batchedFetcher::batchAssetInfo error: "+Object(A.d)(e)),e instanceof T.b)throw e;throw new x.h}})(e);var t}),this.baseFetcher=e}}},1363:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var a=r(1364),n=r(467);async function s(e){const t=await Object(n.c)({network:e.network,addressKeys:e.addressKeys,getUTXOsForAddresses:e.getUTXOsForAddresses});return Object(a.a)({outputAddr:e.outputAddr,addressKeys:e.addressKeys,senderUtxos:t,protocolParams:e.protocolParams})}},1364:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return I}));var a=r(30),n=r.n(a),s=r(8),o=r.n(s),i=r(32),c=r.n(i),d=r(29),l=r.n(d),u=r(228),p=r(10),h=r(23),f=r(17),w=r(214),g=r(6),b=r(38),y=r(21);async function I(t){try{var r;const{addressKeys:a,senderUtxos:s,outputAddr:i}=t,d=new b.a([{identifier:y.c.Jormungandr,amount:c()(r=o()(s).call(s,e=>new l.a(e.amount))).call(r,(e,t)=>e.plus(t),new l.a(0)),networkId:t.protocolParams.networkId}],{defaultNetworkId:t.protocolParams.networkId,defaultIdentifier:y.c.Jormungandr}),p=Object(w.d)(i,s,void 0,{feeConfig:t.protocolParams.feeConfig,networkId:t.protocolParams.networkId}),h=Object(u.b)(p.IOs,t.protocolParams.networkId),f=function(t,r,a){const{senderUtxos:n,IOs:s}=t;return function(t,r,a,n){const s=g.a.WalletV3.Witnesses.new();for(let o=0;o<a.length;o++){const i=g.a.WalletV3.Witness.for_legacy_daedalus_utxo(g.a.WalletV3.Hash.from_hex(n),t.get_auth_data_for_witness(),g.a.WalletV3.LegacyDaedalusPrivateKey.from_bytes(e.from(r[a[o].receiver].to_hex(),"hex")));s.add(i)}return t.set_witnesses(s)}((new g.a.WalletV3.TransactionBuilder).no_payload().set_ios(s.inputs(),s.outputs()),r,n,a).set_payload_auth(g.a.WalletV3.PayloadAuthData.for_no_payload())}(p,a,t.protocolParams.genesisHash),I=g.a.WalletV3.Fragment.from_transaction(f);return{recoveredBalance:d,fee:h,id:e.from(I.id().as_bytes()).toString("hex"),encodedTx:I.as_bytes(),senders:n()(a),receivers:[i]}}catch(e){if(p.a.error(`daedalusTransfer::buildDaedalusTransferTx ${Object(p.d)(e)}`),e instanceof f.b)throw e;throw new h.c}}}).call(this,r(48).Buffer)},1366:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return x}));var a=r(35),n=r.n(a),s=r(55),o=r.n(s),i=r(8),c=r.n(i),d=r(32),l=r.n(d),u=r(29),p=r.n(u),h=r(228),f=r(10),w=r(60),g=r(23),b=r(17),y=r(214),I=(r(6),r(20)),v=r(464),T=r(38),m=r(21);async function x(t){const r=await Object(v.a)({network:t.network,addresses:t.addresses,getUTXOsForAddresses:t.getUTXOsForAddresses});return async function(t){try{var r;const{senderUtxos:a,outputAddr:s}=t,i=new T.a([{identifier:m.c.Jormungandr,amount:l()(r=c()(a).call(a,e=>new p.a(e.amount))).call(r,(e,t)=>e.plus(t),new p.a(0)),networkId:t.protocolParams.networkId}],{defaultNetworkId:t.protocolParams.networkId,defaultIdentifier:m.c.Jormungandr}),d=Object(y.c)(s,a,void 0,{feeConfig:t.protocolParams.feeConfig,networkId:t.protocolParams.networkId}),u=Object(h.b)(d.IOs,t.protocolParams.networkId),f=Object(y.e)(d,t.keyLevel,t.signingKey,t.useLegacyWitness,void 0,t.protocolParams.genesisHash),g=o()(new n.a(c()(a).call(a,e=>e.receiver)));return{recoveredBalance:i,fee:u,id:e.from(f.id().as_bytes()).toString("hex"),encodedTx:f.as_bytes(),senders:c()(g).call(g,e=>Object(w.a)(e,I.j.JormungandrMainnet)),receivers:[s]}}catch(e){if(f.a.error(`transfer::buildYoroiTransferTx ${Object(f.d)(e)}`),e instanceof b.b)throw e;throw new g.c}}({outputAddr:t.outputAddr,keyLevel:t.keyLevel,signingKey:t.signingKey,senderUtxos:r,useLegacyWitness:t.useLegacyWitness,protocolParams:t.protocolParams})}}).call(this,r(48).Buffer)},1367:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return w}));var a=r(30),n=r.n(a),s=r(123),o=r.n(s),i=r(8),c=r.n(i),d=r(1),l=r.n(d),u=r(98),p=r.n(u),h=r(10),f=r(23);class w{constructor(t,r,a){l()(this,"getLastLaunchVersion",void 0),l()(this,"getCurrentLocale",void 0),l()(this,"getPlatform",void 0),l()(this,"getUTXOsForAddresses",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getUTXOsForAddresses missing backend url");return p()(`${t}/api/txs/utxoForAddresses`,{timeout:4e4,method:"post",data:{addresses:e.addresses},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::getUTXOsForAddresses error: "+Object(h.d)(e)),new f.p})}),l()(this,"getUTXOsSumsForAddresses",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getUTXOsForAddresses missing backend url");return p()(`${t}/api/txs/utxoSumForAddresses`,{method:"post",timeout:4e4,data:{addresses:e.addresses},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::getUTXOsSumsForAddresses error: "+Object(h.d)(e)),new f.q})}),l()(this,"getTransactionsHistoryForAddresses",e=>{const{network:t,...r}=e,{BackendService:a}=t.Backend;if(null==a)throw new Error("getUTXOsForAddresses missing backend url");return p()(`${a}/api/v2/txs/history`,{method:"post",timeout:4e4,data:r,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>{var t;return c()(t=e.data).call(t,e=>{for(const t of e.inputs)t.amount=t.amount.toString();if(null!=e.height)return e;null!=e.certificates&&e.certificates.length>0&&(e.certificate=e.certificates[0],delete e.certificates);const t=e.block_num;return delete e.block_num,{...e,height:t}})}).catch(e=>{if(h.a.error("RemoteFetcher::getTransactionsHistoryForAddresses error: "+Object(h.d)(e)),"REFERENCE_BLOCK_MISMATCH"===(null==e?void 0:e.response)||"REFERENCE_TX_NOT_FOUND"===(null==e?void 0:e.response)||"REFERENCE_BEST_BLOCK_MISMATCH"===(null==e?void 0:e.response))throw new f.A;throw new f.m})}),l()(this,"getRewardHistory",e=>{const{network:t,...r}=e,{BackendService:a}=t.Backend;if(null==a)throw new Error("getUTXOsForAddresses missing backend url");return p()(`${a}/api/v2/account/rewards`,{method:"post",timeout:4e4,data:r,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::getRewardHistory error: "+Object(h.d)(e)),new f.l})}),l()(this,"getBestBlock",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getUTXOsForAddresses missing backend url");return p()(`${t}/api/v2/bestblock`,{method:"get",timeout:4e4,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::getBestBlock error: "+Object(h.d)(e)),new f.i})}),l()(this,"sendTx",t=>{const r=e.from(t.encodedTx).toString("base64"),{BackendService:a}=t.network.Backend;if(null==a)throw new Error("getUTXOsForAddresses missing backend url");return p()(`${a}/api/txs/signed`,{method:"post",timeout:4e4,data:{signedTx:r},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(()=>({txId:t.id})).catch(e=>{var t;if(h.a.error("RemoteFetcher::sendTx error: "+Object(h.d)(e)),o()(t=e.request.response).call(t,"Invalid witness"))throw new f.u;throw new f.B})}),l()(this,"checkAddressesInUse",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getUTXOsForAddresses missing backend url");return p()(`${t}/api/v2/addresses/filterUsed`,{method:"post",timeout:4e4,data:{addresses:e.addresses},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::checkAddressesInUse error: "+Object(h.d)(e)),new f.a})}),l()(this,"getAccountState",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getUTXOsForAddresses missing backend url");return p()(`${t}/api/v2/account/state`,{method:"post",timeout:4e4,data:{addresses:e.addresses},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>{const t={};for(const r of n()(e.data))""===e.data[r]||"Account does not exist"===e.data[r]?t[r]={delegation:{pools:[]},value:0,counter:0}:t[r]=e.data[r];return t}).catch(e=>{throw h.a.error("RemoteFetcher::getAccountState error: "+Object(h.d)(e)),new f.e})}),l()(this,"getPoolInfo",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getUTXOsForAddresses missing backend url");return p()(`${t}/api/v2/pool/info`,{method:"post",timeout:4e4,data:{ids:e.ids},headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::getPoolInfo error: "+Object(h.d)(e)),new f.j})}),l()(this,"getReputation",e=>{const{BackendService:t}=e.network.Backend;if(null==t)throw new Error("getUTXOsForAddresses missing backend url");return p()(`${t}/api/v2/pool/reputation`,{method:"get",timeout:4e4,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw h.a.error("RemoteFetcher::getReputation error: "+Object(h.d)(e)),new f.k})}),this.getLastLaunchVersion=t,this.getCurrentLocale=r,this.getPlatform=a}}}).call(this,r(48).Buffer)},1368:function(e,t,r){"use strict";r.d(t,"a",(function(){return A}));var a=r(35),n=r.n(a),s=r(58),o=r.n(s),i=r(84),c=r.n(i),d=r(32),l=r.n(d),u=r(40),p=r.n(u),h=r(8),f=r.n(h),w=r(1),g=r.n(w),b=r(29),y=r.n(b),I=r(17),v=r(43),T=r(23),m=r(10),x=r(52);class A{constructor(e){g()(this,"baseFetcher",void 0),g()(this,"getUTXOsForAddresses",e=>{return(t=this.baseFetcher.getUTXOsForAddresses,async function(e){try{const r=Object(v.chunk)(e.addresses,50),a=f()(r).call(r,r=>t({network:e.network,addresses:r}));return p.a.all(a).then(e=>l()(e).call(e,(e,t)=>c()(e).call(e,t),[]))}catch(e){if(m.a.error("batchedFetcher:::batchUTXOsForAddresses error: "+Object(m.d)(e)),e instanceof I.b)throw e;throw new T.g}})(e);var t}),g()(this,"getUTXOsSumsForAddresses",e=>{return(t=this.baseFetcher.getUTXOsSumsForAddresses,async function(e){try{const r=Object(v.chunk)(e.addresses,50),a=f()(r).call(r,r=>t({network:e.network,addresses:r})),n=await p.a.all(a),s=l()(n).call(n,(e,t)=>e.plus(null!=t.sum&&""!==t.sum?new y.a(t.sum):new y.a(0)),new y.a(0));return s.isZero()?{sum:null}:{sum:s.toString()}}catch(e){if(m.a.error("batchedFetcher::batchGetUTXOsSumsForAddresses error: "+Object(m.d)(e)),e instanceof I.b)throw e;throw new T.q}})(e);var t}),g()(this,"getTransactionsHistoryForAddresses",e=>{return(t=this.baseFetcher.getTransactionsHistoryForAddresses,async function(e){try{const r=await async function(e,t){const r=Object(v.chunk)(e,50),a=f()(r).call(r,t),n=await p.a.all(a);return l()(n).call(n,(e,t)=>c()(e).call(e,t),[])}(e.addresses,async r=>await async function e(t,r,a){const n=await a(r);if(0===n.length)return t;const s=c()(t).call(t,n);if(n.length===x.a.wallets.TRANSACTION_REQUEST_SIZE){const t=function(e){const t=[];for(const r of e)null!=r.block_hash&&null!=r.tx_ordinal&&null!=r.height&&t.push({blockHash:r.block_hash,txHash:r.hash,txOrdinal:r.tx_ordinal,height:r.height});if(0===t.length)return;let r=t[0];for(let e=1;e<t.length;e++)t[e].height>r.height?r=t[e]:t[e].height===r.height&&t[e].txOrdinal>r.txOrdinal&&(r=t[e]);return r}(n);if(void 0===t)throw new Error("_batchHistoryByTransaction only pending/failed tx returned");return await e(s,{...r,after:{block:t.blockHash,tx:t.txHash}},a)}return s}([],{...e,addresses:r},t)),a=new n.a,s=[];for(const e of r)a.has(e.hash)||(s.push(e),a.add(e.hash));return s}catch(e){if(m.a.error("batchedFetcher::batchGetTransactionsHistoryForAddresses error: "+Object(m.d)(e)),e instanceof I.b)throw e;throw new T.m}})(e);var t}),g()(this,"getRewardHistory",e=>{return(t=this.baseFetcher.getRewardHistory,async function(e){try{const r=Object(v.chunk)(e.addresses,50),a=f()(r).call(r,r=>t({network:e.network,addresses:r})),n=await p.a.all(a);return o()({},...n)}catch(e){if(m.a.error("batchedFetcher::batchGetRewardHistory error: "+Object(m.d)(e)),e instanceof I.b)throw e;throw new T.l}})(e);var t}),g()(this,"getBestBlock",e=>this.baseFetcher.getBestBlock(e)),g()(this,"sendTx",e=>this.baseFetcher.sendTx(e)),g()(this,"checkAddressesInUse",e=>{return(t=this.baseFetcher.checkAddressesInUse,async function(e){try{const r=Object(v.chunk)(e.addresses,50),a=f()(r).call(r,r=>t({network:e.network,addresses:r})),n=await p.a.all(a);return l()(n).call(n,(e,t)=>c()(e).call(e,t),[])}catch(e){if(m.a.error("batchedFetcher::batchCheckAddressesInUse error: "+Object(m.d)(e)),e instanceof I.b)throw e;throw new T.a}})(e);var t}),g()(this,"getAccountState",e=>{return(t=this.baseFetcher.getAccountState,async function(e){try{const r=Object(v.chunk)(e.addresses,50),a=f()(r).call(r,r=>t({network:e.network,addresses:r})),n=await p.a.all(a);return o()({},...n)}catch(e){if(m.a.error("batchedFetcher::batchGetAccountState error: "+Object(m.d)(e)),e instanceof I.b)throw e;throw new T.e}})(e);var t}),g()(this,"getReputation",e=>{return(t=this.baseFetcher.getReputation,async function(e){return t(e)})(e);var t}),g()(this,"getPoolInfo",e=>{return(t=this.baseFetcher.getPoolInfo,async function(e){try{const r=Object(v.chunk)(e.ids,50),a=f()(r).call(r,r=>t({network:e.network,ids:r})),n=await p.a.all(a);return o()({},...n)}catch(e){if(m.a.error("batchedFetcher::batchGetPoolInfo error: "+Object(m.d)(e)),e instanceof I.b)throw e;throw new T.j}})(e);var t}),this.baseFetcher=e}}},1370:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var a=r(1),n=r.n(a),s=r(98),o=r.n(s),i=r(10),c=r(23),d=r(20);const l=Object({name:"mainnet"}).priceBackendUrl;class u{constructor(e,t,r){n()(this,"getLastLaunchVersion",void 0),n()(this,"getCurrentLocale",void 0),n()(this,"getPlatform",void 0),n()(this,"checkServerStatus",e=>o()(`${function(){const e=d.j.CardanoMainnet.Backend.BackendService;if(null==e)throw new Error;return e}()}/api/status`,{method:"get",timeout:4e4,headers:{"yoroi-version":`${this.getPlatform()} / ${this.getLastLaunchVersion()}`,"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw i.a.error("RemoteFetcher::checkServerStatus error: "+Object(i.d)(e)),new c.C})),n()(this,"getCurrentCoinPrice",e=>o()(`${l}/price/${e.from}/current`,{method:"get",timeout:4e4,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw i.a.error("RemoteFetcher::getCurrentCoinPrice error: "+Object(i.d)(e)),new c.b})),n()(this,"getHistoricalCoinPrice",e=>o()(`${l}/price/${e.from}/${e.timestamps.join(",")}`,{method:"get",timeout:4e4,headers:{"yoroi-version":this.getLastLaunchVersion(),"yoroi-locale":this.getCurrentLocale()}}).then(e=>e.data).catch(e=>{throw i.a.error("RemoteFetcher::getHistoricalCoinPrice error: "+Object(i.d)(e)),new c.s})),this.getLastLaunchVersion=e,this.getCurrentLocale=t,this.getPlatform=r}}},1371:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var a=r(1),n=r.n(a);class s{constructor(e){n()(this,"baseFetcher",void 0),n()(this,"checkServerStatus",e=>this.baseFetcher.checkServerStatus(e)),n()(this,"getCurrentCoinPrice",e=>this.baseFetcher.getCurrentCoinPrice(e)),n()(this,"getHistoricalCoinPrice",e=>this.baseFetcher.getHistoricalCoinPrice(e)),this.baseFetcher=e}}},138:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var a=r(197),n=r.n(a),s=r(1),o=r.n(s),i=r(198),c=r.n(i),d=r(241),l=r.n(d),u=r(77),p=r(459),h=r(157),f=r(53),w=new n.a,g=new n.a,b=new n.a,y=new n.a,I=new n.a;class v extends u.a{constructor(e,t,r,a,n){return super(t),w.set(this,{writable:!0,value:void 0}),g.set(this,{writable:!0,value:void 0}),b.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:void 0}),I.set(this,{writable:!0,value:void 0}),o()(this,"getDerivationTables",()=>f.b),o()(this,"rawRemove",async(e,t)=>{await h.a.remove(e,t,this.getConceptualWalletId()),await Object(u.d)(e,t,this.getConceptualWalletId())}),l()(this,w,r.PublicDeriverLevel),l()(this,g,r.SignerLevel),l()(this,b,a),l()(this,y,n),this}getPublicDeriverLevel(){return c()(this,w)}getSigningLevel(){return c()(this,g)}getPrivateDeriverLevel(){return c()(this,b)}getPrivateDeriverKeyDerivationId(){return c()(this,y)}static async createBip44Wallet(e,t){return await Object(p.b)(e,t,v)}}},141:function(e,t,r){"use strict";r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return I})),r.d(t,"a",(function(){return v}));var a=r(11),n=r.n(a),s=r(92),o=r.n(s),i=r(31),c=r.n(i),d=r(55),l=r.n(d),u=r(1),p=r.n(u),h=r(62),f=r(15),w=r(25),g=r(119),b=r(86);class y{static async excludingParent(e,t,r,a,n){const s=r.derivationId,o=[];for(let i=0;i<r.children.length;i++){const d=a.get(n+1);if(null==d)throw new Error("AddDerivationTree::excludingParent Unknown table queried");const u=await y.depTables.GetOrAddDerivation.getOrAdd(e,t,s,r.children[i].index,{privateKeyInfo:null,publicKeyInfo:null,derivationInfo:e=>({PublicKeyId:e.private,PrivateKeyId:e.public,Parent:s,Index:r.children[i].index}),levelInfo:e=>r.children[i].insert(e)},l()(c()(a).call(a)),d),p=null==r.children[i].children?void 0:await y.excludingParent(e,t,{derivationId:u.KeyDerivation.KeyDerivationId,children:r.children[i].children},a,n+1);o.push({index:r.children[i].index,result:u,children:p})}return o}static async includingParent(e,t,r,a,n,s){const o=a.get(n);if(null==o)throw new Error("AddDerivationTree::includingParent Unknown table queried");const i=await y.depTables.AddDerivation.add(e,t,r,l()(c()(a).call(a)),o);return{root:i,children:await y.excludingParent(e,t,s(i.KeyDerivation.KeyDerivationId),a,n+1)}}static async fromSinglePath(e,t,r,a){let n=r.parentDerivationId;const s=[];for(let o=0;o<r.path.length;o++){const i=a.get(r.pathStartLevel+o);if(null==i)throw new Error("AddDerivationTree::fromSinglePath Unknown table queried");const d=await y.depTables.GetOrAddDerivation.getOrAdd(e,t,n,r.path[o].index,{privateKeyInfo:r.path[o].privateKey,publicKeyInfo:r.path[o].publicKey,derivationInfo:e=>({PublicKeyId:e.private,PrivateKeyId:e.public,Parent:n,Index:r.pathStartLevel+o===0?null:r.path[o].index}),levelInfo:e=>r.path[o].insert(e)},l()(c()(a).call(a)),i);n=d.KeyDerivation.KeyDerivationId,s.push(d)}return s}}p()(y,"ownTables",n()({})),p()(y,"depTables",n()({GetOrAddDerivation:h.c,AddDerivation:h.a}));class I{static async add(e,t,r,a,n,s,i){const c=await I.depTables.GetKeyForDerivation.get(e,t,a,!1,!0);if(null==c.privateKey)throw new f.a("DerivePublicDeriverFromKey::add privateKey");const d=r.pathToPublic(c.privateKey);if(0===d.length)throw new Error("DerivePublicDeriverFromKey::add derivedPath");const l=await I.depTables.AddDerivationTree.fromSinglePath(e,t,{parentDerivationId:a,path:o()(d).call(d,0,d.length-1),pathStartLevel:n+1},i),u=await v.depTables.GetPublicDeriver.forWallet(e,t,s);let p;{const o=i.get(n+d.length);if(null==o)throw new Error("DerivePublicDeriverFromKey::add Unknown table queried");p=await I.depTables.AddPublicDeriver.add(e,t,{addLevelRequest:{privateKeyInfo:d[d.length-1].privateKey,publicKeyInfo:d[d.length-1].publicKey,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:0===l.length?a:l[l.length-1].KeyDerivation.KeyDerivationId,Index:d[d.length-1].index}),levelInfo:e=>d[d.length-1].insert(e)},derivationTables:i,levelSpecificTableName:o,addPublicDeriverRequest:e=>({ConceptualWalletId:s,KeyDerivationId:e.derivationId,Name:r.publicDeriverMeta.name,Index:u.length,LastSyncInfoId:e.lastSyncInfoId})})}return await I.depTables.AddDerivationTree.excludingParent(e,t,{derivationId:p.publicDeriverResult.KeyDerivationId,children:r.initialDerivations},i,n+d.length),p}}p()(I,"ownTables",n()({})),p()(I,"depTables",n()({GetPublicDeriver:b.e,AddPublicDeriver:g.a,GetKeyForDerivation:w.k,GetOrAddDerivation:h.c,AddDerivationTree:y}));class v{static async add(e,t,r,a,n){var s;const i=await v.depTables.AddDerivationTree.fromSinglePath(e,t,{parentDerivationId:r.parentDerivationId,path:o()(s=r.pathToPublic).call(s,0,r.pathToPublic.length-1),pathStartLevel:r.pathStartLevel},n),c=n.get(r.pathStartLevel+r.pathToPublic.length-1);if(null==c)throw new Error("AddAdhocPublicDeriver::add Unknown table queried");const d=await v.depTables.GetPublicDeriver.forWallet(e,t,a),l=await v.depTables.AddPublicDeriver.add(e,t,{addLevelRequest:{privateKeyInfo:r.pathToPublic[r.pathToPublic.length-1].privateKey,publicKeyInfo:r.pathToPublic[r.pathToPublic.length-1].publicKey,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:0===i.length?r.parentDerivationId:i[i.length-1].KeyDerivation.KeyDerivationId,Index:r.pathToPublic[r.pathToPublic.length-1].index}),levelInfo:e=>r.pathToPublic[r.pathToPublic.length-1].insert(e)},derivationTables:n,levelSpecificTableName:c,addPublicDeriverRequest:e=>({ConceptualWalletId:a,KeyDerivationId:e.derivationId,Name:r.publicDeriverMeta.name,Index:d.length,LastSyncInfoId:e.lastSyncInfoId})});return await v.depTables.AddDerivationTree.excludingParent(e,t,{derivationId:l.publicDeriverResult.KeyDerivationId,children:r.initialDerivations},n,r.pathStartLevel+r.pathToPublic.length-1),{publicDeriver:l,hwWalletMeta:null==r.hwWalletMetaInsert?void 0:await v.depTables.ModifyHwWalletMeta.add(e,t,r.hwWalletMetaInsert)}}}p()(v,"ownTables",n()({})),p()(v,"depTables",n()({GetPublicDeriver:b.e,AddDerivation:h.a,AddPublicDeriver:g.a,ModifyHwWalletMeta:g.d,AddDerivationTree:y}))},142:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var a=r(11),n=r.n(a);r(6),r(38);const s=n()({EXPEND:"expend",INCOME:"income",EXCHANGE:"exchange",SELF:"self",MULTI:"multi"})},144:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return O}));var a=r(35),n=r.n(a),s=r(55),o=r.n(s),i=r(123),c=r.n(i),d=r(34),l=r.n(d),u=r(8),p=r.n(u),h=r(113),f=r.n(h),w=r(31),g=r.n(w),b=r(75),y=r.n(b),I=r(1),v=r.n(I),T=r(29),m=r.n(T),x=(r(787),r(6)),A=r(60),k=r(38),D=r(21);class O{constructor(e,t,r,a){v()(this,"signRequest",void 0),v()(this,"metadata",void 0),v()(this,"networkSettingSnapshot",void 0),v()(this,"neededStakingKeyHashes",void 0),this.signRequest=e,this.metadata=t,this.networkSettingSnapshot=r,this.neededStakingKeyHashes=a}txId(){return e.from(x.a.WalletV4.hash_transaction(this.signRequest.unsignedTx.build()).to_bytes()).toString("hex")}totalInput(){var e;const t=new k.a([],{defaultNetworkId:this.networkSettingSnapshot.NetworkId,defaultIdentifier:D.c.Cardano});return t.add({identifier:D.c.Cardano,amount:new m.a(this.signRequest.unsignedTx.get_implicit_input().checked_add(this.signRequest.unsignedTx.get_explicit_input()).to_str()),networkId:this.networkSettingSnapshot.NetworkId}),y()(e=this.signRequest.changeAddr).call(e,e=>t.joinSubtractMutable(g()(e))),t}totalOutput(){const e=new k.a([],{defaultNetworkId:this.networkSettingSnapshot.NetworkId,defaultIdentifier:D.c.Cardano});return e.add({identifier:D.c.Cardano,amount:new m.a(this.signRequest.unsignedTx.get_explicit_output().to_str()),networkId:this.networkSettingSnapshot.NetworkId}),e}fee(){var e;const t=new k.a([],{defaultNetworkId:this.networkSettingSnapshot.NetworkId,defaultIdentifier:D.c.Cardano});return t.add({identifier:D.c.Cardano,amount:new m.a((null===(e=this.signRequest.unsignedTx.get_fee_if_set())||void 0===e?void 0:e.to_str())||"0").plus(this.signRequest.unsignedTx.get_deposit().to_str()),networkId:this.networkSettingSnapshot.NetworkId}),t}withdrawals(){const t=this.signRequest.unsignedTx.build().withdrawals();if(null==t)return[];const r=f()(t).call(t),a=[];for(let s=0;s<r.len();s++){var n;const o=r.get(s),i=null===(n=t.get(o))||void 0===n?void 0:n.to_str();if(null==i)continue;const c=new k.a([{identifier:D.c.Cardano,amount:new m.a(i),networkId:this.networkSettingSnapshot.NetworkId}],{defaultNetworkId:this.networkSettingSnapshot.NetworkId,defaultIdentifier:D.c.Cardano});a.push({address:e.from(o.to_address().to_bytes()).toString("hex"),amount:c})}return a}keyDeregistrations(){const t=this.signRequest.unsignedTx.build().certs();if(null==t)return[];const r=[];for(let a=0;a<t.len();a++){const n=t.get(a).as_stake_deregistration();if(null==n)continue;const s=x.a.WalletV4.RewardAddress.new(this.networkSettingSnapshot.ChainNetworkId,n.stake_credential());r.push({rewardAddress:e.from(s.to_address().to_bytes()).toString("hex"),refund:new k.a([{identifier:D.c.Cardano,amount:this.networkSettingSnapshot.KeyDeposit,networkId:this.networkSettingSnapshot.NetworkId}],{defaultNetworkId:this.networkSettingSnapshot.NetworkId,defaultIdentifier:D.c.Cardano})})}return r}receivers(e){const t=this.signRequest.unsignedTx.build().outputs(),r=[];for(let e=0;e<t.len();e++)r.push(Object(A.k)(t.get(e).address()));if(!e){var a;const e=p()(a=this.signRequest.changeAddr).call(a,e=>e.address);return l()(r).call(r,t=>!c()(e).call(e,t))}return r}uniqueSenderAddresses(){var e;return o()(new n.a(p()(e=this.signRequest.senderUtxos).call(e,e=>e.receiver)))}isEqual(t){return null!=t&&(t instanceof x.a.WalletV4.TransactionBuilder&&(r=this.signRequest.unsignedTx,a=t,e.from(r.build().to_bytes()).toString("hex")===e.from(a.build().to_bytes()).toString("hex")));var r,a}self(){return this.signRequest.unsignedTx}}}).call(this,r(48).Buffer)},147:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return c})),r.d(t,"c",(function(){return d}));var a=r(11),n=r.n(a),s=r(22),o=r(16);n()({address:"address",transaction:"transaction",pool:"pool"});const i={name:"PreferredExplorer",properties:{PreferredExplorerId:"PreferredExplorerId",ExplorerId:"ExplorerId",NetworkId:"NetworkId"}},c={name:"Explorer",properties:{ExplorerId:"ExplorerId",NetworkId:"NetworkId",IsBackup:"IsBackup",Endpoints:"Endpoints",Name:"Name"}},d=e=>{e.createTable(c.name).addColumn(c.properties.ExplorerId,s.Type.INTEGER).addColumn(c.properties.NetworkId,s.Type.INTEGER).addColumn(c.properties.IsBackup,s.Type.BOOLEAN).addColumn(c.properties.Endpoints,s.Type.OBJECT).addColumn(c.properties.Name,s.Type.STRING).addPrimaryKey([c.properties.ExplorerId]).addIndex("Explorer_IsBackup_Index",[c.properties.IsBackup],!1).addForeignKey("Explorer_NetworkId",{local:c.properties.NetworkId,ref:`${o.j.name}.${o.j.properties.NetworkId}`,action:s.ConstraintAction.CASCADE}),e.createTable(i.name).addColumn(i.properties.PreferredExplorerId,s.Type.INTEGER).addColumn(i.properties.ExplorerId,s.Type.INTEGER).addColumn(i.properties.NetworkId,s.Type.INTEGER).addPrimaryKey([i.properties.PreferredExplorerId],!0).addUnique("PreferredExplorer_NetworkId_Unique",[i.properties.NetworkId]).addForeignKey("PreferredExplorer_ExplorerId",{local:i.properties.ExplorerId,ref:`${c.name}.${c.properties.ExplorerId}`,action:s.ConstraintAction.CASCADE}).addForeignKey("PreferredExplorer_NetworkId",{local:i.properties.NetworkId,ref:`${o.j.name}.${o.j.properties.NetworkId}`,action:s.ConstraintAction.CASCADE})}},15:function(e,t,r){"use strict";r.d(t,"l",(function(){return T})),r.d(t,"f",(function(){return m})),r.d(t,"b",(function(){return x})),r.d(t,"c",(function(){return A})),r.d(t,"e",(function(){return k})),r.d(t,"d",(function(){return D})),r.d(t,"i",(function(){return O})),r.d(t,"j",(function(){return S})),r.d(t,"n",(function(){return E})),r.d(t,"a",(function(){return P})),r.d(t,"m",(function(){return C})),r.d(t,"k",(function(){return _})),r.d(t,"g",(function(){return G})),r.d(t,"h",(function(){return W}));var a=r(84),n=r.n(a),s=r(30),o=r.n(s),i=r(66),c=r.n(i),d=r(35),l=r.n(d),u=r(55),p=r.n(u),h=r(31),f=r.n(h),w=r(8),g=r.n(w),b=r(40),y=r.n(b),I=r(43),v=r(402);async function T(e){return await new y.a((t,r)=>{e.onsuccess=()=>t(e.result),e.onerror=()=>r()})}async function m(e,t,r){const a=e.getSchema().table(r),n=e.select().from(a);return await t.attach(n)}async function x(e,t,r,a){var n;const s=e.getSchema().table(a),o=g()(r).call(r,e=>s.createRow(e));return await t.attach(f()(n=e.insert().into(s)).call(n,o))}async function A(e,t,r,a){return(await x(e,t,[r],a))[0]}async function k(e,t,r,a){var n;const s=e.getSchema().table(a),o=g()(r).call(r,e=>s.createRow(e));return await t.attach(f()(n=e.insertOrReplace().into(s)).call(n,o))}async function D(e,t,r,a){return(await k(e,t,[r],a))[0]}const O=async(e,t,r,a,n)=>{const s=e.getSchema().table(a),o=e.select().from(s).where(s[n].eq(r)),i=await t.attach(o);if(0!==i.length)return i[0]};async function S(e,t,r,a,n){const s=e.getSchema().table(r),o=e.select().from(s).where(s[a].in(n));return await t.attach(o)}async function E(e,t,r,a,n){const s=e.getSchema().table(r);await t.attach(e.delete().from(s).where(s[a].in(n)))}class P extends v.a{constructor(e="Storage query using stale data"){super(e)}}async function C(e,t,r){const a=e.createTransaction();await a.begin(t);try{const e=await r(a);return await a.commit(),e}catch(e){const r=p()(new l.a(g()(t).call(t,e=>e.getName()))).join("\n");throw console.error("rolling back Lovefield query for\n"+r+" with error "+c()(e)),await a.rollback(),e}}function _(e,t){var r;return g()(r=p()(f()(t).call(t))).call(r,t=>e.getSchema().table(t))}function G(e,t){var r;return g()(r=N(t)).call(r,t=>e.getSchema().table(t))}function W(...e){const t=[];for(const r of e)t.push(...N(r));return new l.a(t)}function N(e){var t,r,a,s;if(void 0===e)throw new Error("Found undefined table. Probably a static initialization order issue");const i=g()(t=g()(r=o()(e.ownTables)).call(r,t=>e.ownTables[t])).call(t,e=>e.name);return 0===Object(I.size)(e.depTables)?i:n()(i).call(i,...g()(a=g()(s=o()(e.depTables)).call(s,t=>e.depTables[t])).call(a,e=>N(e)))}},151:function(e,t,r){"use strict";r.d(t,"a",(function(){return I}));var a=r(197),n=r.n(a),s=r(1),o=r.n(s),i=r(198),c=r.n(i),d=r(241),l=r.n(d),u=r(77),p=r(459),h=r(554),f=r(53),w=new n.a,g=new n.a,b=new n.a,y=new n.a;class I extends u.a{constructor(e,t,r,a,n){return super(t),w.set(this,{writable:!0,value:void 0}),g.set(this,{writable:!0,value:void 0}),b.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:void 0}),o()(this,"getDerivationTables",()=>f.b),o()(this,"rawRemove",async(e,t)=>{await h.a.remove(e,t,this.getConceptualWalletId()),await Object(u.d)(e,t,this.getConceptualWalletId())}),l()(this,w,r.PublicDeriverLevel),l()(this,g,r.SignerLevel),l()(this,b,a),l()(this,y,n),this}getPublicDeriverLevel(){return c()(this,w)}getSigningLevel(){return c()(this,g)}getPrivateDeriverLevel(){return c()(this,b)}getPrivateDeriverKeyDerivationId(){return c()(this,y)}static async createCip1852Wallet(e,t){return await Object(p.c)(e,t,I)}}},152:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var a=r(11),n=r.n(a),s=r(56),o=r.n(s),i=r(8),c=r.n(i),d=r(35),l=r.n(d),u=r(55),p=r.n(u),h=r(1),f=r.n(h),w=r(43),g=r(160),b=r(15);class y{static async fromAddressIds(e,t,r){const a=y.ownTables[g.a.name];return await Object(b.j)(e,t,a.name,a.properties.AddressId,r.ids)}static async fromTxIds(e,t,r){const a=y.ownTables[g.a.name];return await Object(b.j)(e,t,a.name,a.properties.TransactionId,r.ids)}}f()(y,"ownTables",n()({[g.a.name]:g.a})),f()(y,"depTables",n()({}));class I{static async fromAddressIds(e,t,r){const a=I.ownTables[g.b.name];return await Object(b.j)(e,t,a.name,a.properties.AddressId,r.ids)}static async fromTxIds(e,t,r){const a=I.ownTables[g.b.name];return await Object(b.j)(e,t,a.name,a.properties.TransactionId,r.ids)}}f()(I,"ownTables",n()({[g.b.name]:g.b})),f()(I,"depTables",n()({}));class v{static async getTxIdsForAddresses(e,t,r){const a=await v.depTables.GetAccountingInputs.fromAddressIds(e,t,{ids:r.addressIds}),n=await v.depTables.GetAccountingOutputs.fromAddressIds(e,t,{ids:r.addressIds});return p()(new l.a([...c()(a).call(a,e=>e.TransactionId),...c()(n).call(n,e=>e.TransactionId)]))}static async getIOsForTx(e,t,r){var a;const n=c()(a=r.txs).call(a,e=>e.TransactionId),s=await v.depTables.GetAccountingInputs.fromTxIds(e,t,{ids:n}),i=await v.depTables.GetAccountingOutputs.fromTxIds(e,t,{ids:n}),d=Object(w.groupBy)(s,e=>e.TransactionId),l=Object(w.groupBy)(i,e=>e.TransactionId),u=new o.a;for(const e of r.txs)u.set(e,{accountingInputs:d[e.TransactionId]||[],accountingOutputs:l[e.TransactionId]||[]});return u}}f()(v,"ownTables",n()({})),f()(v,"depTables",n()({GetAccountingInputs:y,GetAccountingOutputs:I}))},153:function(e,t,r){"use strict";(function(e){r.d(t,"d",(function(){return D})),r.d(t,"e",(function(){return S})),r.d(t,"c",(function(){return E})),r.d(t,"f",(function(){return C})),r.d(t,"a",(function(){return G})),r.d(t,"b",(function(){return W}));var a=r(34),n=r.n(a),s=r(35),o=r.n(s),i=r(32),c=r.n(i),d=r(8),l=r.n(d),u=r(113),p=r.n(u),h=r(55),f=r.n(h),w=r(56),g=r.n(w),b=r(29),y=r.n(b),I=r(23),v=r(6),T=r(261),m=r(53),x=r(60),A=r(38),k=r(21);function D(e,t,r,a,n){var s;const o=new g.a;for(const e of t)o.set({amount:e.amount,receiver:e.receiver,tx_hash:e.tx_hash,tx_index:e.tx_index,utxo_id:e.utxo_id},e);const i=S(e,f()(p()(o).call(o)),r,a,n);return{senderUtxos:l()(s=i.senderUtxos).call(s,e=>{const t=o.get(e);if(null==t)throw new Error("sendAllUnsignedTx utxo reference was changed. Should not happen");return t}),txBuilder:i.txBuilder,changeAddr:i.changeAddr,certificates:[]}}function O(e,t,r){const a=Object(x.i)(t.receiver);if(null==a)throw new Error("addUtxoInput input not a valid Shelley address");const n=_(t),s=v.a.WalletV4.BigNum.from_str(t.amount);if(r){if(new y.a(e.fee_for_input(a,n,s).to_str()).gt(t.amount))return!1}return e.add_input(a,n,s),!0}function S(e,t,r,a,n){var s;const o=c()(s=l()(t).call(t,e=>new y.a(e.amount))).call(s,(e,t)=>e.plus(t),new y.a(0));if(o.isZero())throw new I.x;const i=v.a.WalletV4.TransactionBuilder.new(a.linearFee,a.minimumUtxoVal,a.poolDeposit,a.keyDeposit);i.set_ttl(r.plus(7200).toNumber());for(const e of t)O(i,e,!1);if(void 0!==n&&i.set_metadata(n),o.lt(i.min_fee().to_str()))throw new I.x;{const t=Object(x.i)(e.address);if(null==t)throw new Error("sendAllUnsignedTxFromUtxo receiver not a valid Shelley address");if(!i.add_change_if_needed(t))throw new I.x}const d=(()=>{if(null==e.addressing)return[];const{addressing:t}=e,r=new A.a([{identifier:k.c.Cardano,amount:new y.a(i.get_explicit_output().to_str()),networkId:a.networkId}],{defaultNetworkId:a.networkId,defaultIdentifier:k.c.Cardano});return[{addressing:t,address:e.address,values:r}]})();return{senderUtxos:t,txBuilder:i,changeAddr:d}}function E(e,t,r,a,n,s,o,i,d){var u;const h=new g.a;for(const e of r)h.set({amount:e.amount,receiver:e.receiver,tx_hash:e.tx_hash,tx_index:e.tx_index,utxo_id:e.utxo_id},e);const w=function(e,t,r,a,n,s,o,i,d){const l=!i&&0===e.length;if(l&&null==t)throw new I.w;const u=v.a.WalletV4.TransactionBuilder.new(n.linearFee,n.minimumUtxoVal,n.poolDeposit,n.keyDeposit);if(s.length>0){const e=c()(s).call(s,(e,t)=>(e.add(t),e),v.a.WalletV4.Certificates.new());u.set_certs(e)}void 0!==d&&u.set_metadata(d);if(o.length>0){const e=c()(o).call(o,(e,t)=>(e.insert(t.address,t.amount),e),v.a.WalletV4.Withdrawals.new());u.set_withdrawals(e)}u.set_ttl(a.plus(7200).toNumber());for(const t of e){const e=Object(x.i)(t.address);if(null==e)throw new Error("newAdaUnsignedTxFromUtxo receiver not a valid Shelley address");u.add_output(v.a.WalletV4.TransactionOutput.new(e,v.a.WalletV4.BigNum.from_str(t.amount)))}const p=[];{let e=new y.a(u.get_explicit_input().to_str());for(const a of r){if(!O(u,a,!0))continue;p.push(a),e=e.plus(a.amount);const r=new y.a(u.get_explicit_output().checked_add(u.min_fee()).checked_add(u.get_deposit()).to_str());if(l){if(null==t)throw new I.w;const a=P(u,t,n);if(e.gte(a.plus(r)))break}if(!l&&e.gte(r))break}if(0===p.length)throw new I.x;{const r=new y.a(u.get_explicit_output().checked_add(u.min_fee()).checked_add(u.get_deposit()).to_str());if(l){if(null==t)throw new I.w;const a=P(u,t,n);if(e.lt(a.plus(r)))throw new I.x}if(!l&&e.lt(r))throw new I.x}}const h=(()=>{if(null==t){if(l)throw new I.w;const e=u.get_explicit_input().checked_add(u.get_implicit_input()),t=u.get_explicit_output(),r=u.get_deposit(),a=new y.a(e.checked_sub(t).checked_sub(r).to_str()),n=new y.a(u.min_fee().to_str());if(a.lt(n))throw new I.x;return u.set_fee(v.a.WalletV4.BigNum.from_str(a.toString())),[]}const e=u.get_explicit_output(),r=Object(x.i)(t.address);if(null==r)throw new Error("newAdaUnsignedTxFromUtxo change not a valid Shelley address");const a=u.add_change_if_needed(r);if(l&&!a)throw new Error("No change added even though it should be forced");const s=new A.a([{identifier:k.c.Cardano,amount:new y.a(u.get_explicit_output().checked_sub(e).to_str()),networkId:n.networkId}],{defaultNetworkId:n.networkId,defaultIdentifier:k.c.Cardano});return a?[{...t,values:s}]:[]})();return{senderUtxos:p,txBuilder:u,changeAddr:h}}(e,t,f()(p()(h).call(h)),a,n,s,o,i,d);return{senderUtxos:l()(u=w.senderUtxos).call(u,e=>{const t=h.get(e);if(null==t)throw new Error("newAdaUnsignedTx utxo reference was changed. Should not happen");return t}),txBuilder:w.txBuilder,changeAddr:w.changeAddr,certificates:s}}function P(e,t,r){const a=Object(x.i)(t.address);if(null==a)throw new Error("getFeeForChange change not a valid Shelley address");const n=e.fee_for_output(v.a.WalletV4.TransactionOutput.new(a,v.a.WalletV4.BigNum.from_str(4294967296..toString()))).to_str();return new y.a(n).plus(r.minimumUtxoVal.to_str())}function C(t,r,a,n,s){const i=new o.a,c=new o.a,d=[];for(const r of t.senderUtxos){const t=Object(x.i)(r.receiver);if(null==t)throw new Error("signTransaction utxo not a valid Shelley address");const a=Object(x.d)(t),n=e.from(t.to_bytes()).toString("hex");if(null!==a){if(void 0===a)throw new Error("signTransaction cannot sign script inputs");{const t=e.from(a.to_bytes()).toString("hex");c.has(t)||(c.add(t),d.push(r))}}else i.has(n)||(i.add(n),d.push(r))}const u=t.unsignedTx instanceof v.a.WalletV4.TransactionBuilder?t.unsignedTx.build():t.unsignedTx,p=v.a.WalletV4.hash_transaction(u),h=v.a.WalletV4.Vkeywitnesses.new(),f=v.a.WalletV4.BootstrapWitnesses.new();!function(e,t,r,a,n,s){const o=l()(t).call(t,e=>{if(e.addressing.startLevel+e.addressing.path.length-1!==m.a.ADDRESS.level)throw new Error("addWitnesses incorrect addressing size");return Object(T.a)({addressing:e.addressing,startingFrom:{level:r,key:a}})});for(let r=0;r<t.length;r++){const a=Object(x.i)(t[r].receiver);if(null==a)throw new Error("addWitnesses utxo not a valid Shelley address");const i=v.a.WalletV4.ByronAddress.from_address(a);if(null==i){const t=v.a.WalletV4.make_vkey_witness(e,o[r].to_raw_key());n.add(t)}else{const t=v.a.WalletV4.make_icarus_bootstrap_witness(e,i,o[r]);s.add(t)}}}(p,d,r,a,h,f);const w=new o.a;for(const t of n)w.has(t)||(w.add(t),h.add(v.a.WalletV4.Vkeywitness.from_bytes(e.from(t,"hex"))));const g=v.a.WalletV4.TransactionWitnessSet.new();return f.len()>0&&g.set_bootstraps(f),h.len()>0&&g.set_vkeys(h),v.a.WalletV4.Transaction.new(u,g,s)}function _(t){return v.a.WalletV4.TransactionInput.new(v.a.WalletV4.TransactionHash.from_bytes(e.from(t.tx_hash,"hex")),t.tx_index)}function G(e){return l()(e).call(e,e=>{var t;return{amount:n()(t=e.output.tokens).call(t,e=>e.Token.Identifier===k.c.Cardano)[0].TokenList.Amount,receiver:e.address,tx_hash:e.output.Transaction.Hash,tx_index:e.output.UtxoTransactionOutput.OutputIndex,utxo_id:e.output.Transaction.Hash+e.output.UtxoTransactionOutput.OutputIndex,addressing:e.addressing}})}function W(e){const t=v.a.WalletV4.TransactionBuilder.new(e.protocolParams.linearFee,v.a.WalletV4.BigNum.from_str("0"),v.a.WalletV4.BigNum.from_str("0"),v.a.WalletV4.BigNum.from_str("0"));return e=>{const r=Object(x.i)(e.receiver);if(null==r)throw new Error("addUtxoInput input not a valid Shelley address");return new y.a(t.fee_for_input(r,_(e),v.a.WalletV4.BigNum.from_str(e.amount)).to_str()).lte(e.amount)}}}).call(this,r(48).Buffer)},157:function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return y}));var a=r(11),n=r.n(a),s=r(1),o=r.n(s),i=r(22),c=r(655),d=r(199),l=r(200),u=r(88),p=r(16),h=r(25),f=r(62),w=r(53),g=r(15);class b{static async add(e,t,r){return await Object(g.c)(e,t,r,b.ownTables[d.a.name].name)}static async remove(e,t,r){const a=await b.depTables.GetBip44Wrapper.get(e,t,r);if(null==a)throw new Error("ModifyBip44Wrapper::remove Should never happen");await b.depTables.RemoveKeyDerivationTree.remove(e,t,{rootKeyId:a.RootKeyDerivationId})}}o()(b,"ownTables",n()({[d.a.name]:d.a})),o()(b,"depTables",n()({GetBip44Wrapper:c.b,RemoveKeyDerivationTree:f.l}));class y{static async pop(e,t,r,a){const{derivationLevel:n,...s}=r,o=await(async()=>{if(n===w.a.CHAIN.level){const n=(await y.depTables.GetDerivationSpecific.get(e,t,[r.pubDeriverKeyDerivationId],w.a.CHAIN.level,a))[0];if(void 0===n)throw new Error("ModifyDisplayCutoff::pop missing chain. Should never happen");return n}if(n===w.a.ACCOUNT.level)return(await y.depTables.GetPathWithSpecific.getPath(e,t,{...s,level:w.a.CHAIN.level},async r=>{const n=(await y.depTables.GetDerivationSpecific.get(e,t,[r],w.a.CHAIN.level,a))[0];if(void 0===n)throw new Error("ModifyDisplayCutoff::pop missing chain. Should never happen");return n})).levelSpecific;throw new Error("ModifyDisplayCutoff::pop incorrect pubderiver level")})();if(null===o.DisplayCutoff)throw new Error("ModifyDisplayCutoff::pop should DisplayCutoff==null");const i=o.DisplayCutoff+1,c=await y.depTables.GetChildWithSpecific.get(e,t,async r=>{const n=(await y.depTables.GetDerivationSpecific.get(e,t,[r],w.a.ADDRESS.level,a))[0];if(void 0===n)throw new Error("ModifyDisplayCutoff::pop missing address. Should never happen");return n},o.KeyDerivationId,i);if(void 0!==c)return await y.set(e,t,{derivationId:o.KeyDerivationId,newIndex:i}),{index:i,row:c.levelSpecific}}static async set(e,t,r){const a=e.getSchema().table(y.ownTables[l.b.name].name),n=e.update(a).set(a[l.b.properties.DisplayCutoff],r.newIndex).where(i.op.and(a[l.b.properties.KeyDerivationId].eq(r.derivationId)));await t.attach(n)}}o()(y,"ownTables",n()({[l.b.name]:l.b,[p.d.name]:p.d,[p.h.name]:p.h})),o()(y,"depTables",n()({GetPathWithSpecific:h.m,GetChildWithSpecific:h.f,GetDerivationSpecific:u.a}))},159:function(e,t,r){"use strict";(function(e){r.d(t,"c",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"d",(function(){return o})),r.d(t,"a",(function(){return i}));var a=r(6);function n(t,r,n){const s=a.a.WalletV3.Address.from_bytes(e.from(t,"hex"));if(s.get_kind()!==a.a.WalletV3.AddressKind.Group)return n;const o=s.to_group_address();if(null==o)return n;const i=o.get_account_key();return r===e.from(i.as_bytes()).toString("hex")}function s(t,r,a){const s=e.from(t.as_bytes()).toString("hex"),o=[];for(const e of r)n(e.address,s,a)&&o.push(e);return o}function o(t){const r=a.a.WalletV3.Address.from_bytes(e.from(t,"hex")).to_account_address();if(null==r)throw new Error("unwrapStakingKey staking key invalid");return r.get_account_key()}function i(e){const t=e.get_kind();switch(t){case a.a.WalletV3.DelegationKind.NonDelegated:return{pools:[]};case a.a.WalletV3.DelegationKind.Full:{const t=e.get_full();if(null==t)throw new Error("delegationTypeToResponse Should never happen");return{pools:[[t.to_string(),1]]}}case a.a.WalletV3.DelegationKind.Ratio:{const t=e.get_ratios();if(null==t)throw new Error("delegationTypeToResponse Should never happen");const r=[],a=t.pools();for(let e=0;e<a.size();e++){const t=a.get(e);r.push([t.pool().to_string(),t.parts()])}return{pools:r}}default:throw new Error(`delegationTypeToResponse unexpected kind ${t}`)}}}).call(this,r(48).Buffer)},16:function(e,t,r){"use strict";r.d(t,"j",(function(){return o})),r.d(t,"i",(function(){return i})),r.d(t,"b",(function(){return c})),r.d(t,"g",(function(){return d})),r.d(t,"h",(function(){return l})),r.d(t,"c",(function(){return u})),r.d(t,"n",(function(){return p})),r.d(t,"m",(function(){return h})),r.d(t,"f",(function(){return f})),r.d(t,"e",(function(){return w})),r.d(t,"d",(function(){return g})),r.d(t,"a",(function(){return b})),r.d(t,"l",(function(){return y})),r.d(t,"k",(function(){return I})),r.d(t,"o",(function(){return v}));var a=r(11),n=r.n(a),s=r(22);const o={name:"Network",properties:{NetworkId:"NetworkId",CoinType:"CoinType",Backend:"Backend",BaseConfig:"BaseConfig",Fork:"Fork"}},i={name:"Key",properties:{KeyId:"KeyId",Type:"Type",Hash:"Hash",IsEncrypted:"IsEncrypted",PasswordLastUpdate:"PasswordLastUpdate"}},c={name:"Address",properties:{AddressId:"AddressId",Digest:"Digest",Type:"Type",Hash:"Hash"}},d={name:"EncryptionMeta",properties:{EncryptionMetaId:"EncryptionMetaId",AddressSeed:"AddressSeed",TransactionSeed:"TransactionSeed",BlockSeed:"BlockSeed",TokenSeed:"TokenSeed"}},l={name:"KeyDerivation",properties:{KeyDerivationId:"KeyDerivationId",PrivateKeyId:"PrivateKeyId",PublicKeyId:"PublicKeyId",Parent:"Parent",Index:"Index"}},u={name:"Block",properties:{BlockId:"BlockId",SlotNum:"SlotNum",Height:"Height",Digest:"Digest",Hash:"Hash",BlockTime:"BlockTime"}},p=n()({CardanoByron:0,CardanoShelley:1,Jormungandr:100,Ergo:200}),h={name:"Transaction",properties:{TransactionId:"TransactionId",Type:"Type",Digest:"Digest",Hash:"Hash",BlockId:"BlockId",Ordinal:"Ordinal",LastUpdateTime:"LastUpdateTime",Status:"Status",ErrorMessage:"ErrorMessage",Extra:"Extra"}},f={name:"Certificate",properties:{CertificateId:"CertificateId",TransactionId:"TransactionId",Ordinal:"Ordinal",Kind:"Kind",Payload:"Payload"}},w={name:"CertificateAddress",properties:{CertificateAddressId:"CertificateAddressId",CertificateId:"CertificateId",AddressId:"AddressId",Relation:"Relation"}},g={name:"CanonicalAddress",properties:{CanonicalAddressId:"CanonicalAddressId",KeyDerivationId:"KeyDerivationId"}},b={name:"AddressMapping",properties:{AddressMappingId:"AddressMappingId",KeyDerivationId:"KeyDerivationId",AddressId:"AddressId"}},y={name:"Token",properties:{TokenId:"TokenId",IsDefault:"IsDefault",NetworkId:"NetworkId",Digest:"Digest",Identifier:"Identifier",Metadata:"Metadata"}},I={name:"TokenList",properties:{TokenListItemId:"TokenListItemId",ListId:"ListId",TokenId:"TokenId",Amount:"Amount"}},v=e=>{e.createTable(o.name).addColumn(o.properties.NetworkId,s.Type.INTEGER).addColumn(o.properties.CoinType,s.Type.NUMBER).addColumn(o.properties.Backend,s.Type.OBJECT).addColumn(o.properties.BaseConfig,s.Type.OBJECT).addColumn(o.properties.Fork,s.Type.INTEGER).addPrimaryKey([o.properties.NetworkId]),e.createTable(i.name).addColumn(i.properties.KeyId,s.Type.INTEGER).addColumn(i.properties.Type,s.Type.INTEGER).addColumn(i.properties.Hash,s.Type.STRING).addColumn(i.properties.IsEncrypted,s.Type.BOOLEAN).addColumn(i.properties.PasswordLastUpdate,s.Type.DATE_TIME).addPrimaryKey([i.properties.KeyId],!0).addNullable([i.properties.PasswordLastUpdate]),e.createTable(c.name).addColumn(c.properties.AddressId,s.Type.INTEGER).addColumn(c.properties.Digest,s.Type.NUMBER).addColumn(c.properties.Type,s.Type.NUMBER).addColumn(c.properties.Hash,s.Type.STRING).addPrimaryKey([c.properties.AddressId],!0).addIndex("Address_Digest_Index",[c.properties.Digest],!1).addIndex("Address_Type_Index",[c.properties.Type],!1),e.createTable(d.name).addColumn(d.properties.EncryptionMetaId,s.Type.INTEGER).addColumn(d.properties.AddressSeed,s.Type.INTEGER).addColumn(d.properties.TransactionSeed,s.Type.INTEGER).addColumn(d.properties.BlockSeed,s.Type.INTEGER).addColumn(d.properties.TokenSeed,s.Type.INTEGER).addPrimaryKey([d.properties.EncryptionMetaId],!1),e.createTable(l.name).addColumn(l.properties.KeyDerivationId,s.Type.INTEGER).addColumn(l.properties.PrivateKeyId,s.Type.INTEGER).addColumn(l.properties.PublicKeyId,s.Type.INTEGER).addColumn(l.properties.Parent,s.Type.INTEGER).addColumn(l.properties.Index,s.Type.INTEGER).addPrimaryKey([l.properties.KeyDerivationId],!0).addForeignKey("KeyDerivation_Parent",{local:l.properties.Parent,ref:`${l.name}.${l.properties.KeyDerivationId}`,timing:s.ConstraintTiming.DEFERRABLE}).addForeignKey("KeyDerivation_PrivateKeyId",{local:l.properties.PrivateKeyId,ref:`${i.name}.${i.properties.KeyId}`}).addForeignKey("KeyDerivation_PublicKeyId",{local:l.properties.PublicKeyId,ref:`${i.name}.${i.properties.KeyId}`}).addNullable([l.properties.PrivateKeyId,l.properties.PublicKeyId,l.properties.Parent,l.properties.Index]),e.createTable(u.name).addColumn(u.properties.BlockId,s.Type.INTEGER).addColumn(u.properties.SlotNum,s.Type.INTEGER).addColumn(u.properties.Height,s.Type.INTEGER).addColumn(u.properties.Digest,s.Type.NUMBER).addColumn(u.properties.Hash,s.Type.STRING).addColumn(u.properties.BlockTime,s.Type.DATE_TIME).addPrimaryKey([u.properties.BlockId],!0).addIndex("Block_Digest_Index",[u.properties.Digest],!1).addIndex("Block_Height_Index",[u.properties.Height],!1),e.createTable(h.name).addColumn(h.properties.TransactionId,s.Type.INTEGER).addColumn(h.properties.Type,s.Type.INTEGER).addColumn(h.properties.Digest,s.Type.NUMBER).addColumn(h.properties.Hash,s.Type.STRING).addColumn(h.properties.BlockId,s.Type.INTEGER).addColumn(h.properties.Ordinal,s.Type.INTEGER).addColumn(h.properties.LastUpdateTime,s.Type.NUMBER).addColumn(h.properties.Status,s.Type.INTEGER).addColumn(h.properties.ErrorMessage,s.Type.STRING).addColumn(h.properties.Extra,s.Type.OBJECT).addPrimaryKey([h.properties.TransactionId],!0).addForeignKey("Transaction_Block",{local:h.properties.BlockId,ref:`${u.name}.${u.properties.BlockId}`}).addNullable([h.properties.BlockId,h.properties.Ordinal,h.properties.ErrorMessage,h.properties.Extra]).addIndex("Transaction_Digest_Index",[h.properties.Digest],!1),e.createTable(g.name).addColumn(g.properties.CanonicalAddressId,s.Type.INTEGER).addColumn(g.properties.KeyDerivationId,s.Type.INTEGER).addPrimaryKey([g.properties.CanonicalAddressId],!0).addForeignKey("CanonicalAddress_KeyDerivation",{local:g.properties.KeyDerivationId,ref:`${l.name}.${l.properties.KeyDerivationId}`,action:s.ConstraintAction.CASCADE}).addIndex("CanonicalAddress_KeyDerivation_Index",[g.properties.KeyDerivationId],!0),e.createTable(b.name).addColumn(b.properties.AddressMappingId,s.Type.INTEGER).addColumn(b.properties.KeyDerivationId,s.Type.INTEGER).addColumn(b.properties.AddressId,s.Type.INTEGER).addPrimaryKey([b.properties.AddressMappingId],!0).addForeignKey("AddressMapping_KeyDerivation",{local:b.properties.KeyDerivationId,ref:`${l.name}.${l.properties.KeyDerivationId}`,action:s.ConstraintAction.CASCADE}).addForeignKey("AddressMapping_Address",{local:b.properties.AddressId,ref:`${c.name}.${c.properties.AddressId}`,action:s.ConstraintAction.CASCADE}).addIndex("AddressMapping_KeyDerivation_Index",[b.properties.KeyDerivationId],!1),e.createTable(f.name).addColumn(f.properties.CertificateId,s.Type.INTEGER).addColumn(f.properties.TransactionId,s.Type.INTEGER).addColumn(f.properties.Ordinal,s.Type.INTEGER).addColumn(f.properties.Kind,s.Type.INTEGER).addColumn(f.properties.Payload,s.Type.STRING).addPrimaryKey([f.properties.CertificateId],!0).addForeignKey("Certificate_Transaction",{local:f.properties.TransactionId,ref:`${h.name}.${h.properties.TransactionId}`,action:s.ConstraintAction.CASCADE}).addIndex("Certificate_Transaction_Index",[f.properties.TransactionId],!1),e.createTable(w.name).addColumn(w.properties.CertificateAddressId,s.Type.INTEGER).addColumn(w.properties.CertificateId,s.Type.INTEGER).addColumn(w.properties.AddressId,s.Type.INTEGER).addColumn(w.properties.Relation,s.Type.INTEGER).addPrimaryKey([w.properties.CertificateAddressId],!0).addForeignKey("CertificateAddress_Certificate",{local:w.properties.CertificateId,ref:`${f.name}.${f.properties.CertificateId}`,action:s.ConstraintAction.CASCADE}).addForeignKey("CertificateAddress_Address",{local:w.properties.AddressId,ref:`${c.name}.${c.properties.AddressId}`}).addIndex("CertificateAddress_Certificate_Index",[w.properties.CertificateId],!1).addIndex("Address_Transaction_Index",[w.properties.AddressId],!1),e.createTable(y.name).addColumn(y.properties.TokenId,s.Type.INTEGER).addColumn(y.properties.NetworkId,s.Type.INTEGER).addColumn(y.properties.IsDefault,s.Type.BOOLEAN).addColumn(y.properties.Identifier,s.Type.STRING).addColumn(y.properties.Digest,s.Type.NUMBER).addColumn(y.properties.Metadata,s.Type.OBJECT).addPrimaryKey([y.properties.TokenId],!0).addForeignKey("Token_Network",{local:y.properties.NetworkId,ref:`${o.name}.${o.properties.NetworkId}`,action:s.ConstraintAction.CASCADE}).addIndex("Token_Digest",[y.properties.Digest],!1),e.createTable(I.name).addColumn(I.properties.TokenListItemId,s.Type.INTEGER).addColumn(I.properties.ListId,s.Type.INTEGER).addColumn(I.properties.TokenId,s.Type.INTEGER).addColumn(I.properties.Amount,s.Type.STRING).addPrimaryKey([I.properties.TokenListItemId],!0).addForeignKey("TokenList_Token",{local:I.properties.TokenId,ref:`${y.name}.${y.properties.TokenId}`}).addIndex("TokenList_ListId",[I.properties.ListId],!1)}},160:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return i}));var a=r(22),n=r(16);const s={name:"AccountingTransactionInput",properties:{AccountingTransactionInputId:"AccountingTransactionInputId",TransactionId:"TransactionId",AddressId:"AddressId",SpendingCounter:"SpendingCounter",IndexInOwnTx:"IndexInOwnTx",TokenListId:"TokenListId"}},o={name:"AccountingTransactionOutput",properties:{AccountingTransactionOutputId:"AccountingTransactionOutputId",TransactionId:"TransactionId",AddressId:"AddressId",OutputIndex:"OutputIndex",TokenListId:"TokenListId"}},i=e=>{e.createTable(s.name).addColumn(s.properties.AccountingTransactionInputId,a.Type.INTEGER).addColumn(s.properties.TransactionId,a.Type.INTEGER).addColumn(s.properties.AddressId,a.Type.INTEGER).addColumn(s.properties.SpendingCounter,a.Type.INTEGER).addColumn(s.properties.IndexInOwnTx,a.Type.INTEGER).addColumn(s.properties.TokenListId,a.Type.INTEGER).addPrimaryKey([s.properties.AccountingTransactionInputId],!0).addForeignKey("AccountingTransactionInput_Transaction",{local:s.properties.TransactionId,ref:`${n.m.name}.${n.m.properties.TransactionId}`,action:a.ConstraintAction.CASCADE}).addForeignKey("AccountingTransactionInput_Address",{local:s.properties.AddressId,ref:`${n.b.name}.${n.b.properties.AddressId}`}),e.createTable(o.name).addColumn(o.properties.AccountingTransactionOutputId,a.Type.INTEGER).addColumn(o.properties.TransactionId,a.Type.INTEGER).addColumn(o.properties.AddressId,a.Type.INTEGER).addColumn(o.properties.OutputIndex,a.Type.INTEGER).addColumn(o.properties.TokenListId,a.Type.INTEGER).addPrimaryKey([o.properties.AccountingTransactionOutputId],!0).addForeignKey("AccountingTransactionOutput_Transaction",{local:o.properties.TransactionId,ref:`${n.m.name}.${n.m.properties.TransactionId}`,action:a.ConstraintAction.CASCADE}).addForeignKey("AccountingTransactionOutput_Address",{local:o.properties.AddressId,ref:`${n.b.name}.${n.b.properties.AddressId}`})}},166:function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return m}));var a=r(30),n=r.n(a),s=r(8),o=r.n(s),i=r(37),c=r.n(i),d=r(11),l=r.n(d),u=r(56),p=r.n(u),h=r(34),f=r.n(h),w=r(33),g=(r(77),r(15)),b=r(25),y=r(88),I=r(76),v=r(131);async function T(e){var t,r;const a=Object(w.j)(e.publicDeriver),s=null==a?new p.a:a.getParent().getDerivationTables(),i=l()({GetUtxoTxOutputsWithTx:I.c,GetAddress:b.b,GetPathWithSpecific:b.m,GetDerivationSpecific:y.a}),d=c()(t=o()(r=n()(i)).call(r,e=>i[e])).call(t,t=>Object(g.g)(e.publicDeriver.getDb(),t));return await Object(g.m)(e.publicDeriver.getDb(),[...d,...Object(g.k)(e.publicDeriver.getDb(),s)],async t=>await async function(e,t,r,a){const n=Object(w.e)(r.publicDeriver);let s=null!=n?await n.rawGetAllUtxoAddresses(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},void 0,a):[];const o=Object(w.d)(r.publicDeriver),i=null!=o?await o.rawGetAllAccountingAddresses(e,{GetPathWithSpecific:t.GetPathWithSpecific,GetAddress:t.GetAddress,GetDerivationSpecific:t.GetDerivationSpecific},void 0,a):[],c=Object(w.c)(r.publicDeriver);if(null!=c){const r=await c.rawGetCutoff(e,{GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},void 0,a);s=f()(s).call(s,e=>e.addressing.path[e.addressing.path.length-1]<=r)}const d=[...s,...i];return await Object(v.d)(r.publicDeriver.getDb(),e,{GetUtxoTxOutputsWithTx:t.GetUtxoTxOutputsWithTx},{addresses:d,type:r.type,networkId:r.publicDeriver.getParent().getNetworkInfo().NetworkId,defaultToken:r.publicDeriver.getParent().getDefaultToken()})}(t,i,{publicDeriver:e.publicDeriver,type:e.type},s))}async function m(e,t,r,a){const n=[],s=[],o=Object(w.e)(r.publicDeriver);if(null!=o){const r=await o.rawGetAllUtxoAddresses(e,{GetPathWithSpecific:t.GetPathWithSpecific,GetAddress:t.GetAddress,GetDerivationSpecific:t.GetDerivationSpecific},void 0,a);for(const e of r)for(const t of e.addrs)n.push(t)}const i=Object(w.d)(r.publicDeriver);if(null!=i){const r=await i.rawGetAllAccountingAddresses(e,{GetPathWithSpecific:t.GetPathWithSpecific,GetAddress:t.GetAddress,GetDerivationSpecific:t.GetDerivationSpecific},void 0,a);for(const e of r)for(const t of e.addrs)s.push(t)}return{utxoAddresses:n,accountingAddresses:s}}},173:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r(402);class n extends a.a{constructor(e="Passphrase doesn't match"){super(e)}}a.a},176:function(e,t,r){"use strict";r.d(t,"b",(function(){return w})),r.d(t,"a",(function(){return g})),r.d(t,"c",(function(){return y}));var a=r(8),n=r.n(a),s=r(32),o=r.n(s),i=r(34),c=r.n(i),d=(r(43),r(29)),l=r.n(d),u=r(142),p=(r(19),r(53)),h=r(49),f=r(38);function w(e){var t,r,a,n;const s=[...e.utxoInputs,...null!==(t=e.accountingInputs)&&void 0!==t?t:[]],o=[...e.utxoOutputs,...null!==(r=e.accountingOutputs)&&void 0!==r?r:[]],i=c()(s).call(s,t=>e.allOwnedAddressIds.has(t.AddressId)),d=c()(o).call(o,t=>e.allOwnedAddressIds.has(t.AddressId)),l=b(s,e.tokens,e.defaultToken),p=b(o,e.tokens,e.defaultToken),h=b(i,e.tokens,e.defaultToken).joinAddCopy(null!==(a=e.ownImplicitInput)&&void 0!==a?a:new f.a([],e.defaultToken)),w=b(d,e.tokens,e.defaultToken).joinAddCopy(null!==(n=e.ownImplicitOutput)&&void 0!==n?n:new f.a([],e.defaultToken)),g=i.length===s.length,y=d.length===o.length,I=g&&y,v=i.length>0&&i.length!==s.length,T=w.joinSubtractCopy(h),m=p.joinSubtractCopy(l);return I?{type:u.a.SELF,amount:new f.a([],e.defaultToken),fee:m}:v?{type:u.a.MULTI,amount:T,fee:new f.a([],e.defaultToken)}:g?{type:u.a.EXPEND,amount:T.joinSubtractCopy(m),fee:m}:{type:u.a.INCOME,amount:T,fee:new f.a([],e.defaultToken)}}function g(e,t){const r=[];for(const i of e){var a,n,s,o;if(null!=i.block)r.push({date:i.block.BlockTime,type:i.type===u.a.INCOME?"in":"out",amount:Object(h.a)(null!==(a=null===(n=i.amount.get(t.Identifier))||void 0===n?void 0:n.abs().shiftedBy(-t.Metadata.numberOfDecimals))&&void 0!==a?a:new l.a(0)),fee:Object(h.a)(null!==(s=null===(o=i.fee.get(t.Identifier))||void 0===o?void 0:o.abs().shiftedBy(-t.Metadata.numberOfDecimals))&&void 0!==s?s:new l.a(0))})}return r}function b(e,t,r){const a=o()(e).call(e,(e,r)=>{for(const a of c()(t).call(t,e=>e.TokenList.ListId===r.TokenListId))e.push(a);return e},[]);return new f.a(n()(a).call(a,e=>({identifier:e.Token.Identifier,amount:new l.a(e.TokenList.Amount),networkId:e.Token.NetworkId})),r)}function y(e){if(e.startLevel!==p.a.PURPOSE.level)throw new Error("verifyFromBip44Root addressing does not start from root");if(e.startLevel+e.path.length-1!==p.a.ADDRESS.level)throw new Error("verifyFromBip44Root incorrect addressing size")}},179:function(e,t,r){"use strict";r.d(t,"e",(function(){return d})),r.d(t,"g",(function(){return l})),r.d(t,"d",(function(){return u})),r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return f})),r.d(t,"f",(function(){return w}));var a=r(58),n=r.n(a),s=r(32),o=r.n(s),i=r(90),c=r.n(i);async function d(e){return t=>{let r=e[0].SlotsPerEpoch,a=0,n=t.epoch;for(let c=0;c<e.length-1;c++){var s,o,i;const d=null!==(s=e[c].StartAt)&&void 0!==s?s:(()=>{throw new Error("genToAbsoluteSlotNumber missing start")})(),l=null!==(o=e[c+1].StartAt)&&void 0!==o?o:(()=>{throw new Error("genToAbsoluteSlotNumber missing end")})();if(l>t.epoch)break;const u=l-d;if(null==r)throw new Error("genToAbsoluteSlotNumber missing params");a+=r*u,n-=u,r=null!==(i=e[c+1].SlotsPerEpoch)&&void 0!==i?i:r}if(null==r)throw new Error("genToAbsoluteSlotNumber missing params");return a+=r*n,a+t.slot}}async function l(e){return t=>{let r=e[0].SlotsPerEpoch,a=0,n=t;for(let t=0;t<e.length-1;t++){var s,o,i;const c=null!==(s=e[t].StartAt)&&void 0!==s?s:(()=>{throw new Error("genToAbsoluteSlotNumber missing start")})(),d=(null!==(o=e[t+1].StartAt)&&void 0!==o?o:(()=>{throw new Error("genToAbsoluteSlotNumber missing end")})())-c;if(null==r)throw new Error("genToAbsoluteSlotNumber missing params");if(n<r*d)break;n-=r*d,a+=d,r=null!==(i=e[t+1].SlotsPerEpoch)&&void 0!==i?i:r}if(null==r)throw new Error("genToAbsoluteSlotNumber missing params");return a+=Math.floor(n/r),{epoch:a,slot:n%r}}}async function u(e){return t=>{const{GenesisDate:r}=e[0];if(null==r)throw new Error("genTimeToSlot missing genesis params");let a=e[0].SlotDuration,n=e[0].SlotsPerEpoch,s=t.time.getTime()-new Date(c()(r,10)).getTime(),o=0;for(let t=0;t<e.length-1;t++){var i,d,l,u;const r=null!==(i=e[t].StartAt)&&void 0!==i?i:(()=>{throw new Error("genTimeToSlot missing start")})(),c=(null!==(d=e[t+1].StartAt)&&void 0!==d?d:(()=>{throw new Error("genTimeToSlot missing end")})())-r;if(null==a||null==n)throw new Error("genTimeToSlot missing params");if(s<n*a*1e3*c)break;o+=n*c,s-=n*a*1e3*c,a=null!==(l=e[t+1].SlotDuration)&&void 0!==l?l:a,n=null!==(u=e[t+1].SlotsPerEpoch)&&void 0!==u?u:n}if(null==a||null==n)throw new Error("genTimeToSlot missing params");const p=s/1e3;return o+=Math.floor(p/a),{slot:o,msIntoSlot:1e3*(p%a)+s%1e3}}}async function p(e){return t=>o()(e).call(e,(e,t)=>n()(e,t),{}).SlotsPerEpoch}async function h(e){return t=>o()(e).call(e,(e,t)=>n()(e,t),{}).SlotDuration}async function f(e){return t=>{let r=e[0].SlotDuration,a=e[0].SlotsPerEpoch,n=0,s=t.absoluteSlotNum;for(let t=0;t<e.length-1;t++){var o,i,c,d;const l=null!==(o=e[t].StartAt)&&void 0!==o?o:(()=>{throw new Error("genTimeSinceGenesis missing start")})(),u=(null!==(i=e[t+1].StartAt)&&void 0!==i?i:(()=>{throw new Error("genTimeSinceGenesis missing end")})())-l;if(null==r||null==a)throw new Error("genTimeSinceGenesis missing params");if(s<a*u)break;n+=a*r*u,s-=a*u,r=null!==(c=e[t+1].SlotDuration)&&void 0!==c?c:r,a=null!==(d=e[t+1].SlotsPerEpoch)&&void 0!==d?d:a}if(null==r||null==a)throw new Error("genTimeSinceGenesis missing params");return n+=s*r,n}}async function w(e){return t=>{const{GenesisDate:r}=e[0];if(null==r)throw new Error("genToRealTime missing genesis start date");const a=t.timeSinceGenesisFunc({absoluteSlotNum:t.absoluteSlotNum}),n=new Date(c()(r,10)).getTime()+1e3*a;return new Date(n)}}},187:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var a=r(11),n=r.n(a);r(141),r(62),r(25);const s=n()({WEB_WALLET:0,HARDWARE_WALLET:1})},195:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return c}));var a=r(8),n=r.n(a),s=r(6),o=r(21);function i(e,t){const r=s.a.WalletV2.BlockchainSettings.from_json({protocol_magic:t});return t=>n()(t).call(t,t=>e.address_key(s.a.WalletV2.AddressKeyIndex.new(t)).bootstrap_era_address(r).to_base58())}async function c(e,t,r){return await e({...t,address:{type:o.b.CARDANO_LEGACY,data:r}}),{KeyDerivationId:t.keyDerivationId}}},196:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return p}));var a=r(11),n=r.n(a),s=r(1),o=r.n(s),i=r(22),c=r(91),d=r(15),l=r(76);class u{static async markAs(e,t,r){const a=await u.depTables.GetUtxoTxOutputsWithTx.getSingleOutput(e,t,{txId:r.txId,outputIndex:r.outputIndex,networkId:r.networkId});if(void 0===a)return;const n=e.getSchema().table(u.ownTables[c.b.name].name),s=e.update(n).set(n[c.b.properties.IsUnspent],r.isUnspent).where(i.op.and(n[c.b.properties.UtxoTransactionOutputId].eq(a.UtxoTransactionOutput.UtxoTransactionOutputId)));return await t.attach(s),{...a,UtxoTransactionOutput:{...a.UtxoTransactionOutput,IsUnspent:!1}}}}o()(u,"ownTables",n()({[c.b.name]:c.b})),o()(u,"depTables",n()({GetUtxoTxOutputsWithTx:l.c}));class p{static async addIOsToTx(e,t,r){const{utxoInputs:a,utxoOutputs:n}=r;return{utxoInputs:await Object(d.b)(e,t,a,p.ownTables[c.a.name].name),utxoOutputs:await Object(d.b)(e,t,n,p.ownTables[c.b.name].name)}}}o()(p,"ownTables",n()({[c.a.name]:c.a,[c.b.name]:c.b})),o()(p,"depTables",n()({}))},199:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return i}));var a=r(65),n=r(22),s=r(16);const o={name:"Bip44Wrapper",properties:{ConceptualWalletId:"ConceptualWalletId",SignerLevel:"SignerLevel",PublicDeriverLevel:"PublicDeriverLevel",PrivateDeriverLevel:"PrivateDeriverLevel",PrivateDeriverKeyDerivationId:"PrivateDeriverKeyDerivationId",RootKeyDerivationId:"RootKeyDerivationId"}},i=e=>{e.createTable(o.name).addColumn(o.properties.ConceptualWalletId,n.Type.INTEGER).addColumn(o.properties.SignerLevel,n.Type.INTEGER).addColumn(o.properties.PublicDeriverLevel,n.Type.INTEGER).addColumn(o.properties.PrivateDeriverLevel,n.Type.INTEGER).addColumn(o.properties.PrivateDeriverKeyDerivationId,n.Type.INTEGER).addColumn(o.properties.RootKeyDerivationId,n.Type.INTEGER).addForeignKey("Bip44Wrapper_ConceptualWallet",{local:o.properties.ConceptualWalletId,ref:`${a.a.name}.${a.a.properties.ConceptualWalletId}`}).addForeignKey("Bip44Wrapper_PrivateDeriverKeyDerivation",{local:o.properties.PrivateDeriverKeyDerivationId,ref:`${s.h.name}.${s.h.properties.KeyDerivationId}`}).addForeignKey("Bip44Wrapper_RootKeyDerivation",{local:o.properties.RootKeyDerivationId,ref:`${s.h.name}.${s.h.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}).addUnique("Bip44Wrapper_ConceptualWallet_Unique",[o.properties.ConceptualWalletId]).addNullable([o.properties.SignerLevel,o.properties.PrivateDeriverLevel,o.properties.PrivateDeriverKeyDerivationId])}},20:function(e,t,r){"use strict";r.d(t,"a",(function(){return I})),r.d(t,"j",(function(){return T})),r.d(t,"i",(function(){return m})),r.d(t,"h",(function(){return x})),r.d(t,"f",(function(){return A})),r.d(t,"g",(function(){return k})),r.d(t,"c",(function(){return D})),r.d(t,"e",(function(){return O})),r.d(t,"d",(function(){return S})),r.d(t,"b",(function(){return E}));var a,n,s=r(30),o=r.n(s),i=r(8),c=r.n(i),d=r(37),l=r.n(d),u=r(66),p=r.n(u),h=r(11),f=r.n(h),w=r(19),g=r(21),b=r(47),y=r(212);const I=f()({Haskell:0,Jormungandr:1}),v=f()({Primary:0}),T=f()({CardanoMainnet:{NetworkId:0,Backend:{BackendService:b.a.isTest()?"http://localhost:8080":"https://iohk-mainnet.yoroiwallet.com",WebSocket:b.a.isTest()?"ws://localhost:8080":"wss://iohk-mainnet.yoroiwallet.com:443"},BaseConfig:[f()({StartAt:0,ChainNetworkId:"1",ByronNetworkId:764824073,GenesisDate:"1506203091000",SlotsPerEpoch:21600,SlotDuration:20}),f()({StartAt:208,SlotsPerEpoch:432e3,SlotDuration:1,PerEpochPercentageReward:69344,LinearFee:{coefficient:"44",constant:"155381"},MinimumUtxoVal:"1000000",PoolDeposit:"500000000",KeyDeposit:"2000000"})],CoinType:w.d.CARDANO,Fork:I.Haskell},JormungandrMainnet:{NetworkId:100,Backend:{BackendService:b.a.isTest()?"http://localhost:21000":"https://shelley-itn-yoroi-backend.yoroiwallet.com",WebSocket:b.a.isTest()?"ws://localhost:21000":"wss://shelley-itn-yoroi-backend.yoroiwallet.com:443"},BaseConfig:[f()({StartAt:0,Discriminant:b.a.isTest()||b.a.isJest()?0:1,ChainNetworkId:"8e4d2a343f3dcf9330ad9035b3e8d168e6728904262f2c434a4f8f934ec7b676",ByronNetworkId:764824073,GenesisDate:"1576264417000",SlotsPerEpoch:43200,SlotDuration:2,PerEpochPercentageReward:19666,LinearFee:{constant:"200000",coefficient:"100000",certificate:"400000",per_certificate_fees:{certificate_pool_registration:"500000000",certificate_stake_delegation:"400000"}}})],CoinType:w.d.CARDANO,Fork:I.Jormungandr},ErgoMainnet:{NetworkId:200,Backend:{BackendService:b.a.isTest()?"http://localhost:21001":"https://ergo-backend.yoroiwallet.com"},BaseConfig:[f()({StartAt:0,ChainNetworkId:"0",MinimumBoxValue:"100000",FeeAddress:Object(y.decode)("2iHkR7CWvD1R4j1yZg5bkeDRQavjAaVPeTDFGGLZduHyfWMuYpmhHocX8GJoaieTx78FntzJbCBVL6rf96ocJoZdmWBL2fci7NqWgAirppPQmZ7fN9V6z13Ay6brPriBKYqLp1bT2Fk4FkFLCfdPpe").toString("hex")})],CoinType:w.d.ERGO,Fork:v.Primary},CardanoTestnet:{NetworkId:300,Backend:{BackendService:b.a.isTest()?"http://localhost:8080":"https://testnet-backend.yoroiwallet.com",WebSocket:b.a.isTest()?"ws://localhost:8080":"wss://testnet-backend.yoroiwallet.com:443"},BaseConfig:[f()({StartAt:0,ChainNetworkId:"0",ByronNetworkId:1097911063,GenesisDate:"1563999616000",SlotsPerEpoch:21600,SlotDuration:20}),f()({StartAt:74,SlotsPerEpoch:432e3,SlotDuration:1,PerEpochPercentageReward:69344,LinearFee:{coefficient:"44",constant:"155381"},MinimumUtxoVal:"1000000",PoolDeposit:"500000000",KeyDeposit:"2000000"})],CoinType:w.d.CARDANO,Fork:I.Haskell}});function m(e){return e.NetworkId===T.JormungandrMainnet.NetworkId||e.NetworkId===T.CardanoTestnet.NetworkId}function x(e){return e.CoinType===w.d.CARDANO&&e.Fork===I.Jormungandr}function A(e){return e.CoinType===w.d.CARDANO&&e.Fork===I.Haskell}function k(e){return e.CoinType===w.d.ERGO&&e.Fork===v.Primary}function D(e){if(!A(e))throw new Error(`Incorrect network type ${p()(e)}`);return e.BaseConfig}function O(e){if(!x(e))throw new Error(`Incorrect network type ${p()(e)}`);return e.BaseConfig}function S(e){if(!k(e))throw new Error(`Incorrect network type ${p()(e)}`);return e.BaseConfig}const E=l()(a=c()(n=o()(T)).call(n,e=>T[e])).call(a,e=>{if(x(e))return[{NetworkId:e.NetworkId,Identifier:g.c.Jormungandr,IsDefault:!0,Metadata:{type:"Cardano",policyId:g.c.Jormungandr,assetName:g.c.Jormungandr,ticker:"ADA",longName:null,numberOfDecimals:6}}];if(A(e))return[{NetworkId:e.NetworkId,Identifier:g.c.Cardano,IsDefault:!0,Metadata:{type:"Cardano",policyId:g.c.Cardano,assetName:g.c.Cardano,ticker:e===T.CardanoTestnet?"TADA":"ADA",longName:null,numberOfDecimals:6}}];if(k(e))return[{NetworkId:e.NetworkId,Identifier:g.c.Ergo,IsDefault:!0,Metadata:{type:"Ergo",height:0,boxId:g.c.Ergo,ticker:"ERG",longName:null,numberOfDecimals:"1000000000".length-1,description:null}}];throw new Error(`Missing default asset for network type ${p()(e)}`)})},200:function(e,t,r){"use strict";r.d(t,"e",(function(){return s})),r.d(t,"d",(function(){return o})),r.d(t,"c",(function(){return i})),r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return d})),r.d(t,"f",(function(){return l}));var a=r(16),n=r(22);const s={name:"RootDerivation",properties:{RootDerivationId:"RootDerivationId",KeyDerivationId:"KeyDerivationId"}},o={name:"PurposeDerivation",properties:{PurposeDerivationId:"PurposeDerivationId",KeyDerivationId:"KeyDerivationId"}},i={name:"CoinTypeDerivation",properties:{CoinTypeDerivationId:"CoinTypeDerivationId",KeyDerivationId:"KeyDerivationId"}},c={name:"Bip44Account",properties:{Bip44AccountId:"Bip44AccountId",KeyDerivationId:"KeyDerivationId"}},d={name:"Bip44Chain",properties:{Bip44ChainId:"Bip44ChainId",KeyDerivationId:"KeyDerivationId",DisplayCutoff:"DisplayCutoff"}},l=e=>{e.createTable(s.name).addColumn(s.properties.RootDerivationId,n.Type.INTEGER).addColumn(s.properties.KeyDerivationId,n.Type.INTEGER).addPrimaryKey([s.properties.RootDerivationId],!0).addForeignKey("RootDerivation_KeyDerivation",{local:s.properties.KeyDerivationId,ref:`${a.h.name}.${a.h.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}),e.createTable(o.name).addColumn(o.properties.PurposeDerivationId,n.Type.INTEGER).addColumn(o.properties.KeyDerivationId,n.Type.INTEGER).addPrimaryKey([o.properties.PurposeDerivationId],!0).addForeignKey("PurposeDerivation_KeyDerivation",{local:o.properties.KeyDerivationId,ref:`${a.h.name}.${a.h.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}),e.createTable(i.name).addColumn(i.properties.CoinTypeDerivationId,n.Type.INTEGER).addColumn(i.properties.KeyDerivationId,n.Type.INTEGER).addPrimaryKey([i.properties.CoinTypeDerivationId],!0).addForeignKey("CoinTypeDerivation_KeyDerivation",{local:i.properties.KeyDerivationId,ref:`${a.h.name}.${a.h.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}),e.createTable(c.name).addColumn(c.properties.Bip44AccountId,n.Type.INTEGER).addColumn(c.properties.KeyDerivationId,n.Type.INTEGER).addPrimaryKey([c.properties.Bip44AccountId],!0).addForeignKey("Bip44Account_KeyDerivation",{local:c.properties.KeyDerivationId,ref:`${a.h.name}.${a.h.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}),e.createTable(d.name).addColumn(d.properties.Bip44ChainId,n.Type.INTEGER).addColumn(d.properties.KeyDerivationId,n.Type.INTEGER).addColumn(d.properties.DisplayCutoff,n.Type.INTEGER).addPrimaryKey([d.properties.Bip44ChainId],!0).addForeignKey("Bip44Chain_KeyDerivation",{local:d.properties.KeyDerivationId,ref:`${a.h.name}.${a.h.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}).addNullable([d.properties.DisplayCutoff])}},201:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return i}));var a=r(65),n=r(22),s=r(16);const o={name:"Cip1852Wrapper",properties:{ConceptualWalletId:"ConceptualWalletId",SignerLevel:"SignerLevel",PublicDeriverLevel:"PublicDeriverLevel",PrivateDeriverLevel:"PrivateDeriverLevel",PrivateDeriverKeyDerivationId:"PrivateDeriverKeyDerivationId",RootKeyDerivationId:"RootKeyDerivationId"}},i=e=>{e.createTable(o.name).addColumn(o.properties.ConceptualWalletId,n.Type.INTEGER).addColumn(o.properties.SignerLevel,n.Type.INTEGER).addColumn(o.properties.PublicDeriverLevel,n.Type.INTEGER).addColumn(o.properties.PrivateDeriverLevel,n.Type.INTEGER).addColumn(o.properties.PrivateDeriverKeyDerivationId,n.Type.INTEGER).addColumn(o.properties.RootKeyDerivationId,n.Type.INTEGER).addForeignKey("Cip1852Wrapper_ConceptualWallet",{local:o.properties.ConceptualWalletId,ref:`${a.a.name}.${a.a.properties.ConceptualWalletId}`}).addForeignKey("Cip1852Wrapper_PrivateDeriverKeyDerivation",{local:o.properties.PrivateDeriverKeyDerivationId,ref:`${s.h.name}.${s.h.properties.KeyDerivationId}`}).addForeignKey("Cip1852Wrapper_RootKeyDerivation",{local:o.properties.RootKeyDerivationId,ref:`${s.h.name}.${s.h.properties.KeyDerivationId}`,action:n.ConstraintAction.CASCADE}).addUnique("Cip1852Wrapper_ConceptualWallet_Unique",[o.properties.ConceptualWalletId]).addNullable([o.properties.SignerLevel,o.properties.PrivateDeriverLevel,o.properties.PrivateDeriverKeyDerivationId])}},202:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o}));var a=r(11),n=r.n(a);const s=n()({byron:"byron",shelley:"shelley"}),o=n()({StakeRegistration:"StakeRegistration",StakeDeregistration:"StakeDeregistration",StakeDelegation:"StakeDelegation",PoolRegistration:"PoolRegistration",PoolRetirement:"PoolRetirement",GenesisKeyDelegation:"GenesisKeyDelegation",MoveInstantaneousRewardsCert:"MoveInstantaneousRewardsCert"})},21:function(e,t,r){"use strict";r.d(t,"c",(function(){return s})),r.d(t,"b",(function(){return o})),r.d(t,"d",(function(){return i})),r.d(t,"a",(function(){return c}));var a=r(11),n=r.n(a);const s={Cardano:"",Ergo:"",Jormungandr:""},o=n()({CARDANO_LEGACY:0,CARDANO_BASE:1,CARDANO_PTR:2,CARDANO_ENTERPRISE:3,CARDANO_REWARD:4,JORMUNGANDR_SINGLE:100,JORMUNGANDR_GROUP:101,JORMUNGANDR_ACCOUNT:102,JORMUNGANDR_MULTISIG:103,ERGO_P2PK:200,ERGO_P2SH:201,ERGO_P2S:202}),i=n()({NOT_IN_REMOTE:-3,ROLLBACK_FAIL:-2,FAIL_RESPONSE:-1,PENDING:0,IN_BLOCK:1}),c=n()({SIGNER:0,REWARD_ADDRESS:1,PLEDGE_ADDRESS:2,OPERATOR:3,OWNER:4,POOL_KEY:5})},210:function(e,t,r){"use strict";(function(e){r.d(t,"e",(function(){return x})),r.d(t,"a",(function(){return A})),r.d(t,"c",(function(){return k})),r.d(t,"d",(function(){return O})),r.d(t,"f",(function(){return S})),r.d(t,"b",(function(){return P}));var a=r(55),n=r.n(a),s=r(75),o=r.n(s),i=r(35),c=r.n(i),d=r(123),l=r.n(d),u=r(8),p=r.n(u),h=r(32),f=r.n(h),w=r(29),g=r.n(w),b=r(131),y=r(6),I=r(33),v=(r(50),r(60)),T=r(21),m=r(38);async function x(e){return{utxoPart:await async function(e,t){const r=Object(I.e)(e);if(null==r)return new m.a([],e.getParent().getDefaultToken());const a=r,n=Object(v.l)(t),s=await a.getAllUtxos(),o=k(n,s,!1);return f()(o).call(o,(t,r)=>{var a;return t.joinAddMutable(new m.a(p()(a=r.output.tokens).call(a,e=>({identifier:e.Token.Identifier,amount:new g.a(e.TokenList.Amount),networkId:e.Token.NetworkId})),e.getParent().getDefaultToken()))},new m.a([],e.getParent().getDefaultToken()))}(e.publicDeriver,e.stakingAddress),accountPart:e.rewardBalance}}function A(t,r,a){const n=Object(v.i)(t);if(null==n)throw new Error(`addrContainsAccountKey invalid address ${t}`);const s=e.from(r.to_bytes()).toString("hex"),o=y.a.WalletV4.BaseAddress.from_address(n);if(null!=o&&e.from(o.stake_cred().to_bytes()).toString("hex")===s)return!0;y.a.WalletV4.PointerAddress.from_address(n);return a}function k(e,t,r){const a=[];for(const n of t)A(n.address,e,r)&&a.push(n);return a}async function D(e){const t=await Object(b.b)(e.publicDeriver.getDb(),[e.stakingKeyAddressId]),r=[];for(const n of t){var a;if(null==n.block)continue;if(n.transaction.Status!==T.d.IN_BLOCK)continue;const t=n.certificate.Kind;l()(a=e.kindFilter).call(a,t)&&r.push(n)}return r}async function O(e){const t=await D({publicDeriver:e.publicDeriver,stakingKeyAddressId:e.stakingKeyAddressId,kindFilter:[y.a.WalletV4.CertificateKind.StakeDeregistration,y.a.WalletV4.CertificateKind.StakeDelegation]}),r={currEpoch:void 0,prevEpoch:void 0,prevPrevEpoch:void 0,prevPrevPrevEpoch:void 0,fullHistory:t},a=new c.a;for(const n of t){const t=n.block;if(null==t)continue;const s=e.toRelativeSlotNumber(t.SlotNum),i=E(n.certificate.Payload,n.certificate.Kind);if(o()(i).call(i,e=>a.add(e[0])),null==r.currEpoch&&s.epoch<=e.currentEpoch&&(r.currEpoch={...n,pools:i}),null==r.prevEpoch&&s.epoch<=e.currentEpoch-1&&(r.prevEpoch={...n,pools:i}),null==r.prevPrevEpoch&&s.epoch<=e.currentEpoch-2&&(r.prevPrevEpoch={...n,pools:i}),null==r.prevPrevPrevEpoch&&s.epoch<=e.currentEpoch-3){r.prevPrevPrevEpoch={...n,pools:i};break}}return{...r,allPoolIds:n()(a)}}async function S(e){const t=await D({publicDeriver:e.publicDeriver,stakingKeyAddressId:e.stakingKeyAddressId,kindFilter:[y.a.WalletV4.CertificateKind.StakeDeregistration,y.a.WalletV4.CertificateKind.StakeRegistration]});return{current:0!==t.length&&t[0].certificate.Kind===y.a.WalletV4.CertificateKind.StakeRegistration,fullHistory:t}}function E(t,r){switch(r){case y.a.WalletV4.CertificateKind.StakeDeregistration:return[];case y.a.WalletV4.CertificateKind.StakeDelegation:{const r=y.a.WalletV4.StakeDelegation.from_bytes(e.from(t,"hex"));return[[e.from(r.pool_keyhash().to_bytes()).toString("hex"),1]]}default:throw new Error(`certificateToPoolList unexpected certificate kind ${r}`)}}function P(t,r,a){const n=y.a.WalletV4.StakeCredential.from_keyhash(t.hash());if(null==a)return r?[y.a.WalletV4.Certificate.new_stake_deregistration(y.a.WalletV4.StakeDeregistration.new(n))]:[];const s=[];return r||s.push(y.a.WalletV4.Certificate.new_stake_registration(y.a.WalletV4.StakeRegistration.new(n))),s.push(y.a.WalletV4.Certificate.new_stake_delegation(y.a.WalletV4.StakeDelegation.new(n,y.a.WalletV4.Ed25519KeyHash.from_bytes(e.from(a,"hex"))))),s}}).call(this,r(48).Buffer)},213:function(e,t,r){"use strict";r.d(t,"e",(function(){return n})),r.d(t,"g",(function(){return s})),r.d(t,"d",(function(){return o})),r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return d})),r.d(t,"f",(function(){return l}));var a=r(179);async function n(e){return Object(a.e)(e)}async function s(e){return Object(a.g)(e)}async function o(e){return Object(a.d)(e)}async function i(e){return Object(a.a)(e)}async function c(e){return Object(a.b)(e)}async function d(e){return Object(a.c)(e)}async function l(e){return Object(a.f)(e)}},214:function(e,t,r){"use strict";(function(e){r.d(t,"c",(function(){return S})),r.d(t,"d",(function(){return E})),r.d(t,"b",(function(){return P})),r.d(t,"e",(function(){return _})),r.d(t,"a",(function(){return G}));var a=r(256),n=r.n(a),s=r(1305),o=r.n(s),i=r(34),c=r.n(i),d=r(32),l=r.n(d),u=r(8),p=r.n(u),h=r(113),f=r.n(h),w=r(55),g=r.n(w),b=r(56),y=r.n(b),I=r(29),v=r.n(I),T=r(23),m=r(6),x=r(494),A=r(238),k=r(711),D=r(38),O=r(21);function S(e,t,r,a){var n;const s=new y.a;for(const e of t)s.set({amount:e.amount,receiver:e.receiver,tx_hash:e.tx_hash,tx_index:e.tx_index,utxo_id:e.utxo_id},e);const o=E(e,g()(f()(s).call(s)),r,a);return{senderUtxos:p()(n=o.senderUtxos).call(n,e=>{const t=s.get(e);if(null==t)throw new Error("sendAllUnsignedTx  utxo reference was changed. Should not happen");return t}),IOs:o.IOs,changeAddr:o.changeAddr,certificate:r}}function E(t,r,a,n){var s;const o=l()(s=p()(r).call(r,e=>new v.a(e.amount))).call(s,(e,t)=>e.plus(t),new v.a(0));if(o.isZero())throw new T.x;const i=Object(x.c)(n.feeConfig);let c;{const n=m.a.WalletV3.InputOutputBuilder.empty();for(const e of r){const t=Object(k.c)(e);n.add_input(t)}n.add_output(m.a.WalletV3.Address.from_bytes(e.from(t,"hex")),m.a.WalletV3.Value.from_str(o.toString()));const s=null!=a?m.a.WalletV3.Payload.certificate(a):m.a.WalletV3.Payload.no_payload(),d=n.estimate_fee(i,s).to_str();c=new v.a(d)}if(o.isLessThan(c))throw new T.x;return C([{address:t,amount:o.minus(c).toString()}],[],r,a,n)}function P(e,t,r,a,n){var s;const o=new y.a;for(const e of r)o.set({amount:e.amount,receiver:e.receiver,tx_hash:e.tx_hash,tx_index:e.tx_index,utxo_id:e.utxo_id},e);const i=C(e,t,g()(f()(o).call(o)),a,n);return{senderUtxos:p()(s=i.senderUtxos).call(s,e=>{const t=o.get(e);if(null==t)throw new Error("newAdaUnsignedTx utxo reference was changed. Should not happen");return t}),IOs:i.IOs,changeAddr:i.changeAddr,certificate:a}}function C(t,r,a,s,i){const d=Object(x.c)(i.feeConfig),l=m.a.WalletV3.InputOutputBuilder.empty();for(const r of t)l.add_output(m.a.WalletV3.Address.from_bytes(e.from(r.address,"hex")),m.a.WalletV3.Value.from_str(r.amount));const u=null!=s?m.a.WalletV3.Payload.certificate(s):m.a.WalletV3.Payload.no_payload();let p,h;const f=[];if(1===r.length){p=Object(k.a)(l,a,d,u);const t=r[0];h=l.seal_with_output_policy(u,d,m.a.WalletV3.OutputPolicy.one(m.a.WalletV3.Address.from_bytes(e.from(t.address,"hex"))));const s=function(t,r,a,s){const i=c()(a).call(a,e=>e.receiver===t.address),d=[],l=m.a.WalletV3.Address.from_bytes(e.from(t.address,"hex")),u=e.from(l.as_bytes()).toString("hex");for(let a=0;a<r.size();a++){const c=r.get(a),l=c.value().to_str(),p=e.from(c.address().as_bytes()).toString("hex");if(u===p){const e=o()(i).call(i,e=>e.amount===l);-1===e&&d.push({...t,values:new D.a([{identifier:O.c.Jormungandr,amount:new v.a(l),networkId:s}],{defaultNetworkId:s,defaultIdentifier:O.c.Jormungandr})}),n()(i).call(i,e,1)}}return d}(t,h.outputs(),p,i.networkId);f.push(...s)}else{if(0!==r.length)throw new Error("only support single change address");p=Object(k.b)(l,a,d,u),h=l.seal_with_output_policy(u,d,m.a.WalletV3.OutputPolicy.forget())}return{senderUtxos:p,IOs:h,changeAddr:f}}function _(e,t,r,a,n,s){const{senderUtxos:o,IOs:i}=e,c=new m.a.WalletV3.TransactionBuilder,d=function(e,t,r,a,n,s){const o=p()(t).call(t,e=>Object(A.a)({addressing:e.addressing,startingFrom:{key:a,level:r}})),i=m.a.WalletV3.Witnesses.new();for(let r=0;r<t.length;r++){const t=n?m.a.WalletV3.Witness.for_legacy_icarus_utxo(m.a.WalletV3.Hash.from_hex(s),e.get_auth_data_for_witness(),o[r]):m.a.WalletV3.Witness.for_utxo(m.a.WalletV3.Hash.from_hex(s),e.get_auth_data_for_witness(),o[r].to_raw_key());i.add(t)}return e.set_witnesses(i)}((null!=n?c.payload(n.certificate):c.no_payload()).set_ios(i.inputs(),i.outputs()),o,t,r,a,s),l=null==n?m.a.WalletV3.PayloadAuthData.for_no_payload():Object(x.b)(m.a.WalletV3.AccountBindingSignature.new_single(n.stakingKey,d.get_auth_data()),n.certificate),u=d.set_payload_auth(l);return m.a.WalletV3.Fragment.from_transaction(u)}function G(e){return p()(e).call(e,e=>{var t;return{amount:c()(t=e.output.tokens).call(t,e=>e.Token.Identifier===O.c.Jormungandr)[0].TokenList.Amount,receiver:e.address,tx_hash:e.output.Transaction.Hash,tx_index:e.output.UtxoTransactionOutput.OutputIndex,utxo_id:e.output.Transaction.Hash+e.output.UtxoTransactionOutput.OutputIndex,addressing:e.addressing}})}}).call(this,r(48).Buffer)},228:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return I}));var a=r(8),n=r.n(a),s=r(35),o=r.n(s),i=r(55),c=r.n(i),d=r(1),l=r.n(d),u=r(29),p=r.n(u),h=(r(787),r(6)),f=r(38),w=r(21);class g{constructor(e,t){l()(this,"signRequest",void 0),l()(this,"networkSettingSnapshot",void 0),this.signRequest=e,this.networkSettingSnapshot=t}totalInput(){return b(this.signRequest.unsignedTx,this.networkSettingSnapshot.NetworkId)}totalOutput(){return y(this.signRequest.unsignedTx,this.networkSettingSnapshot.NetworkId)}fee(){return I(this.signRequest.unsignedTx,this.networkSettingSnapshot.NetworkId)}uniqueSenderAddresses(){var e;return c()(new o.a(n()(e=this.signRequest.senderUtxos).call(e,e=>e.receiver)))}receivers(t){var r;const a=[],s=new o.a(n()(r=this.signRequest.changeAddr).call(r,e=>e.address)),i=this.signRequest.unsignedTx.outputs();for(let r=0;r<i.size();r++){const n=i.get(r),o=e.from(n.address().as_bytes()).toString("hex");!t&&s.has(o)||a.push(o)}return a}isEqual(t){return null!=t&&(t instanceof h.a.WalletV3.InputOutput&&function(t,r){const a=t.inputs(),n=r.inputs();if(a.size()!==n.size())return!1;const s=t.outputs(),o=r.outputs();if(s.size()!==o.size())return!1;for(let t=0;t<a.size();t++){const r=e.from(a.get(t).as_bytes()).toString("hex"),s=e.from(n.get(t).as_bytes()).toString("hex");if(r!==s)return!1}for(let t=0;t<s.size();t++){const r=s.get(t),a=o.get(t);if(r.value().to_str()!==a.value().to_str())return!1;const n=e.from(r.address().as_bytes()).toString("hex"),i=e.from(a.address().as_bytes()).toString("hex");if(n!==i)return!1}return!0}(this.signRequest.unsignedTx,t))}self(){return this.signRequest.unsignedTx}}function b(e,t){const r=new f.a([],{defaultNetworkId:t,defaultIdentifier:w.c.Jormungandr}),a=e.inputs();for(let e=0;e<a.size();e++){const n=a.get(e);r.add({identifier:w.c.Jormungandr,amount:new p.a(n.value().to_str()),networkId:t})}return r}function y(e,t){const r=new f.a([],{defaultNetworkId:t,defaultIdentifier:w.c.Jormungandr}),a=e.outputs();for(let e=0;e<a.size();e++){const n=a.get(e);r.add({identifier:w.c.Jormungandr,amount:new p.a(n.value().to_str()),networkId:t})}return r}function I(e,t){const r=y(e,t);return b(e,t).joinSubtractMutable(r)}}).call(this,r(48).Buffer)},23:function(e,t,r){"use strict";r.d(t,"C",(function(){return o})),r.d(t,"b",(function(){return i})),r.d(t,"s",(function(){return c})),r.d(t,"d",(function(){return d})),r.d(t,"t",(function(){return l})),r.d(t,"E",(function(){return u})),r.d(t,"D",(function(){return p})),r.d(t,"x",(function(){return h})),r.d(t,"f",(function(){return f})),r.d(t,"v",(function(){return w})),r.d(t,"z",(function(){return g})),r.d(t,"w",(function(){return b})),r.d(t,"c",(function(){return y})),r.d(t,"g",(function(){return I})),r.d(t,"p",(function(){return v})),r.d(t,"o",(function(){return T})),r.d(t,"n",(function(){return m})),r.d(t,"q",(function(){return x})),r.d(t,"m",(function(){return A})),r.d(t,"l",(function(){return k})),r.d(t,"A",(function(){return D})),r.d(t,"i",(function(){return O})),r.d(t,"B",(function(){return S})),r.d(t,"a",(function(){return E})),r.d(t,"h",(function(){return P})),r.d(t,"e",(function(){return C})),r.d(t,"j",(function(){return _})),r.d(t,"y",(function(){return G})),r.d(t,"k",(function(){return W})),r.d(t,"u",(function(){return N})),r.d(t,"r",(function(){return j}));var a=r(5),n=r(17);const s=Object(a.e)({serverStatusError:{id:"api.errors.serverStatusError",defaultMessage:"!!!Connection to the server failed. Please check your internet connection or our Twitter account (https://twitter.com/YoroiWallet)."},currentCoinPriceError:{id:"api.errors.currentCoinPriceError",defaultMessage:"!!!Current coin price data not available now."},historicalCoinPriceError:{id:"api.errors.histoicalCoinPriceError",defaultMessage:"!!!Historical coin price data not available now."},genericApiError:{id:"api.errors.GenericApiError",defaultMessage:"!!!An error occurred, please try again later."},incorrectWalletPasswordError:{id:"api.errors.IncorrectPasswordError",defaultMessage:"!!!Incorrect wallet password."},walletAlreadyRestoredError:{id:"api.errors.WalletAlreadyRestoredError",defaultMessage:"!!!Wallet you are trying to restore already exists."},reportRequestError:{id:"api.errors.ReportRequestError",defaultMessage:"!!!There was a problem sending the support request."},unusedAddressesError:{id:"api.errors.unusedAddressesError",defaultMessage:"!!!You cannot generate more than 20 consecutive unused addresses."},walletAlreadyImportedError:{id:"api.errors.WalletAlreadyImportedError",defaultMessage:"!!!Wallet you are trying to import already exists."},walletFileImportError:{id:"api.errors.WalletFileImportError",defaultMessage:"!!!Wallet could not be imported, please make sure you are providing a correct file."},notEnoughMoneyToSendError:{id:"api.errors.NotEnoughMoneyToSendError",defaultMessage:"!!!Not enough funds to make this transaction."},updateAdaWalletError:{id:"api.errors.updateAdaWalletError",defaultMessage:"!!!Error while updating ada wallet."},getBalanceError:{id:"api.errors.getBalanceError",defaultMessage:"!!!Error while getting Balance."},updateAdaTxsHistoryError:{id:"api.errors.updateAdaTxsHistoryError",defaultMessage:"!!!Error while updating ada transactions history."},transactionError:{id:"api.errors.transactionError",defaultMessage:"!!!Error while creating transaction."},pendingTransactionError:{id:"api.errors.pendingTransactionError",defaultMessage:"!!!Error while updating pending transactions."},getAddressesKeysError:{id:"api.errors.getAddressesWithFundsError",defaultMessage:"!!!Error while getting addresses with funds."},noInputsError:{id:"api.errors.noInputsError",defaultMessage:"!!!The wallet restored from your recovery phrase is empty. Please check your recovery phrase and attempt restoration again."},rewardAddressEmptyError:{id:"api.errors.rewardAddressEmpty",defaultMessage:"!!!Reward address is empty."},noOutputsError:{id:"api.errors.noOutputsError",defaultMessage:"!!!Transaction requires at least 1 output, but no output was added"},generateTransferTxError:{id:"api.errors.generateTransferTxError",defaultMessage:"!!!Error while generating transfer transaction."},sendTransactionError:{id:"api.errors.sendTransactionError",defaultMessage:"!!!Error received from api method call while sending tx."},getAllUTXOsForAddressesError:{id:"api.errors.getAllUTXOsForAddressesError",defaultMessage:"!!!Error received from api method call while getting utxos."},getTxsBodiesForUTXOsError:{id:"api.errors.getTxsBodiesForUTXOsError",defaultMessage:"!!!Error received from api method call while getting TxBodies."},getTxsBodiesForUTXOsApiError:{id:"api.errors.getTxsBodiesForUTXOsApiError",defaultMessage:"!!!Error received from server while getting TxBodies."},discoverAddressesError:{id:"api.errors.discoverAddressesError",defaultMessage:"!!!Error received from api method call while discovering addresses."},getUtxosForAddressesApiError:{id:"api.errors.getUtxosForAddressesApiError",defaultMessage:"!!!Error received from server while getting UTXOs."},getUtxosSumsForAddressesApiError:{id:"api.errors.getUtxosSumsForAddressesApiError",defaultMessage:"!!!Error received from server while getting balance."},getTxHistoryForAddressesApiError:{id:"api.errors.getTxHistoryForAddressesApiError",defaultMessage:"!!!Error received from server while getting txs."},getRewardHistoryApiError:{id:"api.errors.getRewardHistoryApiError",defaultMessage:"!!!Error received from server while getting reward history."},rollbackApiError:{id:"api.errors.rollbackApiError",defaultMessage:"!!!Rollback was detected."},getBestBlockApiError:{id:"api.errors.getBestBlockApiError",defaultMessage:"!!!Error received from server while getting best block."},sendTransactionApiError:{id:"api.errors.sendTransactionApiError",defaultMessage:"!!!Error received from server while sending tx."},checkAdressesInUseApiError:{id:"api.errors.checkAdressesInUseApiError",defaultMessage:"!!!Error received from server while checking used addresses."},assetInfoApiError:{id:"api.errors.assetInfoApiError",defaultMessage:"!!!Error received from server while getting asset info."},getAccountStateApiError:{id:"api.errors.getAccountStateApiError",defaultMessage:"!!!Error received from server while getting account state."},getPoolInfoApiError:{id:"api.errors.getPoolInfoApiError",defaultMessage:"!!!Error received from server while getting pool info."},poolMissingApiError:{id:"api.errors.poolMissingApiError",defaultMessage:"!!!Could not find this pool. Double-check the ID and make sure the pool was not deregistered."},getReputationError:{id:"api.errors.getReputationError",defaultMessage:"!!!Error received from server while getting reputation."},invalidWitnessError:{id:"api.errors.invalidWitnessError",defaultMessage:"!!!The signature is invalid."},invalidMnemonicError:{id:"api.errors.invalidMnemonicError",defaultMessage:"!!!Invalid phrase entered, please check."},hardwareUnsupportedError:{id:"api.errors.hardwareUnsupportedError",defaultMessage:"!!!This action is not supported for the currently selected hardware."}});class o extends n.b{constructor(){super({id:s.serverStatusError.id,defaultMessage:s.serverStatusError.defaultMessage||""})}}class i extends n.b{constructor(){super({id:s.currentCoinPriceError.id,defaultMessage:s.currentCoinPriceError.defaultMessage||""})}}class c extends n.b{constructor(){super({id:s.historicalCoinPriceError.id,defaultMessage:s.historicalCoinPriceError.defaultMessage||""})}}class d extends n.b{constructor(){super({id:s.genericApiError.id,defaultMessage:s.genericApiError.defaultMessage||""})}}class l extends n.b{constructor(){super({id:s.incorrectWalletPasswordError.id,defaultMessage:s.incorrectWalletPasswordError.defaultMessage||""})}}class u extends n.b{constructor(){super({id:s.walletAlreadyRestoredError.id,defaultMessage:s.walletAlreadyRestoredError.defaultMessage||""})}}n.b;class p extends n.b{constructor(){super({id:s.unusedAddressesError.id,defaultMessage:s.unusedAddressesError.defaultMessage||""})}}n.b;n.b;class h extends n.b{constructor(){super({id:s.notEnoughMoneyToSendError.id,defaultMessage:s.notEnoughMoneyToSendError.defaultMessage||""})}}n.b;n.b;n.b;class f extends n.b{constructor(){super({id:s.getAddressesKeysError.id,defaultMessage:s.getAddressesKeysError.defaultMessage||""})}}class w extends n.b{constructor(){super({id:s.noInputsError.id,defaultMessage:s.noInputsError.defaultMessage||""})}}class g extends n.b{constructor(){super({id:s.rewardAddressEmptyError.id,defaultMessage:s.rewardAddressEmptyError.defaultMessage||""})}}class b extends n.b{constructor(){super({id:s.noOutputsError.id,defaultMessage:s.noOutputsError.defaultMessage||""})}}class y extends n.b{constructor(){super({id:s.generateTransferTxError.id,defaultMessage:s.generateTransferTxError.defaultMessage||""})}}n.b;class I extends n.b{constructor(){super({id:s.getAllUTXOsForAddressesError.id,defaultMessage:s.getAllUTXOsForAddressesError.defaultMessage||""})}}n.b;class v extends n.b{constructor(){super({id:s.getUtxosForAddressesApiError.id,defaultMessage:s.getUtxosForAddressesApiError.defaultMessage||""})}}class T extends n.b{constructor(){super({id:s.getTxsBodiesForUTXOsError.id,defaultMessage:s.getTxsBodiesForUTXOsError.defaultMessage||""})}}class m extends n.b{constructor(){super({id:s.getTxsBodiesForUTXOsApiError.id,defaultMessage:s.getTxsBodiesForUTXOsApiError.defaultMessage||""})}}class x extends n.b{constructor(){super({id:s.getUtxosSumsForAddressesApiError.id,defaultMessage:s.getUtxosSumsForAddressesApiError.defaultMessage||""})}}class A extends n.b{constructor(){super({id:s.getTxHistoryForAddressesApiError.id,defaultMessage:s.getTxHistoryForAddressesApiError.defaultMessage||""})}}class k extends n.b{constructor(){super({id:s.getRewardHistoryApiError.id,defaultMessage:s.getRewardHistoryApiError.defaultMessage||""})}}class D extends n.b{constructor(){super({id:s.rollbackApiError.id,defaultMessage:s.rollbackApiError.defaultMessage||""})}}class O extends n.b{constructor(){super({id:s.getBestBlockApiError.id,defaultMessage:s.getBestBlockApiError.defaultMessage||""})}}class S extends n.b{constructor(){super({id:s.sendTransactionApiError.id,defaultMessage:s.sendTransactionApiError.defaultMessage||""})}}class E extends n.b{constructor(){super({id:s.checkAdressesInUseApiError.id,defaultMessage:s.checkAdressesInUseApiError.defaultMessage||""})}}class P extends n.b{constructor(){super({id:s.checkAdressesInUseApiError.id,defaultMessage:s.checkAdressesInUseApiError.defaultMessage||""})}}class C extends n.b{constructor(){super({id:s.getAccountStateApiError.id,defaultMessage:s.getAccountStateApiError.defaultMessage||""})}}class _ extends n.b{constructor(){super({id:s.getPoolInfoApiError.id,defaultMessage:s.getPoolInfoApiError.defaultMessage||""})}}class G extends n.b{constructor(){super({id:s.poolMissingApiError.id,defaultMessage:s.poolMissingApiError.defaultMessage||""})}}class W extends n.b{constructor(){super({id:s.getReputationError.id,defaultMessage:s.getReputationError.defaultMessage||""})}}class N extends n.b{constructor(){super({id:s.invalidWitnessError.id,defaultMessage:s.invalidWitnessError.defaultMessage||""})}}n.b;class j extends n.b{constructor(){super({id:s.hardwareUnsupportedError.id,defaultMessage:s.hardwareUnsupportedError.defaultMessage||""})}}},238:function(e,t,r){"use strict";(function(e){r.d(t,"c",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return o}));var a=r(6);function n(e){return a.a.WalletV3.Bip32PrivateKey.from_bytes(e.as_bytes())}function s(t){return a.a.WalletV2.PublicKey.from_hex(e.from(t.as_bytes()).toString("hex"))}function o(e){const t=e.addressing.startLevel,r=e.addressing.path.length;if(e.startingFrom.level+1<t)throw new Error("derivePrivateByAddressing keyLevel < startLevel");let a=e.startingFrom.key;for(let n=e.startingFrom.level-t+1;n<r;n++)a=a.derive(e.addressing.path[n]);return a}}).call(this,r(48).Buffer)},239:function(e,t,r){"use strict";r.d(t,"a",(function(){return I}));var a=r(8),n=r.n(a),s=r(31),o=r.n(s),i=r(84),c=r.n(i),d=r(55),l=r.n(d),u=r(1),p=r.n(u),h=r(119),f=r(157),w=r(554),g=r(141),b=r(15),y=r(459);class I{constructor(e,t,r,a,n,s){p()(this,"db",void 0),p()(this,"txHolder",void 0),p()(this,"tables",void 0),p()(this,"derivationTables",void 0),p()(this,"buildSteps",void 0),p()(this,"state",void 0),p()(this,"addConceptualWallet",e=>this.updateData({conceptualWalletRow:null},l()(Object(b.h)(h.c)),async t=>{t.conceptualWalletRow=await h.c.add(this.db,this.txHolder.tx,e(t))})),p()(this,"addBip44Wrapper",e=>this.updateData({bip44WrapperRow:null},l()(Object(b.h)(f.a)),async t=>{t.bip44WrapperRow=await f.a.add(this.db,this.txHolder.tx,e(t))})),p()(this,"addCip1852Wrapper",e=>this.updateData({cip1852WrapperRow:null},l()(Object(b.h)(w.a)),async t=>{t.cip1852WrapperRow=await w.a.add(this.db,this.txHolder.tx,e(t))})),p()(this,"addFromRoot",e=>this.updateData({root:null},l()(Object(b.h)(g.b)),async t=>{const{rootInsert:r,tree:a}=e(t);t.root=await g.b.includingParent(this.db,this.txHolder.tx,r,this.derivationTables,0,a)})),p()(this,"addAdhocPublicDeriver",e=>this.updateData({publicDeriver:[]},l()(Object(b.h)(g.a)),async t=>{t.publicDeriver=[...t.publicDeriver,(await g.a.add(this.db,this.txHolder.tx,e(t),t.conceptualWalletRow.ConceptualWalletId,this.derivationTables)).publicDeriver]})),p()(this,"derivePublicDeriver",e=>this.updateData({publicDeriver:[]},l()(Object(b.h)(g.c)),async t=>{const{privateDeriverKeyDerivationId:r,privateDeriverLevel:a,deriverRequest:n}=e(t);t.publicDeriver=[...t.publicDeriver,await Object(y.a)(this.db,this.txHolder.tx,{DerivePublicDeriverFromKey:g.c},t.conceptualWalletRow.ConceptualWalletId,n,r,a,this.derivationTables)]})),this.db=e,this.txHolder=t,this.tables=r,this.buildSteps=a,this.state=n,this.derivationTables=s}updateData(e,t,r){var a,n;const s=this.state;return new I(this.db,this.txHolder,c()(a=this.tables).call(a,t),c()(n=this.buildSteps).call(n,r),{...e,...s},this.derivationTables)}static start(e,t){return new I(e,{tx:null},[],[],{},t)}async commit(){var e;const t=l()([...this.tables,...l()(o()(e=this.derivationTables).call(e))]),r=n()(t).call(t,e=>this.db.getSchema().table(e));return await Object(b.m)(this.db,r,async e=>{this.txHolder.tx=e;for(const e of this.buildSteps)await e(this.state)}),this.state}}},242:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));var a=r(22);const n={name:"TxMemo",properties:{WalletId:"WalletId",Content:"Content",Digest:"Digest",TransactionHash:"TransactionHash",LastUpdated:"LastUpdated"}},s=e=>{e.createTable(n.name).addColumn(n.properties.WalletId,a.Type.STRING).addColumn(n.properties.Content,a.Type.STRING).addColumn(n.properties.TransactionHash,a.Type.STRING).addColumn(n.properties.Digest,a.Type.NUMBER).addColumn(n.properties.LastUpdated,a.Type.DATE_TIME).addPrimaryKey([n.properties.WalletId,n.properties.Digest])}},243:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return he})),r.d(t,"c",(function(){return fe})),r.d(t,"b",(function(){return ge})),r.d(t,"d",(function(){return be})),r.d(t,"e",(function(){return ye})),r.d(t,"f",(function(){return Ie}));var a=r(90),n=r.n(a),s=r(58),o=r.n(s),i=r(75),c=r.n(i),d=r(31),l=r.n(d),u=r(32),p=r.n(u),h=r(165),f=r.n(h),w=r(150),g=r.n(w),b=r(11),y=r.n(b),I=r(30),v=r.n(I),T=r(37),m=r.n(T),x=r(34),A=r.n(x),k=r(56),D=r.n(k),O=r(35),S=r.n(O),E=r(55),P=r.n(E),C=r(8),_=r.n(C),G=r(29),W=r.n(G),N=r(43),j=r(15),R=r(16),B=r(25),K=r(62),U=r(408),L=r(118),M=r(196),F=r(76),H=r(152),V=r(107),$=r(21),q=r(33),J=(r(77),r(86)),X=r(157),Y=r(141),z=r(88),Z=r(20),Q=r(119),ee=r(166),te=r(106),re=r(130),ae=r(19),ne=r(23),se=r(176),oe=r(202),ie=r(60),ce=r(6),de=r(340),le=r(38);async function ue(e,t,r,a,n){const{utxoAddresses:s,accountingAddresses:o}=await Object(ee.b)(t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,GetDerivationSpecific:r.GetDerivationSpecific},a,n),i=_()(s).call(s,e=>e.AddressId),c=_()(o).call(o,e=>e.AddressId),d=await r.GetCertificates.forAddress(e,t,{addressIds:[...c,...i]});return{txIds:P()(new S.a([...await r.AssociateTxWithAccountingIOs.getTxIdsForAddresses(e,t,{addressIds:c}),...await r.AssociateTxWithUtxoIOs.getTxIdsForAddresses(e,t,{addressIds:i}),..._()(d).call(d,e=>e.transaction.TransactionId)])),addresses:{utxoAddresses:s,accountingAddresses:o}}}async function pe(t,r,a,n,s){var o,i;const{addresses:c,txIds:d}=await ue(t,r,{GetPathWithSpecific:a.GetPathWithSpecific,GetAddress:a.GetAddress,AssociateTxWithUtxoIOs:a.AssociateTxWithUtxoIOs,AssociateTxWithAccountingIOs:a.AssociateTxWithAccountingIOs,GetDerivationSpecific:a.GetDerivationSpecific,GetCertificates:a.GetCertificates},{publicDeriver:n.publicDeriver},s),l=new D.a,u=await n.getTxAndBlock(d);for(const e of u)l.set(e.Transaction.TransactionId,e.Block);const p=[...await a.CardanoByronAssociateTxWithIOs.getIOsForTx(t,r,{txs:A()(o=_()(u).call(u,e=>e.Transaction)).call(o,e=>e.Type===R.n.CardanoByron),networkId:n.publicDeriver.getParent().getNetworkInfo().NetworkId}),...await a.CardanoShelleyAssociateTxWithIOs.getIOsForTx(t,r,{txs:A()(i=_()(u).call(u,e=>e.Transaction)).call(i,e=>e.Type===R.n.CardanoShelley),networkId:n.publicDeriver.getParent().getNetworkInfo().NetworkId})],h=new D.a;{const e=m()(p).call(p,e=>{var t,r,a,n;return[..._()(t=e.utxoInputs).call(t,e=>e.AddressId),..._()(r=e.utxoOutputs).call(r,e=>e.AddressId),...null==e.accountingInputs?[]:_()(a=e.accountingInputs).call(a,e=>e.AddressId),...null==e.certificates?[]:m()(n=e.certificates).call(n,e=>{var t;return _()(t=e.relatedAddresses).call(t,e=>e.AddressId)})]}),a=await B.b.getById(t,r,P()(new S.a(e)));for(const e of a)h.set(e.AddressId,e.Hash)}const f=n.publicDeriver.getParent().getDefaultToken();return{addressLookupMap:h,txs:_()(p).call(p,t=>{var r,a;return{...t,block:l.get(t.transaction.TransactionId)||null,...Object(se.b)({tokens:t.tokens,utxoInputs:t.utxoInputs,utxoOutputs:t.utxoOutputs,accountingInputs:null==t.accountingInputs?void 0:t.accountingInputs,allOwnedAddressIds:new S.a(_()(r=m()(a=v()(c)).call(a,e=>c[e])).call(r,e=>e.AddressId)),ownImplicitInput:new le.a([],f),ownImplicitOutput:(()=>{if(t.txType===R.n.CardanoShelley){const r=new le.a([],f);for(const a of t.certificates){if(a.certificate.Kind!==ce.a.WalletV4.CertificateKind.MoveInstantaneousRewardsCert)continue;const t=ce.a.WalletV4.MoveInstantaneousRewardsCert.from_bytes(e.from(a.certificate.Payload,"hex")).move_instantaneous_reward();for(const n of a.relatedAddresses)for(const a of c.accountingAddresses)if(n.AddressId===a.AddressId){const n=ce.a.WalletV4.RewardAddress.from_address(ce.a.WalletV4.Address.from_bytes(e.from(a.Hash,"hex")));if(null==n)continue;const s=t.get(n.payment_cred());if(null==s)continue;r.add({identifier:f.defaultIdentifier,networkId:f.defaultNetworkId,amount:new W.a(s.to_str())})}}return r}return new le.a([],f)})(),defaultToken:f})}})}}async function he(e){var t,r;const a=e.publicDeriver.getParent().getDerivationTables(),n=y()({GetPathWithSpecific:B.m,GetAddress:B.b,CardanoByronAssociateTxWithIOs:V.a,CardanoShelleyAssociateTxWithIOs:V.b,AssociateTxWithUtxoIOs:F.a,AssociateTxWithAccountingIOs:H.a,GetTxAndBlock:B.p,GetDerivationSpecific:z.a,GetCertificates:B.d}),s=m()(t=_()(r=v()(n)).call(r,e=>n[e])).call(t,t=>Object(j.g)(e.publicDeriver.getDb(),t));return await Object(j.m)(e.publicDeriver.getDb(),[...s,...Object(j.k)(e.publicDeriver.getDb(),a)],async t=>await pe(e.publicDeriver.getDb(),t,{GetPathWithSpecific:n.GetPathWithSpecific,GetAddress:n.GetAddress,CardanoByronAssociateTxWithIOs:n.CardanoByronAssociateTxWithIOs,CardanoShelleyAssociateTxWithIOs:n.CardanoShelleyAssociateTxWithIOs,AssociateTxWithUtxoIOs:n.AssociateTxWithUtxoIOs,AssociateTxWithAccountingIOs:n.AssociateTxWithAccountingIOs,GetTxAndBlock:n.GetTxAndBlock,GetDerivationSpecific:n.GetDerivationSpecific,GetCertificates:n.GetCertificates},{...e,getTxAndBlock:async r=>await n.GetTxAndBlock.byTime(e.publicDeriver.getDb(),t,{txIds:r,skip:e.skip,limit:e.limit})},a))}async function fe(e){var t,r;const a=e.publicDeriver.getParent().getDerivationTables(),n=y()({GetPathWithSpecific:B.m,GetAddress:B.b,CardanoByronAssociateTxWithIOs:V.a,CardanoShelleyAssociateTxWithIOs:V.b,AssociateTxWithUtxoIOs:F.a,AssociateTxWithAccountingIOs:H.a,GetTxAndBlock:B.p,GetDerivationSpecific:z.a,GetCertificates:B.d}),s=m()(t=_()(r=v()(n)).call(r,e=>n[e])).call(t,t=>Object(j.g)(e.publicDeriver.getDb(),t));return await Object(j.m)(e.publicDeriver.getDb(),[...s,...Object(j.k)(e.publicDeriver.getDb(),a)],async t=>await pe(e.publicDeriver.getDb(),t,{GetPathWithSpecific:n.GetPathWithSpecific,GetAddress:n.GetAddress,CardanoByronAssociateTxWithIOs:n.CardanoByronAssociateTxWithIOs,CardanoShelleyAssociateTxWithIOs:n.CardanoShelleyAssociateTxWithIOs,AssociateTxWithUtxoIOs:n.AssociateTxWithUtxoIOs,AssociateTxWithAccountingIOs:n.AssociateTxWithAccountingIOs,GetTxAndBlock:n.GetTxAndBlock,GetDerivationSpecific:n.GetDerivationSpecific,GetCertificates:n.GetCertificates},{...e,getTxAndBlock:async r=>await n.GetTxAndBlock.withStatus(e.publicDeriver.getDb(),t,{txIds:r,status:[$.d.PENDING]})},a))}async function we(e,t,r,a,n){var s,o;const i=await ue(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,AssociateTxWithAccountingIOs:r.AssociateTxWithAccountingIOs,GetDerivationSpecific:r.GetDerivationSpecific,GetCertificates:r.GetCertificates},{publicDeriver:n.publicDeriver},a),c=await r.GetTransaction.fromIds(e,t,{ids:i.txIds}),d=[...await r.CardanoByronAssociateTxWithIOs.getIOsForTx(e,t,{txs:A()(c).call(c,e=>e.Type===R.n.CardanoByron),networkId:n.publicDeriver.getParent().getNetworkInfo().NetworkId}),...await r.CardanoShelleyAssociateTxWithIOs.getIOsForTx(e,t,{txs:A()(c).call(c,e=>e.Type===R.n.CardanoShelley),networkId:n.publicDeriver.getParent().getNetworkInfo().NetworkId})],l=m()(d).call(d,e=>{var t,r,a;return[..._()(t=e.utxoInputs).call(t,e=>e.AddressId),..._()(r=e.utxoOutputs).call(r,e=>e.AddressId),...null==e.accountingInputs?[]:_()(a=e.accountingInputs).call(a,e=>e.AddressId)]}),u=new S.a(_()(s=m()(o=v()(i.addresses)).call(o,e=>i.addresses[e])).call(s,e=>e.AddressId)),p=A()(l).call(l,e=>!u.has(e));return P()(new S.a(p))}async function ge(e){var t,r;const a=e.publicDeriver.getParent().getDerivationTables(),n=y()({GetPathWithSpecific:B.m,GetAddress:B.b,CardanoByronAssociateTxWithIOs:V.a,CardanoShelleyAssociateTxWithIOs:V.b,AssociateTxWithUtxoIOs:F.a,AssociateTxWithAccountingIOs:H.a,GetDerivationSpecific:z.a,GetTransaction:B.o,GetCertificates:B.d}),s=e.publicDeriver.getDb(),o=m()(t=_()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(j.g)(s,e));return await Object(j.m)(s,[...s.getSchema().tables(),...o,...Object(j.k)(s,a)],async t=>{const r=await we(s,t,n,e.publicDeriver.getParent().getDerivationTables(),{publicDeriver:e.publicDeriver}),a=await B.b.getById(s,t,r),o=[],i=new S.a;for(const e of a)i.has(e.Hash)||(i.add(e.Hash),o.push({address:e.Hash,type:e.Type}));return o})}async function be(e,t,r,a,n){const s=await we(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,CardanoByronAssociateTxWithIOs:r.CardanoByronAssociateTxWithIOs,CardanoShelleyAssociateTxWithIOs:r.CardanoShelleyAssociateTxWithIOs,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,AssociateTxWithAccountingIOs:r.AssociateTxWithAccountingIOs,GetDerivationSpecific:r.GetDerivationSpecific,GetTransaction:r.GetTransaction,GetCertificates:r.GetCertificates},a,n),o=await ue(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,AssociateTxWithAccountingIOs:r.AssociateTxWithAccountingIOs,GetDerivationSpecific:r.GetDerivationSpecific,GetCertificates:r.GetCertificates},{publicDeriver:n.publicDeriver},a),i=await async function(e,t,r,a,n){var s;const o=await ue(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,AssociateTxWithAccountingIOs:r.AssociateTxWithAccountingIOs,GetDerivationSpecific:r.GetDerivationSpecific,GetCertificates:r.GetCertificates},{publicDeriver:n.publicDeriver},a),i=await r.GetTransaction.fromIds(e,t,{ids:o.txIds}),c=[...await r.CardanoByronAssociateTxWithIOs.getIOsForTx(e,t,{txs:A()(i).call(i,e=>e.Type===R.n.CardanoByron),networkId:n.publicDeriver.getParent().getNetworkInfo().NetworkId}),...await r.CardanoShelleyAssociateTxWithIOs.getIOsForTx(e,t,{txs:A()(i).call(i,e=>e.Type===R.n.CardanoShelley),networkId:n.publicDeriver.getParent().getNetworkInfo().NetworkId})];return P()(new S.a(_()(s=m()(c).call(c,e=>e.tokens)).call(s,e=>e.TokenList.ListId)))}(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,CardanoByronAssociateTxWithIOs:r.CardanoByronAssociateTxWithIOs,CardanoShelleyAssociateTxWithIOs:r.CardanoShelleyAssociateTxWithIOs,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,AssociateTxWithAccountingIOs:r.AssociateTxWithAccountingIOs,GetDerivationSpecific:r.GetDerivationSpecific,GetTransaction:r.GetTransaction,GetCertificates:r.GetCertificates},a,n);return await r.DeleteAllTransactions.delete(e,t,{publicDeriverId:n.publicDeriver.getPublicDeriverId(),txIds:o.txIds}),await r.ModifyAddress.remove(e,t,s),await r.FreeBlocks.free(e,t),await r.ModifyTokenList.remove(e,t,i),o}async function ye(e){var t,r;const a=e.publicDeriver.getParent().getDerivationTables(),n=y()({GetPathWithSpecific:B.m,GetAddress:B.b,CardanoByronAssociateTxWithIOs:V.a,CardanoShelleyAssociateTxWithIOs:V.b,AssociateTxWithUtxoIOs:F.a,AssociateTxWithAccountingIOs:H.a,GetDerivationSpecific:z.a,DeleteAllTransactions:Q.b,ModifyAddress:K.d,GetTransaction:B.o,FreeBlocks:K.b,GetCertificates:B.d,ModifyTokenList:K.j}),s=e.publicDeriver.getDb(),o=m()(t=_()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(j.g)(s,e));return await Object(j.m)(s,[...s.getSchema().tables(),...o,...Object(j.k)(s,a)],async t=>be(s,t,n,e.publicDeriver.getParent().getDerivationTables(),{publicDeriver:e.publicDeriver}))}async function Ie(t,r,a,s,i){const d=Object(q.j)(r),u=null==d?new D.a:d.getParent().getDerivationTables();let h=void 0;try{var w,b;const d=y()({GetLastSyncForPublicDeriver:J.d,ModifyLastSyncInfo:Q.e,GetKeyForPublicDeriver:J.c,GetAddress:B.b,GetPathWithSpecific:B.m,GetUtxoTxOutputsWithTx:F.c,ModifyAddress:K.d,GetPublicDeriver:J.e,AddDerivationTree:Y.b,MarkUtxo:M.a,ModifyDisplayCutoff:X.b,GetDerivationsByPath:B.g,GetEncryptionMeta:B.h,GetTransaction:B.o,GetUtxoInputs:F.b,GetTxAndBlock:B.p,GetDerivationSpecific:z.a,ModifyTransaction:K.k,ModifyCardanoByronTx:U.a,ModifyCardanoShelleyTx:U.b,CardanoByronAssociateTxWithIOs:V.a,CardanoShelleyAssociateTxWithIOs:V.b,AssociateTxWithUtxoIOs:F.a,AssociateTxWithAccountingIOs:H.a,GetCertificates:B.d,GetKeyDerivation:B.j,ModifyToken:K.i,GetToken:B.n,AssociateToken:B.a}),I=m()(w=_()(b=v()(d)).call(b,e=>d[e])).call(w,e=>Object(j.g)(t,e));await Object(j.m)(t,[...I,...Object(j.k)(t,u)],async w=>{h=await d.GetLastSyncForPublicDeriver.forId(t,w,r.getPublicDeriverId());const{GetLastSyncForPublicDeriver:b,...y}=d;await async function(t,r,a,s,i,d,u,h,w){const b=s.getParent().getNetworkInfo(),y=await Object(te.e)(Object(Z.c)(b)),I=await h({network:b});if(null!==i.Height){const e=i.Height,t=null!=I.height?I.height:0;if(e-t>ae.b)return}if(null!=I.hash){var T,x,k,O,E,C,G;const i=I.hash,h=Object(q.l)(s);null!=h&&await h.rawScanAddresses(r,{GetKeyForPublicDeriver:a.GetKeyForPublicDeriver,GetAddress:a.GetAddress,GetPathWithSpecific:a.GetPathWithSpecific,GetUtxoTxOutputsWithTx:a.GetUtxoTxOutputsWithTx,ModifyAddress:a.ModifyAddress,GetPublicDeriver:a.GetPublicDeriver,AddDerivationTree:a.AddDerivationTree,ModifyDisplayCutoff:a.ModifyDisplayCutoff,GetDerivationsByPath:a.GetDerivationsByPath,GetDerivationSpecific:a.GetDerivationSpecific,GetKeyDerivation:a.GetKeyDerivation},{checkAddressesInUse:d},w);const{txIds:f,addresses:W}=await ue(t,r,{GetPathWithSpecific:a.GetPathWithSpecific,GetAddress:a.GetAddress,GetDerivationSpecific:a.GetDerivationSpecific,AssociateTxWithUtxoIOs:a.AssociateTxWithUtxoIOs,AssociateTxWithAccountingIOs:a.AssociateTxWithAccountingIOs,GetCertificates:a.GetCertificates},{publicDeriver:s},w),N=await a.GetTxAndBlock.firstSuccessTxBefore(t,r,{txIds:f,height:g.a}),j=null==N?void 0:{after:{block:N.Block.Hash,tx:N.Transaction.Hash}},B=await u({...j,network:b,addresses:[..._()(T=A()(x=W.utxoAddresses).call(x,e=>e.Type===$.b.CARDANO_LEGACY)).call(T,e=>e.Hash),...p()(k=A()(O=W.utxoAddresses).call(O,e=>e.Type===$.b.CARDANO_ENTERPRISE)).call(k,(t,r)=>{const a=ce.a.WalletV4.Address.from_bytes(e.from(r.Hash,"hex")),n=ce.a.WalletV4.EnterpriseAddress.from_address(a);if(null==n)return t;const s=n.payment_cred().to_keyhash();return null==s?t:(t.push(s.to_bech32(de.a.PAYMENT_KEY_HASH)),t)},[]),..._()(E=W.accountingAddresses).call(E,e=>e.Hash)],untilBlock:i}),K=new S.a(_()(C=m()(G=v()(W)).call(G,e=>W[e])).call(C,e=>e.AddressId));await async function(e,t,r,a){const{TransactionSeed:s,BlockSeed:i}=await r.GetEncryptionMeta.get(e,t),d=new D.a;{var u;const n=_()(u=a.txsFromNetwork).call(u,e=>Object(L.a)(e.hash,s)),o=await r.GetTransaction.byDigest(e,t,{digests:n,txIds:a.txIds}),i=P()(l()(o).call(o)),c=await r.CardanoByronAssociateTxWithIOs.getIOsForTx(e,t,{txs:A()(i).call(i,e=>e.Type===R.n.CardanoByron),networkId:a.network.NetworkId}),p=await r.CardanoShelleyAssociateTxWithIOs.getIOsForTx(e,t,{txs:A()(i).call(i,e=>e.Type===R.n.CardanoShelley),networkId:a.network.NetworkId}),h=[...c,...p];for(const e of h)d.set(e.transaction.Hash,e)}const h=[],f=[],w=new S.a;for(const n of a.txsFromNetwork){const o=d.get(n.hash);if(null==o){h.push(n);continue}const c=Ae(n,a.toAbsoluteSlotNumber,s,i);w.add(o.transaction.TransactionId);const l=await r.ModifyTransaction.updateExisting(e,t,{block:c.block,transaction:e=>({...c.transaction(e),TransactionId:o.transaction.TransactionId})});null===o.transaction.BlockId&&(null!==l.block&&f.push({...o,block:l.block,transaction:l.transaction}))}const g=await async function(e,t,r,a,n,s){var o;const i=P()(new S.a(m()(a).call(a,e=>[s.defaultIdentifier]))),d=A()(o=await r.GetToken.fromIdentifier(e,t,i)).call(o,e=>e.NetworkId===n.NetworkId),l=new D.a;return c()(d).call(d,e=>l.set(e.Identifier,e)),l}(e,t,{ModifyToken:r.ModifyToken,GetToken:r.GetToken},h,a.network,a.defaultToken),b=await Object(F.d)(e,t,{AssociateToken:r.AssociateToken}),{byronTxs:y,shelleyTxs:I}=await async function(e,t,r,a,s,i,c,d,u,h,f,w){const g=P()(new S.a(m()(s).call(s,e=>{var t,r,a;return[..._()(t=e.inputs).call(t,e=>e.address),..._()(r=e.outputs).call(r,e=>e.address),...e.withdrawals?_()(a=e.withdrawals).call(a,e=>e.address):[]]}))),b=await i({db:e,tx:t,lockedTables:P()(l()(a).call(a)),hashes:g}),y=e=>{const t=b.get(e);if(void 0===t)throw new Error("networkTxToDbTx should never happen id === undefined");return t},I=e=>{const t=f.get(e);if(void 0===t)throw new Error("networkTxToDbTx should never happen -- asset missing");return t},v=[],T=[];for(const l of s){const{block:s,transaction:f}=Ae(l,d,u,h);if(null==l.type||l.type===oe.a.byron)v.push({block:s,transaction:f,ioGen:ve(l,y,r,I,w)});else{var x;if(l.type!==oe.a.shelley)throw new Error(`networkTxToDbTx Unhandled tx type ${null!==(x=l.type)&&void 0!==x?x:""}`);{var A;const d=p()(A=Object(Z.c)(r)).call(A,(e,t)=>o()(e,t),{}),u=null==l.certificates?[e=>{}]:await ke(e,t,{certificates:l.certificates,hashToIds:i,findOwnAddress:c,derivationTables:a,network:n()(d.ChainNetworkId,10)});T.push({block:s,transaction:f,certificates:u,ioGen:Te(l,y,r,I,w)})}}}return{byronTxs:v,shelleyTxs:T}}(e,t,a.network,a.derivationTables,h,a.hashToIds,a.findOwnAddress,a.toAbsoluteSlotNumber,s,i,g,b),v=new S.a;for(const a of y){const n=await r.ModifyCardanoByronTx.addTxWithIOs(e,t,a);v.add(n.transaction.TransactionId),null!==n.block&&f.push({txType:n.txType,block:n.block,transaction:n.transaction,utxoInputs:n.utxoInputs,utxoOutputs:n.utxoOutputs,tokens:n.tokens})}for(const a of I){const n=await r.ModifyCardanoShelleyTx.addTxWithIOs(e,t,a);v.add(n.transaction.TransactionId),null!==n.block&&f.push({txType:n.txType,block:n.block,transaction:n.transaction,certificates:n.certificates,utxoInputs:n.utxoInputs,utxoOutputs:n.utxoOutputs,accountingInputs:n.accountingInputs,tokens:n.tokens})}const T=_()(f).call(f,e=>e.transaction.TransactionId);await me(e,t,{MarkUtxo:r.MarkUtxo,GetUtxoInputs:r.GetUtxoInputs,GetTransaction:r.GetTransaction},{inputTxIds:T,allTxIds:[...a.txIds,...T],isUnspent:!1,TransactionSeed:s,networkId:a.network.NetworkId});const x=await r.GetTransaction.withStatus(e,t,{txIds:a.txIds,status:[$.d.PENDING]});for(const a of x)w.has(a.TransactionId)||v.has(a.TransactionId)||await r.ModifyTransaction.updateStatus(e,t,{transaction:a,status:$.d.NOT_IN_REMOTE});return f}(t,r,{MarkUtxo:a.MarkUtxo,CardanoByronAssociateTxWithIOs:a.CardanoByronAssociateTxWithIOs,CardanoShelleyAssociateTxWithIOs:a.CardanoShelleyAssociateTxWithIOs,GetEncryptionMeta:a.GetEncryptionMeta,GetTransaction:a.GetTransaction,GetUtxoInputs:a.GetUtxoInputs,ModifyTransaction:a.ModifyTransaction,ModifyCardanoByronTx:a.ModifyCardanoByronTx,ModifyCardanoShelleyTx:a.ModifyCardanoShelleyTx,ModifyToken:a.ModifyToken,GetToken:a.GetToken,AssociateToken:a.AssociateToken},{network:s.getParent().getNetworkInfo(),txIds:f,txsFromNetwork:B,hashToIds:Object(re.c)(K,s.getParent().getNetworkInfo()),defaultToken:s.getParent().getDefaultToken(),findOwnAddress:Object(re.b)(K),toAbsoluteSlotNumber:y,derivationTables:w})}const W=null==I.epoch||null==I.slot?null:y({epoch:I.epoch,slot:I.slot});await a.ModifyLastSyncInfo.overrideLastSyncInfo(t,r,{LastSyncInfoId:i.LastSyncInfoId,Time:new Date(f()()),SlotNum:W,BlockHash:I.hash,Height:I.height})}(t,w,y,r,h,a,s,i,u)})}catch(e){var I,T;if(!(e instanceof ne.A))throw e;if(void 0===h)throw e;const a=y()({GetPathWithSpecific:B.m,GetAddress:B.b,GetTxAndBlock:B.p,GetLastSyncForPublicDeriver:J.d,ModifyLastSyncInfo:Q.e,GetBlock:B.c,ModifyTransaction:K.k,MarkUtxo:M.a,GetTransaction:B.o,GetUtxoInputs:F.b,GetEncryptionMeta:B.h,GetDerivationSpecific:z.a,CardanoByronAssociateTxWithIOs:V.a,AssociateTxWithUtxoIOs:F.a,AssociateTxWithAccountingIOs:H.a}),n=m()(I=_()(T=v()(a)).call(T,e=>a[e])).call(I,e=>Object(j.g)(t,e));await Object(j.m)(t,[...n,...Object(j.k)(t,u)],async e=>{const n=await a.GetLastSyncForPublicDeriver.forId(t,e,r.getPublicDeriverId());Object(N.isEqual)(n,h)&&await async function(e,t,r,a,n){const{TransactionSeed:s}=await r.GetEncryptionMeta.get(e,t);if(null===a.lastSyncInfo.SlotNum)return;const{utxoAddresses:o,accountingAddresses:i}=await Object(ee.b)(t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,GetDerivationSpecific:r.GetDerivationSpecific},{publicDeriver:a.publicDeriver},n),c=_()(o).call(o,e=>e.AddressId),d=_()(i).call(i,e=>e.AddressId),l=P()(new S.a([...await r.AssociateTxWithAccountingIOs.getTxIdsForAddresses(e,t,{addressIds:d}),...await r.AssociateTxWithUtxoIOs.getTxIdsForAddresses(e,t,{addressIds:c})])),u=await r.GetTxAndBlock.firstSuccessTxBefore(e,t,{txIds:l,height:g.a});if(null==u)return;const p=await r.GetTxAndBlock.gteHeight(e,t,{txIds:l,height:u.Block.Height-ae.b});for(const a of p)await r.ModifyTransaction.updateStatus(e,t,{status:$.d.ROLLBACK_FAIL,transaction:a.Transaction});await me(e,t,{MarkUtxo:r.MarkUtxo,GetUtxoInputs:r.GetUtxoInputs,GetTransaction:r.GetTransaction},{inputTxIds:_()(p).call(p,e=>e.Transaction.TransactionId),allTxIds:l,isUnspent:!0,TransactionSeed:s,networkId:a.publicDeriver.getParent().getNetworkInfo().NetworkId});const h=await r.GetTransaction.withStatus(e,t,{txIds:l,status:[$.d.PENDING]});for(const a of h)await r.ModifyTransaction.updateStatus(e,t,{transaction:a,status:$.d.ROLLBACK_FAIL});const w=await r.GetTxAndBlock.firstSuccessTxBefore(e,t,{txIds:l,height:u.Block.Height-ae.b});await r.ModifyLastSyncInfo.overrideLastSyncInfo(e,t,{LastSyncInfoId:a.lastSyncInfo.LastSyncInfoId,Time:new Date(f()()),SlotNum:void 0===w?null:w.Block.SlotNum,Height:void 0===w?0:w.Block.Height,BlockHash:void 0===w?null:w.Block.Hash})}(t,e,a,{publicDeriver:r,lastSyncInfo:n},u)})}}function ve(e,t,r,a,n){if(null!=e.type&&e.type!==oe.a.byron)throw new Error("genByronIOGen not a byron transaction");return s=>{const o=[],i=[],c=[];for(let i=0;i<e.inputs.length;i++){const d=e.inputs[i],l=n();c.push({TokenList:{Amount:d.amount,ListId:l,TokenId:a($.c.Cardano).TokenId},identifier:$.c.Cardano,networkId:r.NetworkId}),o.push({TransactionId:s,AddressId:t(d.address),ParentTxHash:d.txHash,IndexInParentTx:d.index,IndexInOwnTx:i,TokenListId:l})}for(let o=0;o<e.outputs.length;o++){const d=e.outputs[o],l=n();c.push({TokenList:{Amount:d.amount,ListId:l,TokenId:a($.c.Cardano).TokenId},identifier:$.c.Cardano,networkId:r.NetworkId}),i.push({TransactionId:s,AddressId:t(d.address),OutputIndex:o,IsUnspent:!0,ErgoBoxId:null,ErgoCreationHeight:null,ErgoRegisters:null,ErgoTree:null,TokenListId:l})}return{utxoInputs:o,utxoOutputs:i,tokenList:c}}}function Te(e,t,r,a,n){if(e.type!==oe.a.shelley)throw new Error("genShelleyIOGen not a shelley transaction");return s=>{const o=[],i=[],c=[],d=[];for(let i=0;i<e.inputs.length;i++){const c=e.inputs[i],l=n();d.push({TokenList:{Amount:c.amount,ListId:l,TokenId:a($.c.Cardano).TokenId},identifier:$.c.Cardano,networkId:r.NetworkId}),o.push({TransactionId:s,AddressId:t(c.address),ParentTxHash:c.txHash,IndexInParentTx:c.index,IndexInOwnTx:i,TokenListId:l})}for(let o=0;o<e.withdrawals.length;o++){const i=n();d.push({TokenList:{Amount:e.withdrawals[o].amount,ListId:i,TokenId:a($.c.Cardano).TokenId},identifier:$.c.Cardano,networkId:r.NetworkId}),c.push({TransactionId:s,AddressId:t(e.withdrawals[o].address),SpendingCounter:0,IndexInOwnTx:o,TokenListId:i})}for(let o=0;o<e.outputs.length;o++){const c=e.outputs[o],l=n();d.push({TokenList:{Amount:c.amount,ListId:l,TokenId:a($.c.Cardano).TokenId},identifier:$.c.Cardano,networkId:r.NetworkId});const u=Object(ie.b)(c.address,"bytes",r);if(u!==$.b.CARDANO_LEGACY&&u!==$.b.CARDANO_ENTERPRISE&&u!==$.b.CARDANO_BASE&&u!==$.b.CARDANO_PTR)throw u===$.b.CARDANO_REWARD?new Error("networkTxToDbTx cannot send to a reward address"):new Error("networkTxToDbTx Unhandled output type");i.push({TransactionId:s,AddressId:t(c.address),OutputIndex:o,TokenListId:l,IsUnspent:!0,ErgoBoxId:null,ErgoCreationHeight:null,ErgoRegisters:null,ErgoTree:null})}return{utxoInputs:o,utxoOutputs:i,accountingInputs:c,tokenList:d}}}async function me(e,t,r,a){const n=await r.GetUtxoInputs.fromTxIds(e,t,{ids:a.inputTxIds}),s=_()(n).call(n,e=>Object(L.a)(e.ParentTxHash,a.TransactionSeed)),o=await r.GetTransaction.byDigest(e,t,{digests:s,txIds:a.allTxIds});for(const s of n){const n=o.get(s.ParentTxHash);void 0!==n&&await r.MarkUtxo.markAs(e,t,{txId:n.TransactionId,outputIndex:s.IndexInParentTx,isUnspent:a.isUnspent,networkId:a.networkId})}}function xe(e){if("Successful"===e)return $.d.IN_BLOCK;if("Pending"===e)return $.d.PENDING;if("Failed"===e)return $.d.FAIL_RESPONSE;throw new Error("statusStringToCode unexpected status "+e)}function Ae(e,t,r,a){var n;const s=null!=e.epoch&&null!=e.slot&&null!=e.block_hash&&null!=e.time&&null!=e.height?{Hash:e.block_hash,BlockTime:new Date(e.time),Height:e.height,SlotNum:t({epoch:e.epoch,slot:e.slot}),Digest:Object(L.a)(e.hash,a)}:null,o=Object(L.a)(e.hash,r),i={Hash:e.hash,Digest:o,Ordinal:e.tx_ordinal,LastUpdateTime:null==s||null==e.time?new Date(e.last_update).getTime():new Date(e.time).getTime(),Status:xe(e.tx_state),ErrorMessage:null};if(null==e.type||e.type===oe.a.byron)return{block:s,transaction:e=>({Type:R.n.CardanoByron,Extra:null,BlockId:e,...i})};if(e.type===oe.a.shelley)return{block:s,transaction:t=>({Type:R.n.CardanoShelley,Extra:{Fee:e.fee,Metadata:e.metadata},BlockId:t,...i})};throw new Error(`networkTxHeaderToDb Unhandled tx type ${null!==(n=e.type)&&void 0!==n?n:""}`)}async function ke(t,r,a){const n=async e=>{var n;return await a.findOwnAddress({db:t,tx:r,lockedTables:P()(l()(n=a.derivationTables).call(n)),hash:e})},s=async e=>{var n;const s=(await a.hashToIds({db:t,tx:r,lockedTables:P()(l()(n=a.derivationTables).call(n)),hashes:[e]})).get(e);if(void 0===s)throw new Error("certificateToDb should never happen id === undefined");return s},o=async t=>{{const r=ce.a.WalletV4.RewardAddress.new(a.network,t),s=await n(e.from(r.to_address().to_bytes()).toString("hex"));if(null!=s)return s}{const r=ce.a.WalletV4.EnterpriseAddress.new(a.network,t),s=await n(e.from(r.to_address().to_bytes()).toString("hex"));if(null!=s)return s}},i=[];for(let t=0;t<a.certificates.length;t++){const r=a.certificates[t];switch(r.kind){case oe.b.StakeRegistration:{var c;const t=null===(c=ce.a.WalletV4.RewardAddress.from_address(ce.a.WalletV4.Address.from_bytes(e.from(r.rewardAddress,"hex"))))||void 0===c?void 0:c.payment_cred();if(null==t)throw new Error("certificateToDb not a valid reward account");const n=ce.a.WalletV4.StakeRegistration.new(t),o=ce.a.WalletV4.RewardAddress.new(a.network,t),d=e.from(o.to_address().to_bytes()).toString("hex"),l=await s(d);i.push(t=>({certificate:{Ordinal:r.certIndex,Kind:ce.a.WalletV4.CertificateKind.StakeRegistration,Payload:e.from(n.to_bytes()).toString("hex"),TransactionId:t},relatedAddresses:e=>[{CertificateId:e,AddressId:l,Relation:$.a.SIGNER}]}));break}case oe.b.StakeDeregistration:{var d;const t=null===(d=ce.a.WalletV4.RewardAddress.from_address(ce.a.WalletV4.Address.from_bytes(e.from(r.rewardAddress,"hex"))))||void 0===d?void 0:d.payment_cred();if(null==t)throw new Error("certificateToDb not a valid reward account");const n=ce.a.WalletV4.StakeRegistration.new(t),o=ce.a.WalletV4.RewardAddress.new(a.network,t),c=e.from(o.to_address().to_bytes()).toString("hex"),l=await s(c);i.push(t=>({certificate:{Ordinal:r.certIndex,Kind:ce.a.WalletV4.CertificateKind.StakeDeregistration,Payload:e.from(n.to_bytes()).toString("hex"),TransactionId:t},relatedAddresses:e=>[{CertificateId:e,AddressId:l,Relation:$.a.SIGNER}]}));break}case oe.b.StakeDelegation:{const t=[],a=ce.a.WalletV4.RewardAddress.from_address(ce.a.WalletV4.Address.from_bytes(e.from(r.rewardAddress,"hex")));if(null==a)throw new Error("certificateToDb not a valid reward account");const n=a.payment_cred(),c=ce.a.WalletV4.Ed25519KeyHash.from_bytes(e.from(r.poolKeyHash,"hex")),d=ce.a.WalletV4.StakeDelegation.new(n,c);{const e=await o(ce.a.WalletV4.StakeCredential.from_keyhash(c));null!=e&&t.push({AddressId:e,Relation:$.a.POOL_KEY})}{const r=e.from(a.to_address().to_bytes()).toString("hex"),n=await s(r);t.push({AddressId:n,Relation:$.a.SIGNER})}i.push(a=>({certificate:{Ordinal:r.certIndex,Kind:ce.a.WalletV4.CertificateKind.StakeDelegation,Payload:e.from(d.to_bytes()).toString("hex"),TransactionId:a},relatedAddresses:e=>_()(t).call(t,t=>({...t,CertificateId:e}))}));break}case oe.b.PoolRegistration:{const t=[],a=ce.a.WalletV4.Ed25519KeyHash.from_bytes(e.from(r.poolParams.operator,"hex"));{const e=await o(ce.a.WalletV4.StakeCredential.from_keyhash(a));null!=e&&t.push({AddressId:e,Relation:$.a.OPERATOR})}const n=ce.a.WalletV4.Address.from_bytes(e.from(r.poolParams.rewardAccount,"hex"));{const e=await s(r.poolParams.rewardAccount);t.push({AddressId:e,Relation:$.a.REWARD_ADDRESS})}const c=ce.a.WalletV4.RewardAddress.from_address(n);if(null==c)throw new Error("certificateToDb registration address not a reward address");const d=ce.a.WalletV4.Ed25519KeyHashes.new();for(let a=0;a<r.poolParams.poolOwners.length;a++){const n=r.poolParams.poolOwners[a],s=ce.a.WalletV4.Ed25519KeyHash.from_bytes(e.from(n,"hex"));d.add(s);const i=await o(ce.a.WalletV4.StakeCredential.from_keyhash(s));null!=i&&t.push({AddressId:i,Relation:$.a.OWNER})}const l=ce.a.WalletV4.Relays.new();for(let e=0;e<r.poolParams.relays.length;e++);const u=ce.a.WalletV4.PoolRegistration.new(ce.a.WalletV4.PoolParams.new(a,ce.a.WalletV4.VRFKeyHash.from_bytes(e.from(r.poolParams.vrfKeyHash,"hex")),ce.a.WalletV4.BigNum.from_str(r.poolParams.pledge),ce.a.WalletV4.BigNum.from_str(r.poolParams.cost),ce.a.WalletV4.UnitInterval.new(ce.a.WalletV4.BigNum.from_str("1"),ce.a.WalletV4.BigNum.from_str("1")),c,d,l,null==r.poolParams.poolMetadata?void 0:ce.a.WalletV4.PoolMetadata.new(r.poolParams.poolMetadata.url,ce.a.WalletV4.MetadataHash.from_bytes(e.from(r.poolParams.poolMetadata.metadataHash,"hex")))));i.push(a=>({certificate:{Ordinal:r.certIndex,Kind:ce.a.WalletV4.CertificateKind.PoolRegistration,Payload:e.from(u.to_bytes()).toString("hex"),TransactionId:a},relatedAddresses:e=>_()(t).call(t,t=>({...t,CertificateId:e}))}));break}case oe.b.PoolRetirement:{const t=[],a=ce.a.WalletV4.Ed25519KeyHash.from_bytes(e.from(r.poolKeyHash,"hex")),n=ce.a.WalletV4.PoolRetirement.new(a,r.epoch),s=await o(ce.a.WalletV4.StakeCredential.from_keyhash(a));null!=s&&t.push({AddressId:s,Relation:$.a.POOL_KEY}),i.push(a=>({certificate:{Ordinal:r.certIndex,Kind:ce.a.WalletV4.CertificateKind.PoolRetirement,Payload:e.from(n.to_bytes()).toString("hex"),TransactionId:a},relatedAddresses:e=>_()(t).call(t,t=>({...t,CertificateId:e}))}));break}case oe.b.GenesisKeyDelegation:{const t=ce.a.WalletV4.GenesisDelegateHash.from_bytes(e.from(r.genesisDelegateHash,"hex")),a=ce.a.WalletV4.GenesisKeyDelegation.new(ce.a.WalletV4.GenesisHash.from_bytes(e.from(r.genesishash,"hex")),t,ce.a.WalletV4.VRFKeyHash.from_bytes(e.from(r.vrfKeyHash,"hex")));i.push(t=>({certificate:{Ordinal:r.certIndex,Kind:ce.a.WalletV4.CertificateKind.GenesisKeyDelegation,Payload:e.from(a.to_bytes()).toString("hex"),TransactionId:t},relatedAddresses:e=>[]}));break}case oe.b.MoveInstantaneousRewardsCert:{const t=[],a=ce.a.WalletV4.MoveInstantaneousReward.new(r.pot);for(const s of v()(r.rewards)){const o=ce.a.WalletV4.RewardAddress.from_address(ce.a.WalletV4.Address.from_bytes(e.from(s,"hex")));if(null==o)throw new Error("certificateToDb not a valid reward account");const i=o.payment_cred();if(null==i)throw new Error("certificateToDb not a valid reward account");a.insert(i,ce.a.WalletV4.BigNum.from_str(r.rewards[s]));const c=await n(e.from(o.to_address().to_bytes()).toString("hex"));null!=c&&t.push({AddressId:c,Relation:$.a.REWARD_ADDRESS})}const s=ce.a.WalletV4.MoveInstantaneousRewardsCert.new(a);i.push(a=>({certificate:{Ordinal:r.certIndex,Kind:ce.a.WalletV4.CertificateKind.MoveInstantaneousRewardsCert,Payload:e.from(s.to_bytes()).toString("hex"),TransactionId:a},relatedAddresses:e=>_()(t).call(t,t=>({...t,CertificateId:e}))}));break}default:throw new Error("certificateToDb unknown cert kind "+r.kind)}}return i}}).call(this,r(48).Buffer)},25:function(e,t,r){"use strict";r.d(t,"h",(function(){return G})),r.d(t,"i",(function(){return W})),r.d(t,"c",(function(){return N})),r.d(t,"b",(function(){return j})),r.d(t,"e",(function(){return R})),r.d(t,"f",(function(){return B})),r.d(t,"j",(function(){return K})),r.d(t,"g",(function(){return U})),r.d(t,"m",(function(){return M})),r.d(t,"k",(function(){return F})),r.d(t,"o",(function(){return H})),r.d(t,"p",(function(){return V})),r.d(t,"d",(function(){return $})),r.d(t,"l",(function(){return q})),r.d(t,"n",(function(){return J})),r.d(t,"a",(function(){return X}));var a=r(11),n=r.n(a),s=r(31),o=r.n(s),i=r(113),c=r.n(i),d=r(55),l=r.n(d),u=r(84),p=r.n(u),h=r(458),f=r.n(h),w=r(56),g=r.n(w),b=r(32),y=r.n(b),I=r(8),v=r.n(I),T=r(30),m=r.n(T),x=r(75),A=r.n(x),k=r(1),D=r.n(k),O=r(22),S=r.n(O),E=r(21),P=r(16),C=r(118),_=r(15);class G{static async getOrInitial(e,t,r){var a;const n=await Object(_.i)(e,t,0,G.ownTables[P.g.name].name,G.ownTables[P.g.name].properties.EncryptionMetaId);if(null==n)return r;const s={...n};return A()(a=m()(s)).call(a,e=>{null==s[e]&&(s[e]=r[e])}),s}static async get(e,t){const r=await Object(_.i)(e,t,0,G.ownTables[P.g.name].name,G.ownTables[P.g.name].properties.EncryptionMetaId);if(void 0===r)throw new Error("GetEncryptionMeta::get no encryption meta found");return r}}D()(G,"ownTables",n()({[P.g.name]:P.g})),D()(G,"depTables",n()({}));class W{static async get(e,t,r){return await Object(_.i)(e,t,r,W.ownTables[P.i.name].name,W.ownTables[P.i.name].properties.KeyId)}}D()(W,"ownTables",n()({[P.i.name]:P.i})),D()(W,"depTables",n()({}));class N{static async byIds(e,t,r){return await Object(_.j)(e,t,N.ownTables[P.c.name].name,N.ownTables[P.c.name].properties.BlockId,r)}static async byDigests(e,t,r){return await Object(_.j)(e,t,N.ownTables[P.c.name].name,N.ownTables[P.c.name].properties.Digest,r)}}D()(N,"ownTables",n()({[P.c.name]:P.c})),D()(N,"depTables",n()({}));class j{static async getById(e,t,r){return await Object(_.j)(e,t,j.ownTables[P.b.name].name,j.ownTables[P.b.name].properties.AddressId,r)}static async getByHash(e,t,r){const{AddressSeed:a}=await j.depTables.GetEncryptionMeta.get(e,t),n=v()(r).call(r,e=>Object(C.a)(e,a));return await Object(_.j)(e,t,j.ownTables[P.b.name].name,j.ownTables[P.b.name].properties.Digest,n)}static async fromCanonical(e,t,r,a){const n=j.ownTables[P.a.name],s=e.getSchema().table(n.name),o=j.ownTables[P.b.name],i=e.getSchema().table(o.name),c=e.select().from(s).innerJoin(i,O.op.and(s[n.properties.AddressId].eq(i[o.properties.AddressId]),...null!=a?[i[o.properties.Type].in(a)]:[])).where(s[n.properties.KeyDerivationId].in(r)),d=await t.attach(c);return y()(d).call(d,(e,t)=>{const r=e.get(t.AddressMapping.KeyDerivationId)||[];return e.set(t.AddressMapping.KeyDerivationId,[...r,t.Address]),e},new g.a)}static async getKeyForFamily(e,t,r){const a=await Object(_.i)(e,t,r,j.ownTables[P.a.name].name,j.ownTables[P.a.name].properties.AddressId);return void 0===a?a:a.KeyDerivationId}}D()(j,"ownTables",n()({[P.b.name]:P.b,[P.a.name]:P.a})),D()(j,"depTables",n()({GetEncryptionMeta:G}));class R{static async get(e,t,r,a){const n=R.ownTables[P.h.name],s=e.getSchema().table(n.name),o=[s[n.properties.Index].eq(a),s[n.properties.Parent].eq(r)],i=e.select().from(s).where(O.op.and(...o)),c=await t.attach(i);return 1===c.length?c[0]:void 0}}D()(R,"ownTables",n()({[P.h.name]:P.h})),D()(R,"depTables",n()({}));class B{static async get(e,t,r,a,n){const s=await B.depTables.GetChildIfExists.get(e,t,a,n);if(void 0!==s)return{derivation:s,levelSpecific:await r(s.KeyDerivationId)}}}D()(B,"ownTables",n()({})),D()(B,"depTables",n()({GetChildIfExists:R}));class K{static async get(e,t,r){return await Object(_.i)(e,t,r,K.ownTables[P.h.name].name,K.ownTables[P.h.name].properties.KeyDerivationId)}}D()(K,"ownTables",n()({[P.h.name]:P.h})),D()(K,"depTables",n()({}));class U{static async getParentPath(e,t,r){const a=[r.startingKey];for(let n=0;n<r.numLevels;n++){const r=a[a.length-1].Parent;if(null===r)throw new Error("GetDerivationsByPath::getParentPath unexpected end");const n=await U.depTables.GetKeyDerivation.get(e,t,r);if(void 0===n)throw new Error("GetDerivationsByPath::getParentPath parent not found");a.push(n)}return f()(a).call(a)}static async getSinglePath(e,t,r,a){if(0===a.length)throw new Error("GetDerivationsByPath::getSinglePath empty path");let n=r;const s=[];for(const r of a){const o=await U.depTables.GetChildIfExists.get(e,t,n,a[r]);if(void 0===o)throw new Error("GetDerivationsByPath::getSinglePath no path from"+n+" to "+r);s.push(o),n=o.KeyDerivationId}return s}static async getTree(e,t,r,a,n){const s=new g.a([[r,a]]);return await L(e,t,s,n?p()(a).call(a,n):void 0,a.length)}static async allFromRoot(e,t,r){const a=await U.depTables.GetKeyDerivation.get(e,t,r);if(void 0===a)throw new Error("GetDerivationsByPath::getParentPath root not found");const n=[];let s=[a];const o=U.ownTables[P.h.name],i=e.getSchema().table(o.name);for(;0!==s.length;){n.push(...s);const r=e.select().from(i).where(i[o.properties.Parent].in(v()(s).call(s,e=>e.KeyDerivationId)));s=await t.attach(r)}return n}}D()(U,"ownTables",n()({[P.h.name]:P.h})),D()(U,"depTables",n()({GetChildIfExists:R,GetKeyDerivation:K}));const L=async(e,t,r,a,n)=>{if(a&&n===a.length)return r;const s=U.ownTables[P.h.name],o=e.getSchema().table(s.name),i=[o[s.properties.Parent].in(l()(c()(r).call(r)))];a&&null!==a[n]&&i.push(o[s.properties.Index].eq(a[n]));const d=e.select().from(o).where(O.op.and(...i)),u=await t.attach(d),h=new g.a(v()(u).call(u,e=>{if(null==e.Parent)throw new Error("bip44::_getDerivationsByPath Should never happen");const t=r.get(e.Parent);if(null==t)throw new Error("bip44::_getDerivationsByPath Should never happen");if(null===e.Index)throw new Error("bip44::_getDerivationsByPath null child index");return[e.KeyDerivationId,p()(t).call(t,[e.Index])]}));if(0===h.size){if(null==a)return r;throw new Error("bip44::_getDerivationsByPath no result")}return L(e,t,h,a,n+1)};class M{static async getPath(e,t,r,a){const n=await M.depTables.GetDerivationsByPath.getSinglePath(e,t,r.pubDeriverKeyDerivationId,r.pathToLevel),s=n[n.length-1];return{path:n,levelSpecific:await a(s.KeyDerivationId)}}static async getTree(e,t,r,a){const n=await U.getTree(e,t,r.startingDerivation,r.commonPrefix,r.queryPath);return{pathMap:n,rows:await a(l()(c()(n).call(n)))}}}D()(M,"ownTables",n()({})),D()(M,"depTables",n()({GetDerivationsByPath:U}));class F{static async get(e,t,r,a,n){const s=await F.depTables.GetKeyDerivation.get(e,t,r);if(void 0===s)throw new _.a("GetKeyForDerivation::get keyDerivationRow");let o,i;return a&&(o=null===s.PublicKeyId?null:await F.depTables.GetKey.get(e,t,s.PublicKeyId)),n&&(i=null===s.PrivateKeyId?null:await F.depTables.GetKey.get(e,t,s.PrivateKeyId)),{KeyDerivation:s,publicKey:o,privateKey:i}}}D()(F,"ownTables",n()({})),D()(F,"depTables",n()({GetKeyDerivation:K,GetKey:W}));class H{static async fromIds(e,t,r){return await Object(_.j)(e,t,H.ownTables[P.m.name].name,H.ownTables[P.m.name].properties.TransactionId,r.ids)}static async withStatus(e,t,r){const a=H.ownTables[P.m.name],n=e.getSchema().table(a.name),s=e.select().from(n).where(O.op.and(n[a.properties.TransactionId].in(r.txIds),n[a.properties.Status].in(r.status)));return await t.attach(s)}static async byDigest(e,t,r){const a=H.ownTables[P.m.name],n=e.getSchema().table(a.name),s=e.select().from(n).where(O.op.and(n[a.properties.TransactionId].in(r.txIds),n[a.properties.Digest].in(r.digests))),o=await t.attach(s),i=new g.a;for(const e of o)i.set(e.Hash,e);return i}}D()(H,"ownTables",n()({[P.m.name]:P.m})),D()(H,"depTables",n()({}));class V{static async gteHeight(e,t,r){const a=e.getSchema().table(V.ownTables[P.m.name].name),n=e.getSchema().table(V.ownTables[P.c.name].name),s=e.select().from(a).innerJoin(n,a[P.m.properties.BlockId].eq(n[P.c.properties.BlockId])).where(O.op.and(n[P.c.properties.Height].gte(r.height),a[P.m.properties.TransactionId].in(r.txIds)));return await t.attach(s)}static async firstSuccessTxBefore(e,t,r){const a=e.getSchema().table(V.ownTables[P.m.name].name),n=e.getSchema().table(V.ownTables[P.c.name].name),s=e.select().from(a).innerJoin(n,a[P.m.properties.BlockId].eq(n[P.c.properties.BlockId])).orderBy(n[P.c.properties.Height],S.a.Order.DESC).orderBy(a[P.m.properties.Ordinal],S.a.Order.DESC).where(O.op.and(n[P.c.properties.Height].lt(r.height),a[P.m.properties.TransactionId].in(r.txIds),a[P.m.properties.Status].eq(E.d.IN_BLOCK))).limit(1),o=await t.attach(s);if(0!==o.length)return o[0]}static async byTime(e,t,r){const a=V.ownTables[P.m.name],n=V.ownTables[P.c.name],s=e.getSchema().table(a.name),o=e.getSchema().table(n.name),i=e.select().from(s).leftOuterJoin(o,s[a.properties.BlockId].eq(o[n.properties.BlockId])).orderBy(s[a.properties.LastUpdateTime],S.a.Order.DESC).where(O.op.and(s[a.properties.TransactionId].in(r.txIds)));null!=r.limit&&i.limit(r.limit),null!=r.skip&&i.skip(r.skip);const c=await t.attach(i);return v()(c).call(c,e=>null===e.Block.BlockId?{Transaction:e.Transaction,Block:null}:e)}static async withStatus(e,t,r){const a=V.ownTables[P.m.name],n=V.ownTables[P.c.name],s=e.getSchema().table(a.name),o=e.getSchema().table(n.name),i=e.select().from(s).leftOuterJoin(o,s[a.properties.BlockId].eq(o[n.properties.BlockId])).orderBy(s[a.properties.LastUpdateTime],S.a.Order.DESC).where(O.op.and(s[a.properties.TransactionId].in(r.txIds),s[a.properties.Status].in(r.status))),c=await t.attach(i);return v()(c).call(c,e=>null===e.Block.BlockId?{Transaction:e.Transaction,Block:null}:e)}}D()(V,"ownTables",n()({[P.m.name]:P.m,[P.c.name]:P.c})),D()(V,"depTables",n()({}));class ${static async forAddress(e,t,r){var a;const n=$.ownTables[P.e.name],s=$.ownTables[P.f.name],i=$.ownTables[P.m.name],c=$.ownTables[P.c.name],d=e.getSchema().table(n.name),u=e.getSchema().table(s.name),p=e.getSchema().table(i.name),h=e.getSchema().table(c.name),f=e.select().from(d).innerJoin(u,u[s.properties.CertificateId].eq(d[n.properties.CertificateId])).innerJoin(p,u[s.properties.TransactionId].eq(p[i.properties.TransactionId])).leftOuterJoin(h,p[i.properties.BlockId].eq(h[i.properties.BlockId])).where(d[n.properties.AddressId].in(r.addressIds)).orderBy(h[P.c.properties.Height],S.a.Order.DESC).orderBy(p[P.m.properties.Ordinal],S.a.Order.DESC).orderBy(p[P.f.properties.Ordinal],S.a.Order.DESC),w=await t.attach(f),b=new g.a;for(const e of w){const t=b.get(e.Certificate.CertificateId);null==t?b.set(e.Certificate.CertificateId,{relatedAddresses:[e.CertificateAddress],certificate:e.Certificate,transaction:e.Transaction,block:null==e.Block.BlockId?null:e.Block}):t.relatedAddresses.push(e.CertificateAddress)}return v()(a=l()(o()(b).call(b))).call(a,e=>({...e}))}static async forTransactions(e,t,r){const a=$.ownTables[P.e.name],n=$.ownTables[P.f.name],s=e.getSchema().table(a.name),i=e.getSchema().table(n.name),c=e.select().from(i).leftOuterJoin(s,i[n.properties.CertificateId].eq(s[a.properties.CertificateId])).where(i[n.properties.TransactionId].in(r.txIds)),d=await t.attach(c),l=new g.a;for(const e of d){const t=l.get(e.Certificate.CertificateId);null==t?l.set(e.Certificate.CertificateId,{relatedAddresses:null==e.CertificateAddress?[]:[e.CertificateAddress],certificate:e.Certificate}):null!=e.CertificateAddress&&t.relatedAddresses.push(e.CertificateAddress)}const u=new g.a;for(const e of o()(l).call(l)){const t=u.get(e.certificate.TransactionId);null==t?u.set(e.certificate.TransactionId,[{...e}]):t.push({...e})}return u}}D()($,"ownTables",n()({[P.e.name]:P.e,[P.f.name]:P.f,[P.m.name]:P.m,[P.c.name]:P.c})),D()($,"depTables",n()({}));class q{static async get(e,t){return await Object(_.f)(e,t,q.ownTables[P.j.name].name)}}D()(q,"ownTables",n()({[P.j.name]:P.j})),D()(q,"depTables",n()({}));class J{static async all(e,t){return Object(_.f)(e,t,J.ownTables[P.l.name].name)}static async fromIds(e,t,r){return Object(_.j)(e,t,J.ownTables[P.l.name].name,J.ownTables[P.l.name].properties.TokenId,r)}static async fromIdentifier(e,t,r){const{TokenSeed:a}=await J.depTables.GetEncryptionMeta.get(e,t),n=v()(r).call(r,e=>Object(C.a)(e,a));return J.fromDigest(e,t,n)}static async fromDigest(e,t,r){return await Object(_.j)(e,t,J.ownTables[P.l.name].name,J.ownTables[P.l.name].properties.Digest,r)}}D()(J,"ownTables",n()({[P.l.name]:P.l})),D()(J,"depTables",n()({GetEncryptionMeta:G}));class X{static async nextTokenListId(e,t){const r=X.ownTables[P.k.name],a=e.getSchema().table(r.name),n=e.select().from(a).orderBy(a[P.k.properties.ListId],S.a.Order.DESC).limit(1),s=await t.attach(n);return s.length>=1?s[0].ListId+1:0}static async forListId(e,t,r){const a=await Object(_.j)(e,t,X.ownTables[P.k.name].name,X.ownTables[P.k.name].properties.ListId,r.listIds),n=new g.a;for(const e of a){var s;const{ListId:t}=e;if(null==t)continue;const r=null!==(s=n.get(t))&&void 0!==s?s:[];r.push(e),n.set(t,r)}return n}static async join(e,t,r){const a=X.ownTables[P.k.name],n=X.ownTables[P.l.name],s=e.getSchema().table(a.name),o=e.getSchema().table(n.name),i=e.select().from(s).innerJoin(o,s[a.properties.TokenId].eq(o[n.properties.TokenId])).where(O.op.and(s[a.properties.ListId].in(r.listIds),o[n.properties.NetworkId].eq(r.networkId)));return await t.attach(i)}}D()(X,"ownTables",n()({[P.k.name]:P.k,[P.l.name]:P.l})),D()(X,"depTables",n()({}))},261:function(e,t,r){"use strict";(function(e){r.d(t,"c",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return o}));var a=r(6);function n(t){return a.a.WalletV2.PublicKey.from_hex(e.from(t.as_bytes()).toString("hex"))}function s(e){if(e.startingFrom.level+1<e.addressing.startLevel)throw new Error("derivePublicByAddressing keyLevel < startLevel");let t=e.startingFrom.key;for(let r=e.startingFrom.level-e.addressing.startLevel+1;r<e.addressing.path.length;r++)t=t.derive(e.addressing.path[r]);return t}function o(e){if(e.startingFrom.level+1<e.addressing.startLevel)throw new Error("derivePrivateByAddressing keyLevel < startLevel");let t=e.startingFrom.key;for(let r=e.startingFrom.level-e.addressing.startLevel+1;r<e.addressing.path.length;r++)t=t.derive(e.addressing.path[r]);return t}}).call(this,r(48).Buffer)},262:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));r(34);var a=r(8),n=r.n(a);r(92),r(1293),r(659),r(1294);function s(e){return`m/${n()(e).call(e,e=>e%2147483648+(e>=2147483648?"'":"")).join("/")}`}},281:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));var a=r(22);const n={name:"PriceData",properties:{From:"From",To:"To",Time:"Time",Price:"Price"}},s=e=>{e.createTable(n.name).addColumn(n.properties.From,a.Type.NUMBER).addColumn(n.properties.To,a.Type.STRING).addColumn(n.properties.Time,a.Type.DATE_TIME).addColumn(n.properties.Price,a.Type.NUMBER).addPrimaryKey([n.properties.From,n.properties.To,n.properties.Time])}},282:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return x}));var a=r(40),n=r.n(a),s=r(304),o=r.n(s),i=r(32),c=r.n(i),d=r(92),l=r.n(d),u=r(11),p=r.n(u),h=r(1296),f=r.n(h),w=r(842),g=r.n(w),b=r(1297),y=r(1298),I=r(10),v=r(410),T=r(1299);const m=p()({initializing:0,background:1,frontpage:2,addresses:3,backpage:4,mnemonic:5,done:6}),x=async(t,r=(()=>{}))=>{const{network:a,addresses:n,words:s,plate:i}=t;r(m.initializing);const d=new f.a({format:[595.28,841.98],compressPdf:!0}),[u,p]=[d.internal.pageSize.getWidth(),d.internal.pageSize.getHeight()],h={w:u,h:p};try{if(r(m.background),await D(d,b.a,h),a!==v.a.MAINNET&&A(d,a,172),i&&(d.setFontSize(12),d.text(145,180,i.TextPart)),r(m.frontpage),a!==v.a.MAINNET&&A(d,a,105),r(m.addresses),!function(t,r){const a=t.internal.pageSize.getWidth(),[n,s]=[{x:40,y:187},{x:170,y:249}];if(t.setTextColor(0,0,0),1===r.length){t.setFontSize(9);const[s]=r;k(t,n.y+7,s,null,180,!0);const o=e.from(g.a.imageSync(s,{type:"png",size:10,ec_level:"L",margin:0})).toString("base64");O(t,o,{x:a/2-15,y:n.y+17,w:30,h:30})}else if(r.length>1){if(r.length>5)throw new Error("Maximum number of addresses supported: 5");t.setFontSize(8);const a=22,o=[14,14,12,10][r.length-2],i=(s.y-n.y)/r.length;for(let n=0;n<r.length;n++){const c=s.y-i/2-i*n;t.text(s.x-a,c,r[n],null,180);const d=e.from(g.a.imageSync(r[n],{type:"png",size:10,ec_level:"L",margin:0})).toString("base64");O(t,d,{x:s.x-a+4,y:c-(o/2-1),w:o,h:o})}}return!0}(d,n))return null;if(d.addPage(),r(m.backpage),a!==v.a.MAINNET&&A(d,a,75,180),i){O(d,Object(T.a)({seed:i.ImagePart,size:7,scale:5,bgcolor:"#fff",color:"#aaa",spotcolor:"#000"}).toDataURL("image/png"),{x:(u+24)/2,y:115,w:24,h:24,r:180}),d.setFontSize(12),k(d,130,i.TextPart,null,180,!0)}await D(d,y.a,h),r(m.mnemonic),function(e,t){e.setFont("courier"),e.setFontSize(7);const[r,a]=[{x:56,y:82},{x:153,y:105}],n=(a.y-r.y)/3;for(let r=0;r<3;r++){var s;const i=7*r,d=l()(t).call(t,i,i+7),u=c()(d).call(d,(e,t)=>e+t.length,0),p=d.join(o()(s=" ").call(s,(64-u)/7)),h=a.y-n/2-n*r;k(e,h,p,null,180,!0)}}(d,s),function(e){e.setFontSize(11),k(e,56,"password or a hint",null,180,!0),e.setFontType("normal")}(d)}catch(e){throw I.a.error("Failed to render paper wallet! "+Object(I.d)(e)),e}const w=d.output("blob");return r(m.done),w};function A(e,t,r,a,n){e.setFontSize(50),e.setFontType("bold"),e.setTextColor(255,180,164),k(e,r,t.toUpperCase(),null,a,(a||0)>90,n),e.setFontType("normal"),e.setTextColor(0,0,0)}function k(e,t,r,a,n,s,o){const i=e.getStringUnitWidth(r)*e.internal.getFontSize()/e.internal.scaleFactor,c=e.internal.pageSize.width/2-i/2*(!0===s?-1:1);e.text(c+(o||0),t,r,a,n)}async function D(e,t,r){return O(e,await async function(e){return new n.a((t,r)=>{try{const r=new Image;r.crossOrigin="Anonymous",r.onload=()=>{const e=document.createElement("canvas");e.width=r.width,e.height=r.height,e.getContext("2d").drawImage(r,0,0),t(e.toDataURL("image/png"))},r.src=e}catch(e){r(e)}})}(t),r)}function O(e,t,r){const{x:a,y:n,w:s,h:o,r:i}=r||{};e.addImage(t,"png",a||0,n||0,s,o,"","FAST",i)}}).call(this,r(48).Buffer)},309:function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return c})),r.d(t,"c",(function(){return d}));r(62);var a=r(188),n=r(120),s=r(134),o=r(173);function i(t){const r=function(t){const r=c(t.keyRow,t.password);switch(t.keyRow.Type){case n.a.BIP32ED25519:if(t.subkind===n.b.Private)return s.a.fromBuffer(e.from(r,"hex"));if(t.subkind===n.b.Public)return s.b.fromBuffer(e.from(r,"hex"));throw new Error(`keyRowToClass unexpected subtype ${t.keyRow.Type}-${t.subkind}`);case n.a.BIP32:if(t.subkind===n.b.Private)return s.c.fromBuffer(e.from(r,"hex"));if(t.subkind===n.b.Public)return s.d.fromBuffer(e.from(r,"hex"));throw new Error(`keyRowToClass unexpected subtype ${t.keyRow.Type}-${t.subkind}`);default:throw new Error(`keyRowToClass unexpected type ${t.keyRow.Type}`)}}({keyRow:t.privateKeyRow,subkind:n.b.Private,password:t.password}),a=Object(s.g)(r,t.path),o=Object(s.e)(a);if(null==o)throw new Error("Should never happen");return{prvKeyHex:o.toBuffer().toString("hex"),pubKeyHex:o.toPublic().toBuffer().toString("hex")}}function c(t,r){let n;if(t.IsEncrypted){if(null===r)throw new o.a;const s=Object(a.a)(r,t.Hash);n=e.from(s).toString("hex")}else n=t.Hash;return n}async function d(t,r,n,s){const o=c(s.oldKeyRow,s.oldPassword);let i=o;null!==s.newPassword&&(i=Object(a.b)(s.newPassword,e.from(o,"hex")));const d={KeyId:s.oldKeyRow.KeyId,Hash:i,IsEncrypted:null!==s.newPassword,PasswordLastUpdate:s.currentTime,Type:s.oldKeyRow.Type};return await n.ModifyKey.update(t,r,d)}}).call(this,r(48).Buffer)},310:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return ie})),r.d(t,"c",(function(){return ce})),r.d(t,"b",(function(){return le})),r.d(t,"d",(function(){return ue})),r.d(t,"e",(function(){return pe})),r.d(t,"f",(function(){return he}));var a=r(58),n=r.n(a),s=r(32),o=r.n(s),i=r(75),c=r.n(i),d=r(31),l=r.n(d),u=r(165),p=r.n(u),h=r(150),f=r.n(h),w=r(34),g=r.n(w),b=r(11),y=r.n(b),I=r(30),v=r.n(I),T=r(56),m=r.n(T),x=r(35),A=r.n(x),k=r(55),D=r.n(k),O=r(8),S=r.n(O),E=r(37),P=r.n(E),C=r(43),_=r(15),G=r(16),W=r(25),N=r(62),j=r(408),R=r(118),B=r(196),K=r(76),U=r(152),L=r(107),M=r(709),F=r(21),H=r(33),V=(r(77),r(86)),$=r(157),q=r(141),J=r(88),X=r(119),Y=r(166),z=r(213),Z=r(130),Q=r(19),ee=r(23),te=r(6),re=r(60),ae=r(176),ne=r(20);async function se(e,t,r,a,n){const s=[],o=Object(H.e)(a.publicDeriver);if(null!=o){const e=await o.rawGetAllUtxoAddresses(t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,GetDerivationSpecific:r.GetDerivationSpecific},void 0,n),a=P()(e).call(e,e=>{var t;return S()(t=e.addrs).call(t,e=>e.AddressId)});s.push(...a)}const i=[],c=Object(H.d)(a.publicDeriver);if(null!=c){const e=await c.rawGetAllAccountingAddresses(t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,GetDerivationSpecific:r.GetDerivationSpecific},void 0,n),a=P()(e).call(e,e=>{var t;return S()(t=e.addrs).call(t,e=>e.AddressId)});i.push(...a)}return{txIds:D()(new A.a([...await r.AssociateTxWithAccountingIOs.getTxIdsForAddresses(e,t,{addressIds:i}),...await r.AssociateTxWithUtxoIOs.getTxIdsForAddresses(e,t,{addressIds:s})])),addressIds:{utxoAddressIds:s,accountingAddressIds:i}}}async function oe(e,t,r,a,n){const{addressIds:s,txIds:o}=await se(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,AssociateTxWithAccountingIOs:r.AssociateTxWithAccountingIOs,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,GetDerivationSpecific:r.GetDerivationSpecific},{publicDeriver:a.publicDeriver},n),i=new m.a,c=await a.getTxAndBlock(o);for(const e of c)i.set(e.Transaction.TransactionId,e.Block);const d=await r.JormungandrAssociateTxWithIOs.getIOsForTx(e,t,{txs:S()(c).call(c,e=>e.Transaction),networkId:a.publicDeriver.getParent().getNetworkInfo().NetworkId}),l=new m.a;{const r=P()(d).call(d,e=>{var t,r,a,n,s;return[...S()(t=e.utxoInputs).call(t,e=>e.AddressId),...S()(r=e.utxoOutputs).call(r,e=>e.AddressId),...S()(a=e.accountingInputs).call(a,e=>e.AddressId),...S()(n=e.accountingOutputs).call(n,e=>e.AddressId),...P()(s=e.certificates).call(s,e=>{var t;return S()(t=e.relatedAddresses).call(t,e=>e.AddressId)})]}),a=await W.b.getById(e,t,D()(new A.a(r)));for(const e of a)l.set(e.AddressId,e.Hash)}return{addressLookupMap:l,txs:S()(d).call(d,e=>{var t;return{...e,block:i.get(e.transaction.TransactionId)||null,...Object(ae.b)({tokens:e.tokens,utxoInputs:e.utxoInputs,utxoOutputs:e.utxoOutputs,accountingInputs:e.accountingInputs,accountingOutputs:e.accountingOutputs,allOwnedAddressIds:new A.a(P()(t=v()(s)).call(t,e=>s[e])),defaultToken:a.publicDeriver.getParent().getDefaultToken()})}})}}async function ie(e){var t,r;const a=e.publicDeriver.getParent().getDerivationTables(),n=y()({GetPathWithSpecific:W.m,GetAddress:W.b,JormungandrAssociateTxWithIOs:L.d,AssociateTxWithAccountingIOs:U.a,AssociateTxWithUtxoIOs:K.a,GetTxAndBlock:W.p,GetDerivationSpecific:J.a}),s=P()(t=S()(r=v()(n)).call(r,e=>n[e])).call(t,t=>Object(_.g)(e.publicDeriver.getDb(),t));return await Object(_.m)(e.publicDeriver.getDb(),[...s,...Object(_.k)(e.publicDeriver.getDb(),a)],async t=>await oe(e.publicDeriver.getDb(),t,{GetPathWithSpecific:n.GetPathWithSpecific,GetAddress:n.GetAddress,JormungandrAssociateTxWithIOs:n.JormungandrAssociateTxWithIOs,AssociateTxWithAccountingIOs:n.AssociateTxWithAccountingIOs,AssociateTxWithUtxoIOs:n.AssociateTxWithUtxoIOs,GetTxAndBlock:n.GetTxAndBlock,GetDerivationSpecific:n.GetDerivationSpecific},{...e,getTxAndBlock:async r=>await n.GetTxAndBlock.byTime(e.publicDeriver.getDb(),t,{txIds:r,skip:e.skip,limit:e.limit})},a))}async function ce(e){var t,r;const a=e.publicDeriver.getParent().getDerivationTables(),n=y()({GetPathWithSpecific:W.m,GetAddress:W.b,JormungandrAssociateTxWithIOs:L.d,AssociateTxWithAccountingIOs:U.a,AssociateTxWithUtxoIOs:K.a,GetTxAndBlock:W.p,GetDerivationSpecific:J.a}),s=P()(t=S()(r=v()(n)).call(r,e=>n[e])).call(t,t=>Object(_.g)(e.publicDeriver.getDb(),t));return await Object(_.m)(e.publicDeriver.getDb(),[...s,...Object(_.k)(e.publicDeriver.getDb(),a)],async t=>await oe(e.publicDeriver.getDb(),t,{GetPathWithSpecific:n.GetPathWithSpecific,GetAddress:n.GetAddress,JormungandrAssociateTxWithIOs:n.JormungandrAssociateTxWithIOs,AssociateTxWithAccountingIOs:n.AssociateTxWithAccountingIOs,AssociateTxWithUtxoIOs:n.AssociateTxWithUtxoIOs,GetTxAndBlock:n.GetTxAndBlock,GetDerivationSpecific:n.GetDerivationSpecific},{...e,getTxAndBlock:async r=>await n.GetTxAndBlock.withStatus(e.publicDeriver.getDb(),t,{txIds:r,status:[F.d.PENDING]})},a))}async function de(e,t,r,a,n){var s;const o=await se(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,AssociateTxWithAccountingIOs:r.AssociateTxWithAccountingIOs,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,GetDerivationSpecific:r.GetDerivationSpecific},{publicDeriver:n.publicDeriver},a),i=await r.GetTransaction.fromIds(e,t,{ids:o.txIds}),c=await r.JormungandrAssociateTxWithIOs.getIOsForTx(e,t,{txs:i,networkId:n.publicDeriver.getParent().getNetworkInfo().NetworkId}),d=P()(c).call(c,e=>{var t,r,a,n;return[...S()(t=e.utxoInputs).call(t,e=>e.AddressId),...S()(r=e.utxoOutputs).call(r,e=>e.AddressId),...S()(a=e.accountingInputs).call(a,e=>e.AddressId),...S()(n=e.accountingOutputs).call(n,e=>e.AddressId)]}),l=new A.a(P()(s=v()(o.addressIds)).call(s,e=>o.addressIds[e])),u=g()(d).call(d,e=>!l.has(e));return D()(new A.a(u))}async function le(e){var t,r;const a=e.publicDeriver.getParent().getDerivationTables(),n=y()({GetPathWithSpecific:W.m,GetAddress:W.b,JormungandrAssociateTxWithIOs:L.d,AssociateTxWithAccountingIOs:U.a,AssociateTxWithUtxoIOs:K.a,GetDerivationSpecific:J.a,GetTransaction:W.o}),s=e.publicDeriver.getDb(),o=P()(t=S()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(_.g)(s,e));return await Object(_.m)(s,[...s.getSchema().tables(),...o,...Object(_.k)(s,a)],async t=>{const r=await de(s,t,n,e.publicDeriver.getParent().getDerivationTables(),{publicDeriver:e.publicDeriver}),a=await W.b.getById(s,t,r),o=[],i=new A.a;for(const e of a)i.has(e.Hash)||(i.add(e.Hash),o.push({address:e.Hash,type:e.Type}));return o})}async function ue(e,t,r,a,n){const s=await de(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,JormungandrAssociateTxWithIOs:r.JormungandrAssociateTxWithIOs,AssociateTxWithAccountingIOs:r.AssociateTxWithAccountingIOs,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,GetDerivationSpecific:r.GetDerivationSpecific,GetTransaction:r.GetTransaction},a,n),o=await se(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,AssociateTxWithAccountingIOs:r.AssociateTxWithAccountingIOs,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,GetDerivationSpecific:r.GetDerivationSpecific},{publicDeriver:n.publicDeriver},a),i=await async function(e,t,r,a,n){var s;const o=await se(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,AssociateTxWithAccountingIOs:r.AssociateTxWithAccountingIOs,GetDerivationSpecific:r.GetDerivationSpecific},{publicDeriver:n.publicDeriver},a),i=await r.GetTransaction.fromIds(e,t,{ids:o.txIds}),c=await r.JormungandrAssociateTxWithIOs.getIOsForTx(e,t,{txs:i,networkId:n.publicDeriver.getParent().getNetworkInfo().NetworkId});return D()(new A.a(S()(s=P()(c).call(c,e=>e.tokens)).call(s,e=>e.TokenList.ListId)))}(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,JormungandrAssociateTxWithIOs:r.JormungandrAssociateTxWithIOs,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,AssociateTxWithAccountingIOs:r.AssociateTxWithAccountingIOs,GetDerivationSpecific:r.GetDerivationSpecific,GetTransaction:r.GetTransaction},a,n);return await r.DeleteAllTransactions.delete(e,t,{publicDeriverId:n.publicDeriver.getPublicDeriverId(),txIds:o.txIds}),await r.ModifyAddress.remove(e,t,s),await r.FreeBlocks.free(e,t),await r.ModifyTokenList.remove(e,t,i),o}async function pe(e){var t,r;const a=e.publicDeriver.getParent().getDerivationTables(),n=y()({GetPathWithSpecific:W.m,GetAddress:W.b,JormungandrAssociateTxWithIOs:L.d,AssociateTxWithAccountingIOs:U.a,AssociateTxWithUtxoIOs:K.a,GetDerivationSpecific:J.a,DeleteAllTransactions:X.b,ModifyAddress:N.d,GetTransaction:W.o,FreeBlocks:N.b,ModifyTokenList:N.j}),s=e.publicDeriver.getDb(),o=P()(t=S()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(_.g)(s,e));return await Object(_.m)(s,[...s.getSchema().tables(),...o,...Object(_.k)(s,a)],async t=>ue(s,t,n,e.publicDeriver.getParent().getDerivationTables(),{publicDeriver:e.publicDeriver}))}async function he(e,t,r,a,s){const i=Object(H.j)(t),d=null==i?new m.a:i.getParent().getDerivationTables();let u=void 0;try{var h,w;const i=y()({GetLastSyncForPublicDeriver:V.d,ModifyLastSyncInfo:X.e,GetKeyForPublicDeriver:V.c,GetAddress:W.b,GetPathWithSpecific:W.m,GetUtxoTxOutputsWithTx:K.c,ModifyAddress:N.d,GetPublicDeriver:V.e,AddDerivationTree:q.b,MarkUtxo:B.a,ModifyDisplayCutoff:$.b,GetDerivationsByPath:W.g,GetEncryptionMeta:W.h,GetTransaction:W.o,GetUtxoInputs:K.b,GetTxAndBlock:W.p,GetDerivationSpecific:J.a,ModifyTransaction:N.k,ModifyJormungandrTx:j.d,JormungandrAssociateTxWithIOs:L.d,AssociateTxWithAccountingIOs:U.a,AssociateTxWithUtxoIOs:K.a,GetKeyDerivation:W.j,ModifyToken:N.i,GetToken:W.n,AssociateToken:W.a}),b=P()(h=S()(w=v()(i)).call(w,e=>i[e])).call(h,t=>Object(_.g)(e,t));await Object(_.m)(e,[...b,...Object(_.k)(e,d)],async h=>{u=await i.GetLastSyncForPublicDeriver.forId(e,h,t.getPublicDeriverId());const{GetLastSyncForPublicDeriver:w,...b}=i;await async function(e,t,r,a,s,i,d,u,h){const w=await Object(z.e)(Object(ne.e)(a.getParent().getNetworkInfo())),{BackendService:b}=a.getParent().getNetworkInfo().Backend;if(null==b)throw new Error("rawUpdateTransactions missing backend url");const y=await u({network:a.getParent().getNetworkInfo()});if(null!==s.SlotNum){const e=s.Height,t=null!=y.height?y.height:0;if(e-t>Q.b)return}if(null!=y.hash){var I;const s=y.hash,u=Object(H.l)(a);null!=u&&await u.rawScanAddresses(t,{GetKeyForPublicDeriver:r.GetKeyForPublicDeriver,GetAddress:r.GetAddress,GetPathWithSpecific:r.GetPathWithSpecific,GetUtxoTxOutputsWithTx:r.GetUtxoTxOutputsWithTx,ModifyAddress:r.ModifyAddress,GetPublicDeriver:r.GetPublicDeriver,AddDerivationTree:r.AddDerivationTree,ModifyDisplayCutoff:r.ModifyDisplayCutoff,GetDerivationsByPath:r.GetDerivationsByPath,GetDerivationSpecific:r.GetDerivationSpecific,GetKeyDerivation:r.GetKeyDerivation},{checkAddressesInUse:i},h);const{utxoAddresses:p,accountingAddresses:b}=await Object(Y.b)(t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,GetDerivationSpecific:r.GetDerivationSpecific},{publicDeriver:a},h),v=S()(p).call(p,e=>e.AddressId),T=S()(b).call(b,e=>e.AddressId),x=D()(new A.a([...await r.AssociateTxWithAccountingIOs.getTxIdsForAddresses(e,t,{addressIds:T}),...await r.AssociateTxWithUtxoIOs.getTxIdsForAddresses(e,t,{addressIds:v})])),k=await r.GetTxAndBlock.firstSuccessTxBefore(e,t,{txIds:x,height:f.a}),O=null==k?void 0:{after:{block:k.Block.Hash,tx:k.Transaction.Hash}},E=await d({...O,network:a.getParent().getNetworkInfo(),addresses:[...S()(I=g()(p).call(p,e=>e.Type!==F.b.JORMUNGANDR_GROUP)).call(I,e=>e.Hash),...S()(b).call(b,e=>e.Hash)],untilBlock:s});await async function(e,t,r,a){const{TransactionSeed:s,BlockSeed:i}=await r.GetEncryptionMeta.get(e,t),d=new m.a;{var u;const n=S()(u=a.txsFromNetwork).call(u,e=>Object(R.a)(e.hash,s)),o=await r.GetTransaction.byDigest(e,t,{digests:n,txIds:a.txIds}),i=D()(l()(o).call(o)),c=await r.JormungandrAssociateTxWithIOs.getIOsForTx(e,t,{txs:i,networkId:a.network.NetworkId});for(const e of c)d.set(e.transaction.Hash,e)}const p=[],h=[],f=new A.a;for(const n of a.txsFromNetwork){const o=d.get(n.hash);if(null==o){p.push(n);continue}const c=be(n,a.toAbsoluteSlotNumber,s,i);f.add(o.transaction.TransactionId);const l=await r.ModifyTransaction.updateExisting(e,t,{block:c.block,transaction:e=>({...c.transaction(e),TransactionId:o.transaction.TransactionId})});null===o.transaction.BlockId&&(null!==l.block&&h.push({...o,block:l.block,transaction:l.transaction}))}const w=await async function(e,t,r,a,n,s){var o;const i=D()(new A.a(P()(a).call(a,e=>[s.defaultIdentifier]))),d=g()(o=await r.GetToken.fromIdentifier(e,t,i)).call(o,e=>e.NetworkId===n.NetworkId),l=new m.a;return c()(d).call(d,e=>l.set(e.Identifier,e)),l}(e,t,{ModifyToken:r.ModifyToken,GetToken:r.GetToken},p,a.network,a.defaultToken),b=await Object(K.d)(e,t,{AssociateToken:r.AssociateToken}),y=await async function(e,t,r,a,s,i,c,d,u,p,h){var f;const w=D()(new A.a(P()(s).call(s,e=>{var t,r;return[...S()(t=e.inputs).call(t,e=>e.address),...S()(r=e.outputs).call(r,e=>e.address)]}))),g=await i({db:e,tx:t,lockedTables:D()(l()(a).call(a)),hashes:w}),b=e=>{const t=g.get(e);if(void 0===t)throw new Error("networkTxToDbTx should never happen id === undefined");return t},y=e=>{const t=p.get(e);if(void 0===t)throw new Error("networkTxToDbTx should never happen -- asset missing");return t},I=o()(f=Object(ne.e)(r)).call(f,(e,t)=>n()(e,t),{}),v=[];for(const n of s){const{block:s,transaction:o}=be(n,c,d,u),l=null==n.certificate?[e=>{}]:[await ye(e,t,{discriminant:I.Discriminant,certificate:n.certificate,hashToIds:i,derivationTables:a,firstInput:n.inputs[0]})];v.push({block:s,transaction:o,certificates:l,ioGen:fe(n,b,r,y,h)})}return v}(e,t,a.network,a.derivationTables,p,a.hashToIds,a.toAbsoluteSlotNumber,s,i,w,b),I=new A.a;for(const a of y){const n=await r.ModifyJormungandrTx.addTxWithIOs(e,t,a);I.add(n.transaction.TransactionId),null!==n.block&&h.push({txType:n.txType,block:n.block,transaction:n.transaction,certificates:n.certificates,utxoInputs:n.utxoInputs,utxoOutputs:n.utxoOutputs,accountingInputs:n.accountingInputs,accountingOutputs:n.accountingOutputs,tokens:n.tokens})}const v=S()(h).call(h,e=>e.transaction.TransactionId);await we(e,t,{MarkUtxo:r.MarkUtxo,GetUtxoInputs:r.GetUtxoInputs,GetTransaction:r.GetTransaction},{inputTxIds:v,allTxIds:[...a.txIds,...v],isUnspent:!1,TransactionSeed:s,networkId:a.network.NetworkId});const T=await r.GetTransaction.withStatus(e,t,{txIds:a.txIds,status:[F.d.PENDING]});for(const a of T)f.has(a.TransactionId)||I.has(a.TransactionId)||await r.ModifyTransaction.updateStatus(e,t,{transaction:a,status:F.d.NOT_IN_REMOTE});return h}(e,t,{MarkUtxo:r.MarkUtxo,JormungandrAssociateTxWithIOs:r.JormungandrAssociateTxWithIOs,GetEncryptionMeta:r.GetEncryptionMeta,GetTransaction:r.GetTransaction,GetUtxoInputs:r.GetUtxoInputs,ModifyTransaction:r.ModifyTransaction,ModifyJormungandrTx:r.ModifyJormungandrTx,ModifyToken:r.ModifyToken,GetToken:r.GetToken,AssociateToken:r.AssociateToken},{network:a.getParent().getNetworkInfo(),txIds:x,txsFromNetwork:E,hashToIds:Object(Z.c)(new A.a([...v,...T]),a.getParent().getNetworkInfo()),defaultToken:a.getParent().getDefaultToken(),toAbsoluteSlotNumber:w,derivationTables:h})}const v=null==y.epoch||null==y.slot?null:w({epoch:y.epoch,slot:y.slot});await r.ModifyLastSyncInfo.overrideLastSyncInfo(e,t,{LastSyncInfoId:s.LastSyncInfoId,Time:new Date(p()()),SlotNum:v,BlockHash:y.hash,Height:y.height})}(e,h,b,t,u,r,a,s,d)})}catch(r){var b,I;if(!(r instanceof ee.A))throw r;if(void 0===u)throw r;const a=y()({GetPathWithSpecific:W.m,GetAddress:W.b,GetTxAndBlock:W.p,GetLastSyncForPublicDeriver:V.d,ModifyLastSyncInfo:X.e,GetBlock:W.c,ModifyTransaction:N.k,MarkUtxo:B.a,GetTransaction:W.o,GetUtxoInputs:K.b,GetEncryptionMeta:W.h,GetDerivationSpecific:J.a,JormungandrAssociateTxWithIOs:L.d,AssociateTxWithAccountingIOs:U.a,AssociateTxWithUtxoIOs:K.a}),n=P()(b=S()(I=v()(a)).call(I,e=>a[e])).call(b,t=>Object(_.g)(e,t));await Object(_.m)(e,[...n,...Object(_.k)(e,d)],async r=>{const n=await a.GetLastSyncForPublicDeriver.forId(e,r,t.getPublicDeriverId());Object(C.isEqual)(n,u)&&await async function(e,t,r,a,n){const{TransactionSeed:s}=await r.GetEncryptionMeta.get(e,t);if(null===a.lastSyncInfo.SlotNum)return;const{utxoAddresses:o,accountingAddresses:i}=await Object(Y.b)(t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,GetDerivationSpecific:r.GetDerivationSpecific},{publicDeriver:a.publicDeriver},n),c=S()(o).call(o,e=>e.AddressId),d=S()(i).call(i,e=>e.AddressId),l=D()(new A.a([...await r.AssociateTxWithAccountingIOs.getTxIdsForAddresses(e,t,{addressIds:d}),...await r.AssociateTxWithUtxoIOs.getTxIdsForAddresses(e,t,{addressIds:c})])),u=await r.GetTxAndBlock.firstSuccessTxBefore(e,t,{txIds:l,height:f.a});if(null==u)return;const h=await r.GetTxAndBlock.gteHeight(e,t,{txIds:l,height:u.Block.Height-Q.b});for(const a of h)await r.ModifyTransaction.updateStatus(e,t,{status:F.d.ROLLBACK_FAIL,transaction:a.Transaction});await we(e,t,{MarkUtxo:r.MarkUtxo,GetUtxoInputs:r.GetUtxoInputs,GetTransaction:r.GetTransaction},{inputTxIds:S()(h).call(h,e=>e.Transaction.TransactionId),allTxIds:l,isUnspent:!0,TransactionSeed:s,networkId:a.publicDeriver.getParent().getNetworkInfo().NetworkId});const w=await r.GetTransaction.withStatus(e,t,{txIds:l,status:[F.d.PENDING]});for(const a of w)await r.ModifyTransaction.updateStatus(e,t,{transaction:a,status:F.d.ROLLBACK_FAIL});const g=await r.GetTxAndBlock.firstSuccessTxBefore(e,t,{txIds:l,height:u.Block.Height-Q.b});await r.ModifyLastSyncInfo.overrideLastSyncInfo(e,t,{LastSyncInfoId:a.lastSyncInfo.LastSyncInfoId,Time:new Date(p()()),SlotNum:void 0===g?null:g.Block.SlotNum,Height:void 0===g?0:g.Block.Height,BlockHash:void 0===g?null:g.Block.Hash})}(e,r,a,{publicDeriver:t,lastSyncInfo:n},d)})}}function fe(e,t,r,a,n){return s=>{const o=[],i=[],c=[],d=[],l=[];for(let i=0;i<e.inputs.length;i++){const d=e.inputs[i],u=n();if(l.push({TokenList:{Amount:d.amount,ListId:u,TokenId:a(F.c.Jormungandr).TokenId},identifier:F.c.Jormungandr,networkId:r.NetworkId}),d.type===M.a.utxo||d.type===M.a.legacyUtxo)o.push({TransactionId:s,AddressId:t(d.address),ParentTxHash:d.txHash,IndexInParentTx:d.index,IndexInOwnTx:i,TokenListId:u});else{if(d.type!==M.a.account)throw new Error("networkTxToDbTx Unhandled input type");c.push({TransactionId:s,AddressId:t(d.address),SpendingCounter:d.spendingCounter,IndexInOwnTx:i,TokenListId:u})}}for(let o=0;o<e.outputs.length;o++){const c=e.outputs[o],u=Object(re.b)(c.address,"bytes",r),p=n();if(l.push({TokenList:{Amount:c.amount,ListId:p,TokenId:a(F.c.Jormungandr).TokenId},identifier:F.c.Jormungandr,networkId:r.NetworkId}),u===F.b.CARDANO_LEGACY||u===F.b.JORMUNGANDR_SINGLE||u===F.b.JORMUNGANDR_GROUP)i.push({TransactionId:s,AddressId:t(c.address),OutputIndex:o,TokenListId:p,IsUnspent:!0,ErgoBoxId:null,ErgoCreationHeight:null,ErgoTree:null,ErgoRegisters:null});else{if(u!==F.b.JORMUNGANDR_ACCOUNT)throw new Error("networkTxToDbTx Unhandled output type");d.push({TransactionId:s,AddressId:t(c.address),OutputIndex:o,TokenListId:p})}}return{utxoInputs:o,utxoOutputs:i,accountingInputs:c,accountingOutputs:d,tokenList:l}}}async function we(e,t,r,a){const n=await r.GetUtxoInputs.fromTxIds(e,t,{ids:a.inputTxIds}),s=S()(n).call(n,e=>Object(R.a)(e.ParentTxHash,a.TransactionSeed)),o=await r.GetTransaction.byDigest(e,t,{digests:s,txIds:a.allTxIds});for(const s of n){const n=o.get(s.ParentTxHash);void 0!==n&&await r.MarkUtxo.markAs(e,t,{txId:n.TransactionId,outputIndex:s.IndexInParentTx,isUnspent:a.isUnspent,networkId:a.networkId})}}function ge(e){if("Successful"===e)return F.d.IN_BLOCK;if("Pending"===e)return F.d.PENDING;if("Failed"===e)return F.d.FAIL_RESPONSE;throw new Error("statusStringToCode unexpected status "+e)}function be(e,t,r,a){const n=null!=e.epoch&&null!=e.slot&&null!=e.block_hash&&null!=e.time&&null!=e.height?{Hash:e.block_hash,BlockTime:new Date(e.time),Height:e.height,SlotNum:t({epoch:e.epoch,slot:e.slot}),Digest:Object(R.a)(e.hash,a)}:null,s=Object(R.a)(e.hash,r);return{block:n,transaction:t=>({Type:G.n.Jormungandr,Hash:e.hash,Digest:s,BlockId:t,Ordinal:e.tx_ordinal,LastUpdateTime:null==n||null==e.time?new Date(e.last_update).getTime():new Date(e.time).getTime(),Status:ge(e.tx_state),ErrorMessage:null,Extra:null})}}async function ye(t,r,a){const n=async n=>{var s;const o=n.to_address(a.discriminant),i=e.from(o.as_bytes()).toString("hex"),c=(await a.hashToIds({db:t,tx:r,lockedTables:D()(l()(s=a.derivationTables).call(s)),hashes:[i]})).get(i);if(void 0===c)throw new Error("certificateToDb should never happen id === undefined");return c},s=a.certificate.payloadKindId;switch(s){case te.a.WalletV3.CertificateKind.StakeDelegation:{const t=te.a.WalletV3.StakeDelegation.from_bytes(e.from(a.certificate.payloadHex,"hex")).account().to_account_single(),r=await n(t);return e=>({certificate:{Ordinal:0,Kind:s,Payload:a.certificate.payloadHex,TransactionId:e},relatedAddresses:e=>[{CertificateId:e,AddressId:r,Relation:F.a.SIGNER}]})}case te.a.WalletV3.CertificateKind.OwnerStakeDelegation:{var o;const e=(await a.hashToIds({db:t,tx:r,lockedTables:D()(l()(o=a.derivationTables).call(o)),hashes:[a.firstInput.address]})).get(a.firstInput.address);if(void 0===e)throw new Error("certificateToDb should never happen id === undefined");return t=>({certificate:{Ordinal:0,Kind:s,Payload:a.certificate.payloadHex,TransactionId:t},relatedAddresses:t=>[{CertificateId:t,AddressId:e,Relation:F.a.SIGNER}]})}case te.a.WalletV3.CertificateKind.PoolRegistration:{const t=te.a.WalletV3.PoolRegistration.from_bytes(e.from(a.certificate.payloadHex,"hex")).reward_account(),r=null==t?null:await n(t);return e=>({certificate:{Ordinal:0,Kind:s,Payload:a.certificate.payloadHex,TransactionId:e},relatedAddresses:e=>[...null!=r?[{CertificateId:e,AddressId:r,Relation:F.a.REWARD_ADDRESS}]:[]]})}case te.a.WalletV3.CertificateKind.PoolRetirement:case te.a.WalletV3.CertificateKind.PoolUpdate:return e=>({certificate:{Ordinal:0,Kind:s,Payload:a.certificate.payloadHex,TransactionId:e},relatedAddresses:e=>[]});default:throw new Error("unknown cert type "+s)}}}).call(this,r(48).Buffer)},311:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return se})),r.d(t,"c",(function(){return oe})),r.d(t,"b",(function(){return ce})),r.d(t,"d",(function(){return de})),r.d(t,"e",(function(){return le})),r.d(t,"f",(function(){return ue}));var a=r(75),n=r.n(a),s=r(66),o=r.n(s),i=r(31),c=r.n(i),d=r(165),l=r.n(d),u=r(150),p=r.n(u),h=r(11),f=r.n(h),w=r(30),g=r.n(w),b=r(58),y=r.n(b),I=r(32),v=r.n(I),T=r(37),m=r.n(T),x=r(34),A=r.n(x),k=r(56),D=r.n(k),O=r(35),S=r.n(O),E=r(55),P=r.n(E),C=r(8),_=r.n(C),G=r(43),W=r(15),N=r(16),j=r(25),R=r(62),B=r(408),K=r(118),U=r(196),L=r(76),M=r(107),F=r(21),H=r(33),V=(r(77),r(86)),$=r(157),q=r(141),J=r(88),X=r(119),Y=r(166),z=r(130),Z=r(19),Q=r(23),ee=r(6),te=r(176),re=r(20);async function ae(e,t,r,a,n){const{utxoAddresses:s}=await Object(Y.b)(t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,GetDerivationSpecific:r.GetDerivationSpecific},a,n),o=_()(s).call(s,e=>e.AddressId);return{txIds:P()(new S.a([...await r.AssociateTxWithUtxoIOs.getTxIdsForAddresses(e,t,{addressIds:o})])),addresses:{utxoAddresses:s}}}async function ne(t,r,a,n,s){var o,i;const{addresses:c,txIds:d}=await ae(t,r,{GetPathWithSpecific:a.GetPathWithSpecific,GetAddress:a.GetAddress,AssociateTxWithUtxoIOs:a.AssociateTxWithUtxoIOs,GetDerivationSpecific:a.GetDerivationSpecific},{publicDeriver:n.publicDeriver},s),l=new D.a,u=await n.getTxAndBlock(d);for(const e of u)l.set(e.Transaction.TransactionId,e.Block);const p=await a.ErgoAssociateTxWithIOs.getIOsForTx(t,r,{txs:A()(o=_()(u).call(u,e=>e.Transaction)).call(o,e=>e.Type===N.n.Ergo),networkId:n.publicDeriver.getParent().getNetworkInfo().NetworkId}),h=new D.a;{const e=m()(p).call(p,e=>{var t,r;return[..._()(t=e.utxoInputs).call(t,e=>e.AddressId),..._()(r=e.utxoOutputs).call(r,e=>e.AddressId)]}),a=await j.b.getById(t,r,P()(new S.a(e)));for(const e of a)h.set(e.AddressId,e.Hash)}const f=n.publicDeriver.getParent().getNetworkInfo(),w=v()(i=Object(re.d)(f)).call(i,(e,t)=>y()(e,t),{}),b=e.from(ee.a.SigmaRust.Address.from_bytes(e.from(w.FeeAddress,"hex")).to_ergo_tree().to_bytes()).toString("hex");return{addressLookupMap:h,txs:_()(p).call(p,e=>{var t,r,a;return{...e,block:l.get(e.transaction.TransactionId)||null,...Object(te.b)({tokens:e.tokens,utxoInputs:e.utxoInputs,utxoOutputs:A()(t=e.utxoOutputs).call(t,e=>e.ErgoTree!==b),allOwnedAddressIds:new S.a(_()(r=m()(a=g()(c)).call(a,e=>c[e])).call(r,e=>e.AddressId)),defaultToken:n.publicDeriver.getParent().getDefaultToken()})}})}}async function se(e){var t,r;const a=e.publicDeriver.getParent().getDerivationTables(),n=f()({GetPathWithSpecific:j.m,GetAddress:j.b,ErgoAssociateTxWithIOs:M.c,AssociateTxWithUtxoIOs:L.a,GetTxAndBlock:j.p,GetDerivationSpecific:J.a}),s=m()(t=_()(r=g()(n)).call(r,e=>n[e])).call(t,t=>Object(W.g)(e.publicDeriver.getDb(),t));return await Object(W.m)(e.publicDeriver.getDb(),[...s,...Object(W.k)(e.publicDeriver.getDb(),a)],async t=>await ne(e.publicDeriver.getDb(),t,{GetPathWithSpecific:n.GetPathWithSpecific,GetAddress:n.GetAddress,ErgoAssociateTxWithIOs:n.ErgoAssociateTxWithIOs,AssociateTxWithUtxoIOs:n.AssociateTxWithUtxoIOs,GetTxAndBlock:n.GetTxAndBlock,GetDerivationSpecific:n.GetDerivationSpecific},{...e,getTxAndBlock:async r=>await n.GetTxAndBlock.byTime(e.publicDeriver.getDb(),t,{txIds:r,skip:e.skip,limit:e.limit})},a))}async function oe(e){var t,r;const a=e.publicDeriver.getParent().getDerivationTables(),n=f()({GetPathWithSpecific:j.m,GetAddress:j.b,ErgoAssociateTxWithIOs:M.c,AssociateTxWithUtxoIOs:L.a,GetTxAndBlock:j.p,GetDerivationSpecific:J.a}),s=m()(t=_()(r=g()(n)).call(r,e=>n[e])).call(t,t=>Object(W.g)(e.publicDeriver.getDb(),t));return await Object(W.m)(e.publicDeriver.getDb(),[...s,...Object(W.k)(e.publicDeriver.getDb(),a)],async t=>await ne(e.publicDeriver.getDb(),t,{GetPathWithSpecific:n.GetPathWithSpecific,GetAddress:n.GetAddress,ErgoAssociateTxWithIOs:n.ErgoAssociateTxWithIOs,AssociateTxWithUtxoIOs:n.AssociateTxWithUtxoIOs,GetTxAndBlock:n.GetTxAndBlock,GetDerivationSpecific:n.GetDerivationSpecific},{...e,getTxAndBlock:async r=>await n.GetTxAndBlock.withStatus(e.publicDeriver.getDb(),t,{txIds:r,status:[F.d.PENDING]})},a))}async function ie(e,t,r,a,n){var s,o;const i=await ae(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,GetDerivationSpecific:r.GetDerivationSpecific},{publicDeriver:n.publicDeriver},a),c=await r.GetTransaction.fromIds(e,t,{ids:i.txIds}),d=await r.ErgoAssociateTxWithIOs.getIOsForTx(e,t,{txs:A()(c).call(c,e=>e.Type===N.n.Ergo),networkId:n.publicDeriver.getParent().getNetworkInfo().NetworkId}),l=m()(d).call(d,e=>{var t,r;return[..._()(t=e.utxoInputs).call(t,e=>e.AddressId),..._()(r=e.utxoOutputs).call(r,e=>e.AddressId)]}),u=new S.a(_()(s=m()(o=g()(i.addresses)).call(o,e=>i.addresses[e])).call(s,e=>e.AddressId)),p=A()(l).call(l,e=>!u.has(e));return P()(new S.a(p))}async function ce(e){var t,r;const a=e.publicDeriver.getParent().getDerivationTables(),n=f()({GetPathWithSpecific:j.m,GetAddress:j.b,ErgoAssociateTxWithIOs:M.c,AssociateTxWithUtxoIOs:L.a,GetDerivationSpecific:J.a,GetTransaction:j.o}),s=e.publicDeriver.getDb(),o=m()(t=_()(r=g()(n)).call(r,e=>n[e])).call(t,e=>Object(W.g)(s,e));return await Object(W.m)(s,[...s.getSchema().tables(),...o,...Object(W.k)(s,a)],async t=>{const r=await ie(s,t,n,e.publicDeriver.getParent().getDerivationTables(),{publicDeriver:e.publicDeriver}),a=await j.b.getById(s,t,r),o=[],i=new S.a;for(const e of a)i.has(e.Hash)||(i.add(e.Hash),o.push({address:e.Hash,type:e.Type}));return o})}async function de(e,t,r,a,n){const s=await ie(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,ErgoAssociateTxWithIOs:r.ErgoAssociateTxWithIOs,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,GetDerivationSpecific:r.GetDerivationSpecific,GetTransaction:r.GetTransaction},a,n),o=await ae(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,GetDerivationSpecific:r.GetDerivationSpecific},{publicDeriver:n.publicDeriver},a),i=await async function(e,t,r,a,n){var s;const o=await ae(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,GetDerivationSpecific:r.GetDerivationSpecific},{publicDeriver:n.publicDeriver},a),i=await r.GetTransaction.fromIds(e,t,{ids:o.txIds}),c=await r.ErgoAssociateTxWithIOs.getIOsForTx(e,t,{txs:i,networkId:n.publicDeriver.getParent().getNetworkInfo().NetworkId});return P()(new S.a(_()(s=m()(c).call(c,e=>e.tokens)).call(s,e=>e.TokenList.ListId)))}(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,ErgoAssociateTxWithIOs:r.ErgoAssociateTxWithIOs,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs,GetDerivationSpecific:r.GetDerivationSpecific,GetTransaction:r.GetTransaction},a,n);return await r.DeleteAllTransactions.delete(e,t,{publicDeriverId:n.publicDeriver.getPublicDeriverId(),txIds:o.txIds}),await r.ModifyAddress.remove(e,t,s),await r.FreeBlocks.free(e,t),await r.ModifyTokenList.remove(e,t,i),o}async function le(e){var t,r;const a=e.publicDeriver.getParent().getDerivationTables(),n=f()({GetPathWithSpecific:j.m,GetAddress:j.b,ErgoAssociateTxWithIOs:M.c,AssociateTxWithUtxoIOs:L.a,GetDerivationSpecific:J.a,DeleteAllTransactions:X.b,ModifyAddress:R.d,GetTransaction:j.o,FreeBlocks:R.b,ModifyTokenList:R.j}),s=e.publicDeriver.getDb(),o=m()(t=_()(r=g()(n)).call(r,e=>n[e])).call(t,e=>Object(W.g)(s,e));return await Object(W.m)(s,[...s.getSchema().tables(),...o,...Object(W.k)(s,a)],async t=>de(s,t,n,e.publicDeriver.getParent().getDerivationTables(),{publicDeriver:e.publicDeriver}))}async function ue(e,t,r,a,s,o){const i=Object(H.j)(t),d=null==i?new D.a:i.getParent().getDerivationTables();let u=void 0;try{var h,w;const i=f()({GetLastSyncForPublicDeriver:V.d,ModifyLastSyncInfo:X.e,GetKeyForPublicDeriver:V.c,GetAddress:j.b,GetPathWithSpecific:j.m,GetUtxoTxOutputsWithTx:L.c,ModifyAddress:R.d,GetPublicDeriver:V.e,AddDerivationTree:q.b,MarkUtxo:U.a,ModifyDisplayCutoff:$.b,GetDerivationsByPath:j.g,GetEncryptionMeta:j.h,GetTransaction:j.o,GetUtxoInputs:L.b,GetTxAndBlock:j.p,GetDerivationSpecific:J.a,ModifyTransaction:R.k,ModifyErgoTx:B.c,ErgoAssociateTxWithIOs:M.c,AssociateTxWithUtxoIOs:L.a,GetKeyDerivation:j.j,ModifyToken:R.i,GetToken:j.n,AssociateToken:j.a}),b=m()(h=_()(w=g()(i)).call(w,e=>i[e])).call(h,t=>Object(W.g)(e,t));await Object(W.m)(e,[...b,...Object(W.k)(e,d)],async h=>{u=await i.GetLastSyncForPublicDeriver.forId(e,h,t.getPublicDeriverId());const{GetLastSyncForPublicDeriver:f,...w}=i;await async function(e,t,r,a,s,o,i,d,u,h){const f=a.getParent().getNetworkInfo(),w=await u({network:f});if(0!==s.Height){const e=s.Height,t=w.height;if(e-t>Z.f)return}if(null!=w.hash){var b,y,I;const s=w.hash,l=Object(H.l)(a);null!=l&&await l.rawScanAddresses(t,{GetKeyForPublicDeriver:r.GetKeyForPublicDeriver,GetAddress:r.GetAddress,GetPathWithSpecific:r.GetPathWithSpecific,GetUtxoTxOutputsWithTx:r.GetUtxoTxOutputsWithTx,ModifyAddress:r.ModifyAddress,GetPublicDeriver:r.GetPublicDeriver,AddDerivationTree:r.AddDerivationTree,ModifyDisplayCutoff:r.ModifyDisplayCutoff,GetDerivationsByPath:r.GetDerivationsByPath,GetDerivationSpecific:r.GetDerivationSpecific,GetKeyDerivation:r.GetKeyDerivation},{checkAddressesInUse:o},h);const{txIds:u,addresses:v}=await ae(e,t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,GetDerivationSpecific:r.GetDerivationSpecific,AssociateTxWithUtxoIOs:r.AssociateTxWithUtxoIOs},{publicDeriver:a},h),T=await r.GetTxAndBlock.firstSuccessTxBefore(e,t,{txIds:u,height:p.a}),x=null==T?void 0:{after:{block:T.Block.Hash,tx:T.Transaction.Hash}},k=await i({...x,network:f,addresses:[..._()(b=v.utxoAddresses).call(b,e=>e.Hash)],untilBlock:s}),O=new S.a(_()(y=m()(I=g()(v)).call(I,e=>v[e])).call(y,e=>e.AddressId));await async function(e,t,r,a){const{TransactionSeed:s,BlockSeed:o}=await r.GetEncryptionMeta.get(e,t),i=new D.a;{var d;const n=_()(d=a.txsFromNetwork).call(d,e=>Object(K.a)(e.hash,s)),o=await r.GetTransaction.byDigest(e,t,{digests:n,txIds:a.txIds}),l=P()(c()(o).call(o)),u=await r.ErgoAssociateTxWithIOs.getIOsForTx(e,t,{txs:A()(l).call(l,e=>e.Type===N.n.Ergo),networkId:a.network.NetworkId});for(const e of u)i.set(e.transaction.Hash,e)}const l=[],u=[],p=new S.a;for(const n of a.txsFromNetwork){const a=i.get(n.hash);if(null==a){l.push(n);continue}const c=we(n,s,o);p.add(a.transaction.TransactionId);const d=await r.ModifyTransaction.updateExisting(e,t,{block:c.block,transaction:e=>({...c.transaction(e),TransactionId:a.transaction.TransactionId})});null===a.transaction.BlockId&&(null!==d.block&&u.push({...a,block:d.block,transaction:d.transaction}))}const h=await async function(e,t,r,a,s,o,i){var c,d;const l=P()(new S.a(m()(a).call(a,e=>{var t,r,a,n;return[..._()(t=m()(r=e.inputs).call(r,e=>e.assets)).call(t,e=>e.tokenId),..._()(a=m()(n=e.outputs).call(n,e=>e.assets)).call(a,e=>e.tokenId),i.defaultIdentifier]}))),u=A()(c=await r.GetToken.fromIdentifier(e,t,l)).call(c,e=>e.NetworkId===o.NetworkId),p=new S.a(_()(u).call(u,e=>e.Identifier)),h=await s({network:o,assetIds:A()(l).call(l,e=>!p.has(e))}),f=_()(d=g()(h)).call(d,e=>({NetworkId:o.NetworkId,Identifier:e,IsDefault:!1,Metadata:{type:"Ergo",height:h[e].height,boxId:h[e].boxId,ticker:null,longName:h[e].name,numberOfDecimals:h[e].numDecimals||0,description:h[e].desc}})),w=await r.ModifyToken.upsert(e,t,f),b=new D.a;return n()(u).call(u,e=>b.set(e.Identifier,e)),n()(w).call(w,e=>b.set(e.Identifier,e)),b}(e,t,{ModifyToken:r.ModifyToken,GetToken:r.GetToken},l,a.getAssetInfo,a.network,a.defaultToken),f=await Object(L.d)(e,t,{AssociateToken:r.AssociateToken}),{ergoTxs:w}=await async function(e,t,r,a,n,s,o,i,d,l){const u=P()(new S.a(m()(n).call(n,e=>{var t,r;return[..._()(t=e.inputs).call(t,e=>e.address),..._()(r=e.outputs).call(r,e=>e.address)]}))),p=await s({db:e,tx:t,lockedTables:P()(c()(r).call(r)),hashes:u}),h=e=>{const t=p.get(e);if(void 0===t)throw new Error("networkTxToDbTx should never happen id === undefined");return t},f=e=>{const t=d.get(e);if(void 0===t)throw new Error("networkTxToDbTx should never happen -- asset missing");return t},w=[];for(const e of n){const{block:t,transaction:r}=we(e,o,i);w.push({networkId:a,block:t,transaction:r,ioGen:pe(e,a,h,f,l)})}return{ergoTxs:w}}(e,t,a.derivationTables,a.network.NetworkId,l,a.hashToIds,s,o,h,f),b=new S.a;for(const a of w){const n=await r.ModifyErgoTx.addTxWithIOs(e,t,a);b.add(n.transaction.TransactionId),null!==n.block&&u.push({txType:n.txType,block:n.block,transaction:n.transaction,utxoInputs:n.utxoInputs,utxoOutputs:n.utxoOutputs,tokens:n.tokens})}const y=_()(u).call(u,e=>e.transaction.TransactionId);await he(e,t,{MarkUtxo:r.MarkUtxo,GetUtxoInputs:r.GetUtxoInputs,GetTransaction:r.GetTransaction},{inputTxIds:y,allTxIds:[...a.txIds,...y],isUnspent:!1,TransactionSeed:s,networkId:a.network.NetworkId});const I=await r.GetTransaction.withStatus(e,t,{txIds:a.txIds,status:[F.d.PENDING]});for(const a of I)p.has(a.TransactionId)||b.has(a.TransactionId)||await r.ModifyTransaction.updateStatus(e,t,{transaction:a,status:F.d.NOT_IN_REMOTE});return u}(e,t,{MarkUtxo:r.MarkUtxo,ErgoAssociateTxWithIOs:r.ErgoAssociateTxWithIOs,GetEncryptionMeta:r.GetEncryptionMeta,GetTransaction:r.GetTransaction,GetUtxoInputs:r.GetUtxoInputs,ModifyTransaction:r.ModifyTransaction,ModifyErgoTx:r.ModifyErgoTx,ModifyToken:r.ModifyToken,GetToken:r.GetToken,AssociateToken:r.AssociateToken},{network:a.getParent().getNetworkInfo(),txIds:u,txsFromNetwork:k,hashToIds:Object(z.c)(O,a.getParent().getNetworkInfo()),defaultToken:a.getParent().getDefaultToken(),findOwnAddress:Object(z.b)(O),derivationTables:h,getAssetInfo:d})}await r.ModifyLastSyncInfo.overrideLastSyncInfo(e,t,{LastSyncInfoId:s.LastSyncInfoId,Time:new Date(l()()),SlotNum:w.slot,BlockHash:w.hash,Height:w.height})}(e,h,w,t,u,r,a,s,o,d)})}catch(r){var b,y;if(!(r instanceof Q.A))throw r;if(void 0===u)throw r;const a=f()({GetPathWithSpecific:j.m,GetAddress:j.b,GetTxAndBlock:j.p,GetLastSyncForPublicDeriver:V.d,ModifyLastSyncInfo:X.e,GetBlock:j.c,ModifyTransaction:R.k,MarkUtxo:U.a,GetTransaction:j.o,GetUtxoInputs:L.b,GetEncryptionMeta:j.h,GetDerivationSpecific:J.a,ErgoAssociateTxWithIOs:M.c,AssociateTxWithUtxoIOs:L.a}),n=m()(b=_()(y=g()(a)).call(y,e=>a[e])).call(b,t=>Object(W.g)(e,t));await Object(W.m)(e,[...n,...Object(W.k)(e,d)],async r=>{const n=await a.GetLastSyncForPublicDeriver.forId(e,r,t.getPublicDeriverId());Object(G.isEqual)(n,u)&&await async function(e,t,r,a,n){const{TransactionSeed:s}=await r.GetEncryptionMeta.get(e,t);if(0===a.lastSyncInfo.Height)return;const{utxoAddresses:o}=await Object(Y.b)(t,{GetPathWithSpecific:r.GetPathWithSpecific,GetAddress:r.GetAddress,GetDerivationSpecific:r.GetDerivationSpecific},{publicDeriver:a.publicDeriver},n),i=_()(o).call(o,e=>e.AddressId),c=P()(new S.a([...await r.AssociateTxWithUtxoIOs.getTxIdsForAddresses(e,t,{addressIds:i})])),d=await r.GetTxAndBlock.firstSuccessTxBefore(e,t,{txIds:c,height:p.a});if(null==d)return;const u=await r.GetTxAndBlock.gteHeight(e,t,{txIds:c,height:d.Block.Height-Z.f});for(const a of u)await r.ModifyTransaction.updateStatus(e,t,{status:F.d.ROLLBACK_FAIL,transaction:a.Transaction});await he(e,t,{MarkUtxo:r.MarkUtxo,GetUtxoInputs:r.GetUtxoInputs,GetTransaction:r.GetTransaction},{inputTxIds:_()(u).call(u,e=>e.Transaction.TransactionId),allTxIds:c,isUnspent:!0,TransactionSeed:s,networkId:a.publicDeriver.getParent().getNetworkInfo().NetworkId});const h=await r.GetTransaction.withStatus(e,t,{txIds:c,status:[F.d.PENDING]});for(const a of h)await r.ModifyTransaction.updateStatus(e,t,{transaction:a,status:F.d.ROLLBACK_FAIL});const f=await r.GetTxAndBlock.firstSuccessTxBefore(e,t,{txIds:c,height:d.Block.Height-Z.f});await r.ModifyLastSyncInfo.overrideLastSyncInfo(e,t,{LastSyncInfoId:a.lastSyncInfo.LastSyncInfoId,Time:new Date(l()()),SlotNum:void 0===f?null:f.Block.SlotNum,Height:void 0===f?0:f.Block.Height,BlockHash:void 0===f?null:f.Block.Hash})}(e,r,a,{publicDeriver:t,lastSyncInfo:n},d)})}}function pe(e,t,r,a,n){return s=>{const i=[],c=[],d=[];for(let o=0;o<e.inputs.length;o++){const c=e.inputs[o],l=n();d.push({TokenList:{Amount:c.value.toString(),ListId:l,TokenId:a(F.c.Ergo).TokenId},identifier:F.c.Ergo,networkId:t});for(let e=0;e<c.assets.length;e++){const r=a(c.assets[e].tokenId);d.push({TokenList:{Amount:c.assets[e].amount.toString(),ListId:l,TokenId:r.TokenId},identifier:c.assets[e].tokenId,networkId:t})}const u={TransactionId:s,AddressId:r(c.address),ParentTxHash:c.outputTransactionId,IndexInParentTx:c.outputIndex,IndexInOwnTx:o,TokenListId:l};i.push(u)}for(let i=0;i<e.outputs.length;i++){const l=e.outputs[i],u=n();d.push({TokenList:{Amount:l.value.toString(),ListId:u,TokenId:a(F.c.Ergo).TokenId},identifier:F.c.Ergo,networkId:t});for(let e=0;e<l.assets.length;e++){const r=a(l.assets[e].tokenId);d.push({TokenList:{Amount:l.assets[e].amount.toString(),ListId:u,TokenId:r.TokenId},identifier:l.assets[e].tokenId,networkId:t})}const p={TransactionId:s,AddressId:r(l.address),OutputIndex:i,TokenListId:u,IsUnspent:!0,ErgoBoxId:l.id,ErgoCreationHeight:l.creationHeight,ErgoTree:l.ergoTree,ErgoRegisters:o()(l.additionalRegisters)};c.push(p)}return{utxoInputs:i,utxoOutputs:c,tokenList:d}}}async function he(e,t,r,a){const n=await r.GetUtxoInputs.fromTxIds(e,t,{ids:a.inputTxIds}),s=_()(n).call(n,e=>Object(K.a)(e.ParentTxHash,a.TransactionSeed)),o=await r.GetTransaction.byDigest(e,t,{digests:s,txIds:a.allTxIds});for(const s of n){const n=o.get(s.ParentTxHash);void 0!==n&&await r.MarkUtxo.markAs(e,t,{txId:n.TransactionId,outputIndex:s.IndexInParentTx,isUnspent:a.isUnspent,networkId:a.networkId})}}function fe(e){if("Successful"===e)return F.d.IN_BLOCK;if("Pending"===e)return F.d.PENDING;if("Failed"===e)return F.d.FAIL_RESPONSE;throw new Error("statusStringToCode unexpected status "+e)}function we(e,t,r){const a=null!=e.block_hash&&null!=e.time&&null!=e.block_num?{Hash:e.block_hash,BlockTime:new Date(e.time),Height:e.block_num,SlotNum:0,Digest:Object(K.a)(e.hash,r)}:null,n=Object(K.a)(e.hash,t),s={Hash:e.hash,Digest:n,Ordinal:e.tx_ordinal,LastUpdateTime:null==a?(new Date).getTime():new Date(e.time).getTime(),Status:fe(e.tx_state),ErrorMessage:null};return{block:a,transaction:e=>({Type:N.n.Ergo,Extra:null,BlockId:e,...s})}}}).call(this,r(48).Buffer)},314:function(e,t,r){"use strict";r.d(t,"c",(function(){return T})),r.d(t,"b",(function(){return m})),r.d(t,"d",(function(){return x})),r.d(t,"a",(function(){return A}));var a=r(30),n=r.n(a),s=r(8),o=r.n(s),i=r(37),c=r.n(i),d=r(11),l=r.n(d),u=r(68),p=r.n(u),h=r(66),f=r.n(h),w=r(15),g=r(1),b=r.n(g),y=r(281);class I{static async getAllPrices(e,t){return await Object(w.f)(e,t,I.ownTables[y.a.name].name)}}b()(I,"ownTables",l()({[y.a.name]:y.a})),b()(I,"depTables",l()({}));class v{static async upsertPrices(e,t,r){return await Object(w.e)(e,t,r,v.ownTables[y.a.name].name)}}function T(e,t,r){return f()({From:e,To:t,Time:r})}function m(e,t,r){if(!r)return null;const a=p()(r).call(r,r=>r.From===e&&r.To===t);return a?a.Price:null}async function x(e){var t,r;const a=l()({ModifyPriceData:v}),s=c()(t=o()(r=n()(a)).call(r,e=>a[e])).call(t,t=>Object(w.g)(e.db,t));return await Object(w.m)(e.db,s,async t=>a.ModifyPriceData.upsertPrices(e.db,t,e.prices))}async function A(e){var t,r;const a=l()({GetPriceData:I}),s=c()(t=o()(r=n()(a)).call(r,e=>a[e])).call(t,t=>Object(w.g)(e.db,t));return await Object(w.m)(e.db,s,async t=>a.GetPriceData.getAllPrices(e.db,t))}b()(v,"ownTables",l()({[y.a.name]:y.a})),b()(v,"depTables",l()({}))},33:function(e,t,r){"use strict";(function(e){r.d(t,"j",(function(){return oe})),r.d(t,"e",(function(){return le})),r.d(t,"d",(function(){return he})),r.d(t,"i",(function(){return ge})),r.d(t,"c",(function(){return ve})),r.d(t,"k",(function(){return De})),r.d(t,"g",(function(){return Ee})),r.d(t,"h",(function(){return _e})),r.d(t,"l",(function(){return Fe})),r.d(t,"f",(function(){return $e})),r.d(t,"a",(function(){return Je})),r.d(t,"b",(function(){return Xe}));var a=r(90),n=r.n(a),s=r(35),o=r.n(s),i=r(92),c=r.n(i),d=r(123),l=r.n(d),u=r(34),p=r.n(u),h=r(68),f=r.n(h),w=r(84),g=r.n(w),b=r(708),y=r.n(b),I=r(30),v=r.n(I),T=r(11),m=r.n(T),x=r(56),A=r.n(x),k=r(8),D=r.n(k),O=r(37),S=r.n(O),E=r(1),P=r.n(E),C=r(103),_=r(131),G=r(60),W=r(159),N=r(309),j=r(130),R=r(15),B=r(86),K=r(157),U=r(141),L=r(88),M=r(53),F=r(76),H=r(25),V=r(21),$=r(62),q=r(195),J=r(357),X=r(358),Y=r(359),z=r(360),Z=r(23),Q=r(19),ee=(r(77),r(6)),te=r(261),re=r(20),ae=r(134);const ne=Object(C.Mixin)(e=>class extends e{});const se=Object(C.Mixin)(e=>class extends e{});function oe(e){if(e instanceof se)return e}const ie=Object(C.Mixin)(e=>class extends e{});const ce=Object(C.Mixin)(e=>class extends e{constructor(...e){super(...e),P()(this,"rawGetAllUtxos",async(e,t,r,a)=>{const n=await this.rawGetAllUtxoAddresses(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},void 0,a),s=S()(n).call(n,e=>{var t;return D()(t=e.addrs).call(t,e=>e.AddressId)}),o=await t.GetUtxoTxOutputsWithTx.getUtxo(super.getDb(),e,s,this.getParent().getNetworkInfo().NetworkId),i=new A.a(S()(n).call(n,e=>{var t;return D()(t=e.addrs).call(t,t=>[t.AddressId,{addressing:e.addressing,address:t.Hash}])})),c=[];for(const e of o){const t=i.get(e.UtxoTransactionOutput.AddressId);if(null==t)throw new Error("GetAllUtxos::rawGetAllUtxos should never happen");c.push({output:e,addressing:t.addressing,address:t.address})}return c}),P()(this,"getAllUtxos",async e=>{var t,r;const a=this.getParent().getDerivationTables(),n=m()({GetPathWithSpecific:H.m,GetAddress:H.b,GetUtxoTxOutputsWithTx:F.c,GetDerivationSpecific:L.a}),s=S()(t=D()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),[...s,...Object(R.k)(super.getDb(),a)],async e=>this.rawGetAllUtxos(e,n,void 0,a))}),P()(this,"rawGetAllUtxoAddresses",async(e,t,r,a)=>{var n,s,o,i,c;if(this.getParent().getPublicDeriverLevel()>=M.a.CHAIN.level)return Object(_.e)(super.getDb(),e,t,{startingDerivation:super.getDerivationId(),derivationLevel:this.getParent().getPublicDeriverLevel(),commonPrefix:super.getPathToPublic(),queryPath:y()(c=Array(M.a.ADDRESS.level-this.getParent().getPublicDeriverLevel())).call(c,null)},a);return[...await Object(_.e)(super.getDb(),e,t,{startingDerivation:super.getDerivationId(),derivationLevel:this.getParent().getPublicDeriverLevel(),commonPrefix:super.getPathToPublic(),queryPath:g()(n=y()(s=Array(M.a.ACCOUNT.level-this.getParent().getPublicDeriverLevel())).call(s,null)).call(n,[0,null])},a),...await Object(_.e)(super.getDb(),e,t,{startingDerivation:super.getDerivationId(),derivationLevel:this.getParent().getPublicDeriverLevel(),commonPrefix:super.getPathToPublic(),queryPath:g()(o=y()(i=Array(M.a.ACCOUNT.level-this.getParent().getPublicDeriverLevel())).call(i,null)).call(o,[1,null])},a)]}),P()(this,"getAllUtxoAddresses",async e=>{var t,r;const a=this.getParent().getDerivationTables(),n=m()({GetPathWithSpecific:H.m,GetAddress:H.b,GetDerivationSpecific:L.a}),s=S()(t=D()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),[...s,...Object(R.k)(super.getDb(),a)],async t=>this.rawGetAllUtxoAddresses(t,n,e,a))})}}),de=ce;function le(e){if(e instanceof de)return e}const ue=Object(C.Mixin)(e=>class extends e{constructor(...e){super(...e),P()(this,"rawGetAllAccountingAddresses",async(e,t,r,a)=>{if(this.getParent().getPublicDeriverLevel()!==M.a.ACCOUNT.level)throw new Error("GetAllAccounting::rawGetAllAccountingAddresses incorrect pubderiver level");return Object(_.e)(super.getDb(),e,t,{startingDerivation:super.getDerivationId(),derivationLevel:this.getParent().getPublicDeriverLevel(),commonPrefix:super.getPathToPublic(),queryPath:[Q.c.CHIMERIC_ACCOUNT,null]},a)}),P()(this,"getAllAccountingAddresses",async e=>{var t,r;const a=this.getParent().getDerivationTables(),n=m()({GetPathWithSpecific:H.m,GetAddress:H.b,GetDerivationSpecific:L.a}),s=S()(t=D()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),[...s,...Object(R.k)(super.getDb(),a)],async t=>this.rawGetAllAccountingAddresses(t,n,e,a))}),P()(this,"rawGetStakingKey",async(e,t,r,a)=>{var n;const s=(await this.rawGetAllAccountingAddresses(e,t,r,a))[0],o=f()(n=s.addrs).call(n,e=>e.Type===V.b.JORMUNGANDR_ACCOUNT||e.Type===V.b.CARDANO_REWARD);if(null==o)throw new R.a("GetAllAccounting::rawGetStakingKey no account found at account derivation");return{row:s.row,addressing:s.addressing,addr:o}}),P()(this,"getStakingKey",async e=>{var t,r;const a=this.getParent().getDerivationTables(),n=m()({GetPathWithSpecific:H.m,GetAddress:H.b,GetDerivationSpecific:L.a}),s=S()(t=D()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),[...s,...Object(R.k)(super.getDb(),a)],async t=>this.rawGetStakingKey(t,n,e,a))})}}),pe=ue;function he(e){if(e instanceof pe)return e}const fe=Object(C.Mixin)(e=>class extends e{}),we=fe;function ge(e){if(e instanceof we)return e}const be=Object(C.Mixin)(e=>class extends e{constructor(...e){super(...e),P()(this,"rawAddBip44FromPublic",async(e,t,r,a)=>{const n=await t.GetPublicDeriver.get(super.getDb(),e,super.getPublicDeriverId());if(void 0===n)throw new Error("AddBip44FromPublic::rawAddBip44FromPublic pubDeriver");await t.AddDerivationTree.excludingParent(super.getDb(),e,{derivationId:n.KeyDerivationId,children:r.tree},a,this.getParent().getPublicDeriverLevel());const s=ve(this);null!=s&&await Object(_.g)(e,{GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific,GetDerivationsByPath:t.GetDerivationsByPath,ModifyDisplayCutoff:t.ModifyDisplayCutoff,GetKeyDerivation:t.GetKeyDerivation},{publicDeriverLevel:this.getParent().getPublicDeriverLevel(),displayCutoffInstance:s,tree:r.tree},a)}),P()(this,"addBip44FromPublic",async e=>{var t,r;const a=this.getParent().getDerivationTables(),n=m()({GetPublicDeriver:B.e,AddDerivationTree:U.b,ModifyDisplayCutoff:K.b,GetDerivationsByPath:H.g,GetPathWithSpecific:H.m,GetDerivationSpecific:L.a,GetKeyDerivation:H.j}),s=S()(t=D()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),[...s,...Object(R.k)(super.getDb(),a)],async t=>this.rawAddBip44FromPublic(t,n,e,a))})}});const ye=Object(C.Mixin)(e=>class extends e{constructor(...e){super(...e),P()(this,"rawPopAddress",async(e,t,r,a)=>{const n=await t.ModifyDisplayCutoff.pop(super.getDb(),e,{pubDeriverKeyDerivationId:super.getDerivationId(),derivationLevel:this.getParent().getPublicDeriverLevel(),pathToLevel:[0]},a);if(void 0===n)throw new Z.D;const s=(await t.GetAddress.fromCanonical(super.getDb(),e,[n.row.KeyDerivationId],void 0)).get(n.row.KeyDerivationId);if(null==s)throw new Error("DisplayCutoffMixin::popAddress should never happen");return{...n,addrs:s}}),P()(this,"popAddress",async e=>{var t,r;const a=this.getParent().getDerivationTables(),n=m()({ModifyDisplayCutoff:K.b,GetAddress:H.b}),s=S()(t=D()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),[...s,...Object(R.k)(super.getDb(),a)],async t=>this.rawPopAddress(t,n,e,a))}),P()(this,"rawGetCutoff",async(e,t,r,a)=>{const n=this.getParent().getPublicDeriverLevel(),s=(await(async()=>{if(n===M.a.CHAIN.level){const r=(await t.GetDerivationSpecific.get(super.getDb(),e,[super.getDerivationId()],M.a.CHAIN.level,a))[0];if(void 0===r)throw new Error("DisplayCutoffMixin::rawGetCutoff missing chain. Should never happen");return r}if(n===M.a.ACCOUNT.level)return(await t.GetPathWithSpecific.getPath(super.getDb(),e,{pubDeriverKeyDerivationId:super.getDerivationId(),pathToLevel:[0],level:M.a.CHAIN.level},async r=>{const n=(await t.GetDerivationSpecific.get(super.getDb(),e,[r],M.a.CHAIN.level,a))[0];if(void 0===n)throw new Error("DisplayCutoffMixin::rawGetCutoff missing chain. Should never happen");return n})).levelSpecific;throw new Error("DisplayCutoffMixin::rawGetCutoff incorrect pubderiver level")})()).DisplayCutoff;if(null==s)throw new Error("DisplayCutoffMixin::rawGetCutoff null cutoff");return s}),P()(this,"getCutoff",async e=>{var t,r;const a=this.getParent().getDerivationTables(),n=m()({GetPathWithSpecific:H.m,GetDerivationSpecific:L.a}),s=S()(t=D()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),[...s,...Object(R.k)(super.getDb(),a)],async t=>this.rawGetCutoff(t,n,e,a))}),P()(this,"rawSetCutoff",async(e,t,r)=>{const a=this.getParent().getPublicDeriverLevel(),n=await(async()=>{if(a===M.a.CHAIN.level){const r=await t.GetKeyDerivation.get(super.getDb(),e,super.getDerivationId());if(null==r)throw new Error("ModifyDisplayCutoff::pop no derivation row found for chain");return r}if(a===M.a.ACCOUNT.level){const r=await t.GetDerivationsByPath.getSinglePath(super.getDb(),e,super.getDerivationId(),[0]);return r[r.length-1]}throw new Error("ModifyDisplayCutoff::pop incorrect pubderiver level")})();await t.ModifyDisplayCutoff.set(super.getDb(),e,{derivationId:n.KeyDerivationId,newIndex:r.newIndex})}),P()(this,"setCutoff",async e=>{var t,r;const a=m()({ModifyDisplayCutoff:K.b,GetDerivationsByPath:H.g,GetKeyDerivation:H.j}),n=S()(t=D()(r=v()(a)).call(r,e=>a[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),n,async t=>this.rawSetCutoff(t,a,e))})}}),Ie=ye;function ve(e){if(e instanceof Ie)return e}const Te=Object(C.Mixin)(e=>class extends e{constructor(...e){super(...e),P()(this,"rawPickInternal",async(e,t,r,a)=>{var n;const s=p()(n=r.addrs).call(n,e=>e.Type===V.b.CARDANO_LEGACY);if(1!==s.length)throw new Error("Bip44PickInternal::rawPickInternal no legacy address found");return{addr:s[0],row:r.row,addressing:r.addressing}})}}),me=Object(C.Mixin)(t=>class extends t{constructor(...t){super(...t),P()(this,"rawPickInternal",async(t,r,a,n)=>{var s,o;const i=await this.rawGetStakingKey(t,r,void 0,n),c=e.from(Object(W.d)(i.addr.Hash).as_bytes()).toString("hex"),d=p()(s=p()(o=a.addrs).call(o,e=>e.Type===V.b.JORMUNGANDR_GROUP)).call(s,e=>{var t;return l()(t=e.Hash).call(t,c)});if(1!==d.length)throw new Error("Cip1852JormungandrPickInternal::rawPickInternal no group address found");return{addr:d[0],row:a.row,addressing:a.addressing}})}}),xe=Object(C.Mixin)(t=>class extends t{constructor(...t){super(...t),P()(this,"rawPickInternal",async(t,r,a,n)=>{var s,o;const i=await this.rawGetStakingKey(t,r,void 0,n),c=Object(G.l)(i.addr.Hash).to_keyhash();if(null==c)throw new Error("Cip1852PickInternal::rawPickInternal internal address is a script");const d=e.from(c.to_bytes()).toString("hex"),u=p()(s=p()(o=a.addrs).call(o,e=>e.Type===V.b.CARDANO_BASE)).call(s,e=>{var t;return l()(t=e.Hash).call(t,d)});if(1!==u.length)throw new Error("Cip1852PickInternal::rawPickInternal no base address found");return{addr:u[0],row:a.row,addressing:a.addressing}})}}),Ae=Object(C.Mixin)(e=>class extends e{constructor(...e){super(...e),P()(this,"rawGetAddressesForChain",async(e,t,r,a)=>{if(this.getParent().getPublicDeriverLevel()!==M.a.ACCOUNT.level)throw new Error("HasUtxoChains::rawGetAddressesForChain incorrect pubderiver level");return Object(_.e)(super.getDb(),e,t,{startingDerivation:super.getDerivationId(),derivationLevel:this.getParent().getPublicDeriverLevel(),commonPrefix:super.getPathToPublic(),queryPath:[r.chainId,null]},a)}),P()(this,"getAddressesForChain",async e=>{var t,r;const a=this.getParent().getDerivationTables(),n=m()({GetAddress:H.b,GetPathWithSpecific:H.m,GetDerivationSpecific:L.a}),s=S()(t=D()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),[...s,...Object(R.k)(super.getDb(),a)],async t=>this.rawGetAddressesForChain(t,n,e,a))}),P()(this,"rawNextInternal",async(e,t,r,a)=>{const n={GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},s=await this.rawGetAddressesForChain(e,n,{chainId:Q.c.INTERNAL},a),o=await Object(_.f)(super.getDb(),e,{GetUtxoTxOutputsWithTx:t.GetUtxoTxOutputsWithTx},{addressesForChain:s,networkId:this.getParent().getNetworkInfo().NetworkId});return null==o.addressInfo?{addressInfo:void 0,index:o.index}:{addressInfo:await this.rawPickInternal(e,n,o.addressInfo,a),index:o.index}}),P()(this,"nextInternal",async e=>{var t,r;const a=this.getParent().getDerivationTables(),n=m()({GetUtxoTxOutputsWithTx:F.c,GetAddress:H.b,GetPathWithSpecific:H.m,GetDerivationSpecific:L.a}),s=S()(t=D()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),s,async t=>this.rawNextInternal(t,n,e,a))})}}),ke=Ae;function De(e){if(e instanceof ke)return e}const Oe=Object(C.Mixin)(e=>class extends e{constructor(...e){super(...e),P()(this,"rawGetPublicKey",async(e,t,r)=>{const a=await t.GetKeyForPublicDeriver.get(super.getDb(),e,super.getPublicDeriverId(),!0,!1);if(null==a.publicKey)throw new R.a("GetPublicKey::rawGetPublicKey publicKey");return a.publicKey}),P()(this,"getPublicKey",async e=>{var t,r;const a=m()({GetKeyForPublicDeriver:B.c}),n=S()(t=D()(r=v()(a)).call(r,e=>a[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),n,async t=>this.rawGetPublicKey(t,a,e))}),P()(this,"rawChangePubDeriverPassword",async(e,t,r)=>{const a=await this.rawGetPublicKey(e,{GetKeyForPublicDeriver:t.GetKeyForPublicDeriver},void 0);return Object(N.c)(super.getDb(),e,{ModifyKey:t.ModifyKey},{...r,oldKeyRow:a})}),P()(this,"changePubDeriverPassword",async e=>{var t,r;const a=m()({ModifyKey:$.g,GetKeyForPublicDeriver:B.c}),n=S()(t=D()(r=v()(a)).call(r,e=>a[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),n,async t=>this.rawChangePubDeriverPassword(t,a,e))})}}),Se=Oe;function Ee(e){if(e instanceof Se)return e}const Pe=Object(C.Mixin)(e=>class extends e{constructor(...e){super(...e),P()(this,"rawGetSigningKey",async(e,t,r)=>{const a=this.getParent().getSigningLevel();if(null===a)throw new R.a("GetSigningKey::getSigningKey signingLevel=null");const n=this.getParent().getPublicDeriverLevel()-a;if(n<0)throw new R.a("GetSigningKey::getSigningKey levelDifference<0");const s=await t.GetPublicDeriver.get(super.getDb(),e,super.getPublicDeriverId());if(void 0===s)throw new Error("GetSigningKey::getSigningKey pubDeriver");const o=await t.GetKeyDerivation.get(super.getDb(),e,s.KeyDerivationId);if(void 0===o)throw new Error("GetSigningKey::getSigningKey keyDerivation");const i=await t.GetDerivationsByPath.getParentPath(super.getDb(),e,{startingKey:o,numLevels:n}),c=i[0].PrivateKeyId;if(null===c)throw new Error("GetSigningKey::getSigningKey privateKeyId");const d=await t.GetKey.get(super.getDb(),e,c);if(void 0===d)throw new Error("GetSigningKey::getSigningKey privateKeyRow");return{level:a,path:i,row:d}}),P()(this,"getSigningKey",async e=>{var t,r;const a=m()({GetDerivationsByPath:H.g,GetPublicDeriver:B.e,GetKeyDerivation:H.j,GetKey:H.i}),n=S()(t=D()(r=v()(a)).call(r,e=>a[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),n,async t=>this.rawGetSigningKey(t,a,e))}),P()(this,"rawChangeSigningKeyPassword",async(e,t,r)=>{const a=await this.rawGetSigningKey(e,{GetDerivationsByPath:t.GetDerivationsByPath,GetKey:t.GetKey,GetKeyDerivation:t.GetKeyDerivation,GetPublicDeriver:t.GetPublicDeriver},void 0);return Object(N.c)(super.getDb(),e,{ModifyKey:t.ModifyKey},{...r,oldKeyRow:a.row})}),P()(this,"changeSigningKeyPassword",async e=>{var t,r;const a=m()({GetDerivationsByPath:H.g,GetPublicDeriver:B.e,GetKeyDerivation:H.j,GetKey:H.i,ModifyKey:$.g}),n=S()(t=D()(r=v()(a)).call(r,e=>a[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),n,async t=>this.rawChangeSigningKeyPassword(t,a,e))}),P()(this,"normalizeKey",async e=>{var t;const r=c()(t=e.path).call(t,1),a=D()(r).call(r,e=>{if(null===e.Index)throw new Error("GetSigningKey::normalizeKey null index");return e.Index});return Object(N.b)({privateKeyRow:e.row,password:e.password,path:a})})}}),Ce=Pe;function _e(e){if(e instanceof Ce)return e}const Ge=Object(C.Mixin)(e=>class extends e{constructor(...e){super(...e),P()(this,"rawScanAccount",async(e,t,r,a)=>{const n=ee.a.WalletV2.Bip44AccountPublic.new(ee.a.WalletV2.PublicKey.from_hex(r.accountPublicKey),ee.a.WalletV2.DerivationScheme.v2()),s=this.getParent().getNetworkInfo();if(null==s.BaseConfig[0].ByronNetworkId)throw new Error("ScanLegacyCardanoAccountUtxo::rawScanAccount missing Byron network id");const{ByronNetworkId:i}=s.BaseConfig[0];return await Object(X.a)({generateInternalAddresses:Object(q.b)(n.bip44_chain(!1),i),generateExternalAddresses:Object(q.b)(n.bip44_chain(!0),i),network:s,lastUsedInternal:r.lastUsedInternal,lastUsedExternal:r.lastUsedExternal,checkAddressesInUse:r.checkAddressesInUse,addByHash:Object(j.a)(new o.a([...r.internalAddresses,...r.externalAddresses])),type:V.b.CARDANO_LEGACY})})}});const We=Object(C.Mixin)(t=>class extends t{constructor(...t){super(...t),P()(this,"rawScanAccount",async(t,r,a,n)=>{const s=await this.rawGetStakingKey(t,r,void 0,n),i=ee.a.WalletV3.Address.from_bytes(e.from(s.addr.Hash,"hex")).to_account_address();if(null==i)throw new R.a("ScanJormungandrAccountUtxo::rawScanAccount Could non-account hash in staking key derivation");return await Object(Y.c)({accountPublicKey:a.accountPublicKey,lastUsedInternal:a.lastUsedInternal,lastUsedExternal:a.lastUsedExternal,network:this.getParent().getNetworkInfo(),checkAddressesInUse:a.checkAddressesInUse,addByHash:Object(j.a)(new o.a([...a.internalAddresses,...a.externalAddresses])),stakingKey:i.get_account_key()})})}});const Ne=Object(C.Mixin)(t=>class extends t{constructor(...t){super(...t),P()(this,"rawScanAccount",async(t,r,a,n)=>{const s=await this.rawGetStakingKey(t,r,void 0,n),i=ee.a.WalletV4.Bip32PublicKey.from_bytes(e.from(a.accountPublicKey,"hex")),c=Object(te.b)({addressing:s.addressing,startingFrom:{level:this.getParent().getPublicDeriverLevel(),key:i}}),d=this.getParent().getNetworkInfo();return await Object(z.c)({accountPublicKey:a.accountPublicKey,lastUsedInternal:a.lastUsedInternal,lastUsedExternal:a.lastUsedExternal,checkAddressesInUse:a.checkAddressesInUse,network:d,addByHash:Object(j.a)(new o.a([...a.internalAddresses,...a.externalAddresses])),stakingKey:c.to_raw_key()})})}});const je=Object(C.Mixin)(t=>class extends t{constructor(...t){super(...t),P()(this,"rawScanAccount",async(t,r,a,s)=>{const i=ae.d.fromBuffer(e.from(a.accountPublicKey,"hex")),c=this.getParent().getNetworkInfo(),d=n()(c.BaseConfig[0].ChainNetworkId,10);return await Object(X.a)({generateInternalAddresses:Object(J.b)(Object(ae.f)(i,Q.c.INTERNAL).key,d),generateExternalAddresses:Object(J.b)(Object(ae.f)(i,Q.c.EXTERNAL).key,d),lastUsedInternal:a.lastUsedInternal,lastUsedExternal:a.lastUsedExternal,network:this.getParent().getNetworkInfo(),checkAddressesInUse:a.checkAddressesInUse,addByHash:Object(j.a)(new o.a([...a.internalAddresses,...a.externalAddresses])),type:V.b.ERGO_P2PK})})}});const Re=Object(C.Mixin)(t=>class extends t{constructor(...t){super(...t),P()(this,"rawScanChain",async(t,r,a,s)=>{const i=ae.d.fromBuffer(e.from(a.chainPublicKey,"hex")),c=this.getParent().getNetworkInfo(),d=n()(c.BaseConfig[0].ChainNetworkId,10);return await Object(X.b)({generateAddressFunc:Object(J.b)(i.key,d),lastUsedIndex:a.lastUsedIndex,network:this.getParent().getNetworkInfo(),checkAddressesInUse:a.checkAddressesInUse,addByHash:Object(j.a)(new o.a([...a.addresses])),type:V.b.ERGO_P2PK})})}});const Be=Object(C.Mixin)(e=>class extends e{constructor(...e){super(...e),P()(this,"rawScanAddresses",async(e,t,r,a)=>{const n=await this.rawGetPublicKey(e,{GetKeyForPublicDeriver:t.GetKeyForPublicDeriver},void 0),s=Object(N.a)(n,null),o=await this.rawGetAddressesForChain(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},{chainId:Q.c.INTERNAL},a),i=await Object(_.f)(super.getDb(),e,{GetUtxoTxOutputsWithTx:t.GetUtxoTxOutputsWithTx},{addressesForChain:o,networkId:this.getParent().getNetworkInfo().NetworkId}),c=await this.rawGetAddressesForChain(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},{chainId:Q.c.EXTERNAL},a),d=await Object(_.f)(super.getDb(),e,{GetUtxoTxOutputsWithTx:t.GetUtxoTxOutputsWithTx},{addressesForChain:c,networkId:this.getParent().getNetworkInfo().NetworkId}),l=await this.rawScanAccount(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},{accountPublicKey:s,lastUsedInternal:i.index-1,lastUsedExternal:d.index-1,checkAddressesInUse:r.checkAddressesInUse,internalAddresses:S()(o).call(o,e=>{var t;return D()(t=e.addrs).call(t,e=>e.AddressId)}),externalAddresses:S()(c).call(c,e=>{var t;return D()(t=e.addrs).call(t,e=>e.AddressId)})},a);await this.rawAddBip44FromPublic(e,{GetPublicDeriver:t.GetPublicDeriver,AddDerivationTree:t.AddDerivationTree,ModifyDisplayCutoff:t.ModifyDisplayCutoff,GetDerivationsByPath:t.GetDerivationsByPath,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific,GetKeyDerivation:t.GetKeyDerivation},{tree:l},a)}),P()(this,"scanAddresses",async e=>{var t,r;const a=this.getParent().getDerivationTables(),n=m()({GetKeyForPublicDeriver:B.c,GetAddress:H.b,GetPathWithSpecific:H.m,GetUtxoTxOutputsWithTx:F.c,ModifyAddress:$.d,GetPublicDeriver:B.e,AddDerivationTree:U.b,GetDerivationsByPath:H.g,ModifyDisplayCutoff:K.b,GetDerivationSpecific:L.a,GetKeyDerivation:H.j}),s=S()(t=D()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),[...s,...Object(R.k)(super.getDb(),a)],async t=>this.rawScanAddresses(t,n,e,a))})}});const Ke=Object(C.Mixin)(e=>class extends e{constructor(...e){super(...e),P()(this,"rawScanAddresses",async(e,t,r,a)=>{const n=await this.rawGetPublicKey(e,{GetKeyForPublicDeriver:t.GetKeyForPublicDeriver},void 0),s=Object(N.a)(n,null),o=await Object(_.e)(super.getDb(),e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},{startingDerivation:super.getDerivationId(),derivationLevel:this.getParent().getPublicDeriverLevel(),commonPrefix:super.getPathToPublic(),queryPath:[null]},a),i=await Object(_.f)(super.getDb(),e,{GetUtxoTxOutputsWithTx:t.GetUtxoTxOutputsWithTx},{addressesForChain:o,networkId:this.getParent().getNetworkInfo().NetworkId}),c=await this.rawScanChain(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific},{chainPublicKey:s,lastUsedIndex:i.index-1,checkAddressesInUse:r.checkAddressesInUse,addresses:S()(o).call(o,e=>{var t;return D()(t=e.addrs).call(t,e=>e.AddressId)})},a);await this.rawAddBip44FromPublic(e,{GetPublicDeriver:t.GetPublicDeriver,AddDerivationTree:t.AddDerivationTree,ModifyDisplayCutoff:t.ModifyDisplayCutoff,GetDerivationsByPath:t.GetDerivationsByPath,GetPathWithSpecific:t.GetPathWithSpecific,GetDerivationSpecific:t.GetDerivationSpecific,GetKeyDerivation:t.GetKeyDerivation},{tree:c},a)}),P()(this,"scanAddresses",async e=>{var t,r;const a=this.getParent().getDerivationTables(),n=m()({GetKeyForPublicDeriver:B.c,GetAddress:H.b,GetPathWithSpecific:H.m,GetUtxoTxOutputsWithTx:F.c,ModifyAddress:$.d,GetPublicDeriver:B.e,AddDerivationTree:U.b,GetDerivationsByPath:H.g,ModifyDisplayCutoff:K.b,GetDerivationSpecific:L.a,GetKeyDerivation:H.j}),s=S()(t=D()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),[...s,...Object(R.k)(super.getDb(),a)],async t=>this.rawScanAddresses(t,n,e,a))})}});const Ue=Object(C.Mixin)(e=>class extends e{constructor(...e){super(...e),P()(this,"rawGetUtxoBalance",async(e,t,r,a)=>{const n=await this.rawGetAllUtxos(e,{GetAddress:t.GetAddress,GetPathWithSpecific:t.GetPathWithSpecific,GetUtxoTxOutputsWithTx:t.GetUtxoTxOutputsWithTx,GetDerivationSpecific:t.GetDerivationSpecific},void 0,a);return Object(_.a)(D()(n).call(n,e=>e.output),this.getParent().getDefaultToken())}),P()(this,"getUtxoBalance",async e=>{var t,r;const a=this.getParent().getDerivationTables(),n=m()({GetPathWithSpecific:H.m,GetAddress:H.b,GetUtxoTxOutputsWithTx:F.c,GetDerivationSpecific:L.a}),s=S()(t=D()(r=v()(n)).call(r,e=>n[e])).call(t,e=>Object(R.g)(super.getDb(),e));return await Object(R.m)(super.getDb(),[...s,...Object(R.k)(super.getDb(),a)],async e=>this.rawGetUtxoBalance(e,n,void 0,a))})}});const Le=Object(C.Mixin)(e=>class extends e{}),Me=Le;function Fe(e){if(e instanceof Me)return e}const He=Object(C.Mixin)(e=>class extends e{constructor(...e){super(...e),P()(this,"getBalance",async e=>await this.getUtxoBalance(e))}}),Ve=He;function $e(e){if(e instanceof Ve)return e}const qe={2147485463:async function(e){let t,r=e.startClass;r=ne(r),r=se(r),r=ie(r),r=ce(r);{var a,n;const r=m()({GetKeyForPublicDeriver:B.c}),s=S()(a=D()(n=v()(r)).call(n,e=>r[e])).call(a,t=>Object(R.g)(e.db,t));t=await Object(R.m)(e.db,s,async t=>{const a=await r.GetKeyForPublicDeriver.get(e.db,t,e.pubDeriver.PublicDeriverId,!0,!1);if(void 0===a.publicKey)throw new R.a("addTraitsForCardanoBip44 publicKey");return a.publicKey})}r=be(r),e.conceptualWallet.getPublicDeriverLevel()===M.a.CHAIN.level&&(r=ye(r));e.conceptualWallet.getPublicDeriverLevel()===M.a.ACCOUNT.level?(r=ye(r),r=Ae(Te(r)),null!==t&&(r=Oe(r),r=Ge(r),r=Be(r),r=Le(r))):null!==t&&(r=Oe(r));null!==e.conceptualWallet.getSigningLevel()&&(r=Pe(r));return r=Ue(r),r=He(r),{finalClass:r}},2147484077:async function(e){let t,r=e.startClass;r=ne(r),r=se(r),r=ie(r),r=ce(r);{var a,n;const r=m()({GetKeyForPublicDeriver:B.c}),s=S()(a=D()(n=v()(r)).call(n,e=>r[e])).call(a,t=>Object(R.g)(e.db,t));t=await Object(R.m)(e.db,s,async t=>{const a=await r.GetKeyForPublicDeriver.get(e.db,t,e.pubDeriver.PublicDeriverId,!0,!1);if(void 0===a.publicKey)throw new R.a("addTraitsForErgoBip44 publicKey");return a.publicKey})}r=be(r),e.conceptualWallet.getPublicDeriverLevel()===M.a.CHAIN.level?(r=ye(r),null!==t&&(r=Oe(r),r=Re(r),r=Ke(r),r=Le(r))):e.conceptualWallet.getPublicDeriverLevel()===M.a.ACCOUNT.level?(r=ye(r),r=Ae(Te(r)),null!==t&&(r=Oe(r),r=je(r),r=Be(r),r=Le(r))):null!==t&&(r=Oe(r));null!==e.conceptualWallet.getSigningLevel()&&(r=Pe(r));return r=Ue(r),r=He(r),{finalClass:r}}};async function Je(e){const t=qe[e.conceptualWallet.getNetworkInfo().CoinType.toString()],{finalClass:r}=await t(e);let a;{var n,s;const t=m()({GetDerivationsByPath:H.g}),r=S()(n=D()(s=v()(t)).call(s,e=>t[e])).call(n,t=>Object(R.g)(e.db,t));a=await Object(R.m)(e.db,r,async r=>{const a=e.conceptualWallet.getPublicDeriverLevel()-M.a.ROOT.level,n=await t.GetDerivationsByPath.getParentPath(e.db,r,{startingKey:e.pubDeriverKeyDerivation,numLevels:a}),s=[];for(const e of c()(n).call(n,1)){if(null==e.Index)throw new Error("addTraitsForBip44Child null index");s.push(e.Index)}return s})}return{finalClass:r,pathToPublic:a}}async function Xe(e,t,r,a,n){let s,o,i=n;i=ne(i),i=se(i),i=ie(i),i=ce(i),i=fe(ue(i));{var d,l;const r=m()({GetKeyForPublicDeriver:B.c}),a=S()(d=D()(l=v()(r)).call(l,e=>r[e])).call(d,t=>Object(R.g)(e,t));s=await Object(R.m)(e,a,async a=>{const n=await r.GetKeyForPublicDeriver.get(e,a,t.PublicDeriverId,!0,!1);if(void 0===n.publicKey)throw new R.a("addTraitsForCip1852Child publicKey");return n.publicKey})}if(i=be(i),a.getPublicDeriverLevel()===M.a.CHAIN.level&&(i=ye(i)),a.getPublicDeriverLevel()===M.a.ACCOUNT.level){if(i=ye(i),Object(re.h)(a.getNetworkInfo()))i=me(i);else{if(!Object(re.f)(a.getNetworkInfo()))throw new Error("addTraitsForCip1852Child don't know how to pick internal");i=xe(i)}if(i=Ae(i),null!==s){if(i=Oe(i),Object(re.h)(a.getNetworkInfo()))i=We(i);else{if(!Object(re.f)(a.getNetworkInfo()))throw new Error("addTraitsForCip1852Child don't know how to scan for network");i=Ne(i)}i=Be(i),i=Le(i)}}else null!==s&&(i=Oe(i));null!==a.getSigningLevel()&&(i=Pe(i)),i=Ue(i),i=He(i);{var u,p;const t=m()({GetDerivationsByPath:H.g}),n=S()(u=D()(p=v()(t)).call(p,e=>t[e])).call(u,t=>Object(R.g)(e,t));o=await Object(R.m)(e,n,async n=>{const s=a.getPublicDeriverLevel()-M.a.ROOT.level,o=await t.GetDerivationsByPath.getParentPath(e,n,{startingKey:r,numLevels:s}),i=[];for(const e of c()(o).call(o,1)){if(null==e.Index)throw new Error("addTraitsForCip1852Child null index");i.push(e.Index)}return i})}return{finalClass:i,pathToPublic:o}}}).call(this,r(48).Buffer)},341:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r(167);const n=(e,t)=>e.split(" ").length===t&&Object(a.validateMnemonic)(e)},357:function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return c}));var a=r(8),n=r.n(a),s=r(21),o=r(6);function i(t,r){return a=>n()(a).call(a,a=>{const n=t.derive(a),s=o.a.SigmaRust.Address.from_public_key(n.publicKey);return e.from(s.to_bytes(r)).toString("hex")})}async function c(e,t,r){return await e({...t,address:{type:s.b.ERGO_P2PK,data:r}}),{KeyDerivationId:t.keyDerivationId}}}).call(this,r(48).Buffer)},358:function(e,t,r){"use strict";r.d(t,"b",(function(){return d})),r.d(t,"a",(function(){return l}));var a=r(40),n=r.n(a),s=r(8),o=r.n(s),i=r(460),c=r(19);async function d(e){const t=await Object(i.a)(e.generateAddressFunc,e.lastUsedIndex,c.a,50,e.checkAddressesInUse,e.network);return o()(t).call(t,(t,r)=>({index:r+e.lastUsedIndex+1,insert:async r=>await async function(e,t,r,a){return await e({...t,address:{type:a,data:r}}),{KeyDerivationId:t.keyDerivationId}}(e.addByHash,r,t,e.type)}))}async function l(e){const t=await d({generateAddressFunc:e.generateInternalAddresses,lastUsedIndex:e.lastUsedExternal,checkAddressesInUse:e.checkAddressesInUse,network:e.network,addByHash:e.addByHash,type:e.type}),r=await d({generateAddressFunc:e.generateExternalAddresses,lastUsedIndex:e.lastUsedInternal,checkAddressesInUse:e.checkAddressesInUse,network:e.network,addByHash:e.addByHash,type:e.type});return[{index:c.c.EXTERNAL,insert:e=>n.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:0}),children:t},{index:c.c.INTERNAL,insert:e=>n.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:r}]}},359:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return v}));var a=r(40),n=r.n(a),s=r(58),o=r.n(s),i=r(32),c=r.n(i),d=r(8),l=r.n(d),u=r(460),p=r(19),h=r(6),f=r(20),w=r(21);function g(t,r){return a=>l()(a).call(a,a=>{const n=t.derive(a).to_raw_key(),s=h.a.WalletV3.Address.single_from_public_key(n,r);return e.from(s.as_bytes()).toString("hex")})}async function b(t,r,a,n){const s=h.a.WalletV3.Address.account_from_public_key(a,n);return await t({...r,address:{type:w.b.JORMUNGANDR_ACCOUNT,data:e.from(s.as_bytes()).toString("hex")}}),{KeyDerivationId:r.keyDerivationId}}async function y(t,r,a,n){const s=h.a.WalletV3.Address.from_bytes(e.from(n,"hex")),o=s.to_single_address();if(null==o)throw new Error("addJormungandrUtxoAddress address is not a single address");const i=o.get_spending_key();await t({...r,address:{type:w.b.JORMUNGANDR_SINGLE,data:n}});const c=h.a.WalletV3.Address.delegation_from_public_key(i,a,s.get_discrimination());return await t({...r,address:{type:w.b.JORMUNGANDR_GROUP,data:e.from(c.as_bytes()).toString("hex")}}),{KeyDerivationId:r.keyDerivationId}}async function I(e){const t=await Object(u.a)(e.generateAddressFunc,e.lastUsedIndex,p.a,50,e.checkAddressesInUse,e.network);return l()(t).call(t,(t,r)=>({index:r+e.lastUsedIndex+1,insert:async r=>await y(e.addByHash,r,e.stakingKey,t)}))}async function v(t){var r;const a=h.a.WalletV3.Bip32PublicKey.from_bytes(e.from(t.accountPublicKey,"hex")),s=c()(r=Object(f.e)(t.network)).call(r,(e,t)=>o()(e,t),{});return await async function(e){var t;const r=await I({generateAddressFunc:e.generateExternalAddresses,lastUsedIndex:e.lastUsedExternal,checkAddressesInUse:e.checkAddressesInUse,network:e.network,addByHash:e.addByHash,stakingKey:e.stakingKey}),a=await I({generateAddressFunc:e.generateInternalAddresses,lastUsedIndex:e.lastUsedInternal,checkAddressesInUse:e.checkAddressesInUse,network:e.network,addByHash:e.addByHash,stakingKey:e.stakingKey}),s=l()(t=[0]).call(t,t=>({index:t,insert:async t=>await b(e.addByHash,t,e.stakingKey,e.discrimination)}));return[{index:p.c.EXTERNAL,insert:e=>n.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:0}),children:r},{index:p.c.INTERNAL,insert:e=>n.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:a},{index:p.c.CHIMERIC_ACCOUNT,insert:e=>n.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:s}]}({generateInternalAddresses:g(a.derive(p.c.INTERNAL),s.Discrimination),generateExternalAddresses:g(a.derive(p.c.EXTERNAL),s.Discrimination),lastUsedInternal:t.lastUsedInternal,lastUsedExternal:t.lastUsedExternal,network:t.network,checkAddressesInUse:t.checkAddressesInUse,addByHash:t.addByHash,stakingKey:t.stakingKey,discrimination:s.Discrimination})}}).call(this,r(48).Buffer)},360:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return T})),r.d(t,"c",(function(){return x}));var a=r(40),n=r.n(a),s=r(90),o=r.n(s),i=r(58),c=r.n(i),d=r(32),l=r.n(d),u=r(8),p=r.n(u),h=r(460),f=r(19),w=r(6),g=r(21),b=r(20),y=r(340);function I(e){return t=>p()(t).call(t,t=>e.derive(t).to_raw_key().hash().to_bech32(y.a.PAYMENT_KEY_HASH))}async function v(t,r,a,n){const s=w.a.WalletV4.RewardAddress.new(n,w.a.WalletV4.StakeCredential.from_keyhash(a.hash()));return await t({...r,address:{type:g.b.CARDANO_REWARD,data:e.from(s.to_address().to_bytes()).toString("hex")}}),{KeyDerivationId:r.keyDerivationId}}async function T(t,r,a,n,s){const o=w.a.WalletV4.EnterpriseAddress.new(s,w.a.WalletV4.StakeCredential.from_keyhash(n));if(null==o)throw new Error("addShelleyUtxoAddress address is not an enterprise address");const i=w.a.WalletV4.BaseAddress.new(s,o.payment_cred(),w.a.WalletV4.StakeCredential.from_keyhash(a.hash()));return await t({...r,address:{type:g.b.CARDANO_ENTERPRISE,data:e.from(o.to_address().to_bytes()).toString("hex")}}),await t({...r,address:{type:g.b.CARDANO_BASE,data:e.from(i.to_address().to_bytes()).toString("hex")}}),{KeyDerivationId:r.keyDerivationId}}async function m(e){var t;const r=await Object(h.a)(e.generateAddressFunc,e.lastUsedIndex,f.a,50,e.checkAddressesInUse,e.network),a=l()(t=Object(b.c)(e.network)).call(t,(e,t)=>c()(e,t),{});return p()(r).call(r,(t,r)=>({index:r+e.lastUsedIndex+1,insert:async r=>await T(e.addByHash,r,e.stakingKey,w.a.WalletV4.Ed25519KeyHash.from_bech32(t),o()(a.ChainNetworkId,10))}))}async function x(t){var r;const a=w.a.WalletV4.Bip32PublicKey.from_bytes(e.from(t.accountPublicKey,"hex")),s=l()(r=Object(b.c)(t.network)).call(r,(e,t)=>c()(e,t),{});return await async function(e){var t;const r=await m({generateAddressFunc:e.generateExternalAddresses,lastUsedIndex:e.lastUsedExternal,network:e.network,checkAddressesInUse:e.checkAddressesInUse,addByHash:e.addByHash,stakingKey:e.stakingKey}),a=await m({generateAddressFunc:e.generateInternalAddresses,lastUsedIndex:e.lastUsedInternal,network:e.network,checkAddressesInUse:e.checkAddressesInUse,addByHash:e.addByHash,stakingKey:e.stakingKey}),s=p()(t=[0]).call(t,t=>({index:t,insert:async t=>await v(e.addByHash,t,e.stakingKey,e.chainNetworkId)}));return[{index:f.c.EXTERNAL,insert:e=>n.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:0}),children:r},{index:f.c.INTERNAL,insert:e=>n.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:a},{index:f.c.CHIMERIC_ACCOUNT,insert:e=>n.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:s}]}({generateInternalAddresses:I(a.derive(f.c.INTERNAL)),generateExternalAddresses:I(a.derive(f.c.EXTERNAL)),lastUsedInternal:t.lastUsedInternal,lastUsedExternal:t.lastUsedExternal,network:t.network,checkAddressesInUse:t.checkAddressesInUse,addByHash:t.addByHash,stakingKey:t.stakingKey,chainNetworkId:o()(s.ChainNetworkId,10)})}}).call(this,r(48).Buffer)},361:function(e,t,r){"use strict";r.d(t,"b",(function(){return p})),r.d(t,"a",(function(){return f}));var a=r(68),n=r.n(a),s=r(56),o=r.n(s),i=r(20);const c=[{ExplorerId:100,NetworkId:i.j.CardanoMainnet.NetworkId,IsBackup:!1,Endpoints:{address:"https://adaex.org/",transaction:"https://adaex.org/",pool:"https://adapools.org/pool/"},Name:"ADAex.org"},{ExplorerId:101,NetworkId:i.j.CardanoMainnet.NetworkId,IsBackup:!1,Endpoints:{address:"https://adascan.net/address/",transaction:"https://adascan.net/transaction/"},Name:"AdaScan"},{ExplorerId:102,NetworkId:i.j.CardanoMainnet.NetworkId,IsBackup:!1,Endpoints:{address:"https://blockchair.com/cardano/address/",transaction:"https://blockchair.com/cardano/transaction/"},Name:"Blockchair"},{ExplorerId:103,NetworkId:i.j.CardanoMainnet.NetworkId,IsBackup:!1,Endpoints:{},Name:"Clio.1"},{ExplorerId:104,NetworkId:i.j.CardanoMainnet.NetworkId,IsBackup:!1,Endpoints:{address:"https://explorer.cardano.org/en/address?address=",transaction:"https://explorer.cardano.org/en/transaction?id="},Name:"CardanoExplorer"},{ExplorerId:105,NetworkId:i.j.CardanoMainnet.NetworkId,IsBackup:!1,Endpoints:{address:"https://adapools.org/address/",transaction:"https://adapools.org/transactions/",pool:"https://adapools.org/pool/"},Name:"ADApools"},{ExplorerId:106,NetworkId:i.j.CardanoMainnet.NetworkId,IsBackup:!0,Endpoints:{address:"https://cardanoscan.io/address/",transaction:"https://cardanoscan.io/transaction/",pool:"https://cardanoscan.io/pool/"},Name:"CardanoScan"},{ExplorerId:107,NetworkId:i.j.CardanoMainnet.NetworkId,IsBackup:!1,Endpoints:{pool:"https://pooltool.io/pool/"},Name:"PoolTool"},{ExplorerId:108,NetworkId:i.j.CardanoMainnet.NetworkId,IsBackup:!1,Endpoints:{address:"https://adastat.net/addresses/",transaction:"https://adastat.net/transactions/",pool:"https://adastat.net/pools/"},Name:"AdaStat"}],d=[{ExplorerId:200,NetworkId:i.j.JormungandrMainnet.NetworkId,IsBackup:!0,Endpoints:{address:"https://adastat.net/address/",transaction:"https://adastat.net/transaction/",pool:"https://adastat.net/pool/"},Name:"AdaStat"},{ExplorerId:201,NetworkId:i.j.JormungandrMainnet.NetworkId,IsBackup:!1,Endpoints:{address:"https://itnexplorer.cardano.org/en/address/",transaction:"https://itnexplorer.cardano.org/en/transaction/"},Name:"CardanoExplorer"}],l=[{ExplorerId:300,NetworkId:i.j.ErgoMainnet.NetworkId,IsBackup:!0,Endpoints:{address:"https://explorer.ergoplatform.com/en/addresses/",transaction:"https://explorer.ergoplatform.com/en/transactions/"},Name:"ErgoPlatform"}],u=[{ExplorerId:400,NetworkId:i.j.CardanoTestnet.NetworkId,IsBackup:!0,Endpoints:{address:"https://explorer.cardano-testnet.iohkdev.io/en/address?address=",transaction:"https://explorer.cardano-testnet.iohkdev.io/en/transaction?id="},Name:"CardanoExplorer"}],p=new o.a([[i.j.CardanoMainnet.NetworkId,c],[i.j.CardanoTestnet.NetworkId,u],[i.j.JormungandrMainnet.NetworkId,d],[i.j.ErgoMainnet.NetworkId,l]]),h=function(e){if(null==e)throw new Error("No backup explorer for type");return e},f=new o.a([[i.j.CardanoMainnet.NetworkId,h(n()(c).call(c,e=>e.IsBackup))],[i.j.CardanoTestnet.NetworkId,h(n()(u).call(u,e=>e.IsBackup))],[i.j.JormungandrMainnet.NetworkId,h(n()(d).call(d,e=>e.IsBackup))],[i.j.ErgoMainnet.NetworkId,h(n()(l).call(l,e=>e.IsBackup))]])},362:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return f})),r.d(t,"c",(function(){return w})),r.d(t,"b",(function(){return g}));var a=r(92),n=r.n(a),s=r(356),o=r.n(s),i=r(167),c=r(10),d=r(841),l=r(401),u=r(6),p=r(341),h=r(52);const f=(e,t)=>{const r=t===h.a.wallets.YOROI_PAPER_RECOVERY_PHRASE_WORD_COUNT?"xxx":void 0,[a,n]=w(e,t,r);return!(null==a||!n)&&Object(p.a)(a,n)},w=(t,r,a)=>{const s=t.split(" ");if(s.length===r){if(r===h.a.wallets.DAEDALUS_PAPER_RECOVERY_PHRASE_WORD_COUNT){if(null!=a)throw new Error(`Password is not expected for a ${h.a.wallets.DAEDALUS_PAPER_RECOVERY_PHRASE_WORD_COUNT}-word paper!`);const[t,r]=[n()(s).call(s,0,18),n()(s).call(s,18)];try{a=((t,r)=>{const a=e.from(d.nfkd(t),"utf8"),n="mnemonic"+(d.nfkd(r)||""),s=e.from(n,"utf8");return Object(l.pbkdf2Sync)(a,s,2048,32,"sha512").toString("hex")})(r.join(" "));const n=Object(i.mnemonicToEntropy)(t.join(" "));return[u.a.WalletV2.paper_wallet_unscramble(e.from(n,"hex"),a).to_english_mnemonics(),h.a.wallets.DAEDALUS_RECOVERY_PHRASE_WORD_COUNT]}catch(e){return c.a.error("Failed to unscramble paper mnemonic! "+Object(c.d)(e)),[void 0,0]}}if(r===h.a.wallets.YOROI_PAPER_RECOVERY_PHRASE_WORD_COUNT){if(null==a)throw new Error(`Password is expected for a ${h.a.wallets.YOROI_PAPER_RECOVERY_PHRASE_WORD_COUNT}-word paper!`);try{const r=Object(i.mnemonicToEntropy)(t);return[u.a.WalletV2.paper_wallet_unscramble(e.from(r,"hex"),a).to_english_mnemonics(),h.a.wallets.WALLET_RECOVERY_PHRASE_WORD_COUNT]}catch(e){return c.a.error("Failed to unscramble paper mnemonic! "+Object(c.d)(e)),[void 0,0]}}}return[void 0,0]},g=(t,r)=>{const a=new Uint8Array(e.from(o()({length:16}),"hex")),n=u.a.WalletV2.Entropy.from_english_mnemonics(t),s=u.a.WalletV2.paper_wallet_scramble(n,a,r);return Object(i.entropyToMnemonic)(e.from(s),i.wordlists.ENGLISH)}}).call(this,r(48).Buffer)},371:function(e,t,r){"use strict";r.d(t,"c",(function(){return $})),r.d(t,"b",(function(){return q})),r.d(t,"a",(function(){return X}));var a=r(58),n=r.n(a),s=r(34),o=r.n(s),i=r(165),c=r.n(i),d=r(31),l=r.n(d),u=r(1291),p=r.n(u),h=r(30),f=r.n(h),w=r(8),g=r.n(w),b=r(37),y=r.n(b),I=r(11),v=r.n(I),T=r(40),m=r.n(T),x=r(307),A=r.n(x);var k=r(22),D=r(15),O=r(25),S=r(62),E=r(657),P=r(16),C=r(200),_=r(199),G=r(201),W=r(91),N=r(160);var j=r(65),R=r(242),B=r(281),K=r(147),U=r(120),L=r(20),M=r(361),F=r(47);const H=()=>new m.a(e=>{const t=indexedDB.deleteDatabase("yoroi-schema");t.onsuccess=()=>e(),t.onerror=()=>e()}),V=async e=>{var t,r;const a=v()({GetEncryptionMeta:O.h,ModifyEncryptionMeta:S.f}),n=y()(t=g()(r=f()(a)).call(r,e=>a[e])).call(t,t=>Object(D.g)(e,t));await Object(D.m)(e,n,async t=>{const r={AddressSeed:A.a.randomBytes(4).readUInt32BE(0),TransactionSeed:A.a.randomBytes(4).readUInt32BE(0),BlockSeed:A.a.randomBytes(4).readUInt32BE(0),TokenSeed:A.a.randomBytes(4).readUInt32BE(0)},n=await a.GetEncryptionMeta.getOrInitial(e,t,{...r,EncryptionMetaId:0});await a.ModifyEncryptionMeta.upsert(e,t,{...n,EncryptionMetaId:0})})},$=async e=>{const t=await J(e);return await V(t),await(async e=>{var t,r;const a=v()({GetEncryptionMeta:O.h,ModifyEncryptionMeta:S.f,ModifyNetworks:S.h}),n=y()(t=g()(r=f()(a)).call(r,e=>a[e])).call(t,t=>Object(D.g)(e,t));await Object(D.m)(e,n,async t=>{var r;return a.ModifyNetworks.upsert(e,t,g()(r=f()(L.j)).call(r,e=>L.j[e]))})})(t),await(async e=>{var t,r;const a=v()({GetEncryptionMeta:O.h,ModifyEncryptionMeta:S.f,ModifyExplorers:E.a}),n=y()(t=g()(r=f()(a)).call(r,e=>a[e])).call(t,t=>Object(D.g)(e,t));await Object(D.m)(e,n,async t=>{var r;return a.ModifyExplorers.upsert(e,t,p()(r=[...l()(M.b).call(M.b)]).call(r))})})(t),await(async e=>{var t,r;const a=v()({ModifyToken:S.i}),n=y()(t=g()(r=f()(a)).call(r,e=>a[e])).call(t,t=>Object(D.g)(e,t));await Object(D.m)(e,n,async t=>a.ModifyToken.upsert(e,t,L.b))})(t),t};async function q(e,t){await e.delete();const r=k.schema.create(t.name,t.version),a=await r.connect({storeType:k.schema.DataStoreType.INDEXED_DB});return await a.import(t),a}const J=async e=>{const t=k.schema.create("yoroi-schema",16);return Object(P.o)(t),Object(j.e)(t),Object(C.f)(t),Object(_.b)(t),Object(G.b)(t),Object(W.c)(t),Object(N.c)(t),Object(R.b)(t),Object(B.b)(t),Object(K.c)(t),await t.connect({storeType:e,onUpgrade:Y})};const X={};async function Y(e){const t=e.getVersion();if(0===t)return;const r=await e.dump();if(1===t)return n()(X,r),await e.dropTable("TxAddresses"),await e.dropTable("Txs"),void await e.dropTable("Addresses");if(2===t)return await H(),void window.location.reload();if(3===t){if(0===f()(r).length)return await H(),void window.location.reload()}if(t>=3&&t<=4&&await e.addTableColumn("Cip1852Wrapper","RootKeyDerivationId",1),6===t||7===t){const t=e.getRawTransaction().objectStore("TxMemo");await Object(D.l)(t.clear())}t>=3&&t<=9&&(await e.dropTableColumn("Bip44Wrapper","Bip44WrapperId"),await e.dropTableColumn("Cip1852Wrapper","Cip1852WrapperId")),t>=3&&t<=10&&await e.addTableColumn("Key","Type",U.a.BIP32ED25519),t>=3&&t<=11&&(await e.dropTableColumn("ConceptualWallet","CoinType"),await e.addTableColumn("ConceptualWallet","NetworkId",L.j.CardanoMainnet.NetworkId)),t>=3&&t<=12&&(F.a.isNightly()&&(await H(),window.location.reload()),await e.addTableColumn("Transaction","Type",P.n.CardanoByron),await e.addTableColumn("Transaction","Extra",null)),t>=3&&t<=13&&await e.addTableColumn("Certificate","Ordinal",P.n.CardanoByron),t>=3&&t<=14&&(await e.addTableColumn("UtxoTransactionOutput","ErgoBoxId",null),await e.addTableColumn("UtxoTransactionOutput","ErgoCreationHeight",null),await e.addTableColumn("UtxoTransactionOutput","ErgoTree",null)),t>=3&&t<=15&&await async function(e){const t=e.getRawTransaction(),r=["AccountingTransactionInput","AccountingTransactionOutput","Block","Certificate","CertificateAddress","TokenList","Transaction","UtxoTransactionInput","UtxoTransactionOutput","Token"],a=t.objectStore("LastSyncInfo"),n=await Object(D.l)(a.getAll()),s=t.objectStore("Token"),i=await Object(D.l)(s.getAll());for(const e of r)try{const r=t.objectStore(e);await Object(D.l)(r.clear())}catch(e){}for(const e of n){const r=t.objectStore("LastSyncInfo");await Object(D.l)(r.put({id:e.id,value:{LastSyncInfoId:e.value.LastSyncInfoId,Time:new Date(c()()).getTime(),SlotNum:null,Height:0,BlockHash:null}}))}for(const e of o()(i).call(i,e=>!0===e.value.IsDefault)){const r=t.objectStore("Token");await Object(D.l)(r.put({id:e.id,value:e.value}))}}(e)}},38:function(e,t,r){"use strict";r.d(t,"a",(function(){return y}));var a=r(75),n=r.n(a),s=r(56),o=r.n(s),i=r(8),c=r.n(i),d=r(34),l=r.n(d),u=r(31),p=r.n(u),h=r(68),f=r.n(h),w=r(1),g=r.n(w),b=r(29);class y{constructor(e,t){g()(this,"values",void 0),g()(this,"defaults",void 0),g()(this,"_checkNetworkId",e=>{const t=this.defaults.defaultNetworkId;if(t!==e)throw new Error(`MultiToken network mismatch ${t} - ${e}`)}),g()(this,"get",e=>{var t,r;return null===(t=f()(r=p()(this)).call(r,t=>t.identifier===e))||void 0===t?void 0:t.amount}),g()(this,"add",e=>{var t;this._checkNetworkId(e.networkId);const r=f()(t=p()(this)).call(t,t=>t.identifier===e.identifier);return null==r?(p()(this).push(e),this):(r.amount=r.amount.plus(e.amount),this._removeIfZero(e.identifier),this)}),g()(this,"_removeIfZero",e=>{if(e===this.defaults.defaultIdentifier)return;const t=this.get(e);var r;null!=t&&t.eq(0)&&(this.values=l()(r=p()(this)).call(r,t=>t.identifier!==e))}),g()(this,"subtract",e=>this.add({identifier:e.identifier,amount:e.amount.negated(),networkId:e.networkId})),g()(this,"joinAddMutable",e=>{for(const t of p()(e))this.add(t);return this}),g()(this,"joinSubtractMutable",e=>{for(const t of p()(e))this.subtract(t);return this}),g()(this,"joinAddCopy",e=>new y(p()(this),this.defaults).joinAddMutable(e)),g()(this,"joinSubtractCopy",e=>new y(p()(this),this.defaults).joinSubtractMutable(e)),g()(this,"absCopy",()=>{var e;return new y(c()(e=p()(this)).call(e,e=>({...e,amount:e.amount.absoluteValue()})),this.defaults)}),g()(this,"negatedCopy",()=>{var e;return new y(c()(e=p()(this)).call(e,e=>({...e,amount:e.amount.negated()})),this.defaults)}),g()(this,"getDefault",()=>this.getDefaultEntry().amount),g()(this,"getDefaultEntry",()=>{var e;return l()(e=p()(this)).call(e,e=>e.networkId===this.defaults.defaultNetworkId&&e.identifier===this.defaults.defaultIdentifier)[0]}),g()(this,"nonDefaultEntries",()=>{var e;return l()(e=p()(this)).call(e,e=>!(e.networkId===this.defaults.defaultNetworkId&&e.identifier===this.defaults.defaultIdentifier))}),g()(this,"asMap",()=>{var e;return new o.a(c()(e=p()(this)).call(e,e=>[e.identifier,e.amount]))}),g()(this,"isEqualTo",e=>{const t=this.asMap();for(const r of p()(e)){const e=t.get(r.identifier);if(null==e)return!1;if(!e.isEqualTo(r.amount))return!1;t.delete(r.identifier)}return!(t.size>0)}),g()(this,"isEmpty",()=>{var e;return 0===l()(e=p()(this)).call(e,e=>e.amount.gt(0)).length}),this.values=[],this.defaults=t,this.add({identifier:t.defaultIdentifier,networkId:t.defaultNetworkId,amount:new b.BigNumber(0)}),n()(e).call(e,e=>this.add(e))}}},408:function(e,t,r){"use strict";r.d(t,"d",(function(){return b})),r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return I})),r.d(t,"c",(function(){return v}));var a=r(11),n=r.n(a),s=r(34),o=r.n(s),i=r(8),c=r.n(i),d=r(1),l=r.n(d),u=r(16),p=r(62),h=r(196),f=r(160),w=r(15);class g{static async addIOsToTx(e,t,r){const{accountingInputs:a,accountingOutputs:n}=r;return{accountingInputs:await Object(w.b)(e,t,a,g.ownTables[f.a.name].name),accountingOutputs:await Object(w.b)(e,t,n,g.ownTables[f.b.name].name)}}}l()(g,"ownTables",n()({[f.a.name]:f.a,[f.b.name]:f.b})),l()(g,"depTables",n()({}));class b{static async addTxWithIOs(e,t,r){const{block:a,transaction:n}=r,s=await b.depTables.ModifyTransaction.addNew(e,t,{block:a,transaction:n}),{utxoInputs:i,utxoOutputs:d,accountingInputs:l,accountingOutputs:p,tokenList:h}=r.ioGen(s.transaction.TransactionId),f=await b.depTables.ModifyUtxoTransaction.addIOsToTx(e,t,{utxoInputs:i,utxoOutputs:d}),w=await b.depTables.ModifyAccountingTransaction.addIOsToTx(e,t,{accountingInputs:l,accountingOutputs:p}),g=[];for(const a of r.certificates){const r=a(s.transaction.TransactionId);null!=r&&g.push(await b.depTables.ModifyCertificate.addNew(e,t,r))}const y=await b.depTables.ModifyTokenList.upsert(e,t,c()(h).call(h,e=>e.TokenList));return{txType:u.n.Jormungandr,...s,certificates:g,...f,...w,tokens:c()(y).call(y,e=>({TokenList:e,Token:{TokenId:e.TokenId,Identifier:o()(h).call(h,t=>t.TokenList.TokenId===e.TokenId)[0].identifier,NetworkId:o()(h).call(h,t=>t.TokenList.TokenId===e.TokenId)[0].networkId}}))}}}l()(b,"ownTables",n()({})),l()(b,"depTables",n()({ModifyTransaction:p.k,ModifyUtxoTransaction:h.b,ModifyAccountingTransaction:g,ModifyCertificate:p.e,ModifyTokenList:p.j}));class y{static async addTxWithIOs(e,t,r){const{block:a,transaction:n}=r,s=await y.depTables.ModifyTransaction.addNew(e,t,{block:a,transaction:n}),{utxoInputs:i,utxoOutputs:d,tokenList:l}=r.ioGen(s.transaction.TransactionId),p=await y.depTables.ModifyUtxoTransaction.addIOsToTx(e,t,{utxoInputs:i,utxoOutputs:d}),h=await y.depTables.ModifyTokenList.upsert(e,t,c()(l).call(l,e=>e.TokenList));return{txType:u.n.CardanoByron,...s,...p,tokens:c()(h).call(h,e=>({TokenList:e,Token:{TokenId:e.TokenId,Identifier:o()(l).call(l,t=>t.TokenList.TokenId===e.TokenId)[0].identifier,NetworkId:o()(l).call(l,t=>t.TokenList.TokenId===e.TokenId)[0].networkId}}))}}}l()(y,"ownTables",n()({})),l()(y,"depTables",n()({ModifyTransaction:p.k,ModifyUtxoTransaction:h.b,ModifyTokenList:p.j}));class I{static async addTxWithIOs(e,t,r){const{block:a,transaction:n}=r,{depTables:s}=I,i=await s.ModifyTransaction.addNew(e,t,{block:a,transaction:n}),{utxoInputs:d,utxoOutputs:l,accountingInputs:p,tokenList:h}=r.ioGen(i.transaction.TransactionId),f=await s.ModifyUtxoTransaction.addIOsToTx(e,t,{utxoInputs:d,utxoOutputs:l}),w=await s.ModifyAccountingTransaction.addIOsToTx(e,t,{accountingInputs:p,accountingOutputs:[]}),g=[];for(const a of r.certificates){const r=a(i.transaction.TransactionId);null!=r&&g.push(await s.ModifyCertificate.addNew(e,t,r))}const b=await I.depTables.ModifyTokenList.upsert(e,t,c()(h).call(h,e=>e.TokenList));return{txType:u.n.CardanoShelley,...i,certificates:g,...f,accountingInputs:w.accountingInputs,tokens:c()(b).call(b,e=>({TokenList:e,Token:{TokenId:e.TokenId,Identifier:o()(h).call(h,t=>t.TokenList.TokenId===e.TokenId)[0].identifier,NetworkId:o()(h).call(h,t=>t.TokenList.TokenId===e.TokenId)[0].networkId}}))}}}l()(I,"ownTables",n()({})),l()(I,"depTables",n()({ModifyTransaction:p.k,ModifyCertificate:p.e,ModifyUtxoTransaction:h.b,ModifyAccountingTransaction:g,ModifyTokenList:p.j}));class v{static async addTxWithIOs(e,t,r){const{block:a,transaction:n}=r,s=await v.depTables.ModifyTransaction.addNew(e,t,{block:a,transaction:n}),{utxoInputs:i,utxoOutputs:d,tokenList:l}=r.ioGen(s.transaction.TransactionId),p=await v.depTables.ModifyUtxoTransaction.addIOsToTx(e,t,{utxoInputs:i,utxoOutputs:d}),h=await v.depTables.ModifyTokenList.upsert(e,t,c()(l).call(l,e=>e.TokenList));return{txType:u.n.Ergo,...s,...p,tokens:c()(h).call(h,e=>({TokenList:e,Token:{TokenId:e.TokenId,Identifier:o()(l).call(l,t=>t.TokenList.TokenId===e.TokenId)[0].identifier,NetworkId:o()(l).call(l,t=>t.TokenList.TokenId===e.TokenId)[0].networkId}}))}}}l()(v,"ownTables",n()({})),l()(v,"depTables",n()({ModifyTransaction:p.k,ModifyUtxoTransaction:h.b,ModifyTokenList:p.j}))},456:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return m}));var a=r(66),n=r.n(a),s=r(31),o=r.n(s),i=r(75),c=r.n(i),d=r(8),l=r.n(d),u=r(35),p=r.n(u),h=r(55),f=r.n(h),w=r(1),g=r.n(w),b=r(29),y=r.n(b),I=(r(787),r(38)),v=r(6),T=r(21);class m{constructor(e){g()(this,"senderUtxos",void 0),g()(this,"unsignedTx",void 0),g()(this,"changeAddr",void 0),g()(this,"networkSettingSnapshot",void 0),this.senderUtxos=e.senderUtxos,this.unsignedTx=e.unsignedTx,this.changeAddr=e.changeAddr,this.networkSettingSnapshot=e.networkSettingSnapshot}totalInput(){return function(e,t,r){const a=new I.a([],{defaultNetworkId:r,defaultIdentifier:T.c.Ergo}),n=e.box_selection().boxes();for(let e=0;e<n.len();e++){const t=n.get(e);a.add({identifier:T.c.Ergo,amount:new y.a(t.value().as_i64().to_str()),networkId:r});const s=t.tokens();for(let e=0;e<s.len();e++){const t=s.get(e);a.add({identifier:t.id().to_str(),amount:new y.a(t.amount().as_i64().to_str()),networkId:r})}}return c()(t).call(t,e=>a.joinSubtractMutable(o()(e))),a}(this.unsignedTx,this.changeAddr,this.networkSettingSnapshot.NetworkId)}totalOutput(){return function(t,r,a,n){const s=new I.a([],{defaultNetworkId:n,defaultIdentifier:T.c.Ergo}),o=t.build().outputs();for(let t=0;t<o.len();t++){const i=o.get(t),c=v.a.SigmaRust.NetworkAddress.new(r,v.a.SigmaRust.Address.recreate_from_ergo_tree(i.ergo_tree()));if(e.from(c.to_bytes()).toString("hex")===a)continue;s.add({identifier:T.c.Ergo,amount:new y.a(i.value().as_i64().to_str()),networkId:n});const d=i.tokens();for(let e=0;e<d.len();e++){const t=d.get(e);s.add({identifier:t.id().to_str(),amount:new y.a(t.amount().as_i64().to_str()),networkId:n})}}return s}(this.unsignedTx,this.networkSettingSnapshot.ChainNetworkId,this.networkSettingSnapshot.FeeAddress,this.networkSettingSnapshot.NetworkId)}fee(){return e=this.unsignedTx,t=this.networkSettingSnapshot.NetworkId,new I.a([{identifier:T.c.Ergo,amount:new y.a(e.fee_amount().as_i64().to_str()),networkId:t}],{defaultNetworkId:t,defaultIdentifier:T.c.Ergo});var e,t}uniqueSenderAddresses(){var e;return f()(new p.a(l()(e=this.senderUtxos).call(e,e=>e.receiver)))}receivers(t){var r;const a=[],n=new p.a(l()(r=this.changeAddr).call(r,e=>e.address)),s=this.unsignedTx.build().outputs();for(let r=0;r<s.len();r++){const o=s.get(r).ergo_tree(),i=v.a.SigmaRust.NetworkAddress.new(this.networkSettingSnapshot.ChainNetworkId,v.a.SigmaRust.Address.recreate_from_ergo_tree(o)),c=e.from(i.to_bytes()).toString("hex");!t&&n.has(c)||(t||c!==this.networkSettingSnapshot.FeeAddress)&&a.push(c)}return a}isEqual(e){return null!=e&&(e instanceof v.a.SigmaRust.TxBuilder&&function(e,t){const r=e.build().to_json(),a=t.build().to_json();return n()(r)===n()(a)}(this.unsignedTx,e))}self(){return this.unsignedTx}}}).call(this,r(48).Buffer)},459:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return S})),r.d(t,"c",(function(){return G})),r.d(t,"b",(function(){return W}));var a=r(68),n=r.n(a),s=r(30),o=r.n(s),i=r(37),c=r.n(i),d=r(11),l=r.n(d),u=r(1),p=r.n(u),h=r(40),f=r.n(h),w=r(92),g=r.n(w),b=r(8),y=r.n(b),I=r(187),v=(r(77),r(15)),T=r(86),m=r(103),x=r(188),A=r(141),k=r(62),D=r(25),O=r(309);async function S(t,r,a,n,s,o,i,c){return await a.DerivePublicDeriverFromKey.add(t,r,{publicDeriverMeta:s.publicDeriverMeta,pathToPublic:t=>{var r,a,n;const o=Object(O.b)({privateKeyRow:t,password:s.decryptPrivateDeriverPassword,path:y()(r=s.path).call(r,e=>e.index)});return[...y()(a=g()(n=s.path).call(n,0,s.path.length-1)).call(a,e=>({index:e.index,insert:t=>f.a.resolve({KeyDerivationId:t.keyDerivationId,...e.insert}),privateKey:null,publicKey:null})),{index:s.path[s.path.length-1].index,insert:e=>f.a.resolve({KeyDerivationId:e.keyDerivationId,...s.path[s.path.length-1].insert}),privateKey:void 0===s.encryptPublicDeriverPassword?null:{Hash:null===s.encryptPublicDeriverPassword?o.prvKeyHex:Object(x.b)(s.encryptPublicDeriverPassword,e.from(o.prvKeyHex,"hex")),IsEncrypted:!0,PasswordLastUpdate:null,Type:t.Type},publicKey:{Hash:o.pubKeyHex,IsEncrypted:!1,PasswordLastUpdate:null,Type:t.Type}}]},initialDerivations:s.initialDerivations},o,i,n,c)}const E=Object(m.Mixin)(e=>class extends e{constructor(...e){super(...e),p()(this,"rawDerivePublicDeriverFromPrivate",async(e,t,r,a)=>{const n=super.getPrivateDeriverKeyDerivationId(),s=super.getPrivateDeriverLevel();if(null==n||null==s)throw new v.a("rawDerivePublicDeriverFromPrivate no private deriver");return await S(super.getDb(),e,{DerivePublicDeriverFromKey:t.DerivePublicDeriverFromKey},super.getConceptualWalletId(),r,n,s,a)}),p()(this,"derivePublicDeriverFromPrivate",async e=>{var t,r;const a=this.getDerivationTables(),n=l()({DerivePublicDeriverFromKey:A.c}),s=c()(t=y()(r=o()(n)).call(r,e=>n[e])).call(t,e=>Object(v.g)(super.getDb(),e));return await Object(v.m)(super.getDb(),[...s,...Object(v.k)(super.getDb(),a)],async t=>this.rawDerivePublicDeriverFromPrivate(t,n,e,a))})}});const P=Object(m.Mixin)(e=>class extends e{constructor(...e){super(...e),p()(this,"rawGetPrivateDeriverKey",async(e,t,r)=>{const a=super.getPrivateDeriverKeyDerivationId();if(null==a)throw new v.a("GetPrivateDeriverKey::getPrivateDeriverKey derivationId=null");const n=await t.GetKeyForDerivation.get(super.getDb(),e,a,!1,!0);if(null==n.privateKey)throw new v.a("GetPrivateDeriverKey::getPrivateDeriverKey privateKey=null");return{keyRow:n.privateKey,keyDerivation:n.KeyDerivation}}),p()(this,"getPrivateDeriverKey",async e=>{var t,r;const a=l()({GetKeyForDerivation:D.k}),n=c()(t=y()(r=o()(a)).call(r,e=>a[e])).call(t,e=>Object(v.g)(super.getDb(),e));return await Object(v.m)(super.getDb(),n,async t=>this.rawGetPrivateDeriverKey(t,a,e))}),p()(this,"rawChangePrivateDeriverPassword",async(e,t,r)=>{const a=await this.rawGetPrivateDeriverKey(e,{GetKeyForDerivation:t.GetKeyForDerivation},void 0);return Object(O.c)(super.getDb(),e,{ModifyKey:t.ModifyKey},{...r,oldKeyRow:a.keyRow})}),p()(this,"changePrivateDeriverPassword",async e=>{var t,r;const a=l()({GetKeyForDerivation:D.k,ModifyKey:k.g}),n=c()(t=y()(r=o()(a)).call(r,e=>a[e])).call(t,e=>Object(v.g)(super.getDb(),e));return await Object(v.m)(super.getDb(),n,async t=>this.rawChangePrivateDeriverPassword(t,a,e))})}});const C=Object(m.Mixin)(e=>class extends e{constructor(...e){super(...e),p()(this,"rawAddAdhocPubicDeriver",async(e,t,r,a)=>await t.AddAdhocPublicDeriver.add(super.getDb(),e,r,super.getConceptualWalletId(),a)),p()(this,"addAdhocPubicDeriver",async e=>{var t,r;const a=this.getDerivationTables(),n=l()({AddAdhocPublicDeriver:A.a}),s=c()(t=y()(r=o()(n)).call(r,e=>n[e])).call(t,e=>Object(v.g)(super.getDb(),e));return await Object(v.m)(super.getDb(),[...s,...Object(v.k)(super.getDb(),a)],async t=>this.rawAddAdhocPubicDeriver(t,n,e,a))})}});async function _(e,t){var r,a;const s=l()({GetHwWalletMeta:T.b,GetConceptualWallet:T.a,GetNetworks:D.l,GetToken:D.n}),i=c()(r=y()(a=o()(s)).call(a,e=>s[e])).call(r,t=>Object(v.g)(e,t)),d=await Object(v.m)(e,i,async r=>{const a=await s.GetConceptualWallet.get(e,r,t);if(null==a)throw new Error(`refreshConceptualWalletFunctionality no conceptual wallet with id ${t}`);const o=await s.GetHwWalletMeta.getMeta(e,r,t),i=await s.GetNetworks.get(e,r),c=n()(i).call(i,e=>e.NetworkId===a.NetworkId);if(null==c)throw new Error(`refreshConceptualWalletFunctionality missing network ${a.NetworkId}`);const d=await s.GetToken.all(e,r),l=n()(d).call(d,e=>e.NetworkId===a.NetworkId);if(null==l)throw new Error(`refreshConceptualWalletFunctionality missing token for ${a.NetworkId}`);return{hardwareInfo:o,fullInfo:a,networkInfo:c,defaultToken:l}}),u=null==d.hardwareInfo?I.a.WEB_WALLET:I.a.HARDWARE_WALLET;return{db:e,conceptualWalletId:t,walletType:u,hardwareInfo:d.hardwareInfo,networkInfo:d.networkInfo,defaultToken:d.defaultToken}}async function G(e,t,r){const a=await _(e,t.ConceptualWalletId);let n=null,s=null,o=r;return null!=t.PrivateDeriverLevel&&null!=t.PrivateDeriverKeyDerivationId?(o=E(o),o=P(o),n=t.PrivateDeriverLevel,s=t.PrivateDeriverKeyDerivationId):o=C(o),new o(e,a,t,n,s)}async function W(e,t,r){const a=await _(e,t.ConceptualWalletId);let n=null,s=null,o=r;return null!=t.PrivateDeriverLevel&&null!=t.PrivateDeriverKeyDerivationId?(o=E(o),o=P(o),n=t.PrivateDeriverLevel,s=t.PrivateDeriverKeyDerivationId):o=C(o),new o(e,a,t,n,s)}}).call(this,r(48).Buffer)},46:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return d}));var a=r(66),n=r.n(a),s=r(11),o=r.n(s),i=r(20);const c=o()({ada:"ada",jormungandr:"jormungandr",ergo:"ergo"}),d=e=>{if(Object(i.f)(e))return c.ada;if(Object(i.h)(e))return c.jormungandr;if(Object(i.g)(e))return c.ergo;throw new Error(`getApiForNetwork missing entry for type ${n()(e)}`)}},460:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var a=r(84),n=r.n(a),s=r(35),o=r.n(s),i=r(32),c=r.n(i),d=r(92),l=r.n(d),u=r(8),p=r.n(u),h=r(43);async function f(e,t,r,a,n,s){var o;let i=[],c=t,d=!0;for(;d;){const o=await g(i,e,t+1,c+1,r,a,n,s),l=w(o,t+1,c,r);d=c!==l,c=l,i=o}let u=-1;for(let e=0;e<i.length;e++)e>u&&i[e].isUsed&&(u=e);return p()(o=l()(i).call(i,0,u+r+1)).call(o,e=>e.address)}function w(e,t,r,a){const n=l()(e).call(e,r-t+1,r-t+1+a);return c()(n).call(n,(e,t)=>t.index>e&&t.isUsed?t.index:e,r)}async function g(e,t,r,a,s,i,c,d){if(e.length+r>=a+s)return e;const l=Object(h.range)(e.length+r,e.length+r+i),u=t(l);return function(e,t,r,a){const s=new o.a(r),i=p()(t).call(t,(e,t)=>({address:e,isUsed:s.has(e),index:a[t]}));return n()(e).call(e,i)}(e,u,await c({network:d,addresses:u}),l)}},462:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return Ie})),r.d(t,"b",(function(){return ve}));var a=r(68),n=r.n(a),s=r(84),o=r.n(s),i=r(56),c=r.n(i),d=r(123),l=r.n(d),u=r(40),p=r.n(u),h=r(30),f=r.n(h),w=r(34),g=r.n(w),b=r(35),y=r.n(b),I=r(90),v=r.n(I),T=r(92),m=r.n(T),x=r(8),A=r.n(x),k=r(58),D=r.n(k),O=r(32),S=r.n(O),E=r(26),P=r.n(E),C=r(29),_=r.n(C),G=r(10),W=r(838),N=r(491),j=r(19),R=r(555),B=r(839),K=r(243),U=r(210),L=r(840),M=r(138),F=r(151),H=r(53),V=r(16),$=r(50),q=r(33),J=(r(77),r(153)),X=r(117),Y=r(261),z=r(341),Z=r(557),Q=r(362),ee=r(102),te=r(658),re=r(463),ae=r(23),ne=r(17),se=r(358),oe=r(195),ie=r(360),ce=r(144),de=r(173),le=r(131),ue=r(166),pe=r(176),he=r(282),fe=r(6),we=r(21),ge=r(20),be=r(464),ye=r(38);class Ie{createAdaPaper(e){var t;const r=Object(X.a)(),a=Object(X.d)(r.join(" ")),n=Object(Q.b)(r.join(" "),e.password).split(" "),s=S()(t=Object(ge.c)(e.network)).call(t,(e,t)=>D()(e,t),{}),{addresses:o,plate:i}=Object(Z.a)(a,0,null!=e.numAddresses?e.numAddresses:1,s.ByronNetworkId);return{addresses:o,scrambledWords:n,plate:i}}async createAdaPaperPdf({paper:e,network:t,printAccountPlate:r,updateStatus:a}){const{addresses:n,scrambledWords:s,plate:o}=e;return Object(he.b)({words:s,addresses:n,plate:!0===r?o:void 0,network:t},e=>{G.a.info("[PaperWalletRender] "+e),a&&a(e)})}async getAllAddressesForDisplay(e){G.a.debug("AdaApi::getAllAddressesForDisplay called");try{return await Object(ue.a)(e)}catch(e){if(G.a.error("AdaApi::getAllAddressesForDisplay error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async getChainAddressesForDisplay(e){G.a.debug("AdaApi::getChainAddressesForDisplay called");try{return await Object(le.c)(e)}catch(e){if(G.a.error("AdaApi::getChainAddressesForDisplay error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async refreshTransactions(e){G.a.debug("AdaApi::refreshTransactions called");const{skip:t=0,limit:r}=e;try{var a;e.isLocalRequest||await Object(K.f)(e.publicDeriver.getDb(),e.publicDeriver,e.checkAddressesInUse,e.getTransactionsHistoryForAddresses,e.getBestBlock);const n=await Object(K.a)({publicDeriver:e.publicDeriver,skip:t,limit:r});G.a.debug("AdaApi::refreshTransactions success: "+Object(G.c)(n));const s=A()(a=n.txs).call(a,t=>{if(t.txType===V.n.CardanoByron)return W.a.fromAnnotatedTx({tx:t,addressLookupMap:n.addressLookupMap,network:e.publicDeriver.getParent().getNetworkInfo(),defaultToken:e.publicDeriver.getParent().getDefaultToken()});if(t.txType===V.n.CardanoShelley)return N.a.fromAnnotatedTx({tx:t,addressLookupMap:n.addressLookupMap,network:e.publicDeriver.getParent().getNetworkInfo(),defaultToken:e.publicDeriver.getParent().getDefaultToken()});throw new Error(`refreshTransactions unknown tx type ${t.type}`)});return{transactions:s,total:s.length}}catch(e){if(G.a.error("AdaApi::refreshTransactions error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async refreshPendingTransactions(e){G.a.debug("AdaApi::refreshPendingTransactions called");try{var t;const r=await Object(K.c)({publicDeriver:e.publicDeriver});return G.a.debug("AdaApi::refreshPendingTransactions success: "+Object(G.c)(r)),A()(t=r.txs).call(t,t=>{if(t.txType===V.n.CardanoByron)return W.a.fromAnnotatedTx({tx:t,addressLookupMap:r.addressLookupMap,network:e.publicDeriver.getParent().getNetworkInfo(),defaultToken:e.publicDeriver.getParent().getDefaultToken()});if(t.txType===V.n.CardanoShelley)return N.a.fromAnnotatedTx({tx:t,addressLookupMap:r.addressLookupMap,network:e.publicDeriver.getParent().getNetworkInfo(),defaultToken:e.publicDeriver.getParent().getDefaultToken()});throw new Error(`refreshPendingTransactions unknown tx type ${t.type}`)})}catch(e){if(G.a.error("AdaApi::refreshPendingTransactions error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async removeAllTransactions(e){try{await Object(K.e)({publicDeriver:e.publicDeriver});try{await e.refreshWallet()}catch(e){G.a.warn("removeAllTransactions failed to connect to remote to resync. Data was still cleared locally")}}catch(e){if(G.a.error("AdaApi::removeAllTransactions error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async getForeignAddresses(e){try{return await Object(K.b)({publicDeriver:e.publicDeriver})}catch(e){if(G.a.error("AdaApi::getForeignAddresses error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async getNotices(e){G.a.debug("AdaApi::getNotices called");try{let t=0;const r=[new ee.b({id:(t++).toString(),kind:2,date:new Date}),new ee.b({id:(t++).toString(),kind:0,date:P()().subtract(1,"seconds").toDate()}),new ee.b({id:(t++).toString(),kind:1,date:P()().subtract(5,"seconds").toDate()}),new ee.b({id:(t++).toString(),kind:2,date:P()().subtract(40,"seconds").toDate()}),new ee.b({id:(t++).toString(),kind:3,date:P()().subtract(1,"minutes").toDate()}),new ee.b({id:(t++).toString(),kind:4,date:P()().subtract(2,"minutes").toDate()}),new ee.b({id:(t++).toString(),kind:5,date:P()().subtract(5,"minutes").toDate()}),new ee.b({id:(t++).toString(),kind:6,date:P()().subtract(15,"minutes").toDate()}),new ee.b({id:(t++).toString(),kind:7,date:P()().subtract(30,"minutes").toDate()}),new ee.b({id:(t++).toString(),kind:7,date:P()().subtract(88,"minutes").toDate()}),new ee.b({id:(t++).toString(),kind:0,date:P()().subtract(10,"hours").toDate()}),new ee.b({id:(t++).toString(),kind:3,date:P()().subtract(1,"days").toDate()}),new ee.b({id:(t++).toString(),kind:4,date:P()().subtract(1,"days").toDate()}),new ee.b({id:(t++).toString(),kind:1,date:new Date(2019,11,5,10,15,20)}),new ee.b({id:(t++).toString(),kind:5,date:new Date(2019,11,5,8,20,20)}),new ee.b({id:(t++).toString(),kind:3,date:new Date(2019,11,4,2,15,20)}),new ee.b({id:(t++).toString(),kind:7,date:new Date(2019,11,4,10,40,20)}),new ee.b({id:(t++).toString(),kind:6,date:new Date(2019,11,4,18,55,29)}),new ee.b({id:(t++).toString(),kind:0,date:new Date(2019,11,2,10,45,20)}),new ee.b({id:(t++).toString(),kind:7,date:new Date(2019,11,1,10,18,20)})],{skip:a=0,limit:n}=e;return{notices:m()(r).call(r,a,n),total:r.length}}catch(e){if(G.a.error("AdaApi::getNotices error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async createWallet(e){return await this.restoreWallet(e)}async signAndBroadcast(t){G.a.debug("AdaApi::signAndBroadcast called");const{password:r}=t;try{const a=await t.publicDeriver.getSigningKey(),n=await t.publicDeriver.normalizeKey({...a,password:r}),s=Object(J.f)(t.signRequest.signRequest,t.publicDeriver.getParent().getPublicDeriverLevel(),fe.a.WalletV4.Bip32PrivateKey.from_bytes(e.from(n.prvKeyHex,"hex")),t.signRequest.neededStakingKeyHashes.wits,t.signRequest.metadata),o=t.sendTx({network:t.publicDeriver.getParent().getNetworkInfo(),id:e.from(fe.a.WalletV4.hash_transaction(s.body()).to_bytes()).toString("hex"),encodedTx:s.to_bytes()});return G.a.debug("AdaApi::signAndBroadcast success: "+Object(G.c)(o)),o}catch(e){if(e instanceof de.a)throw new ae.t;if(G.a.error("AdaApi::signAndBroadcast error: "+Object(G.d)(e)),e instanceof ae.u)throw new ae.u;if(e instanceof ne.b)throw e;throw new ae.d}}async createTrezorSignTxData(e){try{var t;G.a.debug("AdaApi::createTrezorSignTxData called");const r=S()(t=Object(ge.c)(e.network)).call(t,(e,t)=>D()(e,t),{}),a=await Object(te.a)(e.signRequest,r.ByronNetworkId,v()(r.ChainNetworkId,10));return G.a.debug("AdaApi::createTrezorSignTxData success: "+Object(G.c)(a)),{trezorSignTxPayload:a}}catch(e){if(G.a.error("AdaApi::createTrezorSignTxData error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async broadcastTrezorSignedTx(e){G.a.debug("AdaApi::broadcastTrezorSignedTx called");try{G.a.debug("trezorTx::broadcastTrezorSignedTx: called");const t=await e.sendTx(e.signedTxRequest);return G.a.debug("AdaApi::broadcastTrezorSignedTx success: "+Object(G.c)(t)),t}catch(e){if(G.a.error("AdaApi::broadcastTrezorSignedTx error: "+Object(G.d)(e)),e instanceof ae.u)throw new ae.u;if(e instanceof ne.b)throw e;throw new ae.d}}async createLedgerSignTxData(e){try{var t;G.a.debug("AdaApi::createLedgerSignTxData called");const r=S()(t=Object(ge.c)(e.network)).call(t,(e,t)=>D()(e,t),{}),a=await Object(re.b)({signRequest:e.signRequest,byronNetworkMagic:r.ByronNetworkId,networkId:v()(r.ChainNetworkId,10),addressingMap:e.addressingMap});return G.a.debug("AdaApi::createLedgerSignTxData success: "+Object(G.c)(a)),{ledgerSignTxPayload:a}}catch(e){if(G.a.error("AdaApi::createLedgerSignTxData error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async broadcastLedgerSignedTx(e){G.a.debug("AdaApi::broadcastLedgerSignedTx called");try{G.a.debug("ledgerTx::broadcastLedgerSignedTx: called");const t=await e.sendTx(e.signedTxRequest);return G.a.debug("AdaApi::broadcastLedgerSignedTx success: "+Object(G.c)(t)),t}catch(e){if(G.a.error("AdaApi::broadcastLedgerSignedTx error: "+Object(G.d)(e)),e instanceof ae.u)throw new ae.u;if(e instanceof ne.b)throw e;throw new ae.d}}async createUnsignedTxForUtxos(e){G.a.debug("AdaApi::createUnsignedTxForUtxos called");try{var t;const n=S()(t=Object(ge.c)(e.network)).call(t,(e,t)=>D()(e,t),{}),s={keyDeposit:fe.a.WalletV4.BigNum.from_str(n.KeyDeposit),linearFee:fe.a.WalletV4.LinearFee.new(fe.a.WalletV4.BigNum.from_str(n.LinearFee.coefficient),fe.a.WalletV4.BigNum.from_str(n.LinearFee.constant)),minimumUtxoVal:fe.a.WalletV4.BigNum.from_str(n.MinimumUtxoVal),poolDeposit:fe.a.WalletV4.BigNum.from_str(n.PoolDeposit),networkId:e.network.NetworkId};let o;const i=void 0!==e.metadata?Object(L.a)(e.metadata):void 0;if(e.shouldSendAll){if(1!==e.receivers.length)throw new Error("createUnsignedTxForUtxos wrong output size for sendAll");const t=e.receivers[0];o=Object(J.d)(t,e.utxos,e.absSlotNumber,s,i)}else{var r,a;const t=e.amount,n=S()(r=e.receivers).call(r,(e,t)=>null!=t.addressing?(e.push({address:t.address,addressing:t.addressing}),e):e,[]);if(1!==n.length)throw new Error("createUnsignedTxForUtxos needs exactly one change address");const c=n[0],d=S()(a=e.receivers).call(a,(e,t)=>null==t.addressing?(e.push({address:t.address}),e):e,[]);if(d.length>1)throw new Error("createUnsignedTxForUtxos can't send to more than one address");o=Object(J.c)(1===d.length?[{address:d[0].address,amount:t}]:[],{address:c.address,addressing:c.addressing},e.utxos,e.absSlotNumber,s,[],[],!1,i)}return G.a.debug("AdaApi::createUnsignedTxForUtxos success: "+Object(G.c)(o)),new ce.a({senderUtxos:o.senderUtxos,unsignedTx:o.txBuilder,changeAddr:o.changeAddr,certificate:void 0},i,{ChainNetworkId:v()(n.ChainNetworkId,10),KeyDeposit:new _.a(n.KeyDeposit),PoolDeposit:new _.a(n.PoolDeposit),NetworkId:e.network.NetworkId},{neededHashes:new y.a,wits:new y.a})}catch(e){if(G.a.error("AdaApi::createUnsignedTxForUtxos error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async createUnsignedTx(e){const t=await e.publicDeriver.getAllUtxos(),r=g()(t).call(t,t=>g()(e).call(e,t)),a=Object(J.a)(r),n=[{address:e.receiver}];if(!e.shouldSendAll){const t=await e.publicDeriver.nextInternal();if(null==t.addressInfo)throw new Error("createUnsignedTx no internal addresses left. Should never happen");n.push({address:t.addressInfo.addr.Hash,addressing:t.addressInfo.addressing})}const s=e.shouldSendAll?{shouldSendAll:e.shouldSendAll}:{amount:e.amount};return this.createUnsignedTxForUtxos({absSlotNumber:e.absSlotNumber,receivers:n,network:e.publicDeriver.getParent().getNetworkInfo(),utxos:a,metadata:e.metadata,...s})}async createDelegationTx(t){G.a.debug("AdaApi::createDelegationTx called");try{var r;const a=S()(r=Object(ge.c)(t.publicDeriver.getParent().getNetworkInfo())).call(r,(e,t)=>D()(e,t),{}),s={keyDeposit:fe.a.WalletV4.BigNum.from_str(a.KeyDeposit),linearFee:fe.a.WalletV4.LinearFee.new(fe.a.WalletV4.BigNum.from_str(a.LinearFee.coefficient),fe.a.WalletV4.BigNum.from_str(a.LinearFee.constant)),minimumUtxoVal:fe.a.WalletV4.BigNum.from_str(a.MinimumUtxoVal),poolDeposit:fe.a.WalletV4.BigNum.from_str(a.PoolDeposit),networkId:t.publicDeriver.getParent().getNetworkInfo().NetworkId},o=await t.publicDeriver.getPublicKey();if(o.IsEncrypted)throw new Error("AdaApi::createDelegationTx public key is encrypted");const i=fe.a.WalletV4.Bip32PublicKey.from_bytes(e.from(o.Hash,"hex")),c=await t.publicDeriver.getStakingKey(),d=Object(Y.b)({addressing:c.addressing,startingFrom:{level:t.publicDeriver.getParent().getPublicDeriverLevel(),key:i}}).to_raw_key(),l=Object(U.b)(d,t.registrationStatus,t.poolRequest),u=await t.publicDeriver.getAllUtxos(),p=Object(J.a)(u),h=await t.publicDeriver.nextInternal();if(null==h.addressInfo)throw new Error("createDelegationTx no internal addresses left. Should never happen");const f=h.addressInfo,w=Object(J.c)([],{address:f.addr.Hash,addressing:f.addressing},p,t.absSlotNumber,s,l,[],!1),g=Object(U.c)(fe.a.WalletV4.StakeCredential.from_keyhash(d.hash()),u,!1),b=S()(g).call(g,(e,r)=>{var a;return e.joinAddMutable(new ye.a(A()(a=r.output.tokens).call(a,e=>({identifier:e.Token.Identifier,amount:new _.a(e.TokenList.Amount),networkId:e.Token.NetworkId})),t.publicDeriver.getParent().getDefaultToken()))},new ye.a([],t.publicDeriver.getParent().getDefaultToken())),I=function(t,r,a,s){const o=fe.a.WalletV4.StakeCredential.from_keyhash(a.hash()),i=new ye.a([],s);for(const e of t.senderUtxos){const t=n()(r).call(r,t=>t.output.Transaction.Hash===e.tx_hash&&t.output.UtxoTransactionOutput.OutputIndex===e.tx_index);if(null==t)throw new Error("getDifferenceAfterTx utxo not found. Should not happen");const a=t.address;var c;if(Object(U.a)(a,o,!0))i.joinAddMutable(new ye.a(A()(c=t.output.tokens).call(c,e=>({identifier:e.Token.Identifier,amount:new _.a(e.TokenList.Amount),networkId:e.Token.NetworkId})),s))}const d=new ye.a([],s);{const r=t.txBuilder.build().outputs();for(let t=0;t<r.len();t++){const a=r.get(t),n=e.from(a.address().to_bytes()).toString("hex");Object(U.a)(n,o,!0)&&d.add({amount:new _.a(a.amount().to_str()),identifier:s.defaultIdentifier,networkId:s.defaultNetworkId})}}return d.joinSubtractCopy(i)}(w,u,d,t.publicDeriver.getParent().getDefaultToken()),T=b.joinAddCopy(I).joinAddCopy(t.valueInAccount);return{signTxRequest:new ce.a({senderUtxos:w.senderUtxos,unsignedTx:w.txBuilder,changeAddr:w.changeAddr,certificate:void 0},void 0,{ChainNetworkId:v()(a.ChainNetworkId,10),KeyDeposit:new _.a(a.KeyDeposit),PoolDeposit:new _.a(a.PoolDeposit),NetworkId:t.publicDeriver.getParent().getNetworkInfo().NetworkId},{neededHashes:new y.a([e.from(fe.a.WalletV4.StakeCredential.from_keyhash(d.hash()).to_bytes()).toString("hex")]),wits:new y.a}),totalAmountToDelegate:T}}catch(e){if(G.a.error("AdaApi::createDelegationTx error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async createWithdrawalTx(t){G.a.debug("AdaApi::createUnsignedTx called");try{var r,a,n;const s=S()(r=Object(ge.c)(t.publicDeriver.getParent().getNetworkInfo())).call(r,(e,t)=>D()(e,t),{}),o={keyDeposit:fe.a.WalletV4.BigNum.from_str(s.KeyDeposit),linearFee:fe.a.WalletV4.LinearFee.new(fe.a.WalletV4.BigNum.from_str(s.LinearFee.coefficient),fe.a.WalletV4.BigNum.from_str(s.LinearFee.constant)),minimumUtxoVal:fe.a.WalletV4.BigNum.from_str(s.MinimumUtxoVal),poolDeposit:fe.a.WalletV4.BigNum.from_str(s.PoolDeposit),networkId:t.publicDeriver.getParent().getNetworkInfo().NetworkId},i=await t.publicDeriver.getAllUtxos(),c=Object(J.a)(i),d=await t.publicDeriver.nextInternal();if(null==d.addressInfo)throw new Error("createWithdrawalTx no internal addresses left. Should never happen");const l=d.addressInfo,u=[],p={neededHashes:new y.a,wits:new y.a},h=[];for(const r of t.withdrawals){const t=fe.a.WalletV4.RewardAddress.from_address(fe.a.WalletV4.Address.from_bytes(e.from(r.rewardAddress,"hex")));if(null==t)throw new Error("AdaApi::createUnsignedTx withdrawal not a reward address");const a=t.payment_cred(),n=a.to_keyhash();if(null==n)throw new Error("Unexpected: withdrawal from a script hash");h.push(n),r.shouldDeregister&&(u.push(fe.a.WalletV4.Certificate.new_stake_deregistration(fe.a.WalletV4.StakeDeregistration.new(a))),p.neededHashes.add(e.from(a.to_bytes()).toString("hex")))}const w=await t.getAccountState({network:t.publicDeriver.getParent().getNetworkInfo(),addresses:A()(a=t.withdrawals).call(a,e=>e.rewardAddress)}),g=S()(n=f()(w)).call(n,(t,r)=>{const a=w[r];if(null==a)return t;if(new _.a(a.remainingAmount).eq(0))return t;const n=fe.a.WalletV4.RewardAddress.from_address(fe.a.WalletV4.Address.from_bytes(e.from(r,"hex")));if(null==n)throw new Error("AdaApi::createUnsignedTx withdrawal not a reward address");{const t=n.payment_cred();p.neededHashes.add(e.from(t.to_bytes()).toString("hex"))}return t.push({address:n,amount:fe.a.WalletV4.BigNum.from_str(a.remainingAmount)}),t},[]);if(0===g.length&&0===u.length)throw new ae.z;const b=Object(J.c)([],{address:l.addr.Hash,addressing:l.addressing},c,t.absSlotNumber,o,u,g,!1);if(0===b.changeAddr.length)throw new ae.x;G.a.debug("AdaApi::createWithdrawalTx success: "+Object(G.c)(b));{const r=b.txBuilder.build();for(const a of t.withdrawals)if(null!=a.privateKey){const{privateKey:t}=a;p.wits.add(e.from(fe.a.WalletV4.make_vkey_witness(fe.a.WalletV4.hash_transaction(r),t).to_bytes()).toString("hex"))}}return new ce.a({senderUtxos:b.senderUtxos,unsignedTx:b.txBuilder,changeAddr:b.changeAddr,certificate:void 0},void 0,{ChainNetworkId:v()(s.ChainNetworkId,10),KeyDeposit:new _.a(s.KeyDeposit),PoolDeposit:new _.a(s.PoolDeposit),NetworkId:t.publicDeriver.getParent().getNetworkInfo().NetworkId},p)}catch(e){if(G.a.error("AdaApi::createWithdrawalTx error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async createVotingRegTx(e){G.a.debug("AdaApi::createVotingRegTx called");try{var t;const r=S()(t=Object(ge.c)(e.publicDeriver.getParent().getNetworkInfo())).call(t,(e,t)=>D()(e,t),{}),a={keyDeposit:fe.a.WalletV4.BigNum.from_str(r.KeyDeposit),linearFee:fe.a.WalletV4.LinearFee.new(fe.a.WalletV4.BigNum.from_str(r.LinearFee.coefficient),fe.a.WalletV4.BigNum.from_str(r.LinearFee.constant)),minimumUtxoVal:fe.a.WalletV4.BigNum.from_str(r.MinimumUtxoVal),poolDeposit:fe.a.WalletV4.BigNum.from_str(r.PoolDeposit),networkId:e.publicDeriver.getParent().getNetworkInfo().NetworkId},n=await e.publicDeriver.getAllUtxos(),s=Object(J.a)(n),o=await e.publicDeriver.nextInternal();if(null==o.addressInfo)throw new Error("createVotingRegTx no internal addresses left. Should never happen");const i=o.addressInfo,c=Object(L.a)(e.metadata),d=Object(J.c)([],{address:i.addr.Hash,addressing:i.addressing},s,e.absSlotNumber,a,[],[],!1,c);return new ce.a({senderUtxos:d.senderUtxos,unsignedTx:d.txBuilder,changeAddr:d.changeAddr,certificate:void 0},c,{ChainNetworkId:v()(r.ChainNetworkId,10),KeyDeposit:new _.a(r.KeyDeposit),PoolDeposit:new _.a(r.PoolDeposit),NetworkId:e.publicDeriver.getParent().getNetworkInfo().NetworkId},{neededHashes:new y.a,wits:new y.a})}catch(e){if(G.a.error("AdaApi::createVotingRegTx error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async saveLastReceiveAddressIndex(e){G.a.debug("AdaApi::saveLastReceiveAddressIndex called");try{const t=Object(q.c)(e.publicDeriver);if(null==t)return;await t.setCutoff({newIndex:e.index})}catch(e){if(G.a.error("AdaApi::saveLastReceiveAddressIndex error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}static isValidMnemonic(e){return Object(z.a)(e.mnemonic,e.numberOfWords)}isValidPaperMnemonic(e){return Object(Q.a)(e.mnemonic,e.numberOfWords)}unscramblePaperMnemonic(e){return Object(Q.c)(e.mnemonic,e.numberOfWords,e.password)}generateWalletRecoveryPhrase(){G.a.debug("AdaApi::generateWalletRecoveryPhrase called");try{const e=new p.a(e=>e(Object(X.a)()));return G.a.debug("AdaApi::generateWalletRecoveryPhrase success"),e}catch(e){if(G.a.error("AdaApi::generateWalletRecoveryPhrase error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async restoreWallet(t){G.a.debug("AdaApi::restoreWallet called");const{recoveryPhrase:r,walletName:a,walletPassword:n}=t;if(t.accountIndex<j.g)throw new Error("restoreWallet needs hardened index");try{const s=Object(X.d)(r),o=[];if("bip44"===t.mode){const r=await Object(R.b)({db:t.db,rootPk:fe.a.WalletV2.Bip44RootPrivateKey.new(fe.a.WalletV2.PrivateKey.from_hex(e.from(s.as_bytes()).toString("hex")),fe.a.WalletV2.DerivationScheme.v2()),password:n,accountIndex:t.accountIndex,walletName:a,accountName:"",network:t.network}),i=await M.a.createBip44Wallet(t.db,r.bip44WrapperRow);for(const e of r.publicDeriver)o.push(await $.a.createPublicDeriver(e.publicDeriverResult,i))}else{if("cip1852"!==t.mode)throw new Error("restoreWallet unknown restoration mode");{const e=await Object(B.b)({db:t.db,rootPk:s,password:n,accountIndex:t.accountIndex,walletName:a,accountName:"",network:t.network}),r=await F.a.createCip1852Wallet(t.db,e.cip1852WrapperRow);for(const t of e.publicDeriver)o.push(await $.a.createPublicDeriver(t.publicDeriverResult,r))}}return G.a.debug("AdaApi::restoreWallet success"),{publicDerivers:o}}catch(e){var s;if(G.a.error("AdaApi::restoreWallet error: "+Object(G.d)(e)),null!=e.message&&l()(s=e.message).call(s,"Wallet with that mnemonics already exists"))throw new ae.E;if(e instanceof ne.b)throw e;throw new ae.d}}async restoreWalletForTransfer(t){var r;G.a.debug("AdaApi::restoreWalletForTransfer called");const{checkAddressesInUse:a}=t,n=S()(r=Object(ge.c)(t.network)).call(r,(e,t)=>D()(e,t),{});try{const r=new c.a,s=new y.a,i=e=>{if(!s.has(e.address.data)){let t=r.get(e.keyDerivationId);null==t&&(t=[],r.set(e.keyDerivationId,t)),t.push(e.address.data),s.add(e.address.data)}return p.a.resolve()};let d;if("bip44"===t.transferSource){const e=fe.a.WalletV2.Bip44AccountPublic.new(Object(Y.c)(t.accountPubKey),fe.a.WalletV2.DerivationScheme.v2());d=await Object(se.a)({network:t.network,generateInternalAddresses:Object(oe.b)(e.bip44_chain(!1),n.ByronNetworkId),generateExternalAddresses:Object(oe.b)(e.bip44_chain(!0),n.ByronNetworkId),lastUsedInternal:-1,lastUsedExternal:-1,checkAddressesInUse:a,addByHash:i,type:we.b.CARDANO_LEGACY})}else{if("cip1852"!==t.transferSource)throw new Error(`restoreWalletForTransfer unexpected wallet type ${t.transferSource}`);{const r=t.accountPubKey.derive(j.c.CHIMERIC_ACCOUNT).derive(j.h).to_raw_key(),n=await Object(ie.c)({network:t.network,accountPublicKey:e.from(t.accountPubKey.as_bytes()).toString("hex"),lastUsedInternal:-1,lastUsedExternal:-1,checkAddressesInUse:a,addByHash:i,stakingKey:r});d=g()(n).call(n,e=>e.index===j.c.EXTERNAL||e.index===j.c.INTERNAL)}}const l=Object(H.c)(d),u=[];for(let e=0;e<l.length;e++){const a=l[e];await a.insert({db:null,tx:null,lockedTables:[],keyDerivationId:e});const n=r.get(e);if(null==n)throw new Error("restoreWalletForTransfer should never happen");const s=A()(n).call(n,e=>{var r;return{address:e,addressing:{startLevel:H.a.ACCOUNT.level,path:o()(r=[t.accountIndex]).call(r,a.path)}}});u.push(...s)}return G.a.debug("restoreWalletForTransfer success"),{addresses:u}}catch(e){var s;if(G.a.error("restoreWalletForTransfer error: "+Object(G.d)(e)),null!=e.message&&l()(s=e.message).call(s,"Wallet with that mnemonics already exists"))throw new ae.E;if(e instanceof ne.b)throw e;throw new ae.d}}async transferToCip1852(t){try{var r,a;const n=await this.restoreWalletForTransfer({accountPubKey:t.bip44AccountPubKey,accountIndex:t.accountIndex,checkAddressesInUse:t.checkAddressesInUse,transferSource:"bip44",network:t.network}),s=await this.restoreWalletForTransfer({accountPubKey:t.bip44AccountPubKey,accountIndex:t.accountIndex,checkAddressesInUse:t.checkAddressesInUse,transferSource:"cip1852",network:t.network}),o=t.cip1852AccountPubKey.derive(j.c.INTERNAL).derive(0).to_raw_key().hash(),i=t.cip1852AccountPubKey.derive(j.c.CHIMERIC_ACCOUNT).derive(0).to_raw_key().hash(),c=S()(r=Object(ge.c)(t.network)).call(r,(e,t)=>D()(e,t),{}),d=v()(c.ChainNetworkId,10),l=fe.a.WalletV4.BaseAddress.new(d,fe.a.WalletV4.StakeCredential.from_keyhash(o),fe.a.WalletV4.StakeCredential.from_keyhash(i)),u=A()(a=[...n.addresses,...s.addresses]).call(a,e=>({address:e.address,addressing:{path:[j.i.BIP44,j.d.CARDANO,...e.addressing.path],startLevel:H.a.PURPOSE.level}})),p=await Object(be.a)({network:t.network,addresses:u,getUTXOsForAddresses:t.getUTXOsForAddresses});return{publicKey:{key:t.bip44AccountPubKey,addressing:{startLevel:1,path:[j.i.CIP1852,j.d.CARDANO,t.accountIndex]}},signRequest:await this.createUnsignedTxForUtxos({absSlotNumber:t.absSlotNumber,receivers:[{address:e.from(l.to_address().to_bytes()).toString("hex"),addressing:{path:[j.i.CIP1852,j.d.CARDANO,t.accountIndex,j.c.INTERNAL,0],startLevel:1}}],network:t.network,shouldSendAll:!0,utxos:p,metadata:void 0})}}catch(e){if(G.a.error("transferToCip1852 error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async createHardwareWallet(t){try{var r;G.a.debug("AdaApi::createHardwareWallet called");const a=S()(r=Object(ge.c)(t.network)).call(r,(e,t)=>D()(e,t),{});if(t.addressing.startLevel!==H.a.PURPOSE.level)throw new Error("AdaApi::createHardwareWallet bad addressing start level");if(t.addressing.path[0]===j.i.BIP44){const e=await Object(R.a)({db:t.db,settings:fe.a.WalletV2.BlockchainSettings.from_json({protocol_magic:a.ByronNetworkId}),accountPublicKey:fe.a.WalletV2.Bip44AccountPublic.new(fe.a.WalletV2.PublicKey.from_hex(t.publicKey),fe.a.WalletV2.DerivationScheme.v2()),accountIndex:t.addressing.path[H.a.ACCOUNT.level-t.addressing.startLevel],walletName:t.walletName,accountName:"",hwWalletMetaInsert:t.hwFeatures,network:t.network}),r=await M.a.createBip44Wallet(t.db,e.bip44WrapperRow);if(1!==e.publicDeriver.length)throw new Error("AdaApi::createHardwareWallet should only do 1 HW derivation at a time");const n=e.publicDeriver[0].publicDeriverResult,s=await $.a.createPublicDeriver(n,r);return G.a.debug("AdaApi::restoreWallet success"),{publicDeriver:s}}if(t.addressing.path[0]===j.i.CIP1852){const r=await Object(B.a)({db:t.db,accountPublicKey:fe.a.WalletV4.Bip32PublicKey.from_bytes(e.from(t.publicKey,"hex")),accountIndex:t.addressing.path[H.a.ACCOUNT.level-t.addressing.startLevel],walletName:t.walletName,accountName:"",hwWalletMetaInsert:t.hwFeatures,network:t.network}),a=await F.a.createCip1852Wallet(t.db,r.cip1852WrapperRow);if(1!==r.publicDeriver.length)throw new Error("AdaApi::createHardwareWallet should only do 1 HW derivation at a time");const n=r.publicDeriver[0].publicDeriverResult,s=await $.a.createPublicDeriver(n,a);return G.a.debug("AdaApi::restoreWallet success"),{publicDeriver:s}}throw new Error("createHardwareWallet unknown restoration mode")}catch(e){if(G.a.error("AdaApi::createHardwareWallet error: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}async getTransactionRowsToExport(e){try{const t=await Object(K.a)({publicDeriver:e.publicDeriver});return G.a.debug("AdaApi::getTransactionRowsToExport: success"),Object(pe.a)(t.txs,e.getDefaultToken(e.publicDeriver.getParent().getNetworkInfo().NetworkId))}catch(e){if(G.a.error("AdaApi::getTransactionRowsToExport: "+Object(G.d)(e)),e instanceof ne.b)throw e;throw new ae.d}}}async function ve(t){try{const r=await t.publicDeriver.getSigningKey(),a=await t.publicDeriver.getStakingKey(),n=await t.publicDeriver.normalizeKey({...r,password:t.password}),s=fe.a.WalletV4.Bip32PrivateKey.from_bytes(e.from(n.prvKeyHex,"hex"));return Object(Y.a)({addressing:a.addressing,startingFrom:{key:s,level:t.publicDeriver.getParent().getPublicDeriverLevel()}}).to_raw_key()}catch(e){if(G.a.error("genOwnStakingKey error: "+Object(G.d)(e)),e instanceof de.a)throw new ae.t;if(e instanceof ne.b)throw e;throw new ae.d}}}).call(this,r(48).Buffer)},463:function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return m})),r.d(t,"c",(function(){return x})),r.d(t,"a",(function(){return A}));var a=r(35),n=r.n(a),s=r(66),o=r.n(s),i=r(1295),c=r.n(i),d=r(113),l=r.n(d),u=r(68),p=r.n(u),h=r(8),f=r.n(h),w=r(176),g=(r(144),r(240)),b=r(6),y=r(60),I=r(53),v=r(19),T=r(261);async function m(t){const r=t.signRequest.signRequest.unsignedTx.build(),a=function(e){for(const t of e)Object(w.c)(t.addressing);return f()(e).call(e,e=>({txHashHex:e.tx_hash,outputIndex:e.tx_index,path:e.addressing.path}))}(t.signRequest.signRequest.senderUtxos),n=function(t){const r=[];for(let n=0;n<t.txOutputs.len();n++){var a;const s=t.txOutputs.get(n),o=s.address(),i=Object(y.k)(s.address()),c=p()(a=t.changeAddrs).call(a,e=>i===e.address);if(null!=c){Object(w.c)(c.addressing);const e=x({networkId:t.networkId,address:o,path:c.addressing.path,addressingMap:t.addressingMap});r.push({addressTypeNibble:e.addressTypeNibble,spendingPath:e.spendingPath,stakingBlockchainPointer:e.stakingBlockchainPointer,stakingKeyHashHex:e.stakingKeyHashHex,stakingPath:e.stakingPath,amountStr:s.amount().to_str()})}else r.push({addressHex:e.from(o.to_bytes()).toString("hex"),amountStr:s.amount().to_str()})}return r}({networkId:t.networkId,txOutputs:r.outputs(),changeAddrs:t.signRequest.signRequest.changeAddr,addressingMap:t.addressingMap}),s=r.withdrawals(),o=r.certs(),i=[];null!=s&&s.len()>0&&i.push(...function(t,r){const a=[],n=l()(t).call(t);for(let s=0;s<n.len();s++){const o=n.get(s),i=t.get(o);if(null==i)throw new Error("formatLedgerWithdrawals should never happen");const c=e.from(o.to_address().to_bytes()).toString("hex"),d=r(c);if(null==d)throw new Error(`formatLedgerWithdrawals Ledger can only withdraw from own address ${c}`);a.push({amountStr:i.to_str(),path:d.path})}return a}(s,t.addressingMap));const c=[];return null!=o&&o.len()>0&&c.push(...function(t,r,a){const n=r=>{const n=b.a.WalletV4.RewardAddress.new(t,r),s=e.from(n.to_address().to_bytes()).toString("hex"),o=a(s);if(null==o)throw new Error(`getPath Ledger only supports certificates from own address ${s}`);return o.path},s=[];for(let t=0;t<r.len();t++){const a=r.get(t),o=a.as_stake_registration();if(null!=o){s.push({type:g.CertificateTypes.STAKE_REGISTRATION,path:n(o.stake_credential()),poolKeyHashHex:void 0,poolRegistrationParams:void 0});continue}const i=a.as_stake_deregistration();if(null!=i){s.push({type:g.CertificateTypes.STAKE_DEREGISTRATION,path:n(i.stake_credential()),poolKeyHashHex:void 0,poolRegistrationParams:void 0});continue}const c=a.as_stake_delegation();if(null==c)throw new Error("formatLedgerCertificates Ledger doesn't support this certificate type");s.push({type:g.CertificateTypes.STAKE_DELEGATION,path:n(c.stake_credential()),poolKeyHashHex:e.from(c.pool_keyhash().to_bytes()).toString("hex"),poolRegistrationParams:void 0})}return s}(t.networkId,o,t.addressingMap)),{inputs:a,outputs:n,feeStr:r.fee().to_str(),ttlStr:r.ttl().toString(),protocolMagic:t.byronNetworkMagic,withdrawals:i,certificates:c,metadataHashHex:void 0,networkId:t.networkId}}function x(t){{const e=b.a.WalletV4.ByronAddress.from_address(t.address);if(e)return{addressTypeNibble:g.AddressTypeNibbles.BYRON,networkIdOrProtocolMagic:e.byron_protocol_magic(),spendingPath:t.path,stakingPath:void 0,stakingKeyHashHex:void 0,stakingBlockchainPointer:void 0}}{const a=b.a.WalletV4.BaseAddress.from_address(t.address);if(a){const n=b.a.WalletV4.RewardAddress.new(t.networkId,a.stake_cred()),s=e.from(n.to_address().to_bytes()).toString("hex"),o=t.addressingMap(s);let i;if(null==o){var r;const t=a.stake_cred(),n=null!==(r=t.to_keyhash())&&void 0!==r?r:t.to_scripthash();if(null==n)throw new Error("toLedgerAddressParameters unknown hash type");i={stakingPath:void 0,stakingKeyHashHex:e.from(n.to_bytes()).toString("hex")}}else i={stakingPath:o.path,stakingKeyHashHex:void 0};return{addressTypeNibble:g.AddressTypeNibbles.BASE,networkIdOrProtocolMagic:a.to_address().network_id(),spendingPath:t.path,...i,stakingBlockchainPointer:void 0}}}{const e=b.a.WalletV4.PointerAddress.from_address(t.address);if(e){const r=e.stake_pointer();return{addressTypeNibble:g.AddressTypeNibbles.POINTER,networkIdOrProtocolMagic:e.to_address().network_id(),spendingPath:t.path,stakingPath:void 0,stakingKeyHashHex:void 0,stakingBlockchainPointer:{blockIndex:r.slot(),txIndex:r.tx_index(),certificateIndex:r.cert_index()}}}}{const e=b.a.WalletV4.EnterpriseAddress.from_address(t.address);if(e)return{addressTypeNibble:g.AddressTypeNibbles.ENTERPRISE,networkIdOrProtocolMagic:e.to_address().network_id(),spendingPath:t.path,stakingPath:void 0,stakingKeyHashHex:void 0,stakingBlockchainPointer:void 0}}{const e=b.a.WalletV4.RewardAddress.from_address(t.address);if(e)return{addressTypeNibble:g.AddressTypeNibbles.REWARD,networkIdOrProtocolMagic:e.to_address().network_id(),spendingPath:t.path,stakingPath:void 0,stakingKeyHashHex:void 0,stakingBlockchainPointer:void 0}}throw new Error("toLedgerAddressParameters unknown address type")}function A(t,r,a,s,i){const d=(e,t)=>e.length===t.length&&c()(e).call(e,(e,r)=>e===t[r]),l=e=>{for(const t of a)if(d(t.path,e))return t.witnessSignatureHex;throw new Error(`buildSignedTransaction no witness for ${o()(e)}`)},u=s.addressing.startLevel+s.addressing.path.length-1,p=b.a.WalletV4.TransactionWitnessSet.new(),h=[],f=[],g=new n.a,y=new n.a;for(const t of r){Object(w.c)(t.addressing);const r=l(t.addressing.path),a=Object(T.b)({addressing:t.addressing,startingFrom:{level:u,key:s.key}});if(b.a.WalletV4.ByronAddress.is_valid(t.receiver)){const n=b.a.WalletV4.ByronAddress.from_base58(t.receiver),s=b.a.WalletV4.BootstrapWitness.new(b.a.WalletV4.Vkey.new(a.to_raw_key()),b.a.WalletV4.Ed25519Signature.from_bytes(e.from(r,"hex")),a.chaincode(),n.attributes()),o=e.from(s.to_bytes()).toString("hex");if(y.has(o))continue;y.add(o),h.push(s);continue}const n=b.a.WalletV4.Vkeywitness.new(b.a.WalletV4.Vkey.new(a.to_raw_key()),b.a.WalletV4.Ed25519Signature.from_bytes(e.from(r,"hex"))),o=e.from(n.to_bytes()).toString("hex");g.has(o)||(g.add(o),f.push(n))}for(const t of a){const r={path:t.path,startLevel:1};if(Object(w.c)(r),t.path[I.a.CHAIN.level-1]===v.c.CHIMERIC_ACCOUNT){const a=Object(T.b)({addressing:r,startingFrom:{level:u,key:s.key}}),n=b.a.WalletV4.Vkeywitness.new(b.a.WalletV4.Vkey.new(a.to_raw_key()),b.a.WalletV4.Ed25519Signature.from_bytes(e.from(t.witnessSignatureHex,"hex"))),o=e.from(n.to_bytes()).toString("hex");if(g.has(o))continue;g.add(o),f.push(n)}}if(h.length>0){const e=b.a.WalletV4.BootstrapWitnesses.new();for(const t of h)e.add(t);p.set_bootstraps(e)}if(f.length>0){const e=b.a.WalletV4.Vkeywitnesses.new();for(const t of f)e.add(t);p.set_vkeys(e)}return b.a.WalletV4.Transaction.new(t,p,i)}}).call(this,r(48).Buffer)},464:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var a=r(56),n=r.n(a),s=r(8),o=r.n(s),i=r(43),c=r(10),d=r(23);async function l(e){var t,r;const a=await e.getUTXOsForAddresses({addresses:o()(t=e.addresses).call(t,e=>e.address),network:e.network}),s=new n.a(o()(r=e.addresses).call(r,e=>[e.address,{addressing:e.addressing}])),l=o()(a).call(a,e=>{const t=s.get(e.receiver);if(null==t)throw new Error(`toSenderUtxos should never happen ${e.receiver}`);return{...e,addressing:t.addressing}});if(Object(i.isEmpty)(a)){const e=new d.v;throw c.a.error(`utils::toSenderUtxos ${Object(c.d)(e)}`),e}return l}},467:function(e,t,r){"use strict";r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return u})),r.d(t,"a",(function(){return p}));var a=r(30),n=r.n(a),s=r(43),o=(r(29),r(10)),i=r(23),c=r(6),d=r(1346);function l(e){try{const{checker:t,fullUtxo:r}=e,a={};for(const e of r){const r=c.a.WalletV2.Address.from_base58(e),n=t.check_address(r);if(n.is_checked()){const t=n.private_key();a[e]=t}}return a}catch(e){throw o.a.error(`legacyDaedalus::getAddressesKeys ${Object(o.d)(e)}`),new i.f}}async function u(e){const t=await e.getUTXOsForAddresses({network:e.network,addresses:n()(e.addressKeys)});if(Object(s.isEmpty)(t)){const e=new i.v;throw o.a.error(`legacyDaedalus::toSenderUtxos ${Object(o.d)(e)}`),e}return t}async function p(e){const t=await u({network:e.network,addressKeys:e.addressKeys,getUTXOsForAddresses:e.getUTXOsForAddresses});return Object(d.a)({outputAddr:e.outputAddr,addressKeys:e.addressKeys,senderUtxos:t,absSlotNumber:e.absSlotNumber,protocolParams:e.protocolParams})}},493:function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return g})),r.d(t,"a",(function(){return b})),r.d(t,"c",(function(){return y}));var a=r(11),n=r.n(a),s=r(90),o=r.n(s),i=r(32),c=r.n(i),d=r(8),l=r.n(d),u=r(21),p=r(29),h=r.n(p),f=r(49),w=r(142);r(6);function g(e,t){const r=[];for(const i of e){var a,n,s,o;if(null!=i.block)r.push({date:i.block.BlockTime,type:i.type===w.a.INCOME?"in":"out",amount:Object(f.a)(null!==(a=null===(n=i.amount.get(t.Identifier))||void 0===n?void 0:n.abs().shiftedBy(-t.Metadata.numberOfDecimals))&&void 0!==a?a:new h.a(0)),fee:Object(f.a)(null!==(s=null===(o=i.fee.get(t.Identifier))||void 0===o?void 0:o.abs().shiftedBy(-t.Metadata.numberOfDecimals))&&void 0!==s?s:new h.a(0))})}return r}function b(e){return l()(e).call(e,e=>{var t;const r=e.output.UtxoTransactionOutput;if(null==r.ErgoCreationHeight||null==r.ErgoBoxId||null==r.ErgoTree)throw new Error("asAddressedUtxo missing Ergo fields for Ergo UTXO");const{ErgoCreationHeight:a,ErgoBoxId:n,ErgoTree:s}=r,o=c()(t=e.output.tokens).call(t,(e,t)=>(t.Token.Identifier===u.c.Ergo?e.amount=e.amount.plus(t.TokenList.Amount):e.tokens.push({amount:Number(t.TokenList.Amount),tokenId:t.Token.Identifier}),e),{amount:new h.a(0),tokens:[]});return{amount:o.amount.toString(),receiver:e.address,tx_hash:e.output.Transaction.Hash,tx_index:e.output.UtxoTransactionOutput.OutputIndex,addressing:e.addressing,creationHeight:a,boxId:n,assets:o.tokens,additionalRegisters:null==e.output.UtxoTransactionOutput.ErgoRegisters?void 0:JSON.parse(e.output.UtxoTransactionOutput.ErgoRegisters),ergoTree:s}})}function y(e){return l()(e).call(e,e=>{var t,r;return{boxId:e.boxId,value:o()(e.amount,10),ergoTree:e.ergoTree,assets:l()(t=null!==(r=e.assets)&&void 0!==r?r:[]).call(t,e=>({amount:e.amount,tokenId:e.tokenId})),creationHeight:e.creationHeight,additionalRegisters:e.additionalRegisters||n()({}),transactionId:e.tx_hash,index:e.tx_index}})}}).call(this,r(48).Buffer)},494:function(e,t,r){"use strict";r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return d})),r.d(t,"a",(function(){return l}));var a=r(29),n=r.n(a),s=r(6),o=r(142),i=r(49);function c(e,t){if(null==t)return s.a.WalletV3.PayloadAuthData.for_no_payload();switch(t.get_type()){case s.a.WalletV3.CertificateKind.StakeDelegation:return s.a.WalletV3.PayloadAuthData.for_stake_delegation(s.a.WalletV3.StakeDelegationAuthData.new(e));default:throw new Error("generateAuthData unexpected cert type "+t.get_type())}}function d(e){const t=s.a.WalletV3.PerCertificateFee.new(),r=e.per_certificate_fees;return r&&(null!=r.certificate_pool_registration&&t.set_pool_registration(s.a.WalletV3.Value.from_str(r.certificate_pool_registration)),null!=r.certificate_stake_delegation&&t.set_stake_delegation(s.a.WalletV3.Value.from_str(r.certificate_stake_delegation)),null!=r.certificate_owner_stake_delegation&&t.set_owner_stake_delegation(s.a.WalletV3.Value.from_str(r.certificate_owner_stake_delegation))),s.a.WalletV3.Fee.linear_fee(s.a.WalletV3.Value.from_str(e.constant),s.a.WalletV3.Value.from_str(e.coefficient),s.a.WalletV3.Value.from_str(e.certificate),t)}function l(e,t){const r=[];for(const l of e){var a,s,c,d;if(null!=l.block)r.push({date:l.block.BlockTime,type:l.type===o.a.INCOME?"in":"out",amount:Object(i.a)(null!==(a=null===(s=l.amount.get(t.Identifier))||void 0===s?void 0:s.abs().shiftedBy(-t.Metadata.numberOfDecimals))&&void 0!==a?a:new n.a(0)),fee:Object(i.a)(null!==(c=null===(d=l.fee.get(t.Identifier))||void 0===d?void 0:d.abs().shiftedBy(-t.Metadata.numberOfDecimals))&&void 0!==c?c:new n.a(0))})}return r}},50:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var a=r(30),n=r.n(a),s=r(8),o=r.n(s),i=r(37),c=r.n(i),d=r(11),l=r.n(d),u=r(1),p=r.n(u),h=r(138),f=r(151),w=(r(77),r(15)),g=r(86),b=r(119),y=r(25),I=r(33);class v{constructor(e){return p()(this,"publicDeriverId",void 0),p()(this,"parent",void 0),p()(this,"derivationId",void 0),p()(this,"pathToPublic",void 0),p()(this,"getFullPublicDeriverInfo",async()=>{var e,t;const r=l()({GetPublicDeriver:g.e}),a=c()(e=o()(t=n()(r)).call(t,e=>r[e])).call(e,e=>Object(w.g)(this.getDb(),e));return await Object(w.m)(this.getDb(),a,async e=>{const t=await r.GetPublicDeriver.get(this.getDb(),e,this.publicDeriverId);if(null==t)throw new w.a("getFullPublicDeriverInfo PublicDeriver==null");return t})}),p()(this,"rawRename",async(e,t,r)=>await t.ModifyPublicDeriver.rename(this.getDb(),e,{pubDeriverId:this.publicDeriverId,newName:r.newName})),p()(this,"rename",async e=>{var t,r;const a=l()({ModifyPublicDeriver:b.f}),s=c()(t=o()(r=n()(a)).call(r,e=>a[e])).call(t,e=>Object(w.g)(this.getDb(),e));return await Object(w.m)(this.getDb(),s,async t=>this.rawRename(t,a,e))}),p()(this,"rawGetLastSyncInfo",async(e,t,r)=>await t.GetLastSyncForPublicDeriver.forId(this.getDb(),e,this.publicDeriverId)),p()(this,"getLastSyncInfo",async e=>{var t,r;const a=l()({GetLastSyncForPublicDeriver:g.d}),s=c()(t=o()(r=n()(a)).call(r,e=>a[e])).call(t,e=>Object(w.g)(this.getDb(),e));return await Object(w.m)(this.getDb(),s,async t=>this.rawGetLastSyncInfo(t,a,e))}),this.publicDeriverId=e.publicDeriverId,this.parent=e.parent,this.pathToPublic=e.pathToPublic,this.derivationId=e.derivationId,this}getDb(){return this.parent.getDb()}getPublicDeriverId(){return this.publicDeriverId}getParent(){return this.parent}getPathToPublic(){return this.pathToPublic}getDerivationId(){return this.derivationId}static async createPublicDeriver(e,t){return await async function(e,t,r){const a=await async function(e,t){var r,a;const s=l()({GetKeyDerivation:y.j}),i=c()(r=o()(a=n()(s)).call(a,e=>s[e])).call(r,t=>Object(w.g)(e,t));return await Object(w.m)(e,i,async r=>{const a=await s.GetKeyDerivation.get(e,r,t);if(void 0===a)throw new w.a("getKeyDerivation keyDerivationRow");return a})}(e,t.KeyDerivationId);if(r instanceof h.a){const n=await Object(I.a)({db:e,pubDeriver:t,pubDeriverKeyDerivation:a,conceptualWallet:r,startClass:v});return new(0,n.finalClass)({publicDeriverId:t.PublicDeriverId,parent:r,pathToPublic:n.pathToPublic,derivationId:a.KeyDerivationId})}if(r instanceof f.a){const n=await Object(I.b)(e,t,a,r,v);return new(0,n.finalClass)({publicDeriverId:t.PublicDeriverId,parent:r,pathToPublic:n.pathToPublic,derivationId:a.KeyDerivationId})}throw new Error("refreshPublicDeriverFunctionality unknown wallet type")}(t.getDb(),e,t)}}},53:function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return x})),r.d(t,"c",(function(){return A}));var a,n,s,o,i,c=r(84),d=r.n(c),l=r(37),u=r.n(l),p=r(30),h=r.n(p),f=r(8),w=r.n(f),g=r(56),b=r.n(g),y=r(11),I=r.n(y),v=r(200),T=r(16);const m=I()({ROOT:{level:0,table:v.e,extra:[]},PURPOSE:{level:1,table:v.d,extra:[]},COIN_TYPE:{level:2,table:v.c,extra:[]},ACCOUNT:{level:3,table:v.a,extra:[]},CHAIN:{level:4,table:v.b,extra:[]},ADDRESS:{level:5,table:T.d,extra:[T.a,T.b,T.g]}}),x=new b.a([...w()(a=w()(n=h()(m)).call(n,e=>m[e])).call(a,e=>[e.level,e.table.name]),...w()(s=u()(o=w()(i=h()(m)).call(i,e=>m[e])).call(o,e=>e.extra)).call(s,(e,t)=>[1e3+t,e.name])]);function A(e){const t=[];for(const a of e)if(null!=a.children){const e=A(a.children);for(const n of e){var r;t.push({path:d()(r=[a.index]).call(r,n.path),insert:n.insert})}}else t.push({path:[a.index],insert:a.insert});return t}},554:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var a=r(11),n=r.n(a),s=r(1),o=r.n(s),i=r(656),c=r(201),d=r(62),l=r(15);class u{static async add(e,t,r){return await Object(l.c)(e,t,r,u.ownTables[c.a.name].name)}static async remove(e,t,r){const a=await u.depTables.GetCip1852Wrapper.get(e,t,r);if(null==a)throw new Error("ModifyCip1852Wrapper::remove Should never happen");await u.depTables.RemoveKeyDerivationTree.remove(e,t,{rootKeyId:a.RootKeyDerivationId})}}o()(u,"ownTables",n()({[c.a.name]:c.a})),o()(u,"depTables",n()({GetCip1852Wrapper:i.b,RemoveKeyDerivationTree:d.l}))},555:function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return T})),r.d(t,"a",(function(){return m})),r.d(t,"c",(function(){return x}));var a=r(68),n=r.n(a),s=r(35),o=r.n(s),i=r(40),c=r.n(i),d=r(8),l=r.n(d),u=r(43),p=(r(22),r(19)),h=r(239),f=r(6),w=r(188),g=r(53),b=r(130),y=r(195),I=r(120);async function v(e,t,r){const a=Object(u.range)(0,p.a),n=l()(a).call(a,r=>t.bip44_chain(!1).address_key(f.a.WalletV2.AddressKeyIndex.new(r)).bootstrap_era_address(e).to_base58()),s=l()(a).call(a,r=>t.bip44_chain(!0).address_key(f.a.WalletV2.AddressKeyIndex.new(r)).bootstrap_era_address(e).to_base58());return[{index:0,insert:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:0}),children:l()(a).call(a,e=>({index:e,insert:async t=>await Object(y.a)(r,t,n[e])}))},{index:1,insert:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:l()(a).call(a,e=>({index:e,insert:async t=>await Object(y.a)(r,t,s[e])}))}]}async function T(t){if(t.accountIndex<p.g)throw new Error("createStandardBip44Wallet needs hardened index");const r=Object(w.b)(t.password,e.from(t.rootPk.key().to_hex(),"hex")),a=t.rootPk.bip44_account(f.a.WalletV2.AccountIndex.new(t.accountIndex)).public();if(null==t.network.BaseConfig[0].ByronNetworkId)throw new Error("createStandardBip44Wallet missing Byron network id");const n=f.a.WalletV2.BlockchainSettings.from_json({protocol_magic:t.network.BaseConfig[0].ByronNetworkId}),s=await v(n,a,Object(b.a)(new o.a)),i=[];let d;return d=await h.a.start(t.db,g.b).addConceptualWallet(e=>({NetworkId:t.network.NetworkId,Name:t.walletName})).addFromRoot(e=>({rootInsert:{privateKeyInfo:{Hash:r,IsEncrypted:!0,PasswordLastUpdate:null,Type:I.a.BIP32ED25519},publicKeyInfo:null,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:null,Index:null}),levelInfo:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId})},tree:e=>({derivationId:e,children:[]})})).addBip44Wrapper(e=>({ConceptualWalletId:e.conceptualWalletRow.ConceptualWalletId,SignerLevel:g.a.ROOT.level,PublicDeriverLevel:g.a.ACCOUNT.level,PrivateDeriverKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId,PrivateDeriverLevel:i.length,RootKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId})).derivePublicDeriver(e=>{const r=e.bip44WrapperRow.PrivateDeriverKeyDerivationId,a=e.bip44WrapperRow.PrivateDeriverLevel;if(null==r||null==a)throw new Error("createStandardBip44Wallet missing private deriver");return{deriverRequest:{decryptPrivateDeriverPassword:t.password,publicDeriverMeta:{name:t.accountName},path:[{index:p.i.BIP44,insert:{}},{index:p.d.CARDANO,insert:{}},{index:t.accountIndex,insert:{}}],initialDerivations:s},privateDeriverKeyDerivationId:r,privateDeriverLevel:a}}).commit(),d}async function m(e){if(e.accountIndex<p.g)throw new Error("createHardwareWallet needs hardened index");const t=await v(e.settings,e.accountPublicKey,Object(b.a)(new o.a));let r;return r=await h.a.start(e.db,g.b).addConceptualWallet(t=>({NetworkId:e.network.NetworkId,Name:e.walletName})).addFromRoot(e=>({rootInsert:{privateKeyInfo:null,publicKeyInfo:null,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:null,Index:null}),levelInfo:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId})},tree:e=>({derivationId:e,children:[]})})).addBip44Wrapper(e=>({ConceptualWalletId:e.conceptualWalletRow.ConceptualWalletId,SignerLevel:null,PublicDeriverLevel:g.a.ACCOUNT.level,PrivateDeriverKeyDerivationId:null,PrivateDeriverLevel:null,RootKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId})).addAdhocPublicDeriver(r=>({parentDerivationId:r.root.root.KeyDerivation.KeyDerivationId,pathStartLevel:1,publicDeriverMeta:{name:e.accountName},pathToPublic:[{index:p.i.BIP44,insert:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId}),publicKey:null,privateKey:null},{index:p.d.CARDANO,insert:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId}),publicKey:null,privateKey:null},{index:e.accountIndex,insert:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId}),publicKey:{Hash:e.accountPublicKey.key().to_hex(),IsEncrypted:!1,PasswordLastUpdate:null,Type:I.a.BIP32ED25519},privateKey:null}],initialDerivations:t,hwWalletMetaInsert:{ConceptualWalletId:r.conceptualWalletRow.ConceptualWalletId,...e.hwWalletMetaInsert}})).commit(),r}async function x(e){if(null!=e.encryptedPk){const t=[],r=e.encryptedPk;let a=h.a.start(e.db,g.b).addConceptualWallet(t=>({NetworkId:e.network.NetworkId,Name:e.walletName})).addFromRoot(e=>({rootInsert:{privateKeyInfo:r,publicKeyInfo:null,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:null,Index:null}),levelInfo:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId})},tree:e=>({derivationId:e,children:[]})})).addBip44Wrapper(e=>({ConceptualWalletId:e.conceptualWalletRow.ConceptualWalletId,SignerLevel:g.a.ROOT.level,PublicDeriverLevel:g.a.ACCOUNT.level,PrivateDeriverKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId,PrivateDeriverLevel:t.length,RootKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId}));return a=await A({builder:a,db:e.db,accountPubKey:e.accountPubKey,settings:e.settings,displayCutoff:e.displayCutoff,hwWalletMetaInsert:e.hwWalletMetaInsert}),await a.commit()}{let t=h.a.start(e.db,g.b).addConceptualWallet(t=>({NetworkId:e.network.NetworkId,Name:e.walletName})).addFromRoot(e=>({rootInsert:{privateKeyInfo:null,publicKeyInfo:null,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:null,Index:null}),levelInfo:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId})},tree:e=>({derivationId:e,children:[]})})).addBip44Wrapper(e=>({ConceptualWalletId:e.conceptualWalletRow.ConceptualWalletId,SignerLevel:null,PublicDeriverLevel:g.a.ACCOUNT.level,PrivateDeriverKeyDerivationId:null,PrivateDeriverLevel:null,RootKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId}));t=await A({builder:t,db:e.db,accountPubKey:e.accountPubKey,settings:e.settings,displayCutoff:e.displayCutoff,hwWalletMetaInsert:e.hwWalletMetaInsert}),await t.commit()}}async function A(e){const t=p.g+0,r=f.a.WalletV2.Bip44AccountPublic.new(f.a.WalletV2.PublicKey.from_hex(e.accountPubKey),f.a.WalletV2.DerivationScheme.v2());let a;{const t=await v(e.settings,r,Object(b.a)(new o.a)),s=n()(t).call(t,e=>e.index===p.c.EXTERNAL);if(null==s)throw new Error("addPublicDeriverToMigratedWallet cannot find external chain. Should never happen");s.insert=t=>c.a.resolve({KeyDerivationId:t.keyDerivationId,DisplayCutoff:e.displayCutoff}),a=t}const s=[{index:p.i.BIP44,insert:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId}),publicKey:null,privateKey:null},{index:p.d.CARDANO,insert:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId}),publicKey:null,privateKey:null},{index:t,insert:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId}),publicKey:{Hash:r.key().to_hex(),IsEncrypted:!1,PasswordLastUpdate:null,Type:I.a.BIP32ED25519},privateKey:null}];return e.builder.addAdhocPublicDeriver(t=>({parentDerivationId:t.root.root.KeyDerivation.KeyDerivationId,pathStartLevel:1,publicDeriverMeta:{name:""},pathToPublic:s,initialDerivations:a,hwWalletMetaInsert:null==e.hwWalletMetaInsert?void 0:{ConceptualWalletId:t.conceptualWalletRow.ConceptualWalletId,...e.hwWalletMetaInsert}}))}}).call(this,r(48).Buffer)},556:function(e,t,r){"use strict";r.d(t,"a",(function(){return k}));var a=r(30),n=r.n(a),s=r(8),o=r.n(s),i=r(37),c=r.n(i),d=r(11),l=r.n(d),u=r(15),p=r(119),h=(r(77),r(33)),f=r(243),w=r(310),g=r(311),b=r(25),y=r(62),I=r(76),v=r(152),T=r(107),m=r(88),x=r(166),A=r(20);async function k(e){var t,r;const a=l()({RemovePublicDeriver:p.g,ModifyConceptualWallet:p.c,GetPathWithSpecific:b.m,GetAddress:b.b,CardanoByronAssociateTxWithIOs:T.a,JormungandrAssociateTxWithIOs:T.d,ErgoAssociateTxWithIOs:T.c,CardanoShelleyAssociateTxWithIOs:T.b,AssociateTxWithAccountingIOs:v.a,AssociateTxWithUtxoIOs:I.a,GetDerivationSpecific:m.a,DeleteAllTransactions:p.b,ModifyAddress:y.d,GetTransaction:b.o,FreeBlocks:y.b,GetCertificates:b.d,ModifyTokenList:y.j}),s=e.publicDeriver.getDb(),i=c()(t=o()(r=n()(a)).call(r,e=>a[e])).call(t,e=>Object(u.g)(s,e));return await Object(u.m)(s,[...s.getSchema().tables(),...i],async t=>{const r=Object(h.j)(e.publicDeriver);if(null!=r){var i,d;const l=e.publicDeriver.getParent().getNetworkInfo();if(Object(A.f)(l))await Object(f.d)(s,t,{GetPathWithSpecific:a.GetPathWithSpecific,GetAddress:a.GetAddress,CardanoByronAssociateTxWithIOs:a.CardanoByronAssociateTxWithIOs,CardanoShelleyAssociateTxWithIOs:a.CardanoShelleyAssociateTxWithIOs,AssociateTxWithUtxoIOs:a.AssociateTxWithUtxoIOs,AssociateTxWithAccountingIOs:a.AssociateTxWithAccountingIOs,GetDerivationSpecific:a.GetDerivationSpecific,DeleteAllTransactions:a.DeleteAllTransactions,ModifyAddress:a.ModifyAddress,GetTransaction:a.GetTransaction,FreeBlocks:a.FreeBlocks,GetCertificates:a.GetCertificates,ModifyTokenList:a.ModifyTokenList},r.getParent().getDerivationTables(),{publicDeriver:r});else if(Object(A.h)(l))await Object(w.d)(s,t,{GetPathWithSpecific:a.GetPathWithSpecific,GetAddress:a.GetAddress,JormungandrAssociateTxWithIOs:a.JormungandrAssociateTxWithIOs,AssociateTxWithAccountingIOs:a.AssociateTxWithAccountingIOs,AssociateTxWithUtxoIOs:a.AssociateTxWithUtxoIOs,GetDerivationSpecific:a.GetDerivationSpecific,DeleteAllTransactions:a.DeleteAllTransactions,ModifyAddress:a.ModifyAddress,GetTransaction:a.GetTransaction,FreeBlocks:a.FreeBlocks,ModifyTokenList:a.ModifyTokenList},r.getParent().getDerivationTables(),{publicDeriver:r});else{if(!Object(A.g)(l))throw new Error("removePublicDeriver No implementation for wallet removal");await Object(g.d)(s,t,{GetPathWithSpecific:a.GetPathWithSpecific,GetAddress:a.GetAddress,ErgoAssociateTxWithIOs:a.ErgoAssociateTxWithIOs,AssociateTxWithUtxoIOs:a.AssociateTxWithUtxoIOs,GetDerivationSpecific:a.GetDerivationSpecific,DeleteAllTransactions:a.DeleteAllTransactions,ModifyAddress:a.ModifyAddress,GetTransaction:a.GetTransaction,FreeBlocks:a.FreeBlocks,ModifyTokenList:a.ModifyTokenList},r.getParent().getDerivationTables(),{publicDeriver:r})}const u=await Object(x.b)(t,{GetPathWithSpecific:a.GetPathWithSpecific,GetAddress:a.GetAddress,GetDerivationSpecific:a.GetDerivationSpecific},{publicDeriver:e.publicDeriver},r.getParent().getDerivationTables()),p=o()(i=c()(d=n()(u)).call(d,e=>u[e])).call(i,e=>e.AddressId);await a.ModifyAddress.remove(s,t,p)}await a.RemovePublicDeriver.remove(s,t,{publicDeriverId:e.publicDeriver.getPublicDeriverId()}),null!=e.conceptualWallet&&await e.conceptualWallet.rawRemove(s,t)})}},557:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return p}));var a=r(8),n=r.n(a),s=r(113),o=r.n(s),i=r(6),c=r(195),d=r(19),l=r(280);const u=(t,r,a,n)=>{var s;const u=t.derive(d.i.BIP44).derive(d.d.CARDANO).derive(r+d.g).to_public(),p=u.derive(d.c.EXTERNAL),h=Object(l.legacyWalletChecksum)(e.from(u.as_bytes()).toString("hex"));return{addresses:Object(c.b)(i.a.WalletV2.Bip44ChainPublic.new(i.a.WalletV2.PublicKey.from_hex(e.from(p.as_bytes()).toString("hex")),i.a.WalletV2.DerivationScheme.v2()),n)([...o()(s=Array(a)).call(s)]),plate:h}},p=(t,r,a,s)=>{var c;const u=t.derive(d.i.CIP1852).derive(d.d.CARDANO).derive(r+d.g).to_public(),p=u.derive(d.c.EXTERNAL),h=u.derive(d.c.CHIMERIC_ACCOUNT).derive(d.h).to_raw_key(),f=Object(l.walletChecksum)(e.from(u.as_bytes()).toString("hex"));return{addresses:function(e,t,r){return a=>{const s=i.a.WalletV4.StakeCredential.from_keyhash(t.hash());return n()(a).call(a,t=>{const a=e.derive(t).to_raw_key(),n=i.a.WalletV4.StakeCredential.from_keyhash(a.hash());return i.a.WalletV4.BaseAddress.new(r,n,s).to_address().to_bech32()})}}(p,h,s)([...o()(c=Array(a)).call(c)]),plate:f}}}).call(this,r(48).Buffer)},559:function(e,t,r){"use strict";(function(e){r.d(t,"c",(function(){return x})),r.d(t,"b",(function(){return A})),r.d(t,"a",(function(){return D}));var a=r(342),n=r.n(a),s=r(55),o=r.n(s),i=r(75),c=r.n(i),d=r(35),l=r.n(d),u=r(8),p=r.n(u),h=r(32),f=r.n(h),w=r(29),g=r.n(w),b=r(131),y=r(6),I=r(33),v=(r(50),r(159)),T=r(21),m=r(38);async function x(e){return{utxoPart:await async function(e,t){const r=Object(I.e)(e);if(null==r)return new m.a([],e.getParent().getDefaultToken());const a=r,n=Object(v.d)(t),s=await a.getAllUtxos(),o=Object(v.b)(n,s,!1);return f()(o).call(o,(t,r)=>{var a;return t.joinAddMutable(new m.a(p()(a=r.output.tokens).call(a,e=>({identifier:e.Token.Identifier,amount:new g.a(e.TokenList.Amount),networkId:e.Token.NetworkId})),e.getParent().getDefaultToken()))},new m.a([],e.getParent().getDefaultToken()))}(e.publicDeriver,e.stakingAddress),accountPart:e.rewardBalance}}async function A(e){const t=await Object(b.b)(e.publicDeriver.getDb(),[e.stakingKeyAddressId]),r={currEpoch:void 0,prevEpoch:void 0,prevPrevEpoch:void 0,prevPrevPrevEpoch:void 0,fullHistory:t},a=new l.a;for(const n of t){const t=n.block;if(null==t)continue;const s=e.toRelativeSlotNumber(t.SlotNum);if(n.transaction.Status!==T.d.IN_BLOCK)continue;const o=n.certificate.Kind;if(o!==y.a.WalletV3.CertificateKind.StakeDelegation&&o!==y.a.WalletV3.CertificateKind.OwnerStakeDelegation)continue;const{pools:i}=k(n.certificate.Payload,o);if(c()(i).call(i,e=>a.add(e[0])),null==r.currEpoch&&s.epoch<=e.currentEpoch&&(r.currEpoch={...n,pools:i}),null==r.prevEpoch&&s.epoch<=e.currentEpoch-1&&(r.prevEpoch={...n,pools:i}),null==r.prevPrevEpoch&&s.epoch<=e.currentEpoch-2&&(r.prevPrevEpoch={...n,pools:i}),null==r.prevPrevPrevEpoch&&s.epoch<=e.currentEpoch-3){r.prevPrevPrevEpoch={...n,pools:i};break}}return{...r,allPoolIds:o()(a)}}function k(t,r){switch(r){case y.a.WalletV3.CertificateKind.StakeDelegation:case y.a.WalletV3.CertificateKind.OwnerStakeDelegation:{const r=y.a.WalletV3.StakeDelegation.from_bytes(e.from(t,"hex")).delegation_type();return Object(v.a)(r)}default:throw new Error(`certificateToPoolList unexpected certificate kind ${r}`)}}function D(e,t){if(null==t)return y.a.WalletV3.StakeDelegation.new(y.a.WalletV3.DelegationType.non_delegated(),e);if(n()(t)){const r=f()(t).call(t,(e,t)=>e+t.part,0),a=y.a.WalletV3.PoolDelegationRatios.new();for(const e of t)a.add(y.a.WalletV3.PoolDelegationRatio.new(y.a.WalletV3.PoolId.from_hex(e.id),e.part));const n=y.a.WalletV3.DelegationRatio.new(r,a);if(null==n)throw new Error("createCertificate invalid ratio");return y.a.WalletV3.StakeDelegation.new(y.a.WalletV3.DelegationType.ratio(n),e)}return y.a.WalletV3.StakeDelegation.new(y.a.WalletV3.DelegationType.full(y.a.WalletV3.PoolId.from_hex(t.id)),e)}}).call(this,r(48).Buffer)},6:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var a=r(1),n=r.n(a);const s=new class{constructor(){n()(this,"_wasmv2",void 0),n()(this,"_wasmv3",void 0),n()(this,"_wasmv4",void 0),n()(this,"_ergo",void 0)}async load(){null==this._wasmv2&&null==this._wasmv3&&null==this._wasmv4&&(this._wasmv2=await r.e(25).then(r.bind(null,2800)),this._wasmv3=await Promise.all([r.e(24),r.e(27)]).then(r.bind(null,2799)),this._wasmv4=await Promise.all([r.e(23),r.e(26)]).then(r.bind(null,2801)),this._ergo=await r.e(22).then(r.bind(null,2802)))}get WalletV2(){return this._wasmv2}get WalletV3(){return this._wasmv3}get WalletV4(){return this._wasmv4}get SigmaRust(){return this._ergo}}},60:function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return p})),r.d(t,"h",(function(){return h})),r.d(t,"j",(function(){return f})),r.d(t,"i",(function(){return w})),r.d(t,"g",(function(){return g})),r.d(t,"f",(function(){return b})),r.d(t,"d",(function(){return y})),r.d(t,"e",(function(){return I})),r.d(t,"a",(function(){return v})),r.d(t,"k",(function(){return T})),r.d(t,"c",(function(){return m})),r.d(t,"l",(function(){return x}));var a=r(66),n=r.n(a),s=r(90),o=r.n(s),i=r(21),c=r(340),d=r(6),l=r(20),u=r(5);function p(t,r,a){try{if(Object(l.h)(a)){if(d.a.WalletV4.ByronAddress.is_valid(t))return i.b.CARDANO_LEGACY;switch(("bytes"===r?d.a.WalletV3.Address.from_bytes(e.from(t,"hex")):d.a.WalletV3.Address.from_string(t)).get_kind()){case d.a.WalletV3.AddressKind.Single:return i.b.JORMUNGANDR_SINGLE;case d.a.WalletV3.AddressKind.Group:return i.b.JORMUNGANDR_GROUP;case d.a.WalletV3.AddressKind.Account:return i.b.JORMUNGANDR_ACCOUNT;case d.a.WalletV3.AddressKind.Multisig:return i.b.JORMUNGANDR_MULTISIG;default:throw new Error("addressToKind unknown address type "+t)}}if(Object(l.f)(a)){if(d.a.WalletV4.ByronAddress.is_valid(t))return i.b.CARDANO_LEGACY;const a="bytes"===r?d.a.WalletV4.Address.from_bytes(e.from(t,"hex")):d.a.WalletV4.Address.from_bech32(t);if(d.a.WalletV4.ByronAddress.from_address(a))return i.b.CARDANO_LEGACY;if(d.a.WalletV4.BaseAddress.from_address(a))return i.b.CARDANO_BASE;if(d.a.WalletV4.PointerAddress.from_address(a))return i.b.CARDANO_PTR;if(d.a.WalletV4.EnterpriseAddress.from_address(a))return i.b.CARDANO_ENTERPRISE;if(d.a.WalletV4.RewardAddress.from_address(a))return i.b.CARDANO_REWARD;throw new Error("addressToKind unknown address type")}if(Object(l.g)(a)){return function(e){switch(e.address().address_type_prefix()){case d.a.SigmaRust.AddressTypePrefix.P2PK:return i.b.ERGO_P2PK;case d.a.SigmaRust.AddressTypePrefix.Pay2SH:return i.b.ERGO_P2SH;case d.a.SigmaRust.AddressTypePrefix.Pay2S:return i.b.ERGO_P2S;default:throw new Error(`ergoAddressToType unknown Ergo address type ${e.to_base58()}`)}}("bytes"===r?d.a.SigmaRust.NetworkAddress.from_bytes(e.from(t,"hex")):d.a.SigmaRust.NetworkAddress.from_base58(t))}throw new Error(`addressToKind not implemented for network ${a.NetworkId}`)}catch(e){throw new Error(`addressToKind failed to parse address type ${e} ${t}`)}}function h(e,t){const r=Object(u.e)({invalidAddress:{id:"wallet.send.form.errors.invalidAddress",defaultMessage:"!!!Please enter a valid address."},cannotSendToLegacy:{id:"wallet.send.form.cannotSendToLegacy",defaultMessage:"!!!You cannot send to legacy addresses (any address created before November 29th, 2019)"},cannotSendToReward:{id:"wallet.send.form.cannotSendToReward",defaultMessage:"!!!You cannot send to a reward account"},cannotSendToP2SH:{id:"wallet.send.form.cannotSendToP2SH",defaultMessage:"!!!You cannot send to pay-to-script-hash addresses"},wrongNetwork:{id:"global.wrongNetwork.address",defaultMessage:"!!!Wrong network for address."}}),a=function(e,t,r){try{return p(e,t,r)}catch(e){return}}(e,"bech32",t);if(null==a)return[!1,r.invalidAddress];if(Object(l.g)(t))return a===i.b.ERGO_P2SH?[!1,r.cannotSendToP2SH]:!!function(e){return e===i.b.ERGO_P2PK||(e===i.b.ERGO_P2SH||e===i.b.ERGO_P2S)}(a)||[!1,r.invalidAddress];if(Object(l.h)(t))return a===i.b.CARDANO_LEGACY?[!1,r.cannotSendToLegacy]:!!g(a)||[!1,r.invalidAddress];if(Object(l.f)(t)){if(a===i.b.CARDANO_REWARD)return[!1,r.cannotSendToReward];if(b(a)){const a=w(e);if(null==a)throw new Error("Should never happen");const n=o()(t.BaseConfig[0].ChainNetworkId,10);return a.network_id()===n||[!1,r.wrongNetwork]}return[!1,r.invalidAddress]}throw new Error(`isValidReceiveAddress Unsupported network ${n()(t)}`)}function f(t){if(d.a.WalletV4.ByronAddress.is_valid(t))return t;try{const r=d.a.WalletV4.Address.from_bytes(e.from(t,"hex")),a=d.a.WalletV4.ByronAddress.from_address(r);return a?a.to_base58():void 0}catch(e){}try{const e=d.a.WalletV4.Address.from_bech32(t),r=d.a.WalletV4.ByronAddress.from_address(e);return r?r.to_base58():void 0}catch(e){}}function w(t){if(d.a.WalletV4.ByronAddress.is_valid(t))return d.a.WalletV4.ByronAddress.from_base58(t).to_address();try{return d.a.WalletV4.Address.from_bytes(e.from(t,"hex"))}catch(e){}try{return d.a.WalletV4.Address.from_bech32(t)}catch(e){}}function g(e){return e===i.b.JORMUNGANDR_SINGLE||(e===i.b.JORMUNGANDR_GROUP||(e===i.b.JORMUNGANDR_ACCOUNT||e===i.b.JORMUNGANDR_MULTISIG))}function b(e){return e===i.b.CARDANO_LEGACY||(e===i.b.CARDANO_BASE||(e===i.b.CARDANO_PTR||(e===i.b.CARDANO_ENTERPRISE||e===i.b.CARDANO_REWARD)))}function y(e){if(d.a.WalletV4.ByronAddress.from_address(e))return null;{const t=d.a.WalletV4.BaseAddress.from_address(e);if(t)return t.payment_cred().to_keyhash()}{const t=d.a.WalletV4.PointerAddress.from_address(e);if(t)return t.payment_cred().to_keyhash()}{const t=d.a.WalletV4.EnterpriseAddress.from_address(e);if(t)return t.payment_cred().to_keyhash()}{const t=d.a.WalletV4.RewardAddress.from_address(e);if(t)return t.payment_cred().to_keyhash()}throw new Error("getCardanoSpendingKeyHash unknown address type")}function I(e){{const t=e.to_group_address();if(t)return t.get_spending_key()}if(e.to_multisig_address())throw new Error("getJormungandrSpendingKey multisig not supported");{const t=e.to_single_address();if(t)return t.get_spending_key()}{const t=e.to_account_address();if(t)return t.get_account_key()}throw new Error("getJormungandrSpendingKey unknown address type")}function v(t,r){try{if(Object(l.h)(r)){if(d.a.WalletV4.ByronAddress.is_valid(t))return t;return d.a.WalletV3.Address.from_bytes(e.from(t,"hex")).to_string(c.a.ADDRESS)}if(Object(l.f)(r)){if(d.a.WalletV4.ByronAddress.is_valid(t))return t;const r=d.a.WalletV4.Address.from_bytes(e.from(t,"hex")),a=d.a.WalletV4.ByronAddress.from_address(r);return null==a?r.to_bech32():a.to_base58()}if(Object(l.g)(r)){return d.a.SigmaRust.NetworkAddress.from_bytes(e.from(t,"hex")).to_base58()}throw new Error(`addressToDisplayString not implemented for network ${r.NetworkId}`)}catch(e){throw new Error("addressToDisplayString failed to parse address type "+t)}}function T(t){const r=d.a.WalletV4.ByronAddress.from_address(t);return null==r?e.from(t.to_bytes()).toString("hex"):r.to_base58()}function m(t,r){try{if(Object(l.h)(r))return d.a.WalletV4.ByronAddress.is_valid(t)?t:e.from(d.a.WalletV3.Address.from_string(t).as_bytes()).toString("hex");if(Object(l.f)(r)){if(d.a.WalletV4.ByronAddress.is_valid(t))return t;const r=d.a.WalletV4.Address.from_bech32(t),a=d.a.WalletV4.ByronAddress.from_address(r);return null==a?e.from(r.to_bytes()).toString("hex"):a.to_base58()}if(Object(l.g)(r)){const r=d.a.SigmaRust.NetworkAddress.from_base58(t);return e.from(r.to_bytes()).toString("hex")}throw new Error(`getAddressPayload not implemented for network ${r.NetworkId}`)}catch(e){throw new Error("getAddressPayload failed to parse address type "+t)}}function x(t){const r=d.a.WalletV4.RewardAddress.from_address(d.a.WalletV4.Address.from_bytes(e.from(t,"hex")));if(null==r)throw new Error("unwrapStakingKey staking key invalid");return r.payment_cred()}}).call(this,r(48).Buffer)},62:function(e,t,r){"use strict";r.d(t,"g",(function(){return I})),r.d(t,"d",(function(){return T})),r.d(t,"f",(function(){return m})),r.d(t,"a",(function(){return x})),r.d(t,"c",(function(){return A})),r.d(t,"k",(function(){return k})),r.d(t,"e",(function(){return D})),r.d(t,"l",(function(){return O})),r.d(t,"b",(function(){return S})),r.d(t,"h",(function(){return E})),r.d(t,"i",(function(){return P})),r.d(t,"j",(function(){return C}));var a=r(11),n=r.n(a),s=r(66),o=r.n(s),i=r(56),c=r.n(i),d=r(32),l=r.n(d),u=r(8),p=r.n(u),h=r(1),f=r.n(h),w=r(16),g=r(118),b=r(15),y=r(25);class I{static async add(e,t,r){return await Object(b.c)(e,t,r,I.ownTables[w.i.name].name)}static async remove(e,t,r){return await Object(b.n)(e,t,I.ownTables[w.i.name].name,I.ownTables[w.i.name].properties.KeyId,r)}static async update(e,t,r){return await Object(b.d)(e,t,r,I.ownTables[w.i.name].name)}}f()(I,"ownTables",n()({[w.i.name]:w.i})),f()(I,"depTables",n()({}));class v{static async getOrAdd(e,t,r){const a=await v.depTables.GetBlock.byDigests(e,t,[r.Digest]);for(const e of a)if(e.Hash===r.Hash)return e;return await Object(b.c)(e,t,r,v.ownTables[w.c.name].name)}}f()(v,"ownTables",n()({[w.c.name]:w.c})),f()(v,"depTables",n()({GetBlock:y.c}));class T{static async addForeignByHash(e,t,r){const{AddressSeed:a}=await T.depTables.GetEncryptionMeta.get(e,t),n=p()(r).call(r,e=>Object(g.a)(e.data,a));return await Object(b.b)(e,t,p()(r).call(r,(e,t)=>({Digest:n[t],Hash:e.data,Type:e.type})),T.ownTables[w.b.name].name)}static async addFromCanonicalByHash(e,t,r){const a=await T.addForeignByHash(e,t,p()(r).call(r,e=>({data:e.data,type:e.type})));return await Object(b.b)(e,t,p()(r).call(r,(e,t)=>({KeyDerivationId:e.keyDerivationId,AddressId:a[t].AddressId})),T.ownTables[w.a.name].name),a}static async remove(e,t,r){return await Object(b.n)(e,t,T.ownTables[w.b.name].name,T.ownTables[w.b.name].properties.AddressId,r)}}f()(T,"ownTables",n()({[w.b.name]:w.b,[w.a.name]:w.a})),f()(T,"depTables",n()({GetEncryptionMeta:y.h}));class m{static async upsert(e,t,r){return(await Object(b.e)(e,t,[r],m.ownTables[w.g.name].name))[0]}}f()(m,"ownTables",n()({[w.g.name]:w.g})),f()(m,"depTables",n()({}));class x{static async add(e,t,r,a,n){const s=null===r.privateKeyInfo?null:await x.depTables.ModifyKey.add(e,t,r.privateKeyInfo),o=null===r.publicKeyInfo?null:await x.depTables.ModifyKey.add(e,t,r.publicKeyInfo),i=await Object(b.c)(e,t,r.derivationInfo({private:s?s.KeyId:null,public:o?o.KeyId:null}),x.ownTables[w.h.name].name);return{KeyDerivation:i,specificDerivationResult:await Object(b.c)(e,t,await r.levelInfo({db:e,tx:t,lockedTables:a,keyDerivationId:i.KeyDerivationId}),n)}}}f()(x,"ownTables",n()({[w.h.name]:w.h})),f()(x,"depTables",n()({ModifyKey:I}));class A{static async getOrAdd(e,t,r,a,n,s,o){const i=null==r||null==a?void 0:await A.depTables.GetChildIfExists.get(e,t,r,a);if(void 0!==i){const r=(await Object(b.j)(e,t,o,A.ownTables[w.h.name].properties.KeyDerivationId,[i.KeyDerivationId]))[0];if(null==r)throw new b.a("GetOrAddDerivation::getOrAdd no derivation found. Should not happen");return{KeyDerivation:i,specificDerivationResult:r}}return await A.depTables.AddDerivation.add(e,t,n,s,o)}}f()(A,"ownTables",n()({[w.h.name]:w.h})),f()(A,"depTables",n()({AddDerivation:x,GetChildIfExists:y.e}));class k{static async addNew(e,t,r){const a=null!==r.block?await k.depTables.GetOrAddBlock.getOrAdd(e,t,r.block):null;return{block:a,transaction:await Object(b.c)(e,t,r.transaction(null!=a?a.BlockId:null),k.ownTables[w.m.name].name)}}static async updateExisting(e,t,r){const a=null!==r.block?await k.depTables.GetOrAddBlock.getOrAdd(e,t,r.block):null;return{block:a,transaction:await Object(b.d)(e,t,r.transaction(null!=a?a.BlockId:null),k.ownTables[w.m.name].name)}}static async updateStatus(e,t,r){await Object(b.d)(e,t,{...r.transaction,Status:r.status},k.ownTables[w.m.name].name)}}f()(k,"ownTables",n()({[w.m.name]:w.m})),f()(k,"depTables",n()({GetOrAddBlock:v}));class D{static async addNew(e,t,r){const a=await Object(b.c)(e,t,r.certificate,D.ownTables[w.f.name].name);return{certificate:a,relatedAddresses:await Object(b.b)(e,t,r.relatedAddresses(a.CertificateId),D.ownTables[w.e.name].name)}}}f()(D,"ownTables",n()({[w.f.name]:w.f,[w.e.name]:w.e})),f()(D,"depTables",n()({}));class O{static async remove(e,t,r){const a=await O.depTables.GetDerivationsByPath.allFromRoot(e,t,r.rootKeyId);await Object(b.n)(e,t,O.ownTables[w.h.name].name,O.ownTables[w.h.name].properties.KeyDerivationId,p()(a).call(a,e=>e.KeyDerivationId));const n=l()(a).call(a,(e,t)=>(null!=t.PrivateKeyId&&e.push(t.PrivateKeyId),null!=t.PublicKeyId&&e.push(t.PublicKeyId),e),[]);await O.depTables.ModifyKey.remove(e,t,n)}}f()(O,"ownTables",n()({[w.h.name]:w.h})),f()(O,"depTables",n()({GetDerivationsByPath:y.g,ModifyKey:I}));class S{static async free(e,t){const r=S.ownTables[w.m.name],a=S.ownTables[w.c.name],n=e.getSchema().table(r.name),s=e.getSchema().table(a.name),o=e.select().from(s).leftOuterJoin(n,n[r.properties.BlockId].eq(s[a.properties.BlockId])),i=await t.attach(o),c=l()(i).call(i,(e,t)=>(null==t.Transaction.TransactionId&&e.push(t.Block),e),[]);await Object(b.n)(e,t,a.name,a.properties.BlockId,p()(c).call(c,e=>e.BlockId))}}f()(S,"ownTables",n()({[w.m.name]:w.m,[w.c.name]:w.c})),f()(S,"depTables",n()({}));class E{static async upsert(e,t,r){return await Object(b.e)(e,t,r,E.ownTables[w.j.name].name)}}f()(E,"ownTables",n()({[w.j.name]:w.j})),f()(E,"depTables",n()({}));class P{static async upsert(e,t,r){const a=[];{const{TokenSeed:s}=await P.depTables.GetEncryptionMeta.get(e,t),o=p()(r).call(r,e=>({Digest:Object(g.a)(e.Identifier,s),...e})),i=new c.a;for(const e of o){var n;const t=null!==(n=i.get(e.Digest))&&void 0!==n?n:new c.a;null==t.get(e.NetworkId)&&a.push(e),t.set(e.NetworkId,!0),i.set(e.Digest,t)}}const s=[],i=[],d=new c.a;{const r=await P.depTables.GetToken.fromDigest(e,t,p()(a).call(a,e=>e.Digest));for(const e of r){var l;const t=null!==(l=d.get(e.Digest))&&void 0!==l?l:new c.a;t.set(e.NetworkId,e),d.set(e.Digest,t)}}for(const e of a){var u;const t=null===(u=d.get(e.Digest))||void 0===u?void 0:u.get(e.NetworkId);null==t?i.push(e):o()(t.Metadata)!==o()(e.Metadata)?i.push(e):s.push(t)}const h=await Object(b.e)(e,t,i,P.ownTables[w.l.name].name);return[...s,...h]}}f()(P,"ownTables",n()({[w.l.name]:w.l})),f()(P,"depTables",n()({GetEncryptionMeta:y.h,GetToken:y.n}));class C{static async upsert(e,t,r){return await Object(b.e)(e,t,r,C.ownTables[w.k.name].name)}static async remove(e,t,r){return await Object(b.n)(e,t,C.ownTables[w.k.name].name,C.ownTables[w.k.name].properties.ListId,r)}}f()(C,"ownTables",n()({[w.k.name]:w.k})),f()(C,"depTables",n()({}))},649:function(e,t,r){"use strict";r.d(t,"a",(function(){return T}));var a=r(30),n=r.n(a),s=r(411),o=r.n(s),i=r(75),c=r.n(i),d=r(40),l=r.n(d),u=r(66),p=r.n(u),h=r(1),f=r.n(h),w=r(47),g=r(461),b=r(79),y=r(303);const I=String(w.a.getNetworkName()),v={USER_LOCALE:I+"-USER-LOCALE",TERMS_OF_USE_ACCEPTANCE:I+"-TERMS-OF-USE-ACCEPTANCE",URI_SCHEME_ACCEPTANCE:I+"-URI-SCHEME-ACCEPTANCE",COMPLEXITY_LEVEL:I+"-COMPLEXITY-LEVEL",THEME:I+"-THEME",CUSTOM_THEME:I+"-CUSTOM-THEME",VERSION:I+"-LAST-LAUNCH-VER",HIDE_BALANCE:I+"-HIDE-BALANCE",UNIT_OF_ACCOUNT:I+"-UNIT-OF-ACCOUNT",COIN_PRICE_PUB_KEY_DATA:I+"-COIN-PRICE-PUB-KEY-DATA",EXTERNAL_STORAGE:I+"-EXTERNAL-STORAGE",TOGGLE_SIDEBAR:I+"-TOGGLE-SIDEBAR"};class T{constructor(){f()(this,"getUserLocale",()=>Object(b.b)(v.USER_LOCALE)),f()(this,"setUserLocale",e=>Object(b.e)(v.USER_LOCALE,e)),f()(this,"unsetUserLocale",()=>Object(b.d)(v.USER_LOCALE)),f()(this,"getTermsOfUseAcceptance",()=>Object(b.b)(v.TERMS_OF_USE_ACCEPTANCE).then(e=>"true"===e)),f()(this,"setTermsOfUseAcceptance",()=>Object(b.e)(v.TERMS_OF_USE_ACCEPTANCE,p()(!0))),f()(this,"unsetTermsOfUseAcceptance",()=>Object(b.d)(v.TERMS_OF_USE_ACCEPTANCE)),f()(this,"getUriSchemeAcceptance",()=>Object(b.b)(v.URI_SCHEME_ACCEPTANCE).then(e=>"true"===e&&JSON.parse(e))),f()(this,"setUriSchemeAcceptance",()=>Object(b.e)(v.URI_SCHEME_ACCEPTANCE,p()(!0))),f()(this,"unsetUriSchemeAcceptance",()=>Object(b.d)(v.URI_SCHEME_ACCEPTANCE)),f()(this,"getComplexityLevel",()=>Object(b.b)(v.COMPLEXITY_LEVEL).then(e=>null==e?null:JSON.parse(e))),f()(this,"setComplexityLevel",e=>Object(b.e)(v.COMPLEXITY_LEVEL,p()(e))),f()(this,"unsetComplexityLevel",()=>Object(b.d)(v.COMPLEXITY_LEVEL)),f()(this,"getUserTheme",()=>Object(b.b)(v.THEME)),f()(this,"setUserTheme",e=>Object(b.e)(v.THEME,e)),f()(this,"unsetUserTheme",()=>Object(b.d)(v.THEME)),f()(this,"getCustomUserTheme",()=>Object(b.b)(v.CUSTOM_THEME)),f()(this,"setCustomUserTheme",e=>new l.a((t,r)=>{try{const t=e.customThemeVars.split(";"),r={};return c()(t).call(t,t=>{const a=t.split(":"),n=a[0],s=a[1];n&&s&&e.currentThemeVars[o()(n).call(n)]!==o()(s).call(s)&&(r[o()(n).call(n)]=o()(s).call(s))}),Object(b.e)(v.CUSTOM_THEME,p()(r))}catch(e){return r(e)}})),f()(this,"unsetCustomUserTheme",()=>Object(b.d)(v.CUSTOM_THEME)),f()(this,"getLastLaunchVersion",()=>Object(b.b)(v.VERSION).then(e=>null==e?"0.0.0":e)),f()(this,"setLastLaunchVersion",e=>Object(b.e)(v.VERSION,e)),f()(this,"unsetLastLaunchVersion",()=>Object(b.d)(v.VERSION)),f()(this,"isEmpty",()=>Object(b.c)()),f()(this,"clear",async()=>{var e;const t=JSON.parse(await this.getStorage());await c()(e=n()(t)).call(e,async e=>{e!==y.a&&await Object(b.d)(e)})}),f()(this,"getHideBalance",()=>Object(b.b)(v.HIDE_BALANCE).then(e=>"true"===e&&JSON.parse(e))),f()(this,"setHideBalance",e=>Object(b.e)(v.HIDE_BALANCE,p()(!e))),f()(this,"unsetHideBalance",()=>Object(b.d)(v.HIDE_BALANCE)),f()(this,"getToggleSidebar",()=>Object(b.b)(v.TOGGLE_SIDEBAR).then(e=>"true"===e&&JSON.parse(e))),f()(this,"setToggleSidebar",e=>Object(b.e)(v.TOGGLE_SIDEBAR,p()(!e))),f()(this,"unsetToggleSidebar",()=>Object(b.d)(v.TOGGLE_SIDEBAR)),f()(this,"getExternalStorage",()=>Object(b.b)(v.EXTERNAL_STORAGE).then(e=>null==e?null:JSON.parse(e))),f()(this,"setExternalStorage",e=>Object(b.e)(v.EXTERNAL_STORAGE,p()(e))),f()(this,"unsetExternalStorage",()=>Object(b.d)(v.EXTERNAL_STORAGE)),f()(this,"getUnitOfAccount",()=>new l.a((e,t)=>{try{const t=localStorage.getItem(v.UNIT_OF_ACCOUNT);e(null==t?g.a:JSON.parse(t))}catch(e){return t(e)}})),f()(this,"setUnitOfAccount",e=>new l.a((t,r)=>{try{localStorage.setItem(v.UNIT_OF_ACCOUNT,p()(e)),t()}catch(e){return r(e)}})),f()(this,"unsetUnitOfAccount",()=>new l.a(e=>{try{localStorage.removeItem(v.UNIT_OF_ACCOUNT)}catch(e){}e()})),f()(this,"getCoinPricePubKeyData",async()=>localStorage.getItem(v.COIN_PRICE_PUB_KEY_DATA)),f()(this,"setCoinPricePubKeyData",async e=>{localStorage.setItem(v.COIN_PRICE_PUB_KEY_DATA,e)}),f()(this,"unsetCoinPricePubKeyData",async()=>{try{localStorage.removeItem(v.COIN_PRICE_PUB_KEY_DATA)}catch(e){}}),f()(this,"getItem",e=>Object(b.b)(e)),f()(this,"setItem",(e,t)=>Object(b.e)(e,t)),f()(this,"getOldStorage",()=>new l.a(e=>{e(localStorage)})),f()(this,"setStorage",async e=>{var t;await c()(t=n()(e)).call(t,async t=>{t!==y.a&&await Object(b.e)(t,e[t])})}),f()(this,"getStorage",()=>Object(b.b)(void 0).then(e=>null==e?"{}":e))}async reset(){await this.unsetUserLocale(),await this.unsetTermsOfUseAcceptance(),await this.unsetUserTheme(),await this.unsetComplexityLevel(),await this.unsetLastLaunchVersion(),await this.unsetHideBalance(),await this.unsetUnitOfAccount(),await this.unsetCoinPricePubKeyData(),await this.unsetExternalStorage(),await this.unsetToggleSidebar()}}},65:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"d",(function(){return o})),r.d(t,"c",(function(){return i})),r.d(t,"b",(function(){return c})),r.d(t,"e",(function(){return d}));var a=r(22),n=r(16);const s={name:"ConceptualWallet",properties:{ConceptualWalletId:"ConceptualWalletId",Name:"Name",NetworkId:"NetworkId"}},o={name:"PublicDeriver",properties:{PublicDeriverId:"PublicDeriverId",ConceptualWalletId:"ConceptualWalletId",KeyDerivationId:"KeyDerivationId",Name:"Name",Index:"Index",LastSyncInfoId:"LastSyncInfoId"}},i={name:"LastSyncInfo",properties:{LastSyncInfoId:"LastSyncInfoId",Time:"Time",SlotNum:"SlotNum",BlockHash:"BlockHash",Height:"Height"}},c={name:"HwWalletMeta",properties:{ConceptualWalletId:"ConceptualWalletId",Vendor:"Vendor",Model:"Model",DeviceId:"DeviceId"}},d=e=>{e.createTable(s.name).addColumn(s.properties.ConceptualWalletId,a.Type.INTEGER).addColumn(s.properties.NetworkId,a.Type.INTEGER).addColumn(s.properties.Name,a.Type.STRING).addPrimaryKey([s.properties.ConceptualWalletId],!0),e.createTable(o.name).addColumn(o.properties.PublicDeriverId,a.Type.INTEGER).addColumn(o.properties.ConceptualWalletId,a.Type.INTEGER).addColumn(o.properties.KeyDerivationId,a.Type.INTEGER).addColumn(o.properties.Name,a.Type.STRING).addColumn(o.properties.Index,a.Type.INTEGER).addColumn(o.properties.LastSyncInfoId,a.Type.INTEGER).addPrimaryKey([o.properties.PublicDeriverId],!0).addForeignKey("PublicDeriver_ConceptualWallet",{local:o.properties.ConceptualWalletId,ref:`${s.name}.${s.properties.ConceptualWalletId}`}).addForeignKey("PublicDeriver_KeyDerivation",{local:o.properties.KeyDerivationId,ref:`${n.h.name}.${n.h.properties.KeyDerivationId}`,action:a.ConstraintAction.CASCADE}).addForeignKey("PublicDeriver_LastSyncInfo",{local:o.properties.LastSyncInfoId,ref:`${i.name}.${i.properties.LastSyncInfoId}`}).addIndex("Bip44ToPublicDeriver_ConceptualWallet_Index",[o.properties.ConceptualWalletId],!1),e.createTable(i.name).addColumn(i.properties.LastSyncInfoId,a.Type.INTEGER).addColumn(i.properties.Time,a.Type.DATE_TIME).addColumn(i.properties.SlotNum,a.Type.NUMBER).addColumn(i.properties.BlockHash,a.Type.STRING).addColumn(i.properties.Height,a.Type.NUMBER).addPrimaryKey([i.properties.LastSyncInfoId],!0).addNullable([i.properties.Time,i.properties.SlotNum,i.properties.BlockHash]),e.createTable(c.name).addColumn(c.properties.ConceptualWalletId,a.Type.INTEGER).addColumn(c.properties.Vendor,a.Type.STRING).addColumn(c.properties.Model,a.Type.STRING).addColumn(c.properties.DeviceId,a.Type.STRING).addForeignKey("HwWalletMetaSchema_ConceptualWallet",{local:c.properties.ConceptualWalletId,ref:`${s.name}.${s.properties.ConceptualWalletId}`,action:a.ConstraintAction.CASCADE}).addUnique("HwWalletMetaSchema_ConceptualWallet_Unique",[c.properties.ConceptualWalletId])}},655:function(e,t,r){"use strict";r.d(t,"b",(function(){return l})),r.d(t,"a",(function(){return u}));var a=r(11),n=r.n(a),s=r(1),o=r.n(s),i=r(199),c=r(15),d=r(65);class l{static async get(e,t,r){return await Object(c.i)(e,t,r,l.ownTables[i.a.name].name,l.ownTables[i.a.name].properties.ConceptualWalletId)}}o()(l,"ownTables",n()({[i.a.name]:i.a})),o()(l,"depTables",n()({}));class u{static async get(e,t){const r=e.getSchema().table(u.ownTables[d.d.name].name),a=e.getSchema().table(u.ownTables[i.a.name].name),n=e.select().from(a).innerJoin(r,r[d.d.properties.ConceptualWalletId].eq(a[d.d.properties.ConceptualWalletId]));return await t.attach(n)}}o()(u,"ownTables",n()({[i.a.name]:i.a,[d.d.name]:d.d})),o()(u,"depTables",n()({}))},656:function(e,t,r){"use strict";r.d(t,"b",(function(){return l})),r.d(t,"a",(function(){return u}));var a=r(11),n=r.n(a),s=r(1),o=r.n(s),i=r(201),c=r(15),d=r(65);class l{static async get(e,t,r){return await Object(c.i)(e,t,r,l.ownTables[i.a.name].name,l.ownTables[i.a.name].properties.ConceptualWalletId)}}o()(l,"ownTables",n()({[i.a.name]:i.a})),o()(l,"depTables",n()({}));class u{static async get(e,t){const r=e.getSchema().table(u.ownTables[d.d.name].name),a=e.getSchema().table(u.ownTables[i.a.name].name),n=e.select().from(a).innerJoin(r,r[d.d.properties.ConceptualWalletId].eq(a[d.d.properties.ConceptualWalletId]));return await t.attach(n)}}o()(u,"ownTables",n()({[i.a.name]:i.a,[d.d.name]:d.d})),o()(u,"depTables",n()({}))},657:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return l}));var a=r(11),n=r.n(a),s=r(1),o=r.n(s),i=r(147),c=r(15);class d{static async upsert(e,t,r){return await Object(c.e)(e,t,r,d.ownTables[i.a.name].name)}}o()(d,"ownTables",n()({[i.a.name]:i.a})),o()(d,"depTables",n()({}));class l{static async upsert(e,t,r){return await Object(c.n)(e,t,l.ownTables[i.b.name].name,l.ownTables[i.b.name].properties.NetworkId,[r.NetworkId]),await Object(c.e)(e,t,[r],l.ownTables[i.b.name].name)}}o()(l,"ownTables",n()({[i.b.name]:i.b})),o()(l,"depTables",n()({}))},658:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return v}));var a=r(68),n=r.n(a),s=r(113),o=r.n(s),i=r(8),c=r.n(i),d=r(176),l=r(262),u=r(263),p=(r(144),r(53)),h=r(19),f=r(6),w=r(43),g=r(60);async function b(t,r,a){var s;const o=t.signRequest.unsignedTx.build();let i={inputs:function(e){for(const t of e)Object(d.c)(t.addressing);return c()(e).call(e,e=>({prev_hash:e.tx_hash,prev_index:e.tx_index,path:Object(l.a)(e.addressing.path)}))}(t.signRequest.senderUtxos),outputs:function(e,t){const r=[];for(let a=0;a<e.len();a++){const s=e.get(a),o=s.address(),i=Object(g.k)(s.address()),c=n()(t).call(t,e=>i===e.address);if(null!=c)Object(d.c)(c.addressing),r.push({addressParameters:v(o,c.addressing.path),amount:s.amount().to_str()});else{const e=f.a.WalletV4.ByronAddress.from_address(o);r.push({address:null==e?o.to_bech32():e.to_base58(),amount:s.amount().to_str()})}}return r}(o.outputs(),t.signRequest.changeAddr),fee:o.fee().to_str(),ttl:o.ttl().toString(),protocolMagic:r,networkId:a};const u=o.withdrawals(),b=()=>{const e=t.signRequest.senderUtxos[0];if(e.addressing.startLevel!==p.a.PURPOSE.level)throw new Error("createTrezorSignTxPayload unexpected addressing start level");const r=[...e.addressing.path];return r[p.a.CHAIN.level-1]=h.c.CHIMERIC_ACCOUNT,r[p.a.ADDRESS.level-1]=0,r};i=null==u?i:{...i,withdrawals:y(u,[b()])};const T=o.certs();i=null==T?i:{...i,certificates:I(T,c()(s=Object(w.range)(0,T.len())).call(s,e=>b()))};const m=t.metadata;return i=void 0===m?i:{...i,metadata:e.from(m.to_bytes()).toString("hex")},i}function y(e,t){const r=[],a=o()(e).call(e);for(let n=0;n<a.len();n++){const s=e.get(a.get(n));if(null==s)throw new Error("formatTrezorWithdrawals should never happen");r.push({amount:s.to_str(),path:t[n]})}return r}function I(t,r){const a=[];for(let n=0;n<t.len();n++){const s=t.get(n);if(null!=s.as_stake_registration()){a.push({type:u.CERTIFICATE_TYPE.StakeRegistration,path:r[n]});continue}if(null!=s.as_stake_deregistration()){a.push({type:u.CERTIFICATE_TYPE.StakeDeregistration,path:r[n]});continue}const o=s.as_stake_delegation();if(null==o)throw new Error("formatTrezorCertificates Trezor doesn't support this certificate type");a.push({type:u.CERTIFICATE_TYPE.StakeDelegation,path:r[n],pool:e.from(o.pool_keyhash().to_bytes()).toString("hex")})}return a}function v(t,r){if(f.a.WalletV4.ByronAddress.from_address(t))return{addressType:u.ADDRESS_TYPE.Byron,path:Object(l.a)(r)};{const n=f.a.WalletV4.BaseAddress.from_address(t);if(n){var a;const t=n.stake_cred(),s=null!==(a=t.to_keyhash())&&void 0!==a?a:t.to_scripthash();if(null==s)throw new Error("toTrezorAddressParameters unknown hash type");return{addressType:u.ADDRESS_TYPE.Base,path:Object(l.a)(r),stakingKeyHash:e.from(s.to_bytes()).toString("hex")}}}{const e=f.a.WalletV4.PointerAddress.from_address(t);if(e){const t=e.stake_pointer();return{addressType:u.ADDRESS_TYPE.Pointer,path:Object(l.a)(r),certificatePointer:{blockIndex:t.slot(),txIndex:t.tx_index(),certificateIndex:t.cert_index()}}}}if(f.a.WalletV4.EnterpriseAddress.from_address(t))return{addressType:u.ADDRESS_TYPE.Enterprise,path:Object(l.a)(r)};if(f.a.WalletV4.RewardAddress.from_address(t))return{addressType:u.ADDRESS_TYPE.Reward,path:Object(l.a)(r)};throw new Error("toTrezorAddressParameters unknown address type")}}).call(this,r(48).Buffer)},660:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var a=r(167),n=r(490),s=r(134);function o(e){const t=Object(a.mnemonicToSeedSync)(e);return s.c.fromBip32(Object(n.fromSeed)(t))}},706:function(e,t,r){"use strict";r.d(t,"b",(function(){return ee})),r.d(t,"a",(function(){return te}));var a,n,s,o=r(129),i=r.n(o),c=r(40),d=r.n(c),l=r(707),u=r(462),p=r(1300),h=r(1303),f=r(649),w=r(30),g=r.n(w),b=r(42),y=r.n(b),I=r(1),v=r.n(I),T=r(10),m=r(23),x=r(273),A=r.n(x),k=r(34),D=r.n(k),O=r(8),S=r.n(O),E=r(84),P=r.n(E),C=r(12),_=r.n(C),G=r(4),W=r.n(G),N=(r(59),r(3)),j=r(1306),R=r(26),B=r.n(R),K=r(209),U=r(36),L=r(47);let M=(a=class{constructor(){var e,t,r,a,o,i,c,d,l,u,p,h,f;v()(this,"authorizeUrl",`https://www.dropbox.com/oauth2/authorize?client_id=${K.a}&response_type=token&redirect_uri=${U.a.ROOT}#/`),v()(this,"baseFolderPath",`/cardano/${L.a.getNetworkName()}/transaction-memos`),v()(this,"memoExt",".txt"),_()(this,"errorMessage",n,this),_()(this,"errorCode",s,this),v()(this,"api",void 0),this.setup=y()(e=this.setup).call(e,this),this.auth=y()(t=this.auth).call(t,this),this.getDisplayName=y()(r=this.getDisplayName).call(r,this),this.revokeToken=y()(a=this.revokeToken).call(a,this),this.getError=y()(o=this.getError).call(o,this),this.getMetadata=y()(i=this.getMetadata).call(i,this),this.fetchFolder=y()(c=this.fetchFolder).call(c,this),this.createFolder=y()(d=this.createFolder).call(d,this),this.fetchFilenames=y()(l=this.fetchFilenames).call(l,this),this.uploadFile=y()(u=this.uploadFile).call(u,this),this.uploadAndOverwriteFile=y()(p=this.uploadAndOverwriteFile).call(p,this),this.deleteFile=y()(h=this.deleteFile).call(h,this),this.downloadFile=y()(f=this.downloadFile).call(f,this)}auth(e){this.api=new j.Dropbox({clientId:K.a,accessToken:e,fetch:fetch})}setup(){}getDisplayName(){return"Dropbox"}async revokeToken(){return this.api.authTokenRevoke().then(e=>(T.a.debug("DropboxApi::revokeToken success"),e)).catch(e=>{throw Object(N.runInAction)(()=>{self.errorCode=e.status,self.errorMessage="An error ocurred while revoking the token"}),T.a.error("DropboxApi::revokeToken error: "+Object(T.d)(e.error)),e})}getError(){return`[${this.errorCode}] ${this.errorMessage}`}async getMetadata(e){const t=this;return await this.api.filesGetMetadata({path:e}).then(e=>{if(!Object.prototype.hasOwnProperty.call(e,".tag")||!Object.prototype.hasOwnProperty.call(e,"name"))throw new Error("Should never happen");return{tag:e[".tag"],lastUpdated:Object.prototype.hasOwnProperty.call(e,"server_modified")&&null!=e.server_modified?B()(e.server_modified,"YYYY-MM-DDTHH:mm:ssZ").toDate():new Date(0)}}).catch(e=>{throw Object(N.runInAction)(()=>{t.errorCode=e.status,t.errorMessage="An error ocurred while fetching metadata"}),T.a.error("DropboxApi::getMetadata error: "+Object(T.d)(e.error)),e})}async fetchFolder(e){var t,r;const{walletId:a}=e,n=null!=a?P()(t=P()(r=this.baseFolderPath).call(r,"/")).call(t,a):this.baseFolderPath;return await this.getMetadata(n).then(e=>"folder"===e.tag).catch(e=>{throw Object(N.runInAction)(()=>{self.errorCode=e.status,self.errorMessage="An error ocurred while fetching folder"}),T.a.error("DropboxApi::fetchFolder error: "+Object(T.d)(e.error)),e})}async createFolder(e){var t,r;const{walletId:a}=e,n=null!=a?P()(t=P()(r=this.baseFolderPath).call(r,"/")).call(t,a):this.baseFolderPath;return this.api.filesCreateFolderV2({path:n}).then(()=>(T.a.debug("DropboxApi::createFolder success: "+n+" created"),!0)).catch(e=>{throw Object(N.runInAction)(()=>{self.errorCode=e.status,self.errorMessage="An error ocurred while creating the folder"}),T.a.error("DropboxApi::createFolder error: "+Object(T.d)(e.error)),e})}async fetchFilenames(e){const t=this;return await this.api.filesListFolder({path:`${this.baseFolderPath}/${e.walletId}`,include_deleted:!0}).then(e=>{var t,r;return S()(t=D()(r=A()(e)).call(r,e=>Object.prototype.hasOwnProperty.call(e,".tag")&&Object.prototype.hasOwnProperty.call(e,"name"))).call(t,e=>({tx:e.name.substr(0,e.name.length-this.memoExt.length),deleted:"deleted"===e[".tag"],lastUpdated:Object.prototype.hasOwnProperty.call(e,"server_modified")&&null!=e.server_modified?B()(e.server_modified,"YYYY-MM-DDTHH:mm:ssZ").toDate():new Date(0)}))}).catch(e=>{throw Object(N.runInAction)(()=>{t.errorCode=e.status,t.errorMessage="An error ocurred while fetching filenames"}),T.a.error("DropboxApi::fetchFilenames error: "+Object(T.d)(e.error)),e})}async uploadFile(e){const t=this,r=e.memo.TransactionHash,a=`${this.baseFolderPath}/${e.memo.WalletId}/${e.memo.TransactionHash}${this.memoExt}`;return this.api.filesUpload({path:a,contents:e.memo.Content}).then(()=>(T.a.debug("DropboxApi::uploadFile success: "+r+" file uploaded"),!0)).catch(e=>{if(409===e.status)return!1;throw Object(N.runInAction)(()=>{t.errorCode=e.status,t.errorMessage="An error ocurred while uploading the file"}),T.a.error("DropboxApi::uploadFile error: "+Object(T.d)(e.error)),e})}async uploadAndOverwriteFile(e){const t=this,r=e.memo.TransactionHash,a=`${this.baseFolderPath}/${e.memo.WalletId}/${e.memo.TransactionHash}${this.memoExt}`;return this.api.filesUpload({path:a,contents:e.memo.Content,mode:"overwrite"}).then(()=>(T.a.debug("DropboxApi::uploadAndOverwriteFile success: "+r+" file uploaded"),!0)).catch(e=>{throw Object(N.runInAction)(()=>{t.errorCode=e.status,t.errorMessage="An error ocurred while uploading the file"}),T.a.error("DropboxApi::uploadAndOverwrite error: "+Object(T.d)(e.error)),e})}async deleteFile(e){const t=`${this.baseFolderPath}/${e.walletId}/${e.txHash}${this.memoExt}`;return this.api.filesDelete({path:t}).then(()=>(T.a.debug("DropboxApi::deleteFile success: "+e.txHash+" file deleted"),!0)).catch(e=>{throw Object(N.runInAction)(()=>{self.errorCode=e.status,self.errorMessage="An error ocurred while deleting the file"}),T.a.error("DropboxApi::deleteFile error: "+Object(T.d)(e.error)),e})}async downloadFile(e){const t=this,r=`${this.baseFolderPath}/${e.walletId}/${e.txHash}${this.memoExt}`;return this.api.filesDownload({path:r}).then(t=>{if(T.a.debug("DropboxApi::downloadFile success: "+e.txHash+" file downloaded"),!t.fileBlob)throw new Error("No fileBlob");return t.fileBlob.text().then(e=>({content:e.substr(0,K.b),lastUpdated:B()(t.server_modified,"YYYY-MM-DDTHH:mm:ssZ").toDate()})).catch(e=>{throw T.a.error("DropboxApi::downloadFile error while parsing the file: "+Object(T.d)(e)),new Error("Unknown dropbox content error")})}).catch(e=>{throw Object(N.runInAction)(()=>{t.errorCode=e.status||"",t.errorMessage="An error ocurred while downloading the file"}),T.a.error("DropboxApi::downloadFile error: "+Object(T.d)(e.error)),e})}},n=W()(a.prototype,"errorMessage",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),s=W()(a.prototype,"errorCode",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),a);const F={[r(661).a.DROPBOX]:new M};class H{constructor(){var e,t,r,a,n,s,o,i,c,d;v()(this,"getProviders",()=>F),v()(this,"selectedProvider",void 0),v()(this,"wallet",void 0),this.setSelectedProvider=y()(e=this.setSelectedProvider).call(e,this),this.setup=y()(t=this.setup).call(t,this),this.fetchFolder=y()(r=this.fetchFolder).call(r,this),this.fetchFilenames=y()(a=this.fetchFilenames).call(a,this),this.createFolder=y()(n=this.createFolder).call(n,this),this.uploadFile=y()(s=this.uploadFile).call(s,this),this.uploadAndOverwriteFile=y()(o=this.uploadAndOverwriteFile).call(o,this),this.deleteFile=y()(i=this.deleteFile).call(i,this),this.downloadFile=y()(c=this.downloadFile).call(c,this),this.revokeToken=y()(d=this.revokeToken).call(d,this)}setup(){for(const e of g()(F))F[e].setup()}async setSelectedProvider(e){this.selectedProvider=F[e.provider];try{return this.selectedProvider.auth(e.token)}catch(e){throw T.a.error("ExternalStorageApi::setSelectedProvider error: "+Object(T.d)(e)),new m.d}}getDisplayName(){return this.getDisplayName()}async revokeToken(){try{return this.selectedProvider.revokeToken()}catch(e){throw T.a.error("ExternalStorageApi::revokeToken error: "+Object(T.d)(e)),new m.d}}async fetchFolder(e){try{return this.selectedProvider.fetchFolder(e)}catch(e){throw T.a.error("ExternalStorageApi::fetchFolder error: "+Object(T.d)(e)),new m.d}}async createFolder(e){try{return this.selectedProvider.createFolder(e)}catch(e){throw T.a.error("ExternalStorageApi::createFolder error: "+Object(T.d)(e)),new m.d}}async fetchFilenames(e){try{return this.selectedProvider.fetchFilenames(e)}catch(e){throw T.a.error("ExternalStorageApi::fetchFilenames error: "+Object(T.d)(e)),new m.d}}async uploadFile(e){try{return this.selectedProvider.uploadFile(e)}catch(e){throw T.a.error("ExternalStorageApi::uploadFile error: "+Object(T.d)(e)),new m.d}}async uploadAndOverwriteFile(e){try{return this.selectedProvider.uploadAndOverwriteFile(e)}catch(e){throw T.a.error("ExternalStorageApi::uploadAndOverwriteFile error: "+Object(T.d)(e)),new m.d}}async deleteFile(e){try{return this.selectedProvider.deleteFile(e)}catch(e){throw T.a.error("ExternalStorageApi::deleteFile error: "+Object(T.d)(e)),new m.d}}async downloadFile(e){try{return this.selectedProvider.downloadFile(e)}catch(e){throw T.a.error("ExternalStorageApi::downloadFile error: "+Object(T.d)(e)),new m.d}}}var V=r(11),$=r.n(V),q=r(17);const J=$()({csv:"csv"}),X=$()({CoinTracking:"CoinTracking"});class Y{constructor(){v()(this,"exportTransactions",async e=>{try{T.a.debug("ExportApi::exportTransactions: called");const{ticker:t,rows:r,format:a,fileType:n}=e,s=Y.createDefaultFileName(e.nameSuffix),o=Y.convertExportRowsToCsv(t,r,a),i=Y.convertCsvDataToFile(o,n);return T.a.debug("ExportApi::exportTransactions: success"),await this.sendFileToUser(i.data,`${s}.${i.fileType}`)}catch(e){throw T.a.error("ExportApi::exportTransactions: "+Object(T.d)(e)),e instanceof q.b?e:new m.d}})}static convertExportRowsToCsv(e,t,r=X.CoinTracking){switch(r){case X.CoinTracking:return function(e,t){return{headers:z,rows:S()(t).call(t,t=>[Z(t.type),"in"===t.type?t.amount:"","in"===t.type?e:"","out"===t.type?t.amount:"","out"===t.type?e:"","out"===t.type?t.fee:"","out"===t.type?e:"","","",null!=t.comment?t.comment:"",B()(t.date).format("YYYY-MM-DD HH:mm:ss")])}}(e,t);default:throw new Error("Unexpected export data format: "+r)}}static convertCsvDataToFile(e,t=J.csv){switch(t){case J.csv:return{fileType:t,data:Q(e)};default:throw new Error("Unexpected file type: "+t)}}async sendFileToUser(e,t){return await async function(e,t){const r=window.document.createElement("a");r.download=t,r.href=window.URL.createObjectURL(e);const a=document.body;if(!a)throw Error("Cannot send file to user! No `document.body` available!");a.appendChild(r),r.click(),a.removeChild(r)}(e,t)}}v()(Y,"createDefaultFileName",e=>"Yoroi-Transaction-History_"+e+"_"+B()().format("YYYY-MM-DD"));const z=["Type (Trade, IN or OUT)","Buy Amount","Buy Cur.","Sell Amount","Sell Cur.","Fee Amount (optional)","Fee Cur. (optional)","Exchange (optional)","Trade Group (optional)","Comment (optional)","Date"];function Z(e){switch(e){case"in":return"Deposit";case"out":return"Withdrawal";default:throw new Error("Unexpected export row type: "+e)}}function Q(e){var t;const r=S()(t=[e.headers,...e.rows]).call(t,e=>S()(e).call(e,e=>`"${e.replace(/"/g,'""')}"`).join(",")).join("\n");return new Blob([r],{type:"text/csv;charset=utf-8"})}const ee=async()=>({common:new l.a,ada:new u.a,ergo:new p.a,jormungandr:new h.a,localStorage:new f.a,externalStorage:new H,export:new Y}),te=async e=>{if(await e.api.localStorage.getLastLaunchVersion()===e.currVersion)return;const t=await e.api.common.migrate(e.api.localStorage,e.persistentDb);await e.api.localStorage.setLastLaunchVersion(e.currVersion),t&&(window.location.reload(),await new d.a(e=>i()(e,5e3)))}},707:function(e,t,r){"use strict";r.d(t,"b",(function(){return Z})),r.d(t,"a",(function(){return Q}));var a=r(66),n=r.n(a),s=r(10),o=r(56),i=r.n(o),c=r(30),d=r.n(c),l=r(8),u=r.n(l),p=r(37),h=r.n(p),f=r(11),w=r.n(f),g=r(15),b=r(50),y=r(138),I=r(151),v=r(655),T=r(656);async function m(e){var t,r;const a=[],n=w()({GetAllBip44Wallets:v.a,GetAllCip1852Wallets:T.a}),s=h()(t=u()(r=d()(n)).call(r,e=>n[e])).call(t,t=>Object(g.g)(e,t)),o=await Object(g.m)(e,s,async t=>({bip44:await n.GetAllBip44Wallets.get(e,t),cip1852:await n.GetAllCip1852Wallets.get(e,t)}));{const t=new i.a;for(const r of o.bip44){let n=t.get(r.Bip44Wrapper.ConceptualWalletId);null==n&&(n=await y.a.createBip44Wallet(e,r.Bip44Wrapper),t.set(r.Bip44Wrapper.ConceptualWalletId,n));const s=await b.a.createPublicDeriver(r.PublicDeriver,n);a.push(s)}}{const t=new i.a;for(const r of o.cip1852){let n=t.get(r.Cip1852Wrapper.ConceptualWalletId);null==n&&(n=await I.a.createCip1852Wallet(e,r.Cip1852Wrapper),t.set(r.Cip1852Wrapper.ConceptualWalletId,n));const s=await b.a.createPublicDeriver(r.PublicDeriver,n);a.push(s)}}return a}var x=r(23),A=r(17),k=r(34),D=r.n(k),O=r(371),S=r(79);const E="ACCOUNT",P="WALLET",C="LAST_BLOCK_NUMBER",_="SELECTED_EXPLORER",G=()=>{const e=d()(O.a);if(0===e.length)return!1;for(const t of e)delete O.a[t];return!0};async function W(e){const t=await N(P);if(!t)throw new Error("Need to create a wallet before saving wallet metadata");t.lastReceiveAddressIndex=e,await async function(e,t){await Object(S.e)(e,n()(t))}(P,t)}async function N(e){return await Object(S.b)(e).then(e=>null==e?e:JSON.parse(e))}r(649);var j=r(1292),R=r.n(j),B=r(303),K=r(555),U=r(6),L=r(243),M=r(556),F=r(33),H=r(77),V=r(47),$=r(120),q=r(20);async function J(e,t){let r=await e.getLastLaunchVersion();s.a.info(`Starting migration for ${r}`);const a=[["=0.0.1",async()=>await async function(e){return s.a.info("Starting testMigration"),await e.setUserLocale("ja-JP"),!0}(e)],["<1.9.0",async()=>{const t=await async function(e){const t=await e.getOldStorage();if(0===t.length)return!1;if(1===t.length&&null!=t[B.a])return t.clear(),!1;return await e.setStorage(t),t.clear(),!0}(e);return t&&(r=await e.getLastLaunchVersion()),t}],["<1.4.0",async()=>await async function(){var e;s.a.info("Starting bip44Migration");const t=await(O.a.Addresses?O.a.Addresses:[]),r=Math.max(...u()(e=D()(t).call(t,e=>0===e.change)).call(e,e=>e.index),0);try{await W(r)}catch(e){return!1}return await G(),!0}()],["<1.10.0",async()=>await async function(e){if(!await G()&&!V.a.isTest())return!1;const t=await async function(){const e=await N(P);return e||void 0}(),r=await async function(){const e=await N(E);if(!e)return null;if("V2"!==e.derivation_scheme)throw Error("Sanity check");return e}();if(null!=t&&null!=r){const a=await async function(){const e=await N(P);return e?e.lastReceiveAddressIndex:0}(),n=q.j.CardanoMainnet;if(null==n.BaseConfig[0].ByronNetworkId)throw new Error("missing Byron network id");const{ByronNetworkId:s}=n.BaseConfig[0],o=U.a.WalletV2.BlockchainSettings.from_json({protocol_magic:s});await Object(K.c)({db:e,accountPubKey:r.root_cached_key,displayCutoff:a,encryptedPk:null==t.masterKey?void 0:{Hash:t.masterKey,IsEncrypted:!0,PasswordLastUpdate:null==t.adaWallet.cwPassphraseLU?null:new Date(t.adaWallet.cwPassphraseLU),Type:$.a.BIP32ED25519},hwWalletMetaInsert:null==t.adaWallet.cwHardwareInfo?void 0:{Vendor:t.adaWallet.cwHardwareInfo.vendor,Model:t.adaWallet.cwHardwareInfo.model,DeviceId:t.adaWallet.cwHardwareInfo.deviceId},settings:o,walletName:t.adaWallet.cwMeta.cwName,network:n})}return await async function(){await Object(S.d)(E),await Object(S.d)(P),await Object(S.d)(C)}(),!0}(t)],["=1.10.0",async()=>await X(t)],[">=2.0.0 <2.4.0",async()=>await X(t)],["<3.0.0",async()=>null!=await Object(S.b)(_)&&(await Object(S.d)(_),!0)],["<3.3.0",async()=>{const e=await X(t),r=await async function(e){const t=await m(e);if(0===t.length)return!1;let r=!1;for(const e of t)Object(H.b)(e.getParent())&&(await Object(M.a)({publicDeriver:e,conceptualWallet:e.getParent()}),r=!0);return r}(t);return e||r}],["<3.7.0",async()=>await async function(e){const t=await m(e);if(0===t.length)return!1;let r=!1;for(const e of t)Object(q.g)(e.getParent().getNetworkInfo())&&(await Object(M.a)({publicDeriver:e,conceptualWallet:e.getParent()}),r=!0);return r}(t)],["<3.8.0",async()=>await X(t)],["<3.9.6",async()=>await async function(e){const t=await m(e);if(0===t.length)return!1;for(const e of t){const t=Object(F.j)(e);if(Object(q.g)(e.getParent().getNetworkInfo())){if(null==t)throw new Error("ergoTxHistoryReset missing levels");await Object(L.e)({publicDeriver:t})}}return!0}(t)]];let n=!1;for(const e of a)if(R()(r,e[0])){s.a.info(`Migration started for ${e[0]}`),await e[1]()?(s.a.info(`Applied migration for ${e[0]}`),n=!0):s.a.info(`No need to apply migration for ${e[0]}`)}return n}async function X(e){const t=await m(e);if(0===t.length)return!1;for(const e of t){const t=Object(F.j)(e);if(Object(q.f)(e.getParent().getNetworkInfo())){if(null==t)throw new Error("cardanoTxHistoryReset missing levels");await Object(L.e)({publicDeriver:t})}}return!0}r(109);var Y=r(173),z=r(25);async function Z(e){s.a.debug("getWallets called");try{const t=await m(e.db);return s.a.debug("getWallets success: "+Object(s.c)(t)),t}catch(e){if(s.a.error("getWallets error: "+Object(s.d)(e)),e instanceof A.b)throw e;throw new x.d}}class Q{async getTokenInfo(e){s.a.debug("getTokenInfo called");try{const t=await async function(e){var t,r;const a=w()({GetToken:z.n}),n=h()(t=u()(r=d()(a)).call(r,e=>a[e])).call(t,t=>Object(g.g)(e.db,t));return await Object(g.m)(e.db,n,async t=>a.GetToken.all(e.db,t))}(e);return s.a.debug("getTokenInfo success: "+Object(s.c)(t)),t}catch(e){if(s.a.error("getTokenInfo error: "+Object(s.d)(e)),e instanceof A.b)throw e;throw new x.d}}async getTxLastUpdatedDate(e){try{return await e.getLastSyncInfo()}catch(e){if(s.a.error("CommonApi::getTxLastUpdatedDate error: "+Object(s.d)(e)),e instanceof A.b)throw e;throw new x.d}}async createAddress(e){s.a.debug("CommonApi::createAddress called");try{const t=await e.popFunc();return s.a.info("CommonApi::createAddress success: "+Object(s.c)(t)),t}catch(e){if(s.a.error("CommonApi::createAddress error: "+Object(s.d)(e)),e instanceof A.b)throw e;throw new x.d}}async getBalance(e){try{return await e.getBalance()}catch(e){if(s.a.error("CommonApi::getBalance error: "+Object(s.d)(e)),e instanceof A.b)throw e;throw new x.d}}async migrate(e,t){return await J(e,t)}async exportLocalDatabase(e){const t=await e.export();return n()(t)}async renameModel(e){s.a.debug("CommonApi::renameModel called: "+Object(s.c)(e));try{const t=await e.func(e.request);return s.a.debug("CommonApi::renameModel success: "+Object(s.c)(t)),t}catch(e){if(s.a.error("CommonApi::renameModel error: "+Object(s.d)(e)),e instanceof A.b)throw e;throw new x.d}}async changeModelPassword(e){s.a.debug("CommonApi::changeModelPassword called");try{const t=await e.func(e.request);return s.a.debug("CommonApi::changeModelPassword success"),t}catch(e){if(s.a.error("CommonApi::changeModelPassword error: "+Object(s.d)(e)),e instanceof Y.a)throw new x.t;if(e instanceof A.b)throw e;throw new x.d}}}},709:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r(11);const n=r.n(a)()({legacyUtxo:void 0,utxo:"utxo",account:"account"})},710:function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return S})),r.d(t,"a",(function(){return P})),r.d(t,"c",(function(){return C}));var a=r(34),n=r.n(a),s=r(35),o=r.n(s),i=r(273),c=r.n(i),d=r(32),l=r.n(d),u=r(8),p=r.n(u),h=r(113),f=r.n(h),w=r(55),g=r.n(w),b=r(56),y=r.n(b),I=r(29),v=r.n(I),T=r(23),m=r(53),x=(r(134),r(1302)),A=(r(456),r(6)),k=r(21),D=r(38),O=r(493);function S(t){var r;const a=new y.a;for(const e of t.utxos)a.set({amount:e.amount,receiver:e.receiver,tx_hash:e.tx_hash,tx_index:e.tx_index,creationHeight:e.creationHeight,boxId:e.boxId,assets:e.assets,additionalRegisters:e.additionalRegisters,ergoTree:e.ergoTree},e);const n=function(t){var r;if(0===t.utxos.length)throw new T.x;const a=A.a.SigmaRust.ErgoBoxes.from_boxes_json(Object(O.c)(t.utxos)),n=l()(r=t.utxos).call(r,(e,t)=>e.plus(t.amount),new v.a(0));if(n.minus(t.txFee).lt(t.protocolParams.MinimumBoxValue))throw new T.x;const s=function(e){const t=new y.a;for(const r of e){const{assets:e}=r;if(null!=e)for(const r of e){const e=t.get(r.tokenId)||new v.a(0);t.set(r.tokenId,e.plus(r.amount))}}return t}(t.utxos),o=(()=>{const e=new A.a.SigmaRust.ErgoBoxAssetsDataList,r=new A.a.SigmaRust.Tokens;for(const e of c()(s).call(s))r.add(new A.a.SigmaRust.Token(A.a.SigmaRust.TokenId.from_str(e[0]),A.a.SigmaRust.TokenAmount.from_i64(A.a.SigmaRust.I64.from_str(e[1].toString()))));const a=A.a.SigmaRust.BoxValue.from_i64(A.a.SigmaRust.I64.from_str(n.minus(t.txFee).toString()));return e.add(new A.a.SigmaRust.ErgoBoxAssetsData(a,r)),e})(),i=new A.a.SigmaRust.BoxSelection(a,o),d=A.a.SigmaRust.TxBuilder.new(i,A.a.SigmaRust.ErgoBoxCandidates.empty(),t.currentHeight,A.a.SigmaRust.BoxValue.from_i64(A.a.SigmaRust.I64.from_str(t.txFee.toString())),A.a.SigmaRust.Address.from_bytes(e.from(t.receiver.address,"hex")),A.a.SigmaRust.BoxValue.from_i64(A.a.SigmaRust.I64.from_str(t.protocolParams.MinimumBoxValue.toString()))),u=(()=>{if(null==t.receiver.addressing)return[];const{addressing:e}=t.receiver;return E(o,e,t.receiver.address,t.protocolParams.NetworkId)})();return{senderUtxos:t.utxos,unsignedTx:d,changeAddr:u}}({receiver:t.receiver,currentHeight:t.currentHeight,protocolParams:t.protocolParams,txFee:t.txFee,utxos:g()(f()(a).call(a))});return{senderUtxos:p()(r=n.senderUtxos).call(r,e=>{const t=a.get(e);if(null==t)throw new Error("sendAllUnsignedTx utxo reference was changed. Should not happen");return t}),unsignedTx:n.unsignedTx,changeAddr:n.changeAddr}}function E(e,t,r,a){const n=[];for(let s=0;s<e.len();s++){const o=e.get(s),i=new D.a([],{defaultNetworkId:a,defaultIdentifier:k.c.Ergo});i.add({identifier:k.c.Ergo,amount:new v.a(o.value().as_i64().to_str()),networkId:a});const c=o.tokens();for(let e=0;e<c.len();e++){const t=c.get(e);i.add({identifier:t.id().to_str(),amount:new v.a(t.amount().as_i64().to_str()),networkId:a})}n.push({addressing:t,address:r,values:i})}return n}function P(t){var r;const a=new y.a;for(const e of t.utxos)a.set({amount:e.amount,receiver:e.receiver,tx_hash:e.tx_hash,tx_index:e.tx_index,creationHeight:e.creationHeight,boxId:e.boxId,assets:e.assets,additionalRegisters:e.additionalRegisters,ergoTree:e.ergoTree},e);const s=function(t){var r;if(0===t.utxos.length)throw new T.x;const a=(()=>{let r=null;for(const a of t.outputs){const n=new A.a.SigmaRust.ErgoBoxCandidateBuilder(A.a.SigmaRust.BoxValue.from_i64(A.a.SigmaRust.I64.from_str(a.amount.getDefaultEntry().amount.toString())),A.a.SigmaRust.Contract.pay_to_address(A.a.SigmaRust.Address.from_bytes(e.from(a.address,"hex"))),t.currentHeight);for(const e of a.amount.nonDefaultEntries())n.add_token(A.a.SigmaRust.TokenId.from_str(e.identifier),A.a.SigmaRust.TokenAmount.from_i64(A.a.SigmaRust.I64.from_str(e.amount.toString())));const s=n.build();null==r?r=new A.a.SigmaRust.ErgoBoxCandidates(s):r.add(s)}if(null==r)throw new Error("newErgoUnsignedTxFromUtxo Ergo txs require at least one output");return r})(),s=A.a.SigmaRust.ErgoBoxes.from_boxes_json(Object(O.c)(t.utxos)),i=(()=>{const e=new A.a.SigmaRust.SimpleBoxSelector;try{var r;const a=l()(r=t.outputs).call(r,(e,t)=>e.joinAddCopy(t.amount),new D.a([],{defaultIdentifier:t.protocolParams.DefaultIdentifier,defaultNetworkId:t.protocolParams.NetworkId}));a.add({amount:t.txFee,identifier:t.protocolParams.DefaultIdentifier,networkId:t.protocolParams.NetworkId});const n=new A.a.SigmaRust.Tokens;for(const e of a.nonDefaultEntries())n.add(new A.a.SigmaRust.Token(A.a.SigmaRust.TokenId.from_str(e.identifier),A.a.SigmaRust.TokenAmount.from_i64(A.a.SigmaRust.I64.from_str(e.amount.toString()))));return e.select(s,A.a.SigmaRust.BoxValue.from_i64(A.a.SigmaRust.I64.from_str(a.getDefaultEntry().amount.toString())),n)}catch(e){throw new T.x}})(),c=A.a.SigmaRust.TxBuilder.new(i,a,t.currentHeight,A.a.SigmaRust.BoxValue.from_i64(A.a.SigmaRust.I64.from_str(t.txFee.toString())),A.a.SigmaRust.Address.from_bytes(e.from(t.changeAddr.address,"hex")),A.a.SigmaRust.BoxValue.from_i64(A.a.SigmaRust.I64.from_str(t.protocolParams.MinimumBoxValue.toString()))),d=E(i.change(),t.changeAddr.addressing,t.changeAddr.address,t.protocolParams.NetworkId),u=(()=>{const e=i.boxes(),t=new o.a;for(let r=0;r<e.len();r++){const a=e.get(r);t.add(a.box_id().to_str())}return t})();return{changeAddr:d,senderUtxos:n()(r=t.utxos).call(r,e=>u.has(e.boxId)),unsignedTx:c}}({outputs:t.outputs,currentHeight:t.currentHeight,changeAddr:t.changeAddr,utxos:g()(f()(a).call(a)),txFee:t.txFee,protocolParams:t.protocolParams});return{senderUtxos:p()(r=s.senderUtxos).call(r,e=>{const t=a.get(e);if(null==t)throw new Error("newErgoUnsignedTx utxo reference was changed. Should not happen");return t}),unsignedTx:s.unsignedTx,changeAddr:s.changeAddr}}function C(e){var t;if(e.signRequest.unsignedTx.data_inputs().len()>0)throw new Error("signTransaction data inputs not supported by sigma rust");const r=e.signRequest.unsignedTx.build(),a=function(e){const t=new A.a.SigmaRust.SecretKeys;for(const r of e.senderUtxos){if(r.addressing.startLevel+r.addressing.path.length-1!==m.a.ADDRESS.level)throw new Error("generateKeys incorrect addressing size");const a=Object(x.a)({addressing:r.addressing,startingFrom:{level:e.keyLevel,key:e.signingKey}}).key.privateKey;if(null==a)throw new Error("generateKeys private key not found (should never happen)");const n=A.a.SigmaRust.SecretKey.dlog_from_bytes(a);t.add(n)}return t}({senderUtxos:e.signRequest.senderUtxos,keyLevel:e.keyLevel,signingKey:e.signingKey}),n=A.a.SigmaRust.Wallet.from_secrets(a).sign_transaction(A.a.SigmaRust.ErgoStateContext.dummy(),r,e.signRequest.unsignedTx.box_selection().boxes(),A.a.SigmaRust.ErgoBoxes.from_boxes_json([])).to_json();return{inputs:n.inputs,dataInputs:n.dataInputs,outputs:p()(t=n.outputs).call(t,e=>({value:e.value,ergoTree:e.ergoTree,creationHeight:e.creationHeight,assets:e.assets,additionalRegisters:e.additionalRegisters}))}}}).call(this,r(48).Buffer)},711:function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return o})),r.d(t,"c",(function(){return i}));var a=r(23),n=r(6);function s(e,t,r,n){const s=[];if(0===t.length)throw new a.x;for(let r=0;r<t.length;r++)s.push(t[r]),e.add_input(i(t[r]));if(!e.get_balance(n,r).is_negative())return s;throw new a.x}function o(e,t,r,n){const s=[];if(0===t.length)throw new a.x;for(let o=0;o<t.length;o++){if(s.push(t[o]),e.add_input(i(t[o])),!e.get_balance(n,r).is_negative())break;if(o===t.length-1)throw new a.x}return s}function i(t){const r=n.a.WalletV3.UtxoPointer.new(n.a.WalletV3.FragmentId.from_bytes(e.from(t.tx_hash,"hex")),t.tx_index,n.a.WalletV3.Value.from_str(t.amount));return n.a.WalletV3.Input.from_utxo(r)}}).call(this,r(48).Buffer)},714:function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return p})),r.d(t,"a",(function(){return h}));var a=r(30),n=r.n(a),s=r(227),o=r.n(s),i=r(8),c=r.n(i),d=r(6);function l(t){var r,a;return e.from(t.from+t.timestamp+c()(r=o()(a=n()(t.prices)).call(a)).call(r,e=>e+t.prices[e]).join(""),"utf8")}function u(e,t,r,a){return a.verify(t(e),d.a.WalletV3.Ed25519Signature.from_hex(r))}function p(e,t){if(null==e.signature)throw new Error("ticker has no signature");return u(e,l,e.signature,t)}function h(t,r,a){return u(t,t=>e.from(t),r,d.a.WalletV3.PublicKey.from_bytes(e.from(a,"hex")))}}).call(this,r(48).Buffer)},744:function(e,t,r){"use strict";r.d(t,"c",(function(){return v})),r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return m}));var a=r(30),n=r.n(a),s=r(8),o=r.n(s),i=r(37),c=r.n(i),d=r(11),l=r.n(d),u=r(15),p=(r(50),r(1)),h=r.n(p),f=r(242);class w{static async getAllMemos(e,t){return await Object(u.f)(e,t,w.ownTables[f.a.name].name)}}h()(w,"ownTables",l()({[f.a.name]:f.a})),h()(w,"depTables",l()({}));var g=r(22),b=r(25),y=r(118);class I{static async upsertMemo(e,t,r){const{TransactionSeed:a}=await I.depTables.GetEncryptionMeta.get(e,t),n=Object(y.a)(r.TransactionHash,a),s={...r,Digest:n};return await Object(u.d)(e,t,s,I.ownTables[f.a.name].name)}static async deleteMemo(e,t,r){const{TransactionSeed:a}=await I.depTables.GetEncryptionMeta.get(e,t),n=Object(y.a)(r.txHash,a),s=e.getSchema().table(I.ownTables[f.a.name].name),{properties:o}=I.ownTables[f.a.name];await t.attach(e.delete().from(s).where(g.op.and(s[o.Digest].eq(n),s[o.WalletId].eq(r.walletId))))}}async function v(e){var t,r;const a=l()({ModifyTxMemo:I}),s=c()(t=o()(r=n()(a)).call(r,e=>a[e])).call(t,t=>Object(u.g)(e.db,t));return await Object(u.m)(e.db,s,async t=>a.ModifyTxMemo.upsertMemo(e.db,t,e.memo))}async function T(e){var t,r;const a=l()({ModifyTxMemo:I}),s=c()(t=o()(r=n()(a)).call(r,e=>a[e])).call(t,t=>Object(u.g)(e.db,t));return await Object(u.m)(e.db,s,async t=>a.ModifyTxMemo.deleteMemo(e.db,t,e.key))}async function m(e){var t,r;const a=l()({GetTxMemo:w}),s=c()(t=o()(r=n()(a)).call(r,e=>a[e])).call(t,t=>Object(u.g)(e.db,t));return await Object(u.m)(e.db,s,async t=>a.GetTxMemo.getAllMemos(e.db,t))}h()(I,"ownTables",l()({[f.a.name]:f.a})),h()(I,"depTables",l()({GetEncryptionMeta:b.h}))},745:function(e,t,r){"use strict";r.d(t,"b",(function(){return I})),r.d(t,"a",(function(){return v})),r.d(t,"c",(function(){return T}));var a=r(56),n=r.n(a),s=r(30),o=r.n(s),i=r(8),c=r.n(i),d=r(37),l=r.n(d),u=r(11),p=r.n(u),h=(r(22),r(15)),f=r(1),w=r.n(f),g=r(147);class b{static async getAll(e,t){return await Object(h.f)(e,t,b.ownTables[g.a.name].name)}static async getBackups(e,t){const r=b.ownTables[g.a.name],a=e.getSchema().table(r.name),n=e.select().from(a).where(a[r.properties.IsBackup].eq(!0));return await t.attach(n)}static async getPreferredExplorer(e,t){const r=new n.a,a=await b.getBackups(e,t);for(const e of a)r.set(e.NetworkId,e);const s=b.ownTables[g.a.name],i=e.getSchema().table(s.name),c=b.ownTables[g.b.name],d=e.getSchema().table(c.name),l=e.select().from(i).innerJoin(d,d[c.properties.ExplorerId].eq(i[s.properties.ExplorerId])),u=await t.attach(l);for(const e of u)0!==o()(e.Explorer.Endpoints).length&&r.set(e.Explorer.NetworkId,e.Explorer);return r}}w()(b,"ownTables",p()({[g.a.name]:g.a,[g.b.name]:g.b})),w()(b,"depTables",p()({}));var y=r(657);async function I(e){var t,r;const a=p()({GetExplorers:b}),s=l()(t=c()(r=o()(a)).call(r,e=>a[e])).call(t,t=>Object(h.g)(e.db,t));return await Object(h.m)(e.db,s,async t=>{const r=await a.GetExplorers.getPreferredExplorer(e.db,t),s=await a.GetExplorers.getBackups(e.db,t);if(r.size!==s.length)throw new Error("getSelectedExplorer size mismatch");const o=new n.a;for(const e of s){const t=r.get(e.NetworkId);if(null==t)throw new Error("getSelectedExplorer key mismatch");o.set(e.NetworkId,{backup:e,selected:t})}return o})}async function v(e){var t,r;const a=p()({GetExplorers:b}),s=l()(t=c()(r=o()(a)).call(r,e=>a[e])).call(t,t=>Object(h.g)(e.db,t));return await Object(h.m)(e.db,s,async t=>{const r=await a.GetExplorers.getAll(e.db,t),s=new n.a;for(const e of r){const t=s.get(e.NetworkId);null==t?s.set(e.NetworkId,[e]):t.push(e)}return s})}async function T(e){var t,r;const a=p()({ModifyPreferredExplorer:y.b}),n=l()(t=c()(r=o()(a)).call(r,e=>a[e])).call(t,t=>Object(h.g)(e.db,t));return await Object(h.m)(e.db,n,async t=>a.ModifyPreferredExplorer.upsert(e.db,t,{ExplorerId:e.explorer.ExplorerId,NetworkId:e.explorer.NetworkId}))}},76:function(e,t,r){"use strict";r.d(t,"b",(function(){return x})),r.d(t,"c",(function(){return k})),r.d(t,"a",(function(){return O})),r.d(t,"d",(function(){return S}));var a=r(11),n=r.n(a),s=r(56),o=r.n(s),i=r(35),c=r.n(i),d=r(55),l=r.n(d),u=r(1),p=r.n(u),h=r(8),f=r.n(h),w=r(22),g=r(43),b=r(91),y=r(16),I=r(25),v=r(21),T=r(15);async function m(e,t,r,a,n){const s=await D.depTables.AssociateToken.join(e,t,{listIds:f()(r).call(r,e=>a(e)),networkId:n}),o=[];for(const e of r){const t={...e,tokens:[]};for(const r of s)r.TokenList.ListId===a(e)&&t.tokens.push(r);o.push(t)}return o}class x{static async fromAddressIds(e,t,r){const a=x.ownTables[b.a.name];return await Object(T.j)(e,t,a.name,a.properties.AddressId,r.ids)}static async fromTxIds(e,t,r){const a=x.ownTables[b.a.name];return await Object(T.j)(e,t,a.name,a.properties.TransactionId,r.ids)}}p()(x,"ownTables",n()({[b.a.name]:b.a})),p()(x,"depTables",n()({}));class A{static async fromAddressIds(e,t,r){const a=A.ownTables[b.b.name];return await Object(T.j)(e,t,a.name,a.properties.AddressId,r.ids)}static async fromTxIds(e,t,r){const a=A.ownTables[b.b.name];return await Object(T.j)(e,t,a.name,a.properties.TransactionId,r.ids)}}p()(A,"ownTables",n()({[b.b.name]:b.b})),p()(A,"depTables",n()({}));class k{static baseQuery(e,t){const r=e.getSchema().table(k.ownTables[y.m.name].name),a=e.getSchema().table(k.ownTables[b.b.name].name);return e.select().from(r).innerJoin(a,r[y.m.properties.TransactionId].eq(a[b.b.properties.TransactionId])).where(t(r,a))}static async getSingleOutput(e,t,r){const a=k.baseQuery(e,(e,t)=>w.op.and(e[y.m.properties.TransactionId].eq(r.txId),t[b.b.properties.OutputIndex].eq(r.outputIndex))),n=await t.attach(a);if(0!==n.length)return(await m(e,t,n,e=>e.UtxoTransactionOutput.TokenListId,r.networkId))[0]}static async getUtxo(e,t,r,a){const n=k.baseQuery(e,(e,t)=>w.op.and(e[y.m.properties.Status].eq(v.d.IN_BLOCK),t[b.b.properties.IsUnspent].eq(!0),t[b.b.properties.AddressId].in(r))),s=await t.attach(n);return await m(e,t,s,e=>e.UtxoTransactionOutput.TokenListId,a)}static async getOutputsForAddresses(e,t,r,a,n){const s=k.baseQuery(e,(e,t)=>w.op.and(e[y.m.properties.Status].in(a),t[b.b.properties.AddressId].in(r))),o=await t.attach(s);return await m(e,t,o,e=>e.UtxoTransactionOutput.TokenListId,n)}}p()(k,"ownTables",n()({[y.m.name]:y.m,[b.b.name]:b.b,[b.b.name]:b.b})),p()(k,"depTables",n()({}));class D{static baseQuery(e,t){const r=e.getSchema().table(D.ownTables[y.m.name].name),a=e.getSchema().table(D.ownTables[b.a.name].name);return e.select().from(r).innerJoin(a,r[y.m.properties.TransactionId].eq(a[b.a.properties.TransactionId])).where(t(r,a))}static async getInputsForAddresses(e,t,r,a,n){const s=D.baseQuery(e,(e,t)=>w.op.and(e[y.m.properties.Status].in(a),t[b.a.properties.AddressId].in(r))),o=await t.attach(s);return await m(e,t,o,e=>e.UtxoTransactionInput.TokenListId,n)}}p()(D,"ownTables",n()({[y.m.name]:y.m,[b.a.name]:b.a})),p()(D,"depTables",n()({AssociateToken:I.a}));class O{static async getTxIdsForAddresses(e,t,r){const a=await O.depTables.GetUtxoInputs.fromAddressIds(e,t,{ids:r.addressIds}),n=await O.depTables.GetUtxoOutputs.fromAddressIds(e,t,{ids:r.addressIds});return l()(new c.a([...f()(a).call(a,e=>e.TransactionId),...f()(n).call(n,e=>e.TransactionId)]))}static async getIOsForTx(e,t,r){var a;const n=f()(a=r.txs).call(a,e=>e.TransactionId),s=await O.depTables.GetUtxoInputs.fromTxIds(e,t,{ids:n}),i=await O.depTables.GetUtxoOutputs.fromTxIds(e,t,{ids:n}),c=Object(g.groupBy)(s,e=>e.TransactionId),d=Object(g.groupBy)(i,e=>e.TransactionId),l=new o.a;for(const e of r.txs)l.set(e,{utxoInputs:c[e.TransactionId]||[],utxoOutputs:d[e.TransactionId]||[]});return l}}async function S(e,t,r){let a=await r.AssociateToken.nextTokenListId(e,t);return()=>{const e=a;return a++,e}}p()(O,"ownTables",n()({})),p()(O,"depTables",n()({GetUtxoInputs:x,GetUtxoOutputs:A}))},77:function(e,t,r){"use strict";r.d(t,"a",(function(){return D})),r.d(t,"d",(function(){return O})),r.d(t,"c",(function(){return E})),r.d(t,"b",(function(){return P}));var a=r(197),n=r.n(a),s=r(30),o=r.n(s),i=r(8),c=r.n(i),d=r(37),l=r.n(d),u=r(11),p=r.n(u),h=r(1),f=r.n(h),w=r(198),g=r.n(w),b=r(241),y=r.n(b),I=r(187),v=r(15),T=r(119),m=r(86),x=r(52),A=new n.a,k=new n.a;class D{constructor(e){return f()(this,"db",void 0),A.set(this,{writable:!0,value:void 0}),k.set(this,{writable:!0,value:void 0}),f()(this,"walletType",void 0),f()(this,"hardwareInfo",void 0),f()(this,"networkInfo",void 0),f()(this,"defaultToken",void 0),f()(this,"getWalletType",()=>this.walletType),f()(this,"getHwWalletMeta",()=>this.hardwareInfo),f()(this,"rename",async e=>{var t,r;const a=p()({ModifyConceptualWallet:T.c}),n=l()(t=c()(r=o()(a)).call(r,e=>a[e])).call(t,e=>Object(v.g)(this.db,e));return await Object(v.m)(this.db,n,async t=>{await a.ModifyConceptualWallet.rename(this.db,t,{walletId:g()(this,A),newName:e.newName})})}),f()(this,"getFullConceptualWalletInfo",async()=>{var e,t;const r=p()({GetConceptualWallet:m.a}),a=l()(e=c()(t=o()(r)).call(t,e=>r[e])).call(e,e=>Object(v.g)(this.db,e));return await Object(v.m)(this.db,a,async e=>{const t=await r.GetConceptualWallet.get(this.db,e,g()(this,A));if(null==t)throw new v.a("getFullConceptualWalletInfo ConceptualWallet==null");return t})}),f()(this,"rawRemove",async(e,t)=>{await O(e,t,this.getConceptualWalletId())}),this.db=e.db,y()(this,A,e.conceptualWalletId),this.walletType=e.walletType,this.hardwareInfo=e.hardwareInfo,this.networkInfo=e.networkInfo,this.defaultToken=e.defaultToken,this}getDb(){return this.db}getNetworkInfo(){return this.networkInfo}getDefaultToken(){return{defaultNetworkId:this.networkInfo.NetworkId,defaultIdentifier:this.defaultToken.Identifier}}getConceptualWalletId(){return g()(this,A)}}async function O(e,t,r){await T.c.remove(e,t,[r])}function S(e,t){if(!(e.getWalletType()===I.a.HARDWARE_WALLET))return!1;const r=e.getHwWalletMeta();return null!=r&&t(r)}function E(e){const t=x.a.wallets.hardwareWallet.trezorT.VENDOR,r=x.a.wallets.hardwareWallet.trezorT.MODEL;return S(e,e=>e.Vendor===t&&e.Model===r)}function P(e){const t=x.a.wallets.hardwareWallet.ledgerNano.VENDOR;return S(e,e=>e.Vendor===t)}},787:function(e,t,r){"use strict";r(38)},79:function(e,t,r){"use strict";r.d(t,"b",(function(){return h})),r.d(t,"e",(function(){return f})),r.d(t,"d",(function(){return w})),r.d(t,"a",(function(){return g})),r.d(t,"c",(function(){return b}));var a=r(30),n=r.n(a),s=r(11),o=r.n(s),i=r(66),c=r.n(i),d=r(40),l=r.n(d),u=r(47);const p=async e=>new l.a((t,r)=>{chrome.storage.local.get(e,a=>{if(chrome.runtime.lastError&&r(chrome.runtime.lastError),void 0===e)t(c()(a));else{const n=a[e];null==n||"string"==typeof n?t(n):r(new Error("getStorageItemInExtension cannot get non-string value"))}})});async function h(e){return u.a.userAgentInfo.isExtension()?await p(e):await(async e=>void 0===e?l.a.resolve(c()(localStorage)):l.a.resolve(localStorage[e]))(e)}async function f(e,t){u.a.userAgentInfo.isExtension()?await new l.a((r,a)=>{chrome.storage.local.set({[e]:t},()=>{chrome.runtime.lastError&&a(chrome.runtime.lastError),r()})}):localStorage.setItem(e,t)}async function w(e){u.a.userAgentInfo.isExtension()?await new l.a((t,r)=>{chrome.storage.local.remove(e,()=>{chrome.runtime.lastError&&r(chrome.runtime.lastError),t()})}):localStorage.removeItem(e)}function g(e){u.a.userAgentInfo.isExtension()?chrome.storage.onChanged.addListener((t,r)=>{e(t)}):window.addEventListener("storage",t=>{if(null==t.key)return;const r=null!=t.oldValue?{oldValue:JSON.parse(t.oldValue)}:o()({}),a=null!=t.newValue?{newValue:JSON.parse(t.newValue)}:o()({});e({[t.key]:{...r,...a}})})}async function b(){if(u.a.userAgentInfo.isExtension()){return await p().then(e=>0===n()(e).length)}return 0===localStorage.length}},839:function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return v})),r.d(t,"a",(function(){return T}));var a=r(35),n=r.n(a),s=r(90),o=r.n(s),i=r(40),c=r.n(i),d=r(8),l=r.n(d),u=r(43),p=(r(22),r(19)),h=r(239),f=(r(6),r(188)),w=r(53),g=r(130),b=r(360),y=r(120);async function I(e,t,r){var a;const n=Object(u.range)(0,p.a),s=t.derive(p.c.CHIMERIC_ACCOUNT).derive(p.h).to_raw_key(),o=l()(n).call(n,e=>t.derive(p.c.EXTERNAL).derive(e).to_raw_key().hash()),i=l()(n).call(n,e=>t.derive(p.c.INTERNAL).derive(e).to_raw_key().hash()),d=l()(n).call(n,t=>({index:t,insert:async a=>await Object(b.b)(r,a,s,o[t],e)})),h=l()(n).call(n,t=>({index:t,insert:async a=>await Object(b.b)(r,a,s,i[t],e)})),f=l()(a=[0]).call(a,t=>({index:t,insert:async t=>await Object(b.a)(r,t,s,e)}));return[{index:p.c.EXTERNAL,insert:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:0}),children:d},{index:p.c.INTERNAL,insert:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:h},{index:p.c.CHIMERIC_ACCOUNT,insert:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId,DisplayCutoff:null}),children:f}]}async function v(e){if(e.accountIndex<p.g)throw new Error("createStandardCip1852Wallet needs hardened index");const t=Object(f.b)(e.password,e.rootPk.as_bytes()),r=e.rootPk.derive(p.i.CIP1852).derive(p.d.CARDANO).derive(e.accountIndex).to_public();if(null==e.network.BaseConfig[0].ChainNetworkId)throw new Error("createStandardCip1852Wallet missing Byron network id");const a=await I(o()(e.network.BaseConfig[0].ChainNetworkId,10),r,Object(g.a)(new n.a)),s=[];let i;return i=await h.a.start(e.db,w.b).addConceptualWallet(t=>({NetworkId:e.network.NetworkId,Name:e.walletName})).addFromRoot(e=>({rootInsert:{privateKeyInfo:{Hash:t,IsEncrypted:!0,PasswordLastUpdate:null,Type:y.a.BIP32ED25519},publicKeyInfo:null,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:null,Index:null}),levelInfo:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId})},tree:e=>({derivationId:e,children:[]})})).addCip1852Wrapper(e=>({ConceptualWalletId:e.conceptualWalletRow.ConceptualWalletId,SignerLevel:w.a.ROOT.level,PublicDeriverLevel:w.a.ACCOUNT.level,PrivateDeriverKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId,PrivateDeriverLevel:s.length,RootKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId})).derivePublicDeriver(t=>{const r=t.cip1852WrapperRow.PrivateDeriverKeyDerivationId,n=t.cip1852WrapperRow.PrivateDeriverLevel;if(null==r||null==n)throw new Error("createStandardCip1852Wallet missing private deriver");return{deriverRequest:{decryptPrivateDeriverPassword:e.password,publicDeriverMeta:{name:e.accountName},path:[{index:p.i.CIP1852,insert:{}},{index:p.d.CARDANO,insert:{}},{index:e.accountIndex,insert:{}}],initialDerivations:a},privateDeriverKeyDerivationId:r,privateDeriverLevel:n}}).commit(),i}async function T(t){if(t.accountIndex<p.g)throw new Error("createStandardCip1852Wallet needs hardened index");const r=await I(o()(t.network.BaseConfig[0].ChainNetworkId,10),t.accountPublicKey,Object(g.a)(new n.a));let a;return a=await h.a.start(t.db,w.b).addConceptualWallet(e=>({NetworkId:t.network.NetworkId,Name:t.walletName})).addFromRoot(e=>({rootInsert:{privateKeyInfo:null,publicKeyInfo:null,derivationInfo:e=>({PublicKeyId:e.public,PrivateKeyId:e.private,Parent:null,Index:null}),levelInfo:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId})},tree:e=>({derivationId:e,children:[]})})).addCip1852Wrapper(e=>({ConceptualWalletId:e.conceptualWalletRow.ConceptualWalletId,SignerLevel:null,PublicDeriverLevel:w.a.ACCOUNT.level,PrivateDeriverKeyDerivationId:null,PrivateDeriverLevel:null,RootKeyDerivationId:e.root.root.KeyDerivation.KeyDerivationId})).addAdhocPublicDeriver(a=>({parentDerivationId:a.root.root.KeyDerivation.KeyDerivationId,pathStartLevel:1,publicDeriverMeta:{name:t.accountName},pathToPublic:[{index:p.i.CIP1852,insert:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId}),publicKey:null,privateKey:null},{index:p.d.CARDANO,insert:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId}),publicKey:null,privateKey:null},{index:t.accountIndex,insert:e=>c.a.resolve({KeyDerivationId:e.keyDerivationId}),publicKey:{Hash:e.from(t.accountPublicKey.as_bytes()).toString("hex"),IsEncrypted:!1,PasswordLastUpdate:null,Type:y.a.BIP32ED25519},privateKey:null}],initialDerivations:r,hwWalletMetaInsert:{ConceptualWalletId:a.conceptualWalletRow.ConceptualWalletId,...t.hwWalletMetaInsert}})).commit(),a}}).call(this,r(48).Buffer)},840:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var a=r(66),n=r.n(a),s=r(75),o=r.n(s),i=r(6);function c(e){const t=i.a.WalletV4.TransactionMetadata.new();return o()(e).call(e,e=>{const r=i.a.WalletV4.encode_json_str_to_metadatum(n()(e.data),i.a.WalletV4.MetadataJsonSchema.BasicConversions);t.insert(i.a.WalletV4.BigNum.from_str(e.label),r)}),t}},86:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return p})),r.d(t,"e",(function(){return h})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return w}));var a=r(11),n=r.n(a),s=r(1),o=r.n(s),i=r(65),c=r(25),d=r(15);class l{static async get(e,t,r){const a=l.ownTables[i.a.name];return await Object(d.i)(e,t,r,a.name,a.properties.ConceptualWalletId)}}o()(l,"ownTables",n()({[i.a.name]:i.a})),o()(l,"depTables",n()({}));class u{static async getLastSyncInfo(e,t,r){return await Object(d.i)(e,t,r,u.ownTables[i.c.name].name,u.ownTables[i.c.name].properties.LastSyncInfoId)}}o()(u,"ownTables",n()({[i.c.name]:i.c})),o()(u,"depTables",n()({}));class p{static async getMeta(e,t,r){return await Object(d.i)(e,t,r,p.ownTables[i.b.name].name,p.ownTables[i.b.name].properties.ConceptualWalletId)}}o()(p,"ownTables",n()({[i.b.name]:i.b})),o()(p,"depTables",n()({}));class h{static async get(e,t,r){return await Object(d.i)(e,t,r,h.ownTables[i.d.name].name,h.ownTables[i.d.name].properties.PublicDeriverId)}static async forWallet(e,t,r){return await Object(d.j)(e,t,h.ownTables[i.d.name].name,h.ownTables[i.d.name].properties.ConceptualWalletId,[r])}}o()(h,"ownTables",n()({[i.d.name]:i.d})),o()(h,"depTables",n()({}));class f{static async get(e,t,r,a,n){const s=await f.depTables.GetPublicDeriver.get(e,t,r);if(void 0===s)throw new d.a("GetKeyForPublicDeriver::get GetPublicDeriver");return{...await f.depTables.GetKeyForDerivation.get(e,t,s.KeyDerivationId,a,n),PublicDeriver:s}}}o()(f,"ownTables",n()({})),o()(f,"depTables",n()({GetKeyForDerivation:c.k,GetPublicDeriver:h}));class w{static async forId(e,t,r){const a=await w.depTables.GetPublicDeriver.get(e,t,r);if(void 0===a)throw new d.a("GetLastSyncForPublicDeriver::forId pubDeriverRow");const n=await w.depTables.ReadLastSyncInfo.getLastSyncInfo(e,t,a.LastSyncInfoId);if(void 0===n)throw new d.a("GetLastSyncForPublicDeriver::forId syncInfo");return n}}o()(w,"ownTables",n()({})),o()(w,"depTables",n()({GetPublicDeriver:h,ReadLastSyncInfo:u}))},88:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var a=r(11),n=r.n(a),s=r(1),o=r.n(s),i=r(15),c=r(16);class d{static async get(e,t,r,a,n){const s=n.get(a);if(null==s)throw new Error("GetDerivationSpecific::get Unknown table queried");return await Object(i.j)(e,t,s,d.ownTables[c.h.name].properties.KeyDerivationId,r)}}o()(d,"ownTables",n()({[c.h.name]:c.h})),o()(d,"depTables",n()({}))},91:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return i}));var a=r(22),n=r(16);const s={name:"UtxoTransactionInput",properties:{UtxoTransactionInputId:"UtxoTransactionInputId",TransactionId:"TransactionId",AddressId:"AddressId",ParentTxHash:"ParentTxHash",IndexInParentTx:"IndexInParentTx",IndexInOwnTx:"IndexInOwnTx",TokenListId:"TokenListId"}},o={name:"UtxoTransactionOutput",properties:{UtxoTransactionOutputId:"UtxoTransactionOutputId",TransactionId:"TransactionId",AddressId:"AddressId",OutputIndex:"OutputIndex",TokenListId:"TokenListId",IsUnspent:"IsUnspent",ErgoBoxId:"ErgoBoxId",ErgoCreationHeight:"ErgoCreationHeight",ErgoTree:"ErgoTree",ErgoRegisters:"ErgoRegisters"}},i=e=>{e.createTable(s.name).addColumn(s.properties.UtxoTransactionInputId,a.Type.INTEGER).addColumn(s.properties.TransactionId,a.Type.INTEGER).addColumn(s.properties.AddressId,a.Type.INTEGER).addColumn(s.properties.ParentTxHash,a.Type.STRING).addColumn(s.properties.IndexInParentTx,a.Type.INTEGER).addColumn(s.properties.IndexInOwnTx,a.Type.INTEGER).addColumn(o.properties.TokenListId,a.Type.INTEGER).addPrimaryKey([s.properties.UtxoTransactionInputId],!0).addForeignKey("UtxoTransactionInput_Transaction",{local:s.properties.TransactionId,ref:`${n.m.name}.${n.m.properties.TransactionId}`,action:a.ConstraintAction.CASCADE}).addForeignKey("UtxoTransactionInput_Address",{local:s.properties.AddressId,ref:`${n.b.name}.${n.b.properties.AddressId}`}),e.createTable(o.name).addColumn(o.properties.UtxoTransactionOutputId,a.Type.INTEGER).addColumn(o.properties.TransactionId,a.Type.INTEGER).addColumn(o.properties.AddressId,a.Type.INTEGER).addColumn(o.properties.OutputIndex,a.Type.INTEGER).addColumn(o.properties.TokenListId,a.Type.INTEGER).addColumn(o.properties.IsUnspent,a.Type.BOOLEAN).addColumn(o.properties.ErgoBoxId,a.Type.STRING).addColumn(o.properties.ErgoCreationHeight,a.Type.NUMBER).addColumn(o.properties.ErgoTree,a.Type.STRING).addColumn(o.properties.ErgoRegisters,a.Type.STRING).addPrimaryKey([o.properties.UtxoTransactionOutputId],!0).addForeignKey("UtxoTransactionOutput_Transaction",{local:o.properties.TransactionId,ref:`${n.m.name}.${n.m.properties.TransactionId}`,action:a.ConstraintAction.CASCADE}).addForeignKey("UtxoTransactionOutput_Address",{local:o.properties.AddressId,ref:`${n.b.name}.${n.b.properties.AddressId}`}).addNullable([o.properties.ErgoBoxId,o.properties.ErgoCreationHeight,o.properties.ErgoTree,o.properties.ErgoRegisters])}}}]);